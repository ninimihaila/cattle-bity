!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=81)}([function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(83)),i(n(88)),i(n(24)),i(n(100)),i(n(108)),i(n(114)),i(n(119)),i(n(122)),i(n(25)),i(n(31)),i(n(128)),i(n(53)),i(n(129)),i(n(130)),i(n(131)),i(n(133)),i(n(23)),i(n(55)),i(n(57)),i(n(56)),i(n(14)),i(n(26)),i(n(51)),i(n(52)),i(n(138)),i(n(12)),i(n(139)),i(n(54)),i(n(10))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.IS_DEV=!1,e.IS_PROD=!0,e.TILE_SIZE_SMALL=16,e.TILE_SIZE_MEDIUM=32,e.TILE_SIZE_LARGE=64,e.FIELD_TILE_COUNT=13,e.FIELD_SIZE=e.FIELD_TILE_COUNT*e.TILE_SIZE_LARGE,e.BORDER_LEFT_WIDTH=64,e.BORDER_RIGHT_WIDTH=128,e.BORDER_TOP_BOTTOM_HEIGHT=32,e.BORDER_RECTS=[{x:0,y:0,width:e.BORDER_LEFT_WIDTH+e.FIELD_SIZE+e.BORDER_RIGHT_WIDTH,height:e.BORDER_TOP_BOTTOM_HEIGHT},{x:0,y:e.FIELD_SIZE+e.BORDER_TOP_BOTTOM_HEIGHT,width:e.BORDER_LEFT_WIDTH+e.FIELD_SIZE+e.BORDER_RIGHT_WIDTH,height:e.BORDER_TOP_BOTTOM_HEIGHT},{x:0,y:e.BORDER_TOP_BOTTOM_HEIGHT,width:e.BORDER_LEFT_WIDTH,height:e.FIELD_SIZE},{x:e.BORDER_LEFT_WIDTH+e.FIELD_SIZE,y:e.BORDER_TOP_BOTTOM_HEIGHT,width:e.BORDER_RIGHT_WIDTH,height:e.FIELD_SIZE}],e.CANVAS_WIDTH=e.FIELD_SIZE+e.BORDER_LEFT_WIDTH+e.BORDER_RIGHT_WIDTH,e.CANVAS_HEIGHT=e.FIELD_SIZE+2*e.BORDER_TOP_BOTTOM_HEIGHT,e.BRICK_TILE_SIZE=e.TILE_SIZE_SMALL,e.BRICK_SUPER_TILE_SIZE=e.TILE_SIZE_MEDIUM,e.STEEL_TILE_SIZE=e.TILE_SIZE_MEDIUM,e.JUNGLE_TILE_SIZE=e.TILE_SIZE_MEDIUM,e.WATER_TILE_SIZE=e.TILE_SIZE_MEDIUM,e.ICE_TILE_SIZE=e.TILE_SIZE_MEDIUM,e.BULLET_WIDTH=12,e.PLAYER_FIRST_SPAWN_DELAY=0,e.PLAYER_SPAWN_DELAY=0,e.ENEMY_FIRST_SPAWN_DELAY=.16,e.ENEMY_SPAWN_DELAY=3,e.ENEMY_MAX_TOTAL_COUNT=20,e.ENEMY_MAX_ALIVE_COUNT=4,e.POWERUP_DURATION=30,e.SHIELD_SPAWN_DURATION=3.5,e.SHIELD_POWERUP_DURATION=10,e.BASE_DEFENCE_POWERUP_DURATION=17,e.FREEZE_POWERUP_DURATION=10,e.POINTS_POWERUP_DURATION=.8,e.POINTS_ENEMY_TANK_DURATION=.16,e.LEVEL_START_DELAY=2,e.PLAYER_INITIAL_LIVES=3,e.PLAYER_EXTRA_LIVE_POINTS=2e4,e.DEFAULT_HIGHSCORE=2e4,e.COLOR_BACKDROP="rgba(0,0,0,0.7)",e.COLOR_GRAY="#636363",e.COLOR_BLACK="#000",e.COLOR_WHITE="#fff",e.COLOR_RED="#d74000",e.COLOR_YELLOW="#ffae0a",e.PRIMARY_SPRITE_FONT_ID="primary",e.PRIMARY_RECT_FONT_ID="primary",e.STORAGE_NAMESPACE="cattle-bity",e.STORAGE_KEY_POINTS_HIGHSCORE_PRIMARY="points.highscore.primary",e.STORAGE_KEY_POINTS_HIGHSCORE_SECONDARY="points.highscore.secondary",e.STORAGE_KEY_SETTINGS_INPUT_BINDINGS_PRIMARY="settings.input.bindings.primary",e.STORAGE_KEY_SETTINGS_AUDIO_MUTED="settings.audio-muted",e.STORAGE_KEY_SETTINGS_SEEN_LEVEL_HINT="settings.seen-level-hint",e.STORAGE_KEY_SETTINGS_SEEN_EDITOR_HINT="settings.seen-editor-hint",e.STORAGE_KEY_SETTINGS_SHOW_LEVEL_HINT="settings.show-level-hint",e.STORAGE_KEY_SETTINGS_SHOW_EDITOR_HINT="settings.show-editor-hint",e.PLAYER_DEFAULT_SPAWN_POSITIONS=[{x:256,y:768}],e.ENEMY_DEFAULT_SPAWN_POSITIONS=[{x:384,y:0},{x:768,y:0},{x:0,y:0}],e.BASE_DEFAULT_POSITION={x:352,y:736},e.BASE_DEFAULT_SIZE={width:128,height:96},e.MENU_TITLE_DEFAULT_POSITION={x:112,y:96},e.MENU_DEFAULT_POSITION={x:16,y:192},e.BRICK_TILE_Z_INDEX=0,e.STEEL_TILE_Z_INDEX=0,e.WATER_TILE_Z_INDEX=0,e.ICE_TILE_Z_INDEX=0,e.BORDER_WALL_Z_INDEX=0,e.BASE_HEART_Z_INDEX=0,e.LEVEL_INFO_Z_INDEX=1,e.ENEMY_TANK_Z_INDEX=1,e.PLAYER_TANK_Z_INDEX=2,e.BULLET_Z_INDEX=3,e.SHIELD_Z_INDEX=3,e.SMALL_EXPLOSION_Z_INDEX=4,e.SPAWN_Z_INDEX=4,e.JUNGLE_TILE_Z_INDEX=5,e.EDITOR_TOOL_Z_INDEX=6,e.LARGE_EXPLOSION_Z_INDEX=6,e.EDITOR_BRUSH_Z_INDEX=7,e.POWERUP_Z_INDEX=7,e.POINTS_Z_INDEX=7,e.PAUSE_NOTICE_Z_INDEX=8,e.GAME_OVER_NOTICE_Z_INDEX=8,e.CURTAIN_Z_INDEX=9,e.LEVEL_TITLE_Z_INDEX=10,e.MODAL_Z_INDEX=11,e.DEBUG_COLLISION_RECT_Z_INDEX=20,e.DEBUG_GRID_Z_INDEX=21,e.GITHUB_URL="https://github.com/dogballs/cattle-bity"},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(146)),i(n(191)),i(n(204)),i(n(210)),i(n(214)),i(n(219)),i(n(13)),i(n(228)),i(n(230)),i(n(36)),i(n(73)),i(n(231)),i(n(232)),i(n(233)),i(n(76)),i(n(234)),i(n(235)),i(n(236)),i(n(237)),i(n(238)),i(n(239)),i(n(75)),i(n(40)),i(n(240)),i(n(41)),i(n(16)),i(n(74)),i(n(241))},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(148)),i(n(149)),i(n(150)),i(n(151)),i(n(152)),i(n(153)),i(n(186))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(1),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.needsSetup=!0,e}return r(e,t),e.prototype.getRoot=function(){return this.root},e.prototype.invokeUpdate=function(t){!0===this.needsSetup&&(this.needsSetup=!1,this.root=this.createRoot(),this.root.invokeUpdate(t),this.setup(t)),this.update(t)},e.prototype.update=function(t){this.root.traverseDescedants((function(e){e.invokeUpdate(t)}))},e.prototype.createRoot=function(){var t=new o.GameObject;return t.size.set(s.CANVAS_WIDTH,s.CANVAS_HEIGHT),t.updateMatrix(),t},e}(o.Scene);e.GameScene=a},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(187)),i(n(37))},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(58)),i(n(60)),i(n(34)),i(n(181)),i(n(17)),i(n(65)),i(n(35)),i(n(182)),i(n(183)),i(n(20)),i(n(184)),i(n(59)),i(n(21)),i(n(66))},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(62)),i(n(164)),i(n(63)),i(n(11)),i(n(174)),i(n(64)),i(n(175)),i(n(176)),i(n(177))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.EditorEnemy=0]="EditorEnemy",t[t.EditorHint=1]="EditorHint",t[t.EditorMap=2]="EditorMap",t[t.EditorMenu=3]="EditorMenu",t[t.LevelHint=4]="LevelHint",t[t.LevelLoad=5]="LevelLoad",t[t.LevelPlay=6]="LevelPlay",t[t.LevelScore=7]="LevelScore",t[t.LevelSelection=8]="LevelSelection",t[t.MainAbout=9]="MainAbout",t[t.MainGameOver=10]="MainGameOver",t[t.MainHighscore=11]="MainHighscore",t[t.MainMenu=12]="MainMenu",t[t.MainVictory=13]="MainVictory",t[t.ModesMenu=14]="ModesMenu",t[t.ModesCustom=15]="ModesCustom",t[t.SettingsAudio=16]="SettingsAudio",t[t.SettingsInterface=17]="SettingsInterface",t[t.SettingsKeybinding=18]="SettingsKeybinding",t[t.SettingsMenu=19]="SettingsMenu",t[t.SandboxTransform=20]="SandboxTransform"}(e.GameSceneType||(e.GameSceneType={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.enabled=!0,this.needsSetup=!0}return t.prototype.isEnabled=function(){return this.enabled},t.prototype.enable=function(){this.enabled=!0},t.prototype.disable=function(){this.enabled=!1},t.prototype.invokeInit=function(t,e,n,i){this.world=t,this.eventBus=e,this.session=n,this.mapConfig=i,this.init()},t.prototype.invokeUpdate=function(t){!1!==this.enabled&&(!0===this.needsSetup&&(this.needsSetup=!1,this.setup(t)),this.update(t))},t.prototype.init=function(){},t.prototype.setup=function(t){},t.prototype.update=function(t){},t}();e.LevelScript=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.set=function(t,e){return this.x=t,this.y=e,this},t.prototype.setX=function(t){return this.x=t,this},t.prototype.setY=function(t){return this.y=t,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.addX=function(t){return this.x+=t,this},t.prototype.addY=function(t){return this.y+=t,this},t.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.subX=function(t){return this.x-=t,this},t.prototype.subY=function(t){return this.y-=t,this},t.prototype.divideScalar=function(t){return this.x/=t,this.y/=t,this},t.prototype.mult=function(t){return this.x*=t.x,this.y*=t.y,this},t.prototype.multScalar=function(t){return this.x*=t,this.y*=t,this},t.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},t.prototype.length=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.normalize=function(){var t=this.length()||1;return this.divideScalar(t),this},t.prototype.distanceTo=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(Math.pow(e,2)+Math.pow(n,2))},t.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.snapX=function(t){return void 0===t&&(t=1),this.x=Math.round(this.x/t)*t,this},t.prototype.snapY=function(t){return void 0===t&&(t=1),this.y=Math.round(this.y/t)*t,this},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.cross=function(t){return this.x*t.y-this.y*t.x},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t.prototype.clone=function(){return new t(this.x,this.y)},t.fromArray=function(e){return new t(e[0],e[1])},t}();e.Vector=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.Select=4]="Select",t[t.PrimaryAction=5]="PrimaryAction",t[t.SecondaryAction=6]="SecondaryAction",t[t.Rewind=7]="Rewind",t[t.FastForward=8]="FastForward"}(e.InputControl||(e.InputControl={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){var t=this;this.listeners=[],this.notify=function(e){return t.listeners.forEach((function(t){t(e)})),t}}return t.prototype.addListener=function(t){var e=this;this.listeners.push(t);return function(){e.removeListener(t)}},t.prototype.addListenerOnce=function(t){var e=this,n=function(i){e.removeListener(n),t(i)};return this.addListener(n)},t.prototype.removeListener=function(t){return this.listeners=this.listeners.filter((function(e){return e!==t})),this},t}();e.Subject=i},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(196)),i(n(197)),i(n(198)),i(n(199)),i(n(200)),i(n(201)),i(n(28)),i(n(22)),i(n(202))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(10),r=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=t,this.y=e,this.width=n,this.height=i}return t.prototype.setWidth=function(t){return this.width=t,this},t.prototype.setHeight=function(t){return this.height=t,this},t.prototype.getCenter=function(){return new i.Vector(this.x+this.width/2,this.y+this.height/2)},t.prototype.intersectsRect=function(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y},t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.toString=function(){return"[x: "+this.x+", y: "+this.y+", width: "+this.width+", height: "+this.height+"]"},t}();e.Rect=r},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(145)),i(n(242)),i(n(77))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroyed=new o.Subject,e}return r(e,t),e.prototype.destroy=function(){this.removeSelf(),this.destroyed.notify({centerPosition:this.getCenter()})},e}(o.GameObject);e.TerrainTile=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.setup=function(t,e){},t}();e.TankBehavior=i},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(140)),i(n(78)),i(n(243)),i(n(19))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),r={top:0,left:null,right:0},o=function(){function t(t,e){void 0===t&&(t="Untitled"),void 0===e&&(e={}),this.options=Object.assign({},r,e),this.container=document.createElement("div"),this.container.setAttribute("style","background: white;\n      position: absolute;\n      left: "+this.getOffsetStyle(this.options.left)+";\n      right: "+this.getOffsetStyle(this.options.right)+";\n      top: "+this.getOffsetStyle(this.options.top)+";\n      padding: 10px;\n      display: flex;\n      flex-direction: column");var n=document.createElement("div");n.textContent=t,this.container.appendChild(n)}return t.prototype.attach=function(){i.IS_PROD||document.body.appendChild(this.container)},t.prototype.detach=function(){document.body.removeChild(this.container)},t.prototype.appendButton=function(t,e){var n=this.createButton(t,e);return this.container.appendChild(n),n},t.prototype.createButton=function(t,e){var n=document.createElement("button");return n.textContent=t,n.addEventListener("click",e),n},t.prototype.getOffsetStyle=function(t){return null===t?"initial":t+"px"},t}();e.DebugMenu=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.Player="player",t.Enemy="enemy"}(e.TankParty||(e.TankParty={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.A="a",t.B="b",t.C="c",t.D="d"}(e.TankTier||(e.TankTier={}))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(5),a=n(1),l=function(t){function e(e,n,i){void 0===e&&(e=""),void 0===i&&(i={});var r=t.call(this)||this;return r.text=new o.Text(e,i),r.terrainType=n,r}return r(e,t),e.prototype.setup=function(t){var e=t.rectFontLoader.load(a.PRIMARY_RECT_FONT_ID);this.text.setFont(e),this.size.copyFrom(this.text.getSize());var n=this.text.build(),i=s.TerrainFactory.createFromRegions(this.terrainType,o.ArrayUtils.flatten(n));this.add.apply(this,i)},e}(o.GameObject);e.TerrainText=l},function(t,e,n){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Debug=1]="Debug",t[t.Info=2]="Info",t[t.Warn=3]="Warn",t[t.Error=4]="Error",t[t.None=5]="None"}(i=e.LogLevel||(e.LogLevel={}));var r=function(){function t(t,e){var n=this;void 0===t&&(t=""),void 0===e&&(e=i.Error),this.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];n.level>i.Warn||console.warn.apply(console,n.composeArgs.apply(n,t))},this.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];n.level>i.Error||console.error.apply(console,n.composeArgs.apply(n,t))},this.time=function(t){console.time(n.tag+" "+t)},this.timeEnd=function(t){console.timeEnd(n.tag+" "+t)},this.tag=t?"["+t+"]":"",this.level=e}return t.prototype.setLevel=function(t){return this.level=t,this},t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.level>i.Debug||console.log.apply(console,this.composeArgs.apply(this,t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.level>i.Info||console.log.apply(console,this.composeArgs.apply(this,t))},t.prototype.composeArgs=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=[];if("string"==typeof t){var r=this.tag+" "+t;i.push(r)}else i.push(this.tag,t);return i.push.apply(i,e),i},t.Level=i,t}();e.Logger=r},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(47)),i(n(94)),i(n(30)),i(n(99))},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(48)),i(n(98))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(10),r=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.width=t,this.height=e}return t.prototype.set=function(t,e){return this.width=t,this.height=e,this},t.prototype.setWidth=function(t){return this.width=t,this},t.prototype.setHeight=function(t){return this.height=t,this},t.prototype.copyFrom=function(t){return this.width=t.width,this.height=t.height,this},t.prototype.flip=function(){var t=this.width;return this.width=this.height,this.height=t,this},t.prototype.clone=function(){return new t(this.width,this.height)},t.prototype.toVector=function(){return new i.Vector(this.width,this.height)},t}();e.Size=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){};e.Painter=i},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(1),a={color:null,letterSpacing:4,lineSpacing:16,opacity:1},l=function(t){function e(e,n){void 0===e&&(e=""),void 0===n&&(n={});var i=t.call(this)||this;return i.painter=new o.SpriteTextPainter,i.colorSpriteFontGenerator=null,i.options=Object.assign({},a,n),i.painter.color=i.options.color,i.painter.opacity=i.options.opacity,i.text=new o.Text(e,i.options),i}return r(e,t),e.prototype.setup=function(t){var e=t.colorSpriteFontGenerator;this.colorSpriteFontGenerator=e;var n=this.colorSpriteFontGenerator.get(s.PRIMARY_SPRITE_FONT_ID,this.painter.color);this.text.setFont(n),this.size.copyFrom(this.text.getSize()),this.painter.text=this.text,this.setNeedsPaint()},e.prototype.setColor=function(t){if(null!==this.colorSpriteFontGenerator){var e=this.colorSpriteFontGenerator.get(s.PRIMARY_SPRITE_FONT_ID,t);this.text.setFont(e),this.painter.color=t}else this.painter.color=t},e.prototype.setText=function(t){this.dirtyPaintBox(),this.text.setText(t),this.size.copyFrom(this.text.getSize()),this.updateMatrix()},e.prototype.getTextSize=function(){return this.text.getSize()},e}(o.GameObject);e.SpriteText=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(12),r=function(){function t(t,e){void 0===e&&(e=!1),this.unregisterRequested=new i.Subject,this.object=t,this.dynamic=e}return t.prototype.unregister=function(){this.unregisterRequested.notify(null)},t}();e.Collider=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(12),r=function(){this.loaded=new i.Subject};e.ImageSource=r},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(124)),i(n(125)),i(n(126)),i(n(127))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){this.canvas=t};e.RenderContext=i},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(155)),i(n(156)),i(n(185))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(59),r=function(){function t(t,e,n,r,o){void 0===o&&(o=1),this.sprites=n.map((function(n){var s=i.TankSpriteId.create(e,n,r,o);return t.load(s)}))}return t.prototype.getSprite=function(t){var e=this.sprites[t];return void 0===e?null:e},t}();e.TankAnimationFrame=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.Default="default",t.Primary="primary",t.Secondary="secondary",t.Danger="danger"}(e.TankColor||(e.TankColor={}))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(1),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.collider=new o.BoxCollider(e),e.painter=new o.RectPainter(a.COLOR_GRAY),e.tags=[s.Tag.Wall,s.Tag.Border,s.Tag.BlockMove],e.zIndex=a.BORDER_WALL_Z_INDEX,e}return r(e,t),e.prototype.setup=function(t){t.collisionSystem.register(this.collider)},e.prototype.update=function(){this.collider.update()},e}(o.GameObject);e.BorderWall=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.Brick="brick",t.BrickSuper="brick-super",t.Steel="steel",t.Jungle="jungle",t.Water="water",t.Ice="ice",t.MenuBrick="menu-brick",t.InverseBrick="inverse-brick",t.BlueBrick="blue-brick"}(e.TerrainType||(e.TerrainType={}))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.focused=new o.Subject,e.unfocused=new o.Subject,e.selected=new o.Subject,e.focusable=!0,e.isFocused=!1,e}return r(e,t),e.prototype.updateFocused=function(t){},e.prototype.setFocusable=function(t){this.focusable=t,this.setNeedsPaint()},e.prototype.isFocusable=function(){return this.focusable},e.prototype.focus=function(){this.isFocused=!0,this.focused.notify(null)},e.prototype.unfocus=function(){this.isFocused=!1,this.unfocused.notify(null)},e.prototype.select=function(){this.selected.notify(null)},e}(o.GameObject);e.MenuItem=s},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(5),l=n(1),c=function(t){function e(){var e=t.call(this,l.BRICK_TILE_SIZE,l.BRICK_TILE_SIZE)||this;return e.type=a.TerrainType.Brick,e.collider=new o.BoxCollider(e),e.zIndex=l.BRICK_TILE_Z_INDEX,e.tags=[s.Tag.Wall,s.Tag.Brick],e.painter=new o.SpritePainter,e}return r(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),this.collider.unregister()},e.prototype.setup=function(t){var e=t.collisionSystem,n=t.spriteLoader;e.register(this.collider),this.sprites=n.loadList(this.getSpriteIds()),this.painter.sprite=this.getSpriteByPosition()},e.prototype.update=function(){this.collider.update()},e.prototype.getSpriteIds=function(){return["terrain.brick.1","terrain.brick.2"]},e.prototype.getSpriteByPosition=function(){var t=(Math.floor(this.position.x/l.BRICK_TILE_SIZE)%2+Math.floor(this.position.y/l.BRICK_TILE_SIZE)%2)%2;return this.sprites[t]},e}(n(16).TerrainTile);e.BrickTerrainTile=c},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(1),a=function(t){function e(){var e=t.call(this,64,64)||this;return e.zIndex=s.SMALL_EXPLOSION_Z_INDEX,e.painter=new o.SpritePainter,e.done=new o.Subject,e.painter.alignment=o.SpriteAlignment.MiddleCenter,e}return r(e,t),e.prototype.setup=function(t){var e=t.spriteLoader;this.animation=new o.Animation(e.loadList(["explosion.small.1","explosion.small.2","explosion.small.3"]),{delay:.05,loop:!1})},e.prototype.update=function(t){if(this.animation.isComplete())return this.dirtyPaintBox(),this.removeSelf(),void this.done.notify(null);this.animation.update(t.deltaTime),this.painter.sprite=this.animation.getCurrentFrame(),this.setNeedsPaint()},e}(o.GameObject);e.SmallExplosion=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o,s,a,l,c=n(0),u=n(3),p=n(6),h=n(1),d=n(73),f=n(75);!function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Idle=1]="Idle",t[t.Moving=2]="Moving"}(o=e.TankState||(e.TankState={})),function(t){t[t.WaitUpdate=0]="WaitUpdate",t[t.WaitCollide=1]="WaitCollide",t[t.NotColliding=2]="NotColliding",t[t.Resolved=3]="Resolved"}(s||(s={})),function(t){t[t.NotColliding=0]="NotColliding",t[t.Colliding=1]="Colliding",t[t.WaitCollide=2]="WaitCollide"}(a||(a={})),function(t){t[t.Unknown=0]="Unknown",t[t.Self=1]="Self",t[t.Both=2]="Both"}(l||(l={}));var y=[{opacity:1},{opacity:.5}],m=h.TILE_SIZE_MEDIUM,g=function(t){function e(e,n){var i=t.call(this,64,64)||this;return i.collider=new c.SweptBoxCollider(i,!0),i.tags=[u.Tag.Tank],i.bullets=[],i.shield=null,i.fired=new c.Subject,i.died=new c.Subject,i.hit=new c.Subject,i.slided=new c.Subject,i.state=o.Uninitialized,i.freezeState=new c.State(!1),i.isOnIce=!1,i.shieldTimer=new c.Timer,i.skinLayers=[],i.lastFireTimer=new c.Timer,i.slideTimer=new c.Timer,i.spawnCollisionState=new c.State(s.WaitUpdate),i.playerCollisionState=new c.State(a.NotColliding),i.tankCollisionResolution=l.Unknown,i.isCollisionAbusedByPlayer=!1,i.handleShieldTimer=function(){i.shield.removeSelf(),i.shield=null},i.pivot.set(.5,.5),i.type=e,i.behavior=n,i.attributes=p.TankAttributesFactory.create(i.type),i.shieldTimer.done.addListener(i.handleShieldTimer),i}return r(e,t),e.prototype.setup=function(t){var e=this,n=t.collisionSystem;this.collisionSystem=n,n.register(this.collider),this.behavior.setup(this,t),y.forEach((function(){var t=new c.GameObject;t.size.copyFrom(e.size);var n=new c.SpritePainter;n.alignment=c.SpriteAlignment.MiddleCenter,t.painter=n,e.skinLayers.push(t),e.add(t)}))},e.prototype.update=function(t){var e=t.deltaTime,n=t.gameState;this.spawnCollisionState.is(s.WaitCollide)?this.enablePostSpawnCollision():this.spawnCollisionState.is(s.WaitUpdate)&&this.spawnCollisionState.set(s.WaitCollide),this.playerCollisionState.is(a.WaitCollide)?this.playerCollisionState.set(a.NotColliding):this.playerCollisionState.is(a.Colliding)&&this.playerCollisionState.set(a.WaitCollide),this.shieldTimer.update(e),(this.freezeState.hasChangedTo(!0)||n.hasChangedTo(u.GameState.Paused))&&this.idle(),this.freezeState.is(!0)||n.is(u.GameState.Paused)?this.updateAnimation(e):(this.dirtyPaintBox(),this.isSliding()&&(this.isOnIce?(this.slideTimer.update(e),this.slideTimer.isDone()?this.idle(!1):this.move(e)):(this.slideTimer.stop(),this.idle(!1))),this.behavior.update(this,t),this.lastFireTimer.update(e),this.updateAnimation(e),this.collider.update(),this.isOnIce=!1,this.tankCollisionResolution=l.Unknown)},e.prototype.updateAnimation=function(t){this.skinAnimation.update(this,t);var e=this.skinAnimation.getCurrentFrame();this.skinLayers.forEach((function(t,n){var i=y[n],r=t.painter,o=e.getSprite(n);r.opacity=i.opacity,r.sprite=o}))},e.prototype.collide=function(t){this.collideIce(t),this.collideSpawnedTanks(t),this.collideWalls(t),this.collideTanks(t),this.collideBullets(t)},e.prototype.fire=function(){var t=this;if(!(this.bullets.length>=this.attributes.bulletMaxCount||this.lastFireTimer.isActive())){var e=new d.Bullet(this.attributes.bulletSpeed,this.attributes.bulletTankDamage,this.attributes.bulletWallDamage);return this.updateWorldMatrix(!0),this.add(e),e.updateMatrix(),e.setCenter(this.getSelfCenter()),e.translateY(this.size.height/2-e.size.height/2),e.updateMatrix(),this.parent.attach(e),this.tags.includes(u.Tag.Player)?e.tags.push(u.Tag.Player):this.tags.includes(u.Tag.Enemy)&&e.tags.push(u.Tag.Enemy),this.bullets.push(e),e.died.addListener((function(){t.bullets=t.bullets.filter((function(t){return t!==e}))})),this.fired.notify(null),this.lastFireTimer.reset(this.attributes.bulletRapidFireDelay),!0}},e.prototype.move=function(t){this.state!==o.Moving&&(this.state=o.Moving),this.translateY(this.attributes.moveSpeed*t),this.updateMatrix(!0)},e.prototype.idle=function(t){void 0===t&&(t=!0),this.state!==o.Idle&&(this.state=o.Idle),t&&this.tags.includes(u.Tag.Player)&&this.isOnIce&&!this.isSliding()&&(this.slided.notify(null),this.slideTimer.reset(.5))},e.prototype.rotate=function(e){return e!==this.rotation&&(e===u.Rotation.Up||e===u.Rotation.Down?this.position.snapX(m):e!==u.Rotation.Left&&e!==u.Rotation.Right||this.position.snapY(m)),t.prototype.rotate.call(this,e),this},e.prototype.die=function(t){void 0===t&&(t=p.TankDeathReason.Bullet),this.died.notify({reason:t}),this.collider.unregister()},e.prototype.activateShield=function(t){null!==this.shield&&(this.shield.removeSelf(),this.shieldTimer.stop(),this.shield=null),this.shield=new f.Shield,this.shield.updateMatrix(),this.shield.setCenter(this.getSelfCenter()),this.add(this.shield),this.shieldTimer.reset(t)},e.prototype.isAlive=function(){return this.attributes.health>0},e.prototype.receiveHit=function(t){this.attributes.health=Math.max(0,this.attributes.health-t),this.hit.notify(null),this.isAlive()||this.die()},e.prototype.isSliding=function(){return this.slideTimer.isActive()},e.prototype.collideIce=function(t){if(!this.tags.includes(u.Tag.Enemy)){var e=t.contacts.filter((function(t){return t.collider.object.tags.includes(u.Tag.Ice)}));if(0!==e.length){for(var n=this.getWorldBoundingBox().getCenter(),i=new c.BoundingBox,r=0,o=e;r<o.length;r++){var s=o[r];i.unionWith(s.box)}var a=i.containsPoint(n);this.isOnIce=a}}},e.prototype.collideSpawnedTanks=function(t){this.spawnCollisionState.is(s.WaitCollide)&&(t.contacts.filter((function(t){return t.collider.object.tags.includes(u.Tag.Tank)})).length>0?this.spawnCollisionState.set(s.WaitUpdate):this.enablePostSpawnCollision())},e.prototype.collideWalls=function(t){for(var e=[],n=0,i=t.contacts;n<i.length;n++){var r=i[n],o=r.collider.object.tags;o.includes(u.Tag.BlockMove)&&!o.includes(u.Tag.Tank)&&e.push(r)}if(0!==e.length){var s=this.getClosestContacts(e,this.collider.getPrevBox());if(0!==s.length){var a=s[0].collider.getCurrentBox();this.resolveMinkowski(a,!0)}}},e.prototype.resolveMinkowski=function(t,e){void 0===e&&(e=!1);var n=this.collider.getCurrentBox(),i=this.collider.getPrevBox().getCenter(),r=t.clone().minkowskiSum(n),o=r.toRect(),s=r.getCenter(),a=new c.Vector(i.x-s.x,i.y-s.y),l=new c.Vector(o.width/2,o.height/2),u=new c.Vector(o.width/2,-o.height/2),p=a.cross(l),h=a.cross(u),d=p>0&&h>0,f=p>0&&h<0,y=p<0&&h>0;p<0&&h<0?(this.position.subY(n.min.y-t.max.y),e&&this.position.snapY(m)):d?(this.position.subY(n.max.y-t.min.y),e&&this.position.snapY(m)):f?(this.position.subX(n.min.x-t.max.x),e&&this.position.snapX(m)):y&&(this.position.subX(n.max.x-t.min.x),e&&this.position.snapX(m)),this.updateMatrix(!0),this.collider.update()},e.prototype.collideTanks=function(t){var e=this;if(this.tags.includes(u.Tag.BlockMove)){for(var n=[],i=[],r=[],o=0,s=t.contacts;o<s.length;o++){var c=s[o],p=c.collider.object.tags;p.includes(u.Tag.BlockMove)&&p.includes(u.Tag.Tank)&&n.push(c),p.includes(u.Tag.BlockMove)&&!p.includes(u.Tag.Tank)&&r.push(c),p.includes(u.Tag.Tank)&&p.includes(u.Tag.Player)&&i.push(c)}if(this.playerCollisionState.is(a.WaitCollide)&&(i.length>0?this.playerCollisionState.set(a.Colliding):this.playerCollisionState.set(a.NotColliding)),0!==n.length){var d=this.getClosestContacts(n,this.collider.getPrevBox())[0].collider,f=d.object;if(f.tankCollisionResolution!==l.Self){var y=this.collider.getCurrentBox(),m=this.collider.getPrevBox(),g=!y.equals(m),v=d.getPrevBox(),_=d.getCurrentBox(),b=!_.equals(v);if((b||g)&&(!b||g)){var w=this.collider.getDirection().normalize(),S=d.getDirection().normalize();if(!b&&g){if(this.tags.includes(u.Tag.Enemy)&&f.tags.includes(u.Tag.Player)){if(this.playerCollisionState.is(a.Colliding))return;var T=this.position.clone().round(),O=(1===w.x||-1===w.x)&&T.y%h.TILE_SIZE_MEDIUM==0,x=(1===w.y||-1===w.y)&&T.x%h.TILE_SIZE_MEDIUM==0,P=y.clone().intersectWith(_).toRect(),I=(this.size.width-h.BULLET_WIDTH)/2,E=(this.size.height-h.BULLET_WIDTH)/2;if(x&&P.width<=I)return void this.playerCollisionState.set(a.Colliding);if(O&&P.height<=E)return void this.playerCollisionState.set(a.Colliding)}return this.resolveMinkowski(v),void(this.tankCollisionResolution=l.Self)}if(!(this.tags.includes(u.Tag.Player)&&f.tags.includes(u.Tag.Enemy)&&(f.playerCollisionState.is(a.Colliding)||f.playerCollisionState.is(a.WaitCollide))||this.tags.includes(u.Tag.Enemy)&&f.tags.includes(u.Tag.Player)&&(this.playerCollisionState.is(a.Colliding)||f.playerCollisionState.is(a.WaitCollide))))if(f.tankCollisionResolution!==l.Both){var L=r.length>0,C=y.getCenter(),M=_.getCenter(),R=M.clone().sub(C).normalize(),k=C.clone().sub(M).normalize(),A=w.dot(R),j=S.dot(k),D=A>0,B=j>0;if(A>0&&j>0&&(A===j?(D=!0,B=!0):(D=A>j,B=j>A)),L&&(D=!1,B=!0),D&&!B)return this.resolveMinkowski(v),void(this.tankCollisionResolution=l.Self);if(D||!B){if(D&&B)return this.resolveByRollback(this.collider.getDirection()),void(this.tankCollisionResolution=l.Both);var N=this.collisionSystem.getCollisionByCollider(f.collider),F=t.contacts.filter((function(t){return t.collider!==f.collider}));return N.contacts.filter((function(t){return t.collider!==e.collider})).length>0&&0===F.length?(this.resolveMinkowski(v),void(this.tankCollisionResolution=l.Self)):void 0}}else this.resolveMinkowski(_)}}}}},e.prototype.collideBullets=function(t){var e=this,n=t.contacts.filter((function(t){return t.collider.object.tags.includes(u.Tag.Bullet)}));0!==n.length&&n.forEach((function(t){var n=t.collider.object;e.bullets.includes(n)||(null===e.shield?n.tags.includes(u.Tag.Enemy)&&e.tags.includes(u.Tag.Enemy)||(n.explode(),e.receiveHit(n.tankDamage)):n.nullify())}))},e.prototype.resolveByRollback=function(t){this.position.sub(t),this.updateMatrix(!0),this.collider.update()},e.prototype.getClosestContacts=function(t,e){for(var n=null,i=0,r=t;i<r.length;i++){var o=r[i],s=e.distanceCenterToCenter(o.box);(null===n||s<n)&&(n=s)}for(var a=[],l=0,c=t;l<c.length;l++){o=c[l];(s=e.distanceCenterToCenter(o.box))===n&&a.push(o)}return a},e.prototype.enablePostSpawnCollision=function(){this.spawnCollisionState.set(s.Resolved),this.tags.push(u.Tag.BlockMove)},e.prototype.getDirection=function(){return this.rotation===u.Rotation.Up?new c.Vector(0,-1):this.rotation===u.Rotation.Down?new c.Vector(0,1):this.rotation===u.Rotation.Left?new c.Vector(-1,0):this.rotation===u.Rotation.Right?new c.Vector(1,0):void 0},e.prototype.resolveBasedOnDirection=function(t,e,n){void 0===n&&(n=!1);var i=this.collider.getDirection().normalize();i.y<0?(this.position.subY(Math.max(0,t.min.y-e.max.y)),n&&this.position.snapY(m)):i.y>0?(this.position.subY(Math.max(0,t.max.y-e.min.y)),n&&this.position.snapY(m)):i.x<0?(this.position.subX(Math.max(0,t.min.x-e.max.x)),n&&this.position.snapX(m)):i.x>0&&(this.position.subX(Math.max(0,t.max.x-e.min.x)),n&&this.position.snapX(m)),this.updateMatrix(!0),this.collider.update()},e.prototype.resolveBasedOnRotation=function(t,e,n){void 0===n&&(n=!1);var i=this.getWorldRotation();i==u.Rotation.Up?(this.position.addY(e.max.y-t.min.y),n&&this.position.snapY(m)):i===u.Rotation.Down?(this.position.addY(e.min.y-t.max.y),n&&this.position.snapY(m)):i===u.Rotation.Left?(this.position.addX(e.max.x-t.min.x),n&&this.position.snapX(m)):i===u.Rotation.Right&&(this.position.addX(e.min.x-t.max.x),n&&this.position.snapX(m)),this.updateMatrix(!0),this.collider.update()},e}(c.GameObject);e.Tank=g},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(244)),i(n(43)),i(n(79)),i(n(250))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=n(6),o=n(5),s=n(1),a=n(246),l={pretty:!0},c=function(){function t(){this.dto=this.fillAndValidate({})}return t.prototype.getDto=function(){return this.dto},t.prototype.fromDto=function(t){this.dto=this.fillAndValidate(t)},t.prototype.fillAndValidate=function(t){var e=a.MapDtoSchema.validate(t),n=e.value,i=e.error;if(void 0!==i)throw i;var r=o.TerrainFactory.validateRegionConfigs(n.terrain.regions);if(void 0!==r)throw r;return n},t.prototype.addTerrainRegion=function(t){this.dto.terrain.regions.push(t)},t.prototype.clearTerrainRect=function(t){for(var e=this.dto.terrain.regions,n=e.length-1;n>=0;n-=1){var r=e[n];new i.Rect(r.x,r.y,r.width,r.height).intersectsRect(t)&&e.splice(n,1)}},t.prototype.getTerrainRegions=function(){return this.dto.terrain.regions},t.prototype.getPlayerSpawnPosition=function(t){var e=this.dto.spawn.player.locations,n=s.PLAYER_DEFAULT_SPAWN_POSITIONS[t];return void 0!==e[t]&&(n=e[t]),new i.Vector(n.x,n.y)},t.prototype.getEnemySpawnPositions=function(){var t=this.dto.spawn.enemy.locations,e=s.ENEMY_DEFAULT_SPAWN_POSITIONS;return t.length>0&&(e=t),e.map((function(t){return new i.Vector(t.x,t.y)}))},t.prototype.getEnemySpawnList=function(){return this.dto.spawn.enemy.list.map((function(t){return new r.TankType(r.TankParty.Enemy,t.tier,t.drop)}))},t.prototype.isEnemySpawnListEmpty=function(){return 0===this.dto.spawn.enemy.list.length},t.prototype.fillEnemySpawnList=function(t){for(var e=0;e<s.ENEMY_MAX_TOTAL_COUNT;e+=1)this.dto.spawn.enemy.list[e]={tier:t.tier,drop:t.hasDrop}},t.prototype.setEnemySpawnListItem=function(t,e){this.dto.spawn.enemy.list[t]={tier:e.tier,drop:e.hasDrop}},t.prototype.toJSON=function(t){return void 0===t&&(t={}),Object.assign({},l,t).pretty?JSON.stringify(this.dto,null,2):JSON.stringify(this.dto)},t.prototype.fromJSON=function(t){var e=JSON.parse(t);this.dto=this.fillAndValidate(e)},t}();e.MapConfig=c},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=function(){this.loaded=new i.Subject,this.error=new i.Subject};e.MapListReader=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){this.contacts=[],this.collider=t,this.box=e}return t.prototype.addContact=function(t){this.contacts.push(t)},t}();e.Collision=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t,e){this.collider=t,this.box=e};e.CollisionContact=i},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(92)),i(n(93))},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(95)),i(n(96)),i(n(97))},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(104)),i(n(105)),i(n(106))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.default=new Map,this.custom=new Map}return t.prototype.setDefault=function(t,e){this.default.set(t,e)},t.prototype.setCustom=function(t,e){this.custom.set(t,e)},t.prototype.get=function(t){return this.custom.has(t)?this.custom.get(t):this.default.get(t)},t.prototype.getControl=function(t){var e=null;return this.custom.forEach((function(n,i){null!==e||n!==t||(e=i)})),null===e&&this.default.forEach((function(n,i){null!==e||n!==t||(e=i)})),e},t.prototype.resetAllToDefault=function(){this.custom.clear()},t.prototype.toJSON=function(){var t=[];return this.custom.forEach((function(e,n){t.push([n,e])})),JSON.stringify(t)},t.prototype.fromJSON=function(t){var e=this,n=[];try{n=JSON.parse(t)}catch(t){}Array.isArray(n)&&n.forEach((function(t){if(Array.isArray(t)){var n=t[0],i=t[1];e.custom.set(n,i)}}))},t}();e.InputBinding=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(12),r=function(){function t(t){var e=this;this.ended=new i.Subject,this.loaded=new i.Subject,this.localMuted=!1,this.globalMuted=!1,this.handleLoaded=function(){e.loaded.notify(null),e.audioElement.removeEventListener("loadeddata",e.handleLoaded)},this.handleEnded=function(){e.ended.notify(null)},this.audioElement=t,this.audioElement.addEventListener("loadeddata",this.handleLoaded),this.audioElement.addEventListener("ended",this.handleEnded)}return t.prototype.isLoaded=function(){return 4===this.audioElement.readyState},t.prototype.play=function(){this.stop(),this.audioElement.loop=!1,this.audioElement.play()},t.prototype.playLoop=function(){this.stop(),this.audioElement.loop=!0,this.audioElement.play()},t.prototype.resume=function(){this.audioElement.play()},t.prototype.pause=function(){this.audioElement.pause()},t.prototype.stop=function(){this.audioElement.pause(),this.audioElement.currentTime=0},t.prototype.canResume=function(){return this.audioElement.paused&&!this.audioElement.ended&&this.audioElement.currentTime>0},t.prototype.setMuted=function(t){this.localMuted=t,this.updateElementMuted()},t.prototype.isMuted=function(){return this.localMuted},t.prototype.setGlobalMuted=function(t){this.globalMuted=t,this.updateElementMuted()},t.prototype.isGlobalMuted=function(){return this.globalMuted},t.prototype.updateElementMuted=function(){this.audioElement.muted=this.globalMuted||this.localMuted},t}();e.Sound=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Stretch=0]="Stretch",t[t.MiddleCenter=1]="MiddleCenter",t[t.MiddleLeft=2]="MiddleLeft",t[t.TopLeft=3]="TopLeft"}(e.SpriteAlignment||(e.SpriteAlignment={}))},function(t,e,n){"use strict";var i=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,r++)i[r]=o[s];return i};Object.defineProperty(e,"__esModule",{value:!0});var r=n(14),o=n(26),s=n(10),a=function(){function t(t,e){void 0===t&&(t=new s.Vector),void 0===e&&(e=new s.Vector),this.min=t,this.max=e}return t.prototype.getCenter=function(){return this.min.clone().add(this.max).divideScalar(2)},t.prototype.getSize=function(){var t=this.max.x-this.min.x,e=this.max.y-this.min.y;return new o.Size(t,e)},t.prototype.round=function(){return this.min.round(),this.max.round(),this},t.prototype.equals=function(t){return this.min.equals(t.min)&&this.max.equals(t.max)},t.prototype.distanceCenterToCenter=function(t){return this.getCenter().distanceTo(t.getCenter())},t.prototype.minkowskiSum=function(t){var e=t.max.x-t.min.x,n=t.max.y-t.min.y,i=this.min.x-e/2,r=this.max.x+e/2,o=this.min.y-n/2,s=this.max.y+n/2;return this.min.set(i,o),this.max.set(r,s),this},t.prototype.intersectWith=function(t){var e=Math.max(this.min.x,t.min.x),n=Math.min(this.max.x,t.max.x),i=Math.max(this.min.y,t.min.y),r=Math.min(this.max.y,t.max.y);return this.min.set(e,i),this.max.set(n,r),this},t.prototype.unionWith=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=i([this],t),r=null,o=null,s=null,a=null,l=0,c=n;l<c.length;l++){var u=c[l];(null===r||u.min.x<r)&&(r=u.min.x),(null===o||u.max.x>o)&&(o=u.max.x),(null===s||u.min.y<s)&&(s=u.min.y),(null===a||u.max.y>a)&&(a=u.max.y)}return this.min.set(r,s),this.max.set(o,a),this},t.prototype.intersectsBox=function(t){return this.min.x<t.max.x&&this.max.x>t.min.x&&this.min.y<t.max.y&&this.max.y>t.min.y},t.prototype.containsPoint=function(t){return!(this.max.x<=t.x||this.min.x>=t.x||this.max.y<=t.y||this.min.y>=t.y)},t.prototype.clone=function(){return new t(this.min.clone(),this.max.clone())},t.prototype.toRect=function(){return new r.Rect(this.min.x,this.min.y,this.max.x-this.min.x,this.max.y-this.min.y)},t.prototype.fromPoints=function(t){if(0===t.length)return this;this.min.copyFrom(t[0]),this.max.copyFrom(t[0]);for(var e=0,n=t;e<n.length;e++){var i=n[e];i.x<this.min.x&&(this.min.x=i.x),i.x>this.max.x&&(this.max.x=i.x),i.y<this.min.y&&(this.min.y=i.y),i.y>this.max.y&&(this.max.y=i.y)}return this},t}();e.BoundingBox=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(53),s=n(55),a=n(56),l=n(26),c=n(10),u=n(31),p=new c.Vector(1,0),h=new c.Vector(0,-1),d=function(t){function e(e,n){void 0===e&&(e=0),void 0===n&&(n=0);var i=t.call(this)||this;return i.size=new l.Size,i.position=new c.Vector(0,0),i.origin=new c.Vector(0,0),i.rotation=0,i.pivot=new c.Vector(0,0),i.matrix=new s.Matrix3,i.worldMatrix=new s.Matrix3,i.boundingBox=new o.BoundingBox,i.worldBoundingBox=new o.BoundingBox,i.matrixAutoUpdate=!1,i.worldMatrixNeedsUpdate=!1,i.size=new l.Size(e,n),i}return r(e,t),e.prototype.rotate=function(t){this.rotation=t},e.prototype.attach=function(t){this.updateWorldMatrix(!0);var e=this.worldMatrix.clone().invert();return null!==t.parent&&(t.parent.updateWorldMatrix(!0),e.premultiply(t.parent.worldMatrix)),t.updateMatrix(),t.applyMatrix3(e),this.add(t),this},e.prototype.applyMatrix3=function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.multiply(t);var e=this.decomposeTransformMatrix(this.matrix,this.getPivotOffset(),this.getOriginOffset()),n=e.rotation,i=e.position;this.rotation=n,this.position=i},e.prototype.translateX=function(t){return this.translateOnAxis(p,t),this},e.prototype.translateY=function(t){return this.translateOnAxis(h,t),this},e.prototype.translateOnAxis=function(t,e){var n=s.Matrix3.createRotation(this.rotation).applyToVector(t.clone()).multScalar(e);return this.position.add(n),this},e.prototype.getWorldPosition=function(){return this.decomposeTransformMatrix(this.worldMatrix,this.getPivotOffset(),this.getOriginOffset()).position},e.prototype.getWorldRotation=function(){return this.decomposeTransformMatrix(this.worldMatrix,this.getPivotOffset(),this.getOriginOffset()).rotation},e.prototype.getCenter=function(){return this.getBoundingBox().getCenter()},e.prototype.setCenter=function(t){var e=this.getBoundingBox().getSize();this.position.set(t.x-e.width/2,t.y-e.height/2)},e.prototype.setCenterX=function(t){var e=this.getBoundingBox().getSize();this.position.setX(t-e.width/2)},e.prototype.setCenterY=function(t){var e=this.getBoundingBox().getSize();this.position.setY(t-e.height/2)},e.prototype.getSelfCenter=function(){return this.size.toVector().divideScalar(2)},e.prototype.getBoundingBox=function(){return this.matrixAutoUpdate&&this.updateMatrix(),this.boundingBox},e.prototype.getWorldBoundingBox=function(){return this.updateWorldMatrix(!0),this.worldBoundingBox},e.prototype.getSelfPoints=function(){var t=this.size,e=t.width,n=t.height;return[new c.Vector(0,0),new c.Vector(e,0),new c.Vector(e,n),new c.Vector(0,n)]},e.prototype.getPoints=function(){var t=this;return this.getSelfPoints().map((function(e){return t.matrix.applyToVector(e)}))},e.prototype.getWorldPoints=function(){var t=this;return this.getSelfPoints().map((function(e){return t.worldMatrix.applyToVector(e)}))},e.prototype.updateMatrix=function(t){void 0===t&&(t=!1);var e=this.composeTransformMatrix(this.getPivotOffset(),this.getOriginOffset(),this.rotation,this.position);this.matrix.copyFrom(e),this.boundingBox.fromPoints(this.getPoints()),this.setWorldMatrixNeedsUpdate(t)},e.prototype.setWorldMatrixNeedsUpdate=function(t){if(void 0===t&&(t=!1),this.worldMatrixNeedsUpdate=!0,t)for(var e=0,n=this.children;e<n.length;e++){n[e].setWorldMatrixNeedsUpdate(t)}},e.prototype.updateWorldMatrix=function(t,e){if(void 0===t&&(t=!1),void 0===e&&(e=!1),!0===t&&null!==this.parent&&this.parent.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.worldMatrixNeedsUpdate&&(null===this.parent?this.worldMatrix.copyFrom(this.matrix):this.worldMatrix.multiplyMatrices(this.matrix,this.parent.worldMatrix),this.worldBoundingBox.fromPoints(this.getWorldPoints()),this.worldMatrixNeedsUpdate=!1),!0===e)for(var n=0,i=this.children;n<i.length;n++){i[n].updateWorldMatrix(!1,!0)}},e.prototype.getPivotOffset=function(){return new c.Vector(-this.pivot.x*this.size.width,-this.pivot.y*this.size.height)},e.prototype.getOriginOffset=function(){return new c.Vector(-this.origin.x*this.size.width,-this.origin.y*this.size.height)},e.prototype.composeTransformMatrix=function(t,e,n,i){var r=t.x,o=t.y,a=e.x,l=e.y,c=i.x,p=i.y,h=u.MathUtils.cosDegrees(n),d=u.MathUtils.sinDegrees(n),f=r*h-o*d-r+a+c,y=r*d+o*h-o+l+p;return(new s.Matrix3).set(h,d,0,-d,h,0,f,y,1)},e.prototype.decomposeTransformMatrix=function(t,e,n){var i=e.x,r=e.y,o=n.x,s=n.y,a=t.elements[0],l=t.elements[1],p=t.elements[6],h=t.elements[7],d=u.MathUtils.atan2Degrees(l,a);d<0&&(d+=360);var f=p-(i*a-r*l-i+o),y=h-(i*l+r*a-r+s);return{rotation:d,position:new c.Vector(f,y)}},e}(a.Node);e.Transform=d},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(31),r=function(){function t(){this.elements=[1,0,0,0,1,0,0,0,1]}return t.prototype.set=function(t,e,n,i,r,o,s,a,l){var c=this.elements;return c[0]=t,c[1]=e,c[2]=n,c[3]=i,c[4]=r,c[5]=o,c[6]=s,c[7]=a,c[8]=l,this},t.prototype.applyToVector=function(t){var e=t.x,n=t.y,i=this.elements;return t.x=e*i[0]+n*i[3]+1*i[6],t.y=e*i[1]+n*i[4]+1*i[7],t},t.prototype.premultiply=function(t){return this.multiplyMatrices(t,this)},t.prototype.multiply=function(t){return this.multiplyMatrices(this,t)},t.prototype.multiplyMatrices=function(t,e){var n=t.elements,i=n[0],r=n[1],o=n[2],s=n[3],a=n[4],l=n[5],c=n[6],u=n[7],p=n[8],h=e.elements,d=h[0],f=h[1],y=h[2],m=h[3],g=h[4],v=h[5],_=h[6],b=h[7],w=h[8],S=this.elements;return S[0]=i*d+r*m+o*_,S[1]=i*f+r*g+o*b,S[2]=i*y+r*v+o*w,S[3]=s*d+a*m+l*_,S[4]=s*f+a*g+l*b,S[5]=s*y+a*v+l*w,S[6]=c*d+u*m+p*_,S[7]=c*f+u*g+p*b,S[8]=c*y+u*v+p*w,this},t.prototype.multiplyScalar=function(t){var e=this.elements;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,this},t.prototype.invert=function(){var t=this.getDeterminant();if(0===t)throw new Error("Determinant is 0, cant invert");var e=this.getCofactors().transpose().multiplyScalar(1/t);return this.copyFrom(e),this},t.prototype.getMinors=function(){var e=this.elements,n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],p=s*u-a*c,h=o*u-a*l,d=o*c-s*l,f=i*u-r*c,y=n*u-r*l,m=n*c-i*l,g=i*a-r*s,v=n*a-r*o,_=n*s-i*o;return(new t).set(p,h,d,f,y,m,g,v,_)},t.prototype.getCofactors=function(){var e=this.getMinors().elements;return(new t).set(e[0],-1*e[1],e[2],-1*e[3],e[4],-1*e[5],e[6],-1*e[7],e[8])},t.prototype.getDeterminant=function(){var t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],s=t[5],a=t[6],l=t[7],c=t[8];return e*(o*c-s*l)-n*(r*c-s*a)+i*(r*l-o*a)},t.prototype.transpose=function(){var t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],s=t[5],a=t[6],l=t[7],c=t[8];return t[0]=e,t[1]=r,t[2]=a,t[3]=n,t[4]=o,t[5]=l,t[6]=i,t[7]=s,t[8]=c,this},t.prototype.copyFrom=function(t){return this.fromArray(t.elements),this},t.prototype.fromArray=function(t){void 0===t&&(t=[]);for(var e=0;e<9;e+=1)this.elements[e]=t[e];return this},t.createRotation=function(e){var n=i.MathUtils.cosDegrees(e),r=i.MathUtils.sinDegrees(e);return(new t).set(n,r,0,-r,n,0,0,0,1)},t.prototype.clone=function(){return(new t).fromArray(this.elements)},t}();e.Matrix3=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.children=[],this.parent=null,this.removedChildren=[],this.isRemoved=!1}return t.prototype.add=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0,i=t;n<i.length;n++){var r=i[n];null!==r.parent&&r.parent.remove(r,!1),r.parent=this,this.children.push(r)}return this},t.prototype.replaceSelf=function(t){return null===this.parent||(this.parent.remove(this),this.parent.add(t)),this},t.prototype.remove=function(t,e){void 0===e&&(e=!0);var n=this.children.indexOf(t);return-1!==n&&(e&&(t.isRemoved=!0,this.removedChildren.push(t)),this.children.splice(n,1),!0)},t.prototype.removeSelf=function(){return null===this.parent||this.parent.remove(this),this},t.prototype.removeAllChildren=function(){return this.children=[],this},t.prototype.cleanupRemoved=function(){this.removedChildren=[]},t.prototype.traverse=function(t){t(this);for(var e=0,n=this.children;e<n.length;e++){n[e].traverse(t)}return this},t.prototype.traverseDescedants=function(t){for(var e=0,n=this.children;e<n.length;e++){n[e].traverse(t)}return this},t.prototype.hasParent=function(t){for(var e=this.parent;null!==e;){if(e===t)return!0;e=e.parent}return!1},t.prototype.traverseParents=function(t){var e=this.parent;return null!==e&&(t(e),e.traverseParents(t)),this},t.prototype.flatten=function(){var t=[];return this.traverse((function(e){t.push(e)})),t},t}();e.Node=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}return t.prototype.set=function(t,e,n,i,r,o,s,a,l,c,u,p,h,d,f,y){var m=this.elements;return m[0]=t,m[1]=e,m[2]=n,m[3]=i,m[4]=r,m[5]=o,m[6]=s,m[7]=a,m[8]=l,m[9]=c,m[10]=u,m[11]=p,m[12]=h,m[13]=d,m[14]=f,m[15]=y,this},t.prototype.premultiply=function(t){return this.multiplyMatrices(t,this)},t.prototype.multiply=function(t){return this.multiplyMatrices(this,t)},t.prototype.multiplyMatrices=function(t,e){var n=t.elements,i=n[0],r=n[1],o=n[2],s=n[3],a=n[4],l=n[5],c=n[6],u=n[7],p=n[8],h=n[9],d=n[10],f=n[11],y=n[12],m=n[13],g=n[14],v=n[15],_=e.elements,b=_[0],w=_[1],S=_[2],T=_[3],O=_[4],x=_[5],P=_[6],I=_[7],E=_[8],L=_[9],C=_[10],M=_[11],R=_[12],k=_[13],A=_[14],j=_[15],D=this.elements;return D[0]=i*b+r*O+o*E+s*R,D[1]=i*w+r*x+o*L+s*k,D[2]=i*S+r*P+o*C+s*A,D[3]=i*T+r*I+o*M+s*j,D[4]=a*b+l*O+c*E+u*R,D[5]=a*w+l*x+c*L+u*k,D[6]=a*S+l*P+c*C+u*A,D[7]=a*T+l*I+c*M+u*j,D[8]=p*b+h*O+d*E+f*R,D[9]=p*w+h*x+d*L+f*k,D[10]=p*S+h*P+d*C+f*A,D[11]=p*T+h*I+d*M+f*j,D[12]=y*b+m*O+g*E+v*R,D[13]=y*w+m*x+g*L+v*k,D[14]=y*S+m*P+g*C+v*A,D[15]=y*T+m*I+g*M+v*j,this},t.prototype.translate=function(e,n,i){var r=t.createTranslation(e,n,i);return this.premultiply(r),this},t.prototype.scale=function(e,n,i){var r=t.createScale(e,n,i);return this.premultiply(r),this},t.createTranslation=function(e,n,i){return(new t).set(1,0,0,0,0,1,0,0,0,0,1,0,e,n,i,1)},t.createScale=function(e,n,i){return(new t).set(e,0,0,0,0,n,0,0,0,0,i,0,0,0,0,1)},t.createOrthographic=function(e,n,i,r,o,s){return(new t).set(2/(n-e),0,0,0,0,2/(r-i),0,0,0,0,2/(o-s),0,(e+n)/(e-n),(i+r)/(i-r),(o+s)/(o-s),1)},t.createProjection=function(e,n,i){return(new t).set(2/e,0,0,0,0,-2/n,0,0,0,0,2/i,0,-1,1,0,1)},t}();e.Matrix4=i},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(157)),i(n(158))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=function(){function t(){}return t.create=function(t,e,n,i){return void 0===i&&(i=1),["tank",t.party.toString(),e.toString(),t.tier.toString(),this.getRotationString(n),i.toString()].join(".")},t.getRotationString=function(t){switch(t){case i.Rotation.Up:return"up";case i.Rotation.Down:return"down";case i.Rotation.Left:return"left";case i.Rotation.Right:return"right";default:return"unknown"}},t}();e.TankSpriteId=r},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(159)),i(n(61)),i(n(160)),i(n(161)),i(n(178)),i(n(179)),i(n(180))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lastPosition=null,e}return r(e,t),e.prototype.update=function(t,e){t.move(e.deltaTime);var n=this.roundPosition(t.position);if(null!==this.lastPosition&&this.lastPosition.equals(n))return t.rotation===s.Rotation.Up?t.rotate(s.Rotation.Down):t.rotation===s.Rotation.Down?t.rotate(s.Rotation.Up):t.rotation===s.Rotation.Left?t.rotate(s.Rotation.Right):t.rotation===s.Rotation.Right&&t.rotate(s.Rotation.Left),void t.move(e.deltaTime);this.lastPosition=n},e.prototype.roundPosition=function(t){return new o.Vector(Math.round(t.x),Math.round(t.y))},e}(n(17).TankBehavior);e.PatrolTankBehavior=a},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(162)),i(n(163))},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(172)),i(n(173))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Keyboard=0]="Keyboard",t[t.Gamepad=1]="Gamepad"}(e.InputDeviceType||(e.InputDeviceType={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Low=1]="Low",t[t.High=2]="High"}(e.TankBulletWallDamage||(e.TankBulletWallDamage={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(20),r=n(21),o=function(){function t(t,e,n){void 0===n&&(n=!1),this.party=t,this.tier=e,this.hasDrop=n}return t.prototype.setHasDrop=function(t){return this.hasDrop=t,this},t.prototype.clone=function(){return new t(this.party,this.tier)},t.prototype.increaseTier=function(t){if(void 0===t&&(t=null),null!==t)return this.tier=t,this;switch(this.tier){case r.TankTier.A:this.tier=r.TankTier.B;break;case r.TankTier.B:this.tier=r.TankTier.C;break;case r.TankTier.C:this.tier=r.TankTier.D}return this},t.prototype.isMaxTier=function(){return this.tier===r.TankTier.D},t.prototype.equals=function(t){return this.party===t.party&&this.tier===t.tier&&this.hasDrop===t.hasDrop},t.prototype.serialize=function(){return this.party+"-"+this.tier+"-"+this.hasDrop},t.prototype.toString=function(){return this.serialize()},t.PlayerA=function(){return new t(i.TankParty.Player,r.TankTier.A)},t.PlayerB=function(){return new t(i.TankParty.Player,r.TankTier.B)},t.PlayerC=function(){return new t(i.TankParty.Player,r.TankTier.C)},t.PlayerD=function(){return new t(i.TankParty.Player,r.TankTier.D)},t.EnemyA=function(){return new t(i.TankParty.Enemy,r.TankTier.A)},t.EnemyB=function(){return new t(i.TankParty.Enemy,r.TankTier.B)},t.EnemyC=function(){return new t(i.TankParty.Enemy,r.TankTier.C)},t.EnemyD=function(){return new t(i.TankParty.Enemy,r.TankTier.D)},t}();e.TankType=o},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(5),a=n(1),l=function(t){function e(e,n,i){var r=t.call(this,e,n)||this;return r.zIndex=a.EDITOR_BRUSH_Z_INDEX,r.type=i,r}return r(e,t),e.prototype.setup=function(){for(var t=0,e=s.TerrainFactory.createFromRegions(this.type,[new o.Rect(0,0,this.size.width,this.size.height)]);t<e.length;t++){var n=e[t];n.setZIndex(this.zIndex+1),this.add(n)}},e}(o.GameObject);e.EditorBrush=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(6),l=function(t){function e(e,n,i){void 0===i&&(i=s.Rotation.Up);var r=t.call(this,64,64)||this;return r.collider=new o.BoxCollider(r),r.painter=new o.SpritePainter,r.tags=[s.Tag.EditorBlockMove],r.type=e,r.color=n,r.pivot.set(.5,.5),r.rotation=i,r}return r(e,t),e.prototype.setup=function(t){var e=t.collisionSystem,n=t.spriteLoader;e.register(this.collider);var i=a.TankSpriteId.create(this.type,this.color,this.rotation,1),r=n.load(i);this.painter.sprite=r},e.prototype.update=function(){this.collider.update()},e}(o.GameObject);e.EditorTankDummy=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(7),l=n(1),c={activationDelay:.12,delay:.024},u=function(t){function e(){var e=t.call(this)||this;return e.collider=new o.BoxCollider(e,!0),e.painter=new o.RectPainter(null,l.COLOR_RED),e.zIndex=l.EDITOR_TOOL_Z_INDEX,e.draw=new o.Subject,e.erase=new o.Subject,e.brushes=[],e.selectedBrush=null,e.velocity=new o.Vector(0,0),e.holdThrottles=[],e.blinkTimer=new o.Timer,e.isBlinkVisible=!0,e.moveUp=function(){e.velocity.set(0,-e.size.height)},e.moveDown=function(){e.velocity.set(0,e.size.height)},e.moveLeft=function(){e.velocity.set(-e.size.width,0)},e.moveRight=function(){e.velocity.set(e.size.width,0)},e.holdThrottles=[new a.InputHoldThrottle(a.EditorMapInputContext.MoveUp,e.moveUp,c),new a.InputHoldThrottle(a.EditorMapInputContext.MoveDown,e.moveDown,c),new a.InputHoldThrottle(a.EditorMapInputContext.MoveLeft,e.moveLeft,c),new a.InputHoldThrottle(a.EditorMapInputContext.MoveRight,e.moveRight,c)],e}return r(e,t),e.prototype.setBrushes=function(t){this.brushes=t,this.selectBrush(0)},e.prototype.getSelectedBrush=function(){return this.selectedBrush},e.prototype.setup=function(t){t.collisionSystem.register(this.collider)},e.prototype.update=function(t){this.dirtyPaintBox(),this.updatePosition(t),this.updateBlinking(t);var e=t.input;e.isDownAny(a.EditorMapInputContext.Draw)&&this.draw.notify(null),e.isDownAny(a.EditorMapInputContext.Erase)&&this.erase.notify(null),e.isDownAny(a.EditorMapInputContext.NextBrush)&&this.selectNextBrush(),e.isDownAny(a.EditorMapInputContext.PrevBrush)&&this.selectPrevBrush(),this.collider.update()},e.prototype.collide=function(t){t.contacts.filter((function(t){return t.collider.object.tags.includes(s.Tag.EditorBlockMove)})).length>0&&(this.position.sub(this.velocity),this.updateMatrix(!0))},e.prototype.updatePosition=function(t){var e=t.deltaTime,n=t.input;this.velocity.set(0,0),n.isDownAny(a.EditorMapInputContext.MoveUp)?this.moveUp():n.isDownAny(a.EditorMapInputContext.MoveDown)?this.moveDown():n.isDownAny(a.EditorMapInputContext.MoveLeft)?this.moveLeft():n.isDownAny(a.EditorMapInputContext.MoveRight)&&this.moveRight();for(var i=0,r=this.holdThrottles;i<r.length;i++){r[i].update(n,e)}0===this.velocity.x&&0===this.velocity.y||(this.position.add(this.velocity),this.updateMatrix(!0))},e.prototype.updateBlinking=function(t){var e=t.deltaTime;this.blinkTimer.isDone()?(this.isBlinkVisible=!this.isBlinkVisible,this.blinkTimer.reset(.2)):this.blinkTimer.update(e),null!==this.selectBrush&&this.selectedBrush.setVisible(this.isBlinkVisible)},e.prototype.selectNextBrush=function(){var t=this.brushes.indexOf(this.selectedBrush)+1;t>this.brushes.length-1&&(t=0),this.selectBrush(t)},e.prototype.selectPrevBrush=function(){var t=this.brushes.indexOf(this.selectedBrush)-1;t<0&&(t=this.brushes.length-1),this.selectBrush(t)},e.prototype.selectBrush=function(t){null!==this.selectedBrush&&(this.selectedBrush.setVisible(!0),this.remove(this.selectedBrush)),void 0!==this.brushes[t]?(this.selectedBrush=this.brushes[t],this.selectedBrush.setVisible(this.isBlinkVisible),this.size.copyFrom(this.selectedBrush.size),this.position.x-=this.position.x%this.size.width,this.position.y-=this.position.y%this.size.height,this.add(this.selectedBrush),this.updateMatrix(!0)):this.selectBrush=null},e}(o.GameObject);e.EditorTool=u},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),s=n(13),a=n(38),l={color:o.COLOR_WHITE,unfocusableColor:o.COLOR_GRAY},c=function(t){function e(e,n){void 0===e&&(e=""),void 0===n&&(n={});var i=t.call(this)||this;return i.options=Object.assign({},l,n),i.text=new s.SpriteText(e,i.options),i}return r(e,t),e.prototype.setText=function(t){this.text.setText(t)},e.prototype.setup=function(){this.size.copyFrom(this.text.size),this.add(this.text)},e.prototype.update=function(){this.focusable?this.text.setColor(this.options.color):this.text.setColor(this.options.unfocusableColor)},e}(a.MenuItem);e.TextMenuItem=c},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(7),a=n(72),l={initialIndex:0,itemHeight:60},c=function(t){function e(e){void 0===e&&(e={});var n=t.call(this)||this;return n.focused=new o.Subject,n.selected=new o.Subject,n.items=[],n.cursor=new a.MenuCursor,n.focusedIndex=-1,n.options=Object.assign({},l,e),n.focusedIndex=n.options.initialIndex,n}return r(e,t),e.prototype.setItems=function(t){var e=this;this.items=t,this.size.set(480,t.length*this.options.itemHeight),this.updateMatrix(),this.removeAllChildren(),this.items.forEach((function(t,n){t.position.set(96,n*e.options.itemHeight+16),e.add(t)})),this.add(this.cursor),this.focusItem(0)},e.prototype.hideCursor=function(){this.cursor.setVisible(!1)},e.prototype.showCursor=function(){this.cursor.setVisible(null)},e.prototype.reset=function(){this.focusItem(0)},e.prototype.update=function(t){var e=this,n=t.input;n.isDownAny(s.MenuInputContext.VerticalPrev)&&this.focusPrev(),n.isDownAny(s.MenuInputContext.VerticalNext)&&this.focusNext(),n.isDownAny(s.MenuInputContext.Select)&&this.notifyItemSelected(),this.items.forEach((function(n,i){i===e.focusedIndex&&n.updateFocused(t)}))},e.prototype.focusItem=function(t){var e=this.items[this.focusedIndex];if(void 0!==e&&e.unfocus(),-1===t)return this.focusedIndex=-1,void this.hideCursor();this.focusedIndex=t,this.showCursor(),this.cursor.dirtyPaintBox(),this.cursor.position.setY(this.cursor.size.height*this.focusedIndex),this.cursor.updateMatrix(!0),this.focused.notify(this.focusedIndex),this.items[this.focusedIndex].focus()},e.prototype.notifyItemSelected=function(){-1!==this.focusedIndex&&(this.items[this.focusedIndex].select(),this.selected.notify(this.focusedIndex))},e.prototype.focusPrev=function(){var t=this.getPrevFocusableIndex();this.focusItem(t)},e.prototype.focusNext=function(){var t=this.getNextFocusableIndex();this.focusItem(t)},e.prototype.getPrevFocusableIndex=function(){if(!this.hasFocusableItems())return-1;var t=this.focusedIndex,e=null;do{(t-=1)<0&&(t=this.items.length-1),e=this.items[t]}while(!1===e.isFocusable());return t},e.prototype.getNextFocusableIndex=function(){if(!this.hasFocusableItems())return-1;var t=this.focusedIndex,e=null;do{(t+=1)>this.items.length-1&&(t=0),e=this.items[t]}while(!1===e.isFocusable());return t},e.prototype.hasFocusableItems=function(){return this.items.some((function(t){return t.isFocusable()}))},e}(o.GameObject);e.Menu=c},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(6),l=function(t){function e(){var e=t.call(this,60,60)||this;return e.painter=new o.SpritePainter,e.painter.alignment=o.SpriteAlignment.MiddleCenter,e}return r(e,t),e.prototype.setup=function(t){var e=t.spriteLoader;this.animation=new a.TankMoveAnimation(e,a.TankType.PlayerA(),[a.TankColor.Primary],s.Rotation.Right),this.updateSprite()},e.prototype.update=function(t){this.animation.update(t.deltaTime),this.updateSprite(),this.setNeedsPaint()},e.prototype.updateSprite=function(){var t=this.animation.getCurrentFrame().getSprite(0);this.painter.sprite=t},e}(o.GameObject);e.MenuCursor=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(6),l=n(1),c=n(40),u=n(74),p=function(t){function e(e,n,i){var r=t.call(this,l.BULLET_WIDTH,16)||this;return r.collider=new o.SweptBoxCollider(r,!0),r.painter=new o.SpritePainter,r.zIndex=l.BULLET_Z_INDEX,r.tags=[s.Tag.Bullet],r.died=new o.Subject,r.speed=e,r.tankDamage=n,r.wallDamage=i,r.pivot.set(.5,.5),r}return r(e,t),e.prototype.setup=function(t){var e=t.audioLoader,n=t.collisionSystem,i=t.spriteLoader;n.register(this.collider),this.hitBrickSound=e.load("hit.brick"),this.hitSteelSound=e.load("hit.steel");var r=this.getWorldRotation(),o="bullet."+this.getRotationString(r),s=i.load(o);this.painter.sprite=s},e.prototype.update=function(t){this.dirtyPaintBox(),this.translateY(this.speed*t.deltaTime),this.updateMatrix(),this.collider.update(),this.setNeedsPaint()},e.prototype.collide=function(t){this.collideBullets(t),this.collideWalls(t)},e.prototype.nullify=function(){this.removeSelf(),this.collider.unregister(),this.died.notify(null)},e.prototype.explode=function(){var t=new c.SmallExplosion;t.updateMatrix(),t.setCenter(this.getCenter()),this.replaceSelf(t),this.collider.unregister(),this.died.notify(null)},e.prototype.collideBullets=function(t){var e=this;t.contacts.filter((function(t){return t.collider.object.tags.includes(s.Tag.Bullet)})).forEach((function(t){var n=t.collider.object;n.tags.includes(s.Tag.Enemy)&&e.tags.includes(s.Tag.Enemy)||n.tags.includes(s.Tag.Player)&&e.tags.includes(s.Tag.Player)||(e.nullify(),n.nullify())}))},e.prototype.collideWalls=function(t){var e=this,n=t.contacts.filter((function(t){return t.collider.object.tags.includes(s.Tag.Wall)}));if(0!==n.length){var i=null;n.forEach((function(t){var n=e.collider.getPrevBox().distanceCenterToCenter(t.box);(null===i||n<i)&&(i=n)}));var r=n.filter((function(t){return e.collider.getPrevBox().distanceCenterToCenter(t.box)===i}));if(r.length>0){var o=r[0],l=o.box,c=this.getWorldBoundingBox(),p=o.collider.object,h=p.tags.includes(s.Tag.Brick),d=p.tags.includes(s.Tag.Border),f=p.tags.includes(s.Tag.Steel),y=this.wallDamage===a.TankBulletWallDamage.High;if(h||f&&y){var m=new u.TerrainTileDestroyer(this.wallDamage);this.updateWorldMatrix(!0),this.add(m),m.updateMatrix(),m.setCenter(this.getSelfCenter()),m.updateMatrix();var g=m.getWorldBoundingBox(),v=m.getWorldRotation();v===s.Rotation.Up?m.translateY(g.max.y-l.max.y):v===s.Rotation.Down?m.translateY(l.min.y-g.min.y):v===s.Rotation.Left?m.translateY(g.max.x-l.max.x):v===s.Rotation.Right&&m.translateY(l.min.x-g.min.x),this.parent.attach(m),this.tags.includes(s.Tag.Player)&&this.hitBrickSound.play()}else(f||d)&&this.tags.includes(s.Tag.Player)&&this.hitSteelSound.play();var _=this.getWorldRotation();_===s.Rotation.Up?this.translateY(c.max.y-l.max.y):_===s.Rotation.Down?this.translateY(l.min.y-c.min.y):_===s.Rotation.Left?this.translateY(c.max.x-l.max.x):_===s.Rotation.Right&&this.translateY(l.min.x-c.min.x),this.updateMatrix(),this.explode()}}},e.prototype.getRotationString=function(t){switch(t){case s.Rotation.Up:return"up";case s.Rotation.Down:return"down";case s.Rotation.Left:return"left";case s.Rotation.Right:return"right";default:return"unknown"}},e}(o.GameObject);e.Bullet=p},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(6),l=n(1),c=function(t){function e(e){var n=this,i=Math.min(e,a.TankBulletWallDamage.High),r=l.TILE_SIZE_LARGE,s=l.TILE_SIZE_SMALL*i;return(n=t.call(this,r,s)||this).damage=i,n.collider=new o.BoxCollider(n,!0),n}return r(e,t),e.prototype.setup=function(t){t.collisionSystem.register(this.collider)},e.prototype.collide=function(t){var e=this,n=t.contacts.filter((function(t){return t.collider.object.tags.includes(s.Tag.Wall)}));0!==n.length?n.forEach((function(t){var n=t.collider.object,i=n.tags.includes(s.Tag.Brick),r=n.tags.includes(s.Tag.Steel),o=e.damage===a.TankBulletWallDamage.High;(i||r&&o)&&(n.destroy(),e.destroy())})):this.destroy()},e.prototype.destroy=function(){this.removeSelf(),this.collider.unregister()},e}(o.GameObject);e.TerrainTileDestroyer=c},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(1),l=function(t){function e(){var e=t.call(this,64,64)||this;return e.ignorePause=!0,e.zIndex=a.SHIELD_Z_INDEX,e.painter=new o.SpritePainter,e}return r(e,t),e.prototype.setup=function(t){var e=t.spriteLoader;this.animation=new o.Animation(e.loadList(["shield.1","shield.2"]),{delay:.05,loop:!0})},e.prototype.update=function(t){var e=t.deltaTime,n=t.gameState;n.hasChangedTo(s.GameState.Paused)&&this.setVisible(!1),n.hasChangedTo(s.GameState.Playing)&&this.setVisible(!0),n.is(s.GameState.Paused)||(this.animation.update(e),this.painter.sprite=this.animation.getCurrentFrame(),this.setNeedsPaint())},e}(o.GameObject);e.Shield=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(1),a=function(t){function e(){var e=t.call(this,136,136)||this;return e.zIndex=s.LARGE_EXPLOSION_Z_INDEX,e.painter=new o.SpritePainter,e.completed=new o.Subject,e.painter.alignment=o.SpriteAlignment.MiddleCenter,e}return r(e,t),e.prototype.setup=function(t){var e=t.spriteLoader;this.animation=new o.Animation(e.loadList(["explosion.large.1","explosion.large.2"]),{delay:.066,loop:!1})},e.prototype.update=function(t){if(this.animation.isComplete())return this.dirtyPaintBox(),this.removeSelf(),void this.completed.notify(null);this.animation.update(t.deltaTime),this.painter.sprite=this.animation.getCurrentFrame(),this.setNeedsPaint()},e}(o.GameObject);e.Explosion=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.BaseDefence="defence",t.Freeze="freeze",t.Life="life",t.Shield="shield",t.Upgrade="upgrade",t.Wipeout="wipeout"}(e.PowerupType||(e.PowerupType={}))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(1),a=function(t){function e(e,n,i,r){void 0===r&&(r="#fff");var a=t.call(this,e,n)||this;a.zIndex=s.DEBUG_GRID_Z_INDEX,a.highlightedCells=[],a.step=i;for(var l=0;l<=e;l+=i){var c=new o.GameObject;(p=new o.LinePainter).strokeColor=r,p.positions.push(new o.Vector(l,0),new o.Vector(l,n)),c.painter=p,a.add(c)}for(var u=0;u<=n;u+=i){var p;c=new o.GameObject;(p=new o.LinePainter).strokeColor=r,p.positions.push(new o.Vector(0,u),new o.Vector(e,u)),c.painter=p,a.add(c)}return a}return r(e,t),e.prototype.highlightCell=function(t,e){void 0===e&&(e="rgba(255, 0, 0, 0.5)");var n=new o.GameObject(this.step,this.step);n.painter=new o.RectPainter(e),n.position.set(t.x*this.step,t.y*this.step),this.highlightedCells.push(n),this.add(n)},e.prototype.removeAllCellHighlights=function(){this.highlightedCells.forEach((function(t){t.removeSelf()})),this.highlightedCells=[]},e}(o.GameObject);e.DebugGrid=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(43),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.onLoad=function(t){var e=t.target.result,n=new s.MapConfig;try{n.fromJSON(e),this.loaded.notify(n)}catch(t){this.throwError(t)}},e}(o.TextFileReader);e.MapFileReader=a},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(265)),i(n(266)),i(n(267)),i(n(268)),i(n(269)),i(n(270)),i(n(271)),i(n(272)),i(n(273)),i(n(274)),i(n(275)),i(n(276)),i(n(277))},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}l((i=i.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(82),s=n(0),a=n(18),l=n(3),c=n(7),u=n(42),p=n(33),h=n(251),d=n(1),f=n(298),y=n(299),m=n(300),g=n(301),v=n(302),_=document.querySelector("[data-loading]"),b=new s.Logger("main",s.Logger.Level.Debug),w=new s.GameRenderer({height:d.CANVAS_HEIGHT,width:d.CANVAS_WIDTH}),S=new l.GameStorage(d.STORAGE_NAMESPACE);S.load();var T=new c.InputManager(S);T.listen();var O=new s.AudioLoader(f),x=new s.ImageLoader,P=new s.SpriteFontLoader(x);P.register(d.PRIMARY_SPRITE_FONT_ID,m);var I=new s.ColorSpriteFontGenerator(P);I.register(d.PRIMARY_SPRITE_FONT_ID,d.COLOR_BLACK);var E=new s.SpriteLoader(x,y),L=new s.RectFontLoader;L.register(d.PRIMARY_RECT_FONT_ID,g,{scale:d.TILE_SIZE_SMALL});var C=new u.ManifestMapListReader(v),M=new u.MapLoader(C),R=new l.AudioManager(O,S);R.loadSettings();var k=new l.Session,A=new c.InputHintSettings(S),j=new p.PointsHighscoreManager(S),D=new s.CollisionSystem,B=new h.GameSceneRouter;B.start(h.GameSceneType.MainMenu),B.transitionStarted.addListener((function(){D.reset()}));var N=new a.DebugInspector(w.getDomElement());N.listen(),N.click.addListener((function(t){var e=[];B.getCurrentScene().getRoot().traverseDescedants((function(n){n.getWorldBoundingBox().containsPoint(t)&&e.push(n)})),b.debug(e)}));var F=new s.State(l.GameState.Playing),G={audioManager:R,audioLoader:O,collisionSystem:D,colorSpriteFontGenerator:I,deltaTime:0,gameStorage:S,imageLoader:x,input:T.getInput(),inputHintSettings:A,inputManager:T,gameState:F,mapLoader:M,pointsHighscoreManager:j,rectFontLoader:L,session:k,spriteFontLoader:P,spriteLoader:E},H=new s.GameLoop,U=new o,$=new a.DebugGameLoopMenu(H);d.IS_DEV&&(document.body.appendChild(U.dom),$.attach()),H.tick.addListener((function(t){U.begin(),T.update(),G.deltaTime=t.deltaTime;var e=B.getCurrentScene();e.invokeUpdate(G),w.render(e.getRoot()),F.update(),U.end()})),function(){i(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return b.time("Audio preload"),_.textContent="Loading audio...",[4,O.preloadAllAsync()];case 1:return t.sent(),b.timeEnd("Audio preload"),b.time("Rect font preload"),_.textContent="Loading rects fonts...",[4,L.preloadAll()];case 2:return t.sent(),b.timeEnd("Rect font preload"),b.time("Sprite font preload"),_.textContent="Loading sprite fonts...",[4,P.preloadAllAsync()];case 3:return t.sent(),b.timeEnd("Sprite font preload"),b.time("Color sprite font generation"),_.textContent="Generating sprite font colors...",I.generate(d.PRIMARY_SPRITE_FONT_ID,d.COLOR_WHITE),I.generate(d.PRIMARY_SPRITE_FONT_ID,d.COLOR_GRAY),I.generate(d.PRIMARY_SPRITE_FONT_ID,d.COLOR_RED),I.generate(d.PRIMARY_SPRITE_FONT_ID,d.COLOR_YELLOW),b.timeEnd("Color sprite font generation"),b.time("Sprites preload"),_.textContent="Loading sprites...",[4,E.preloadAllAsync()];case 4:return t.sent(),b.timeEnd("Sprites preload"),b.time("Input bindings load"),_.textContent="Loading input bindings...",T.loadAllBindings(),b.timeEnd("Input bindings load"),document.body.removeChild(_),document.body.appendChild(w.getDomElement()),H.start(),[2]}}))}))}(),d.IS_DEV&&(window.gameLoop=H)},function(t,e,n){var i;t.exports=((i=function(){function t(t){return r.appendChild(t.dom),t}function e(t){for(var e=0;e<r.children.length;e++)r.children[e].style.display=e===t?"block":"none";n=t}var n=0,r=document.createElement("div");r.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",(function(t){t.preventDefault(),e(++n%r.children.length)}),!1);var o=(performance||Date).now(),s=o,a=0,l=t(new i.Panel("FPS","#0ff","#002")),c=t(new i.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=t(new i.Panel("MB","#f08","#201"));return e(0),{REVISION:16,dom:r,addPanel:t,showPanel:e,begin:function(){o=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(c.update(t-o,200),t>s+1e3&&(l.update(1e3*a/(t-s),100),s=t,a=0,u)){var e=performance.memory;u.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){o=this.end()},domElement:r,setMode:e}}).Panel=function(t,e,n){var i=1/0,r=0,o=Math.round,s=o(window.devicePixelRatio||1),a=80*s,l=48*s,c=3*s,u=2*s,p=3*s,h=15*s,d=74*s,f=30*s,y=document.createElement("canvas");y.width=a,y.height=l,y.style.cssText="width:80px;height:48px";var m=y.getContext("2d");return m.font="bold "+9*s+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=n,m.fillRect(0,0,a,l),m.fillStyle=e,m.fillText(t,c,u),m.fillRect(p,h,d,f),m.fillStyle=n,m.globalAlpha=.9,m.fillRect(p,h,d,f),{dom:y,update:function(l,g){i=Math.min(i,l),r=Math.max(r,l),m.fillStyle=n,m.globalAlpha=1,m.fillRect(0,0,a,h),m.fillStyle=e,m.fillText(o(l)+" "+t+" ("+o(i)+"-"+o(r)+")",c,u),m.drawImage(y,p+s,h,d-s,f,p,h,d-s,f),m.fillRect(p+d-s,h,s,f),m.fillStyle=n,m.globalAlpha=.9,m.fillRect(p+d-s,h,s,o((1-l/g)*f))}}},i)},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(84)),i(n(29)),i(n(45)),i(n(46)),i(n(87))},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(85)),i(n(86))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(10),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.init=function(){var t=this.object.getWorldBoundingBox();this.prevBox=t.clone(),this.currentBox=t.clone()},e.prototype.update=function(){var t=this.object.getWorldBoundingBox();this.prevBox=this.currentBox,this.currentBox=t.clone()},e.prototype.getBox=function(){return this.currentBox},e.prototype.getPrevBox=function(){return this.prevBox},e.prototype.getCurrentBox=function(){return this.currentBox},e.prototype.getDirection=function(){var t=this.prevBox.getCenter(),e=this.currentBox.getCenter(),n=e.x-t.x,i=e.y-t.y;return new o.Vector(n,i)},e}(n(29).Collider);e.BoxCollider=s},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(10),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.init=function(){var t=this.object.getWorldBoundingBox();this.prevBox=t.clone(),this.currentBox=t.clone(),this.sumBox=this.prevBox.clone().unionWith(this.currentBox)},e.prototype.update=function(){var t=this.object.getWorldBoundingBox();this.prevBox=this.currentBox,this.currentBox=t.clone(),this.sumBox=this.prevBox.clone().unionWith(this.currentBox)},e.prototype.getBox=function(){return this.sumBox},e.prototype.getCurrentBox=function(){return this.currentBox},e.prototype.getPrevBox=function(){return this.prevBox},e.prototype.getDirection=function(){var t=this.prevBox.getCenter(),e=this.currentBox.getCenter(),n=e.x-t.x,i=e.y-t.y;return new o.Vector(n,i)},e}(n(29).Collider);e.SweptBoxCollider=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(45),r=n(46),o=function(){function t(){this.dynamicColliders=[],this.staticColliders=[],this.collisions=[]}return t.prototype.register=function(t){var e=this;t.dynamic?this.dynamicColliders.push(t):this.staticColliders.push(t),t.unregisterRequested.addListenerOnce((function(){e.unregister(t)})),t.init()},t.prototype.unregister=function(t){var e=t.dynamic?this.dynamicColliders:this.staticColliders,n=e.indexOf(t);-1!==n&&e.splice(n,1)},t.prototype.update=function(){var t=this.dynamicColliders.concat(this.staticColliders);this.collisions=[];for(var e=0,n=this.dynamicColliders;e<n.length;e++){for(var o=n[e],s=null,a=0,l=t;a<l.length;a++){var c=l[a];if(c!==o&&(!c.object.hasParent(o.object)&&!o.object.hasParent(c.object))){var u=o.getBox(),p=c.getBox();if(u.intersectsBox(p)){null===s&&(s=new i.Collision(o,u));var h=new r.CollisionContact(c,p);s.addContact(h)}}}null!==s&&this.collisions.push(s)}},t.prototype.getCollisionByCollider=function(t){for(var e=0,n=this.collisions;e<n.length;e++){var i=n[e];if(i.collider===t)return i}return null},t.prototype.collide=function(){this.collisions.forEach((function(t){t.collider.object.invokeCollide(t)}))},t.prototype.getCollisions=function(){return this.collisions},t.prototype.reset=function(){this.dynamicColliders=[],this.staticColliders=[],this.collisions=[]},t}();e.CollisionSystem=o},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(89)),i(n(90)),i(n(91))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(12),r={multiple:!1},o=function(){function t(t){var e=this;void 0===t&&(t={}),this.opened=new i.Subject,this.handleFileChange=function(){var t=e.fileElement.files;0!==t.length&&e.opened.notify(t)},this.options=Object.assign({},r,t),this.fileElement=document.createElement("input"),this.fileElement.addEventListener("change",this.handleFileChange),this.fileElement.setAttribute("type","file"),this.fileElement.setAttribute("multiple",this.options.multiple.toString())}return t.prototype.openDialog=function(){this.fileElement.click()},t}();e.FileOpener=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.saveJSON=function(t,e){void 0===e&&(e="file.json");var n="data:text/json;charset=utf-8,"+window.encodeURIComponent(t),i=document.createElement("a");i.setAttribute("href",n),i.setAttribute("download",e),i.click()},t}();e.FileSaver=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(23),r=n(12),o=function(){function t(){var e=this;this.loaded=new r.Subject,this.error=new r.Subject,this.log=new i.Logger(t.name),this.handleLoad=function(t){e.onLoad(t)},this.handleError=function(){e.throwError(new Error("Failed to read"))}}return t.prototype.read=function(t){var e=new globalThis.FileReader;e.addEventListener("load",this.handleLoad),e.addEventListener("error",this.handleError),e.readAsText(t)},t.prototype.onLoad=function(t){var e=t.target.result;this.loaded.notify(e)},t.prototype.throwError=function(t){this.log.error("Error:",t),this.error.notify(t)},t}();e.TextFileReader=o},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e){var n=t.call(this)||this;return n.canvasElement=e,n}return r(e,t),e.prototype.getElement=function(){return this.canvasElement},e.prototype.getWidth=function(){return this.canvasElement.width},e.prototype.getHeight=function(){return this.canvasElement.height},e.prototype.isLoaded=function(){return!0},e}(n(30).ImageSource);e.CanvasImage=o},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e){var n=t.call(this)||this;return n.handleLoaded=function(){n.loaded.notify(null),n.imageElement.removeEventListener("load",n.handleLoaded)},n.imageElement=e,n.imageElement.addEventListener("load",n.handleLoaded),n}return r(e,t),e.prototype.getElement=function(){return this.imageElement},e.prototype.getWidth=function(){return this.imageElement.naturalWidth},e.prototype.getHeight=function(){return this.imageElement.naturalHeight},e.prototype.isLoaded=function(){return this.imageElement.complete},e}(n(30).ImageSource);e.Image=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(25),r=n(14),o=n(47),s=function(){function t(t){this.map=new Map,this.spriteFontLoader=t}return t.prototype.get=function(t,e){void 0===e&&(e=null);var n=this.map.get(t);if(void 0===n)throw new Error('Font "'+t+'" not registered');var i=n.defaultColor,r=n.defaultFont,o=n.generatedFonts;if(null===e||e===i)return r;var s=o.get(e);if(void 0===s)throw new Error('Font "'+t+'" color "'+e+'" not generated');return s},t.prototype.register=function(t,e){var n={defaultColor:e,defaultFont:this.spriteFontLoader.load(t),generatedFonts:new Map};this.map.set(t,n)},t.prototype.generate=function(t,e){var n=this.map.get(t);if(void 0===n)throw new Error('Font "'+t+'" not registered');var s=n.defaultFont,a=s.getImageSourceRect(),l=n.canvas,c=void 0===l;c&&((l=document.createElement("canvas")).width=a.width,l.height=a.height,n.canvas=l);var u=l.getContext("2d"),p=l.height,h=null;if(!c){h=u.getImageData(0,0,l.width,l.height);var d=l.height+a.height;l.height=d}var f=c?0:p,y=new r.Rect(0,f,a.width,a.height);u.globalCompositeOperation="source-over",u.drawImage(s.image.getElement(),a.x,a.y,a.width,a.height,y.x,y.y,y.width,y.height),u.globalCompositeOperation="source-in",u.fillStyle=e,u.fillRect(y.x,y.y,y.width,y.height),u.globalCompositeOperation="source-over",c||u.putImageData(h,0,0);var m=new o.CanvasImage(l),g=Object.assign({},s.config,{offsetX:y.x,offsetY:y.y}),v=new i.SpriteFont(g,m,s.options);n.generatedFonts.set(e,v)},t}();e.ColorSpriteFontGenerator=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(10),r=function(){function t(){}return t.prototype.buildCharacter=function(){return null},t.prototype.getScale=function(){return new i.Vector(1,1)},t.prototype.getCharacterWidth=function(){return 0},t.prototype.getCharacterHeight=function(){return 0},t}();e.NullFont=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(14),r=n(10),o={scale:1},s=function(){function t(t,e){void 0===e&&(e={}),this.config=t,this.options=Object.assign({},o,e)}return t.prototype.buildCharacter=function(t,e,n){var o=this;void 0===e&&(e=new r.Vector(1,1)),void 0===n&&(n=new r.Vector(0,0));var s=this.config.characterSet.indexOf(t);if(-1===s)throw new Error('Font character "'+t+'" is not defined');var a=this.config.characters[s],l=[];return a.forEach((function(t,r){Array.from(t).forEach((function(t,s){if(t===o.config.fillSymbol){var a=s*e.x+n.x*e.x,c=r*e.y+n.y*e.y,u=e.x,p=e.y,h=new i.Rect(a,c,u,p);l.push(h)}}))})),l},t.prototype.getScale=function(){var t=this.options.scale;return"number"==typeof t?new r.Vector(t,t):t},t.prototype.getCharacterWidth=function(){return this.config.characterWidth},t.prototype.getCharacterHeight=function(){return this.config.characterHeight},t}();e.RectFont=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(24),r=n(14),o=n(10),s={scale:1},a=function(){function t(t,e,n){void 0===n&&(n={}),this.config=t,this.image=e,this.options=Object.assign({},s,n)}return t.prototype.buildCharacter=function(t,e,n){void 0===e&&(e=new o.Vector(1,1)),void 0===n&&(n=new o.Vector(0,0));var s=this.config.characterSet.indexOf(t);if(-1===s)throw new Error('Font character "'+t+'" is not defined');var a=this.config,l=a.characterWidth,c=a.characterHeight,u=a.columnCount,p=a.horizontalSpacing,h=a.verticalSpacing,d=a.offsetY,f=a.offsetX,y=Math.floor(s/u),m=s%u,g=f+m*l+m*p,v=d+y*c+y*h,_=l,b=c,w=new r.Rect(g,v,_,b),S=n.x*e.x,T=n.y*e.y,O=l*e.x,x=c*e.y,P=new r.Rect(S,T,O,x);return new i.Sprite(this.image,w,P)},t.prototype.getScale=function(){var t=this.options.scale;return"number"==typeof t?new o.Vector(t,t):t},t.prototype.getCharacterWidth=function(){return this.config.characterWidth},t.prototype.getCharacterHeight=function(){return this.config.characterHeight},t.prototype.getImageSourceRect=function(){var t=this.config,e=t.characterWidth,n=t.characterHeight,i=t.columnCount,o=t.rowCount,s=t.horizontalSpacing,a=t.verticalSpacing,l=t.offsetY,c=t.offsetX,u=l,p=e*i+s*i-1,h=n*o+a*(o-1);return new r.Rect(c,u,p,h)},t}();e.SpriteFont=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=n(26),o=n(10),s=n(48);!function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"}(i=e.TextAlignment||(e.TextAlignment={}));var a={alignment:i.Left,letterSpacing:1,lineSpacing:1},l=function(){function t(t,e){void 0===t&&(t=""),void 0===e&&(e={}),this.text="",this.font=new s.NullFont,this.text=t,this.options=Object.assign({},a,e)}return t.prototype.setText=function(t){return this.text=t,this},t.prototype.setFont=function(t){return this.font=t,this},t.prototype.setOptions=function(t){return void 0===t&&(t={}),this.options=Object.assign({},this.options,t),this},t.prototype.getFont=function(){return this.font},t.prototype.build=function(){var t=new o.Vector(0,0);return this.buildLinesFromText(this.text,t)},t.prototype.getWidth=function(){return this.getUnscaledTextWidth(this.text)*this.font.getScale().x},t.prototype.getHeight=function(){var t=this.options.lineSpacing,e=this.splitTextToLines(this.text),n=this.font.getCharacterHeight(),i=this.font.getScale();return e.length*n*i.y+(e.length-1)*t*i.y},t.prototype.getSize=function(){return new r.Size(this.getWidth(),this.getHeight())},t.prototype.buildLinesFromText=function(t,e){var n=this;void 0===e&&(e=new o.Vector(0,0));var r=[],s=this.font.getCharacterHeight(),a=this.getUnscaledTextWidth(this.text);return this.splitTextToLines(t).forEach((function(t,o){var l=o>0?n.options.lineSpacing:0,c=o*(s+l),u=0;if(n.options.alignment===i.Center){var p=n.getUnscaledLineWidth(t);u=(a-p)/2}else if(n.options.alignment===i.Right){p=n.getUnscaledLineWidth(t);u=a-p}var h=e.clone().addX(u).addY(c),d=n.buildWordsFromLine(t,h);r.push.apply(r,d)})),r},t.prototype.buildWordsFromLine=function(t,e){var n=this;void 0===e&&(e=new o.Vector(0,0));var i=[],r=0,s=this.splitLineToWords(t);return s.forEach((function(t,o){var a=e.clone().addX(r),l=n.getUnscaledWordWidth(t),c=n.buildCharactersFromWord(t,a);i.push.apply(i,c);var u=o<s.length-1?n.getWordSeparatorWidth():0;r+=l+u})),i},t.prototype.buildCharactersFromWord=function(t,e){var n=this;void 0===e&&(e=new o.Vector(0,0));var i=[],r=this.font.getScale();return this.splitWordToCharacters(t).forEach((function(t,o){var s=o>0?n.options.letterSpacing:0,a=e.clone().addX(o*(n.font.getCharacterWidth()+s)),l=n.font.buildCharacter(t,r,a);i.push(l)})),i},t.prototype.getUnscaledTextWidth=function(t){var e=this,n=this.splitTextToLines(t).map((function(t){return e.getUnscaledLineWidth(t)}));return Math.max.apply(Math,n)},t.prototype.getUnscaledLineWidth=function(t){var e=this,n=0;return this.splitLineToWords(t).forEach((function(t,i){var r=e.getUnscaledWordWidth(t),o=i>0?e.getWordSeparatorWidth():0;n+=r+o})),n},t.prototype.getUnscaledWordWidth=function(t){var e=this.font.getCharacterWidth(),n=this.options.letterSpacing;return t.length*e+(t.length-1)*n},t.prototype.getWordSeparatorWidth=function(){var t=this.options.letterSpacing;return this.font.getCharacterWidth()+2*t},t.prototype.splitTextToLines=function(t){return t.split("\n")},t.prototype.splitLineToWords=function(t){return t.split(" ")},t.prototype.splitWordToCharacters=function(t){return Array.from(t)},t.LINE_SEPARATOR="\n",t.WORD_SEPARATOR=" ",t}();e.Text=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(14),r=function(){function t(t,e,n){void 0===e&&(e=new i.Rect),void 0===n&&(n=new i.Rect),this.image=t,this.sourceRect=e,this.destinationRect=n}return t.prototype.isImageLoaded=function(){return this.image.isLoaded()},t}();e.Sprite=r},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(101)),i(n(49)),i(n(107)),i(n(50))},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(102)),i(n(103))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.A=0]="A",t[t.B=1]="B",t[t.X=2]="X",t[t.Y=3]="Y",t[t.LeftBumper=4]="LeftBumper",t[t.RightBumper=5]="RightBumper",t[t.LeftTrigger=6]="LeftTrigger",t[t.RightTrigger=7]="RightTrigger",t[t.Select=8]="Select",t[t.Back=8]="Back",t[t.Start=9]="Start",t[t.Forward=9]="Forward",t[t.LeftStick=10]="LeftStick",t[t.RightStick=11]="RightStick",t[t.Up=12]="Up",t[t.Down=13]="Down",t[t.Left=14]="Left",t[t.Right=15]="Right"}(e.GamepadButtonCode||(e.GamepadButtonCode={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Enter=13]="Enter",t[t.RShift=16]="RShift",t[t.Space=32]="Space",t[t.Left=37]="Left",t[t.Up=38]="Up",t[t.Right=39]="Right",t[t.Down=40]="Down",t[t.A=65]="A",t[t.B=66]="B",t[t.D=68]="D",t[t.E=69]="E",t[t.S=83]="S",t[t.T=84]="T",t[t.W=87]="W",t[t.X=88]="X",t[t.Z=90]="Z"}(e.KeyboardButtonCode||(e.KeyboardButtonCode={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.isListening=!1,this.downCodes=[],this.holdCodes=[],this.upCodes=[]}return t.prototype.listen=function(){this.isListening=!0},t.prototype.unlisten=function(){this.isListening=!1},t.prototype.update=function(){if(this.isListening){var t=navigator.getGamepads();if(0!==t.length){var e=t[0];if(null!==e){for(var n=[],i=e.buttons,r=0;r<i.length;r+=1){!0===i[r].pressed&&n.push(r)}for(var o=[],s=[],a=0,l=n;a<l.length;a++){var c=l[a];this.downCodes.includes(c)||this.holdCodes.includes(c)||o.push(c),(this.downCodes.includes(c)||this.holdCodes.includes(c))&&s.push(c)}for(var u=[],p=0,h=this.downCodes;p<h.length;p++){c=h[p];n.includes(c)||u.push(c)}for(var d=0,f=this.holdCodes;d<f.length;d++){c=f[d];n.includes(c)||u.push(c)}this.downCodes=o,this.holdCodes=s,this.upCodes=u}}}},t.prototype.getDownCodes=function(){return this.downCodes},t.prototype.getHoldCodes=function(){return this.holdCodes},t.prototype.getUpCodes=function(){return this.upCodes},t}();e.GamepadInputDevice=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){var t=this;this.listenedDownCodes=[],this.downCodes=[],this.holdCodes=[],this.upCodes=[],this.handleWindowKeyDown=function(e){var n=e.keyCode;t.listenedDownCodes.includes(n)||t.listenedDownCodes.push(n)},this.handleWindowKeyUp=function(e){var n=e.keyCode,i=t.listenedDownCodes.indexOf(n);-1!==i&&t.listenedDownCodes.splice(i,1)},this.handleWindowBlur=function(){t.listenedDownCodes=[]}}return t.prototype.listen=function(){document.addEventListener("keydown",this.handleWindowKeyDown),document.addEventListener("keyup",this.handleWindowKeyUp),window.addEventListener("blur",this.handleWindowBlur)},t.prototype.unlisten=function(){document.removeEventListener("keydown",this.handleWindowKeyDown),document.removeEventListener("keyup",this.handleWindowKeyUp),window.removeEventListener("blur",this.handleWindowBlur)},t.prototype.update=function(){for(var t=this.listenedDownCodes,e=[],n=[],i=0,r=t;i<r.length;i++){var o=r[i];this.downCodes.includes(o)||this.holdCodes.includes(o)||e.push(o),(this.downCodes.includes(o)||this.holdCodes.includes(o))&&n.push(o)}for(var s=[],a=0,l=this.downCodes;a<l.length;a++){o=l[a];t.includes(o)||s.push(o)}for(var c=0,u=this.holdCodes;c<u.length;c++){o=u[c];t.includes(o)||s.push(o)}this.downCodes=e,this.holdCodes=n,this.upCodes=s},t.prototype.getDownCodes=function(){return this.downCodes},t.prototype.getHoldCodes=function(){return this.holdCodes},t.prototype.getUpCodes=function(){return this.upCodes},t}();e.KeyboardInputDevice=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.listen=function(){},t.prototype.unlisten=function(){},t.prototype.update=function(){},t.prototype.getDownCodes=function(){return[]},t.prototype.getHoldCodes=function(){return[]},t.prototype.getUpCodes=function(){return[]},t}();e.NullInputDevice=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(50),r=n(49),o=function(){function t(){this.binding=new i.InputBinding,this.device=new r.NullInputDevice}return t.prototype.setDevice=function(t){return this.device=t,this},t.prototype.setBinding=function(t){return this.binding=t,this},t.prototype.update=function(){this.device.update()},t.prototype.isDown=function(t){var e=this.unmap(t);return this.device.getDownCodes().includes(e)},t.prototype.isDownAny=function(t){var e=this.unmapList(t);return this.device.getDownCodes().some((function(t){return e.includes(t)}))},t.prototype.isHold=function(t){var e=this.unmap(t);return this.device.getHoldCodes().includes(e)},t.prototype.isHoldAny=function(t){var e=this.unmapList(t);return this.device.getHoldCodes().some((function(t){return e.includes(t)}))},t.prototype.isNotHoldAll=function(t){var e=this.unmapList(t);return this.device.getHoldCodes().every((function(t){return!e.includes(t)}))},t.prototype.isHoldFirst=function(t){var e=this.unmap(t);return this.device.getHoldCodes()[0]===e},t.prototype.isHoldFirstAny=function(t){var e=this.unmapList(t),n=this.device.getHoldCodes()[0];return e.includes(n)},t.prototype.isHoldLast=function(t){var e=this.unmap(t),n=this.device.getHoldCodes();return n[n.length-1]===e},t.prototype.isHoldLastAny=function(t){var e=this.unmapList(t),n=this.device.getHoldCodes(),i=n[n.length-1];return e.includes(i)},t.prototype.isUp=function(t){return this.device.getUpCodes().includes(this.unmap(t))},t.prototype.isUpAny=function(t){var e=this.unmapList(t);return this.device.getUpCodes().some((function(t){return e.includes(t)}))},t.prototype.unmap=function(t){return this.binding.get(t)},t.prototype.unmapList=function(t){var e=this;return t.map((function(t){return e.unmap(t)}))},t}();e.Input=o},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(109)),i(n(110)),i(n(111)),i(n(112)),i(n(113))},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}l((i=i.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(23),s=n(51),a=n(12),l=function(){function t(e){this.loaded=new a.Subject,this.sounds=new Map,this.log=new o.Logger(t.name,o.Logger.Level.None),this.manifest=e}return t.prototype.load=function(t){var e=this,n=this.manifest[t];if(void 0===n)throw new Error('Invalid audio id = "'+t+'"');var i=n.file;if(this.sounds.has(i))return this.sounds.get(i);var r=new Audio,o=new s.Sound(r);return o.loaded.addListener((function(){e.log.debug('Loaded "%s"',i),e.loaded.notify(o)})),r.preload="auto",r.src=i,this.sounds.set(i,o),o},t.prototype.loadAsync=function(t){return i(this,void 0,void 0,(function(){var e=this;return r(this,(function(n){return[2,new Promise((function(n){var i=e.load(t);i.isLoaded()?n(i):i.loaded.addListener((function(){n(i)}))}))]}))}))},t.prototype.preloadAll=function(){var t=this;Object.keys(this.manifest).forEach((function(e){t.load(e)}))},t.prototype.preloadAllAsync=function(){return i(this,void 0,void 0,(function(){var t=this;return r(this,(function(e){switch(e.label){case 0:return[4,Promise.all(Object.keys(this.manifest).map((function(e){return t.loadAsync(e)})))];case 1:return e.sent(),[2]}}))}))},t.prototype.getAllLoaded=function(){return Array.from(this.sounds.values())},t}();e.AudioLoader=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(25),r=function(){function t(){this.registeredItems=new Map,this.loadedFonts=new Map}return t.prototype.register=function(t,e,n){void 0===n&&(n={});var i={config:e,options:n};this.registeredItems.set(t,i)},t.prototype.load=function(t){var e=this.registeredItems.get(t);if(void 0===e)throw new Error('Rect font "'+t+" not registered");if(this.loadedFonts.has(t))return this.loadedFonts.get(t);var n=e.config,r=e.options,o=new i.RectFont(n,r);return this.loadedFonts.set(t,o),o},t.prototype.preloadAll=function(){var t=this;this.registeredItems.forEach((function(e,n){t.load(n)}))},t}();e.RectFontLoader=r},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}l((i=i.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(24),s=n(23),a=function(){function t(){this.log=new s.Logger(t.name,s.Logger.Level.None),this.images=new Map}return t.prototype.load=function(t){var e=this;if(this.images.has(t))return this.images.get(t);var n=new window.Image,i=new o.Image(n);return i.loaded.addListenerOnce((function(){e.log.debug('Loaded "%s"',t)})),n.src=t,this.images.set(t,i),i},t.prototype.loadAsync=function(t){return i(this,void 0,void 0,(function(){var e=this;return r(this,(function(n){return[2,new Promise((function(n){var i=e.load(t);i.isLoaded()?n(i):i.loaded.addListenerOnce((function(){n(i)}))}))]}))}))},t}();e.ImageLoader=a},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}l((i=i.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(25),s=function(){function t(t){this.registeredItems=new Map,this.loadedFonts=new Map,this.imageLoader=t}return t.prototype.register=function(t,e,n){void 0===n&&(n={});var i={config:e,options:n};this.registeredItems.set(t,i)},t.prototype.load=function(t){var e=this.registeredItems.get(t);if(void 0===e)throw new Error('Sprite font "'+t+" not registered");if(this.loadedFonts.has(t))return this.loadedFonts.get(t);var n=e.config,i=e.options,r=this.imageLoader.load(n.file),s=new o.SpriteFont(n,r,i);return this.loadedFonts.set(t,s),s},t.prototype.loadAsync=function(t){return i(this,void 0,void 0,(function(){var e=this;return r(this,(function(n){return[2,new Promise((function(n){var i=e.load(t);i.image.isLoaded()?n(i):i.image.loaded.addListenerOnce((function(){n(i)}))}))]}))}))},t.prototype.preloadAll=function(){var t=this;this.registeredItems.forEach((function(e,n){t.load(n)}))},t.prototype.preloadAllAsync=function(){return i(this,void 0,void 0,(function(){var t=this;return r(this,(function(e){switch(e.label){case 0:return[4,Promise.all(Array.from(this.registeredItems).map((function(e){var n=e[0];return t.loadAsync(n)})))];case 1:return e.sent(),[2]}}))}))},t}();e.SpriteFontLoader=s},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}l((i=i.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},o=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,r++)i[r]=o[s];return i};Object.defineProperty(e,"__esModule",{value:!0});var s=n(24),a=n(14),l={scale:1},c=function(){function t(t,e,n){void 0===n&&(n={}),this.imageLoader=t,this.manifest=e,this.options=Object.assign({},l,n)}return t.prototype.load=function(t,e){var n=this.manifest[t];if(void 0===n)throw new Error('Invalid sprite id = "'+t+'"');var i=n.file,r=n.rect,l=this.imageLoader.load(i),c=new(a.Rect.bind.apply(a.Rect,o([void 0],r))),u=new a.Rect(0,0,c.width*this.options.scale,c.height*this.options.scale),p=null!=e?e:u;return new s.Sprite(l,c,p)},t.prototype.loadAsync=function(t,e){return void 0===e&&(e=new a.Rect),i(this,void 0,void 0,(function(){var n=this;return r(this,(function(i){return[2,new Promise((function(i){var r=n.load(t,e);r.image.isLoaded()?i(r):r.image.loaded.addListenerOnce((function(){i(r)}))}))]}))}))},t.prototype.loadList=function(t){var e=this;return t.map((function(t){return e.load(t)}))},t.prototype.preloadAll=function(){var t=this;Object.keys(this.manifest).forEach((function(e){t.load(e)}))},t.prototype.preloadAllAsync=function(){return i(this,void 0,void 0,(function(){var t=this;return r(this,(function(e){switch(e.label){case 0:return[4,Promise.all(Object.keys(this.manifest).map((function(e){return t.loadAsync(e)})))];case 1:return e.sent(),[2]}}))}))},t}();e.SpriteLoader=c},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(115)),i(n(116)),i(n(117)),i(n(118))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.positions=[],e.strokeColor="#000",e}return r(e,t),e.prototype.paint=function(t,e){if(0!==this.positions.length){var n=e.getWorldBoundingBox().min,i=this.positions.map((function(t){return t.clone().add(n)}));t.strokePath(i,this.strokeColor)}},e}(n(27).Painter);e.LinePainter=o},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e,n){void 0===e&&(e=null),void 0===n&&(n=null);var i=t.call(this)||this;return i.fillColor=null,i.strokeColor=null,i.lineWidth=1,i.fillColor=e,i.strokeColor=n,i}return r(e,t),e.prototype.paint=function(t,e){var n=e.getWorldBoundingBox().toRect(),i=n.x+this.lineWidth,r=n.y+this.lineWidth,o=n.width-2*this.lineWidth,s=n.height-2*this.lineWidth;null!==this.fillColor&&t.fillRect(n.x,n.y,n.width,n.height,this.fillColor),null!==this.strokeColor&&t.strokeRect(i,r,o,s,this.strokeColor,this.lineWidth)},e}(n(27).Painter);e.RectPainter=o},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(27),s=n(14),a=n(52),l=function(t){function e(e,n){void 0===e&&(e=null),void 0===n&&(n=a.SpriteAlignment.MiddleCenter);var i=t.call(this)||this;return i.sprite=null,i.opacity=1,i.sprite=e,i.alignment=n,i}return r(e,t),e.prototype.paint=function(t,e){if(null!==this.sprite&&this.sprite.isImageLoaded()){var n=e.getWorldBoundingBox().toRect(),i=n;this.alignment===a.SpriteAlignment.Stretch?i=n:this.alignment===a.SpriteAlignment.TopLeft?i=new s.Rect(n.x,n.y,this.sprite.destinationRect.width,this.sprite.destinationRect.height):this.alignment===a.SpriteAlignment.MiddleCenter&&(i=new s.Rect(n.x+n.width/2-this.sprite.destinationRect.width/2,n.y+n.height/2-this.sprite.destinationRect.height/2,this.sprite.destinationRect.width,this.sprite.destinationRect.height));var r=t.getGlobalAlpha();1!==this.opacity&&t.setGlobalAlpha(this.opacity),t.drawImage(this.sprite.image,this.sprite.sourceRect,i),1!==this.opacity&&t.setGlobalAlpha(r)}},e}(o.Painter);e.SpritePainter=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(27),s=n(14),a=function(t){function e(e,n){void 0===e&&(e=null),void 0===n&&(n=null);var i=t.call(this)||this;return i.text=null,i.color=null,i.opacity=1,i.text=e,i.color=n,i}return r(e,t),e.prototype.paint=function(t,e){if(null!==this.text){var n=e.getWorldBoundingBox().min,i=this.text.build(),r=t.getGlobalAlpha();1!==this.opacity&&t.setGlobalAlpha(this.opacity),i.forEach((function(e){var i=new s.Rect(n.x+e.destinationRect.x,n.y+e.destinationRect.y,e.destinationRect.width,e.destinationRect.height);t.drawImage(e.image,e.sourceRect,i)})),1!==this.opacity&&t.setGlobalAlpha(r)}},e}(o.Painter);e.SpriteTextPainter=a},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(120)),i(n(121))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t,e){this.navigator=t,this.params=e};e.Scene=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(12),r=function(){function t(){this.transitionStarted=new i.Subject,this.routes=new Map,this.scene=null,this.stack=[]}return t.prototype.register=function(t,e){this.routes.set(t,e)},t.prototype.start=function(t,e){this.assertRegistered(t),this.push(t,e)},t.prototype.getCurrentScene=function(){return this.scene},t.prototype.push=function(t,e){this.assertRegistered(t);var n=this.transition(t,e);this.stack.push(n)},t.prototype.replace=function(t,e){this.assertRegistered(t),this.stack.pop();var n=this.transition(t,e);this.stack.push(n)},t.prototype.back=function(){if(1!==this.stack.length){this.stack.pop();var t=this.stack[this.stack.length-1];this.transition(t.type,t.params)}},t.prototype.clearAndPush=function(t,e){this.assertRegistered(t),this.stack=[],this.push(t,e)},t.prototype.transition=function(t,e){void 0===e&&(e={}),this.assertRegistered(t),this.transitionStarted.notify(null);var n=new(this.routes.get(t))(this,e);this.scene=n;var i={type:t,params:e};return this.location=i,this.location},t.prototype.assertRegistered=function(t){if(!this.routes.has(t))throw new Error('Scene "'+t+'" not registered')},t}();e.SceneRouter=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(123))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.cache={},this.namespace=t}return t.prototype.set=function(t,e){this.cache[t]=e},t.prototype.get=function(t){return this.cache[t]},t.prototype.load=function(){var t,e=window.localStorage.getItem(this.namespace);try{t=JSON.parse(e)}catch(t){}"object"==typeof t&&null!==t||(t={}),this.cache=t},t.prototype.save=function(){var t=JSON.stringify(this.cache);window.localStorage.setItem(this.namespace,t)},t}();e.LocalStorage=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.flatten=function(t){var e=[];return t.forEach((function(t){Array.isArray(t)?e=e.concat(t):e.push(t)})),e},t}();e.ArrayUtils=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.round=function(t,e){void 0===e&&(e=10);var n=10*e;return Math.round(t*n)/n},t.degreesToRadians=function(t){return t*Math.PI/180},t.radiansToDegrees=function(t){return 180*t/Math.PI},t.cosDegrees=function(t){var e=this.degreesToRadians(t),n=Math.cos(e);return this.round(n)},t.sinDegrees=function(t){var e=this.degreesToRadians(t),n=Math.sin(e);return this.round(n)},t.atan2Degrees=function(t,e){var n=Math.atan2(t,e);return this.radiansToDegrees(n)},t}();e.MathUtils=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.clamp=function(t,e,n){return Math.max(Math.min(t,n),e)},t}();e.NumberUtils=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.arrayElement=function(t){return t[this.number(0,t.length)]},t.number=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=100),t+Math.floor(Math.random()*(e-t))},t.probability=function(t){return this.number(1,100)<=t},t}();e.RandomUtils=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={delay:0,fps:60,loop:!1},r=function(){function t(t,e){void 0===t&&(t=[]),void 0===e&&(e={}),this.time=0,this.frames=t,this.options=Object.assign({},i,e),this.frameIndex=0,this.loopIndex=0}return t.prototype.getCurrentFrame=function(){return this.frames[this.frameIndex]},t.prototype.getCurrentFrameIndex=function(){return this.frameIndex},t.prototype.isComplete=function(){return!this.isLoopInfinite()&&(!(this.isLoopFinite()&&!this.isLastLoop())&&(!!this.isLastFrame()&&this.isCurrentFrameComplete()))},t.prototype.update=function(t){0!==this.time?this.isLoopDisabled()&&this.isLastFrame()&&this.isCurrentFrameComplete()||this.isLoopFinite()&&this.isLastLoop()&&this.isLastFrame()&&this.isCurrentFrameComplete()||(this.isCurrentFrameComplete()?(this.frameIndex+=1,this.frameIndex>this.frames.length-1&&(this.frameIndex=0,this.loopIndex+=1),this.time+=t):this.time+=t):this.time=t},t.prototype.reset=function(){return this.frameIndex=0,this.loopIndex=0,this.time=0,this},t.prototype.resetWithFrames=function(t){return this.reset(),this.frames=t,this},t.prototype.isCurrentFrameComplete=function(){var t=1/this.options.fps,e=t+this.options.delay,n=(this.loopIndex*this.frames.length+this.frameIndex+1)*e-t;return this.time>n},t.prototype.isLastFrame=function(){return this.frameIndex===this.frames.length-1},t.prototype.isLoopInfinite=function(){return!0===this.options.loop},t.prototype.isLoopFinite=function(){return"number"==typeof this.options.loop},t.prototype.isLoopDisabled=function(){return!1===this.options.loop},t.prototype.isLastLoop=function(){return this.loopIndex+1===this.options.loop},t}();e.Animation=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))};e.Deferred=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=n(12),o={deltaTimeLimit:1,fps:60};!function(t){t[t.Idle=0]="Idle",t[t.Working=1]="Working",t[t.StopRequested=2]="StopRequested"}(i||(i={}));var s=function(){function t(t){var e=this;void 0===t&&(t={}),this.tick=new r.Subject,this.lastTimestamp=null,this.requestedStop=!1,this.state=i.Idle,this.loop=function(t){if(void 0===t&&(t=null),e.state!==i.Idle)if(e.state!==i.StopRequested){var n=e.getIdealDeltaTime(),r=n;null!==t&&(r=(t-e.lastTimestamp)/1e3)>e.options.deltaTimeLimit&&(r=n),e.lastTimestamp=t,e.tick.notify({deltaTime:r}),window.requestAnimationFrame(e.loop)}else e.state=i.Idle},this.options=Object.assign({},o,t)}return t.prototype.start=function(){this.state===i.Idle&&(this.state=i.Working,this.loop())},t.prototype.stop=function(){this.state===i.Working&&(this.state=i.StopRequested)},t.prototype.next=function(t){void 0===t&&(t=1);for(var e=0;e<t;e+=1)this.tick.notify({deltaTime:this.getIdealDeltaTime()})},t.prototype.getIdealDeltaTime=function(){return 1/this.options.fps},t}();e.GameLoop=s},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.collider=null,e.ignorePause=!1,e.tags=[],e.needsSetup=!0,e}return r(e,t),e.prototype.invokeUpdate=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!0===this.needsSetup&&(this.needsSetup=!1,this.setup.apply(this,t),this.updateMatrix(),this.updateWorldVisible(!0),this.updateWorldZIndex(!0)),this.update.apply(this,t)},e.prototype.invokeCollide=function(t){!0!==this.needsSetup&&this.collide(t)},e.prototype.hasBeenSetup=function(){return!this.needsSetup},e.prototype.setup=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.update=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.collide=function(t){},e.prototype.resetNeedsPaint=function(){!0!==this.needsSetup&&t.prototype.resetNeedsPaint.call(this)},e}(n(132).RenderObject);e.GameObject=o},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.painter=null,e.zIndex=null,e.worldZIndex=null,e.visible=null,e.worldVisible=null,e.prevDirtyBox=null,e.needsPaint=!0,e}return r(e,t),e.prototype.canRender=function(){return null!==this.painter&&!1!==this.getWorldVisible()},e.prototype.setVisible=function(t){this.visible=t,this.updateWorldVisible(!0)},e.prototype.getVisible=function(){return this.visible},e.prototype.getWorldVisible=function(){return this.worldVisible},e.prototype.updateWorldVisible=function(t){var e,n;void 0===t&&(t=!1),null!==this.parent&&!0===t&&this.parent.updateWorldVisible(!0),null===this.parent?this.worldVisible=null==(e=this.visible)||e:this.worldVisible=null!=(n=this.visible)?n:this.parent.worldVisible;for(var i=0,r=this.children;i<r.length;i++){r[i].updateWorldVisible()}},e.prototype.setZIndex=function(t){this.zIndex=t,this.updateWorldZIndex(!0)},e.prototype.getWorldZIndex=function(){return this.worldZIndex},e.prototype.updateWorldZIndex=function(t){var e,n;void 0===t&&(t=!1),null!==this.parent&&!0===t&&this.parent.updateWorldZIndex(!0),null===this.parent?this.worldZIndex=null!=(e=this.zIndex)?e:0:this.worldZIndex=null!=(n=this.zIndex)?n:this.parent.worldZIndex;for(var i=0,r=this.children;i<r.length;i++){r[i].updateWorldZIndex()}},e.prototype.dirtyPaintBox=function(){this.prevDirtyBox=this.getWorldBoundingBox().clone(),this.needsPaint=!0;for(var t=0,e=this.children;t<e.length;t++){e[t].dirtyPaintBox()}},e.prototype.getPrevDirtyBox=function(){return this.prevDirtyBox},e.prototype.resetPrevDirtyBox=function(){this.prevDirtyBox=null},e.prototype.setNeedsPaint=function(){this.needsPaint=!0;for(var t=0,e=this.children;t<e.length;t++){e[t].setNeedsPaint()}},e.prototype.doesNeedPaint=function(){return this.needsPaint},e.prototype.resetNeedsPaint=function(){this.needsPaint=!1},e}(n(54).Transform);e.RenderObject=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(134),r={debug:!1,dirtyPassCount:2,height:640,width:640},o=function(){function t(t){void 0===t&&(t={}),this.options=Object.assign({},r,t),this.canvas=document.createElement("canvas"),this.canvas.width=t.width,this.canvas.height=t.height,this.context=new i.CanvasRenderContext(this.canvas),this.context.init()}return t.prototype.getDomElement=function(){return this.canvas},t.prototype.render=function(t){var e=this;t.updateWorldMatrix(!1,!0);var n=[];t.traverse((function(e){e!==t&&(n.push(e),e.removedChildren.length>0&&(n.push.apply(n,e.removedChildren),e.cleanupRemoved()))}));var i=!1;if(t.doesNeedPaint()){this.clearBox(t.getWorldBoundingBox()),t.resetNeedsPaint(),i=!0;for(var r=0,o=n;r<o.length;r++){(u=o[r]).resetPrevDirtyBox()}}var s=[];if(i)s.push.apply(s,n);else{for(var a=[],l=0,c=n;l<c.length;l++){var u,p=(u=c[l]).getWorldBoundingBox();u.canRender()&&u.doesNeedPaint()&&(s.push(u),a.push(p));var h=u.getPrevDirtyBox();null!==h&&(a.push(h),u.resetPrevDirtyBox())}for(var d=0;d<this.options.dirtyPassCount;d+=1)this.findIntersectionBoxes(n,a,s);for(var f=0,y=a;f<y.length;f++){var m=y[f];this.clearBox(m)}}s.sort((function(t,e){return t.getWorldZIndex()-e.getWorldZIndex()})).forEach((function(t){e.renderObject(t)}))},t.prototype.renderObject=function(t){t.canRender()&&(t.isRemoved||(t.painter.paint(this.context,t),t.resetNeedsPaint(),this.options.debug&&this.renderDebugBox(t.getWorldBoundingBox())))},t.prototype.findIntersectionBoxes=function(t,e,n){for(var i=0,r=t;i<r.length;i++){var o=r[i];if(o.canRender()&&!o.doesNeedPaint())for(var s=o.getWorldBoundingBox(),a=0,l=e;a<l.length;a++){var c=l[a];if(s.intersectsBox(c)&&!n.includes(o)){n.push(o),e.push(s);break}}}},t.prototype.clearBox=function(t){this.context.clearRect(Math.round(t.min.x),Math.round(t.min.y),t.max.x-t.min.x,t.max.y-t.min.y)},t.prototype.renderDebugBox=function(t,e){void 0===e&&(e="#fff"),this.context.strokeRect(t.min.x,t.min.y,t.max.x-t.min.x,t.max.y-t.min.y,e)},t}();e.GameRenderer=o},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(135)),i(n(32))},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(136)),i(n(137))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.init=function(){this.context=this.canvas.getContext("2d")},e.prototype.drawImage=function(t,e,n){this.context.drawImage(t.getElement(),e.x,e.y,e.width,e.height,Math.round(n.x),Math.round(n.y),n.width,n.height)},e.prototype.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},e.prototype.clearRect=function(t,e,n,i){this.context.clearRect(t,e,n,i)},e.prototype.fillRect=function(t,e,n,i,r){void 0===r&&(r="#000"),this.context.fillStyle=r,this.context.fillRect(t,e,n,i)},e.prototype.getGlobalAlpha=function(){return this.context.globalAlpha},e.prototype.setGlobalAlpha=function(t){this.context.globalAlpha=t},e.prototype.resetAlpha=function(){this.context.globalAlpha=1},e.prototype.strokePath=function(t,e){if(void 0===e&&(e="#000"),!(t.length<1)){var n=t[0],i=t.slice(1);this.context.beginPath(),this.context.moveTo(n.x,n.y);for(var r=0,o=i;r<o.length;r++){var s=o[r];this.context.lineTo(s.x,s.y)}this.context.closePath(),this.context.strokeStyle=e,this.context.stroke()}},e.prototype.strokeRect=function(t,e,n,i,r,o){void 0===r&&(r="#000"),void 0===o&&(o=1),this.context.strokeStyle=r,this.context.lineWidth=o,this.context.strokeRect(t,e,n,i)},e}(n(32).RenderContext);e.CanvasRenderContext=o},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(57),s=n(32),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.textureMap=new Map,e}return r(e,t),e.prototype.clear=function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT)},e.prototype.clearRect=function(){},e.prototype.init=function(){this.gl=this.canvas.getContext("webgl"),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clearColor(0,0,0,0);var t=this.createShader(this.gl.VERTEX_SHADER,"\nattribute vec4 a_position;\nattribute vec2 a_texcoord;\n\nuniform mat4 u_matrix;\nuniform mat4 u_textureMatrix;\n\nvarying vec2 v_texcoord;\n\nvoid main() {\n  gl_Position = u_matrix * a_position;\n  v_texcoord = (u_textureMatrix * vec4(a_texcoord, 0, 1)).xy;;\n}\n"),e=this.createShader(this.gl.FRAGMENT_SHADER,"\nprecision mediump float;\n\nuniform sampler2D u_texture;\n\nvarying vec2 v_texcoord;\n\nvoid main() {\n  gl_FragColor = texture2D(u_texture, v_texcoord);\n}\n");this.program=this.createProgram(t,e),this.positionAttributeLocation=this.gl.getAttribLocation(this.program,"a_position"),this.texcoordAttributeLocation=this.gl.getAttribLocation(this.program,"a_texcoord"),this.matrixUniformLocation=this.gl.getUniformLocation(this.program,"u_matrix"),this.textureUniformLocation=this.gl.getUniformLocation(this.program,"u_texture"),this.textureMatruxUniformLocation=this.gl.getUniformLocation(this.program,"u_textureMatrix"),this.positionBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),this.gl.STATIC_DRAW),this.texcoordBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texcoordBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),this.gl.STATIC_DRAW)},e.prototype.drawImage=function(t,e,n){var i,r=t.getElement();this.textureMap.has(r)?i=this.textureMap.get(r):(i=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,i),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,r),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.textureMap.set(r,i)),this.gl.bindTexture(this.gl.TEXTURE_2D,i),this.gl.useProgram(this.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.enableVertexAttribArray(this.positionAttributeLocation),this.gl.vertexAttribPointer(this.positionAttributeLocation,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texcoordBuffer),this.gl.enableVertexAttribArray(this.texcoordAttributeLocation),this.gl.vertexAttribPointer(this.texcoordAttributeLocation,2,this.gl.FLOAT,!1,0,0);var s=o.Matrix4.createProjection(this.gl.canvas.width,this.gl.canvas.height,1);s.translate(n.x,n.y,0),s.scale(n.width,n.height,1),this.gl.uniformMatrix4fv(this.matrixUniformLocation,!1,s.elements);var a=o.Matrix4.createTranslation(e.x/r.naturalWidth,e.y/r.naturalHeight,0);a.scale(e.width/r.naturalWidth,e.height/r.naturalHeight,1),this.gl.uniformMatrix4fv(this.textureMatruxUniformLocation,!1,a.elements),this.gl.drawArrays(this.gl.TRIANGLES,0,6)},e.prototype.fillRect=function(){},e.prototype.getGlobalAlpha=function(){return 1},e.prototype.setGlobalAlpha=function(){return 1},e.prototype.strokeRect=function(){},e.prototype.strokePath=function(){},e.prototype.render=function(){},e.prototype.createShader=function(t,e){var n=this.gl.createShader(t);if(this.gl.shaderSource(n,e),this.gl.compileShader(n),!this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS))throw console.log(this.gl.getShaderInfoLog(n)),this.gl.deleteShader(n),new Error("Failed to create shader");return n},e.prototype.createProgram=function(t,e){var n=this.gl.createProgram();if(this.gl.attachShader(n,t),this.gl.attachShader(n,e),this.gl.linkProgram(n),!this.gl.getProgramParameter(n,this.gl.LINK_STATUS))throw console.log(this.gl.getProgramInfoLog(n)),this.gl.deleteProgram(n),new Error("Failed to create program");return n},e.prototype.setRectangle=function(t,e,n,i){var r=t,o=t+n,s=e,a=e+i;this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([r,s,o,s,r,a,r,a,o,s,o,a]),this.gl.STATIC_DRAW)},e}(s.RenderContext);e.WebglRenderContext=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.value=t,this.previousValue=null}return t.prototype.get=function(){return this.value},t.prototype.set=function(t){return this.previousValue=this.value,this.value=t,this},t.prototype.update=function(){return this.previousValue=this.value,this.value=this.value,this},t.prototype.is=function(t){return this.value===t},t.prototype.not=function(t){return this.value!==t},t.prototype.hasChanged=function(){return this.value!==this.previousValue},t.prototype.hasChangedTo=function(t){return this.value!==this.previousValue&&this.value===t},t.prototype.hasChangedFrom=function(t){return this.previousValue===t},t.prototype.hasChangedFromTo=function(t,e){return this.previousValue===t&&this.value===e},t}();e.State=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(12),r=function(){function t(t){void 0===t&&(t=null),this.done=new i.Subject,this.timeLeft=null,this.timeLeft=t}return t.prototype.reset=function(t){return this.timeLeft=t,this},t.prototype.stop=function(){return this.timeLeft=null,this},t.prototype.update=function(t){this.isActive()&&(this.timeLeft-=t,this.timeLeft<0&&(this.timeLeft=null,this.done.notify(null)))},t.prototype.isActive=function(){return null!==this.timeLeft},t.prototype.isDone=function(){return null===this.timeLeft},t}();e.Timer=r},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(141)),i(n(142)),i(n(143)),i(n(144))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(1),a=function(t){function e(e,n,i){void 0===i&&(i={});var r=t.call(this,"Collision",i)||this;return r.items=[],r.isShown=!1,r.handleShow=function(){r.show()},r.handleHide=function(){r.hide()},r.handleUpdate=function(){r.update()},r.collisionSystem=e,r.root=n,r.itemsContainer=new o.GameObject,r.appendButton("Show",r.handleShow),r.appendButton("Hide",r.handleHide),r.appendButton("Update",r.handleUpdate),r}return r(e,t),e.prototype.show=function(){this.isShown=!0,this.root.add(this.itemsContainer)},e.prototype.hide=function(){this.isShown=!1,this.root.remove(this.itemsContainer),this.clear()},e.prototype.update=function(){var t=this;this.isShown&&(this.clear(),this.collisionSystem.getCollisions().forEach((function(e){var n=t.createItem(e.box,"green");t.items.push(n),t.itemsContainer.add(n),e.contacts.forEach((function(e){var n=t.createItem(e.box,"yellow");t.items.push(n),t.itemsContainer.add(n)}))})))},e.prototype.clear=function(){this.items.forEach((function(t){t.removeSelf()})),this.items=[]},e.prototype.createItem=function(t,e){var n=t.toRect(),i=new o.GameObject(n.width,n.height);return i.position.set(n.x,n.y),i.updateMatrix(),i.setZIndex(s.DEBUG_COLLISION_RECT_Z_INDEX),i.painter=new o.RectPainter(null,e),i},e}(n(19).DebugMenu);e.DebugCollisionMenu=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e,n){void 0===n&&(n={});var i=t.call(this,"Game loop",n)||this;return i.handleStart=function(){i.gameLoop.start()},i.handleStop=function(){i.gameLoop.stop()},i.handleNextFrame=function(){i.gameLoop.next()},i.handleNextFrame10=function(){i.gameLoop.next(10)},i.gameLoop=e,i.appendButton("Start",i.handleStart),i.appendButton("Stop",i.handleStop),i.appendButton("Next frame",i.handleNextFrame),i.appendButton("Next 10 frames",i.handleNextFrame10),i}return r(e,t),e}(n(19).DebugMenu);e.DebugGameLoopMenu=o},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=function(t){function e(e){void 0===e&&(e={});var n=t.call(this,"Level Player",e)||this;return n.deathRequest=new o.Subject,n.upgradeRequest=new o.Subject,n.moveSpeedUpRequest=new o.Subject,n.handleDeath=function(){n.deathRequest.notify(null)},n.handleMoveSpeedUp=function(){n.moveSpeedUpRequest.notify(500)},n.handleUpgrade=function(){n.upgradeRequest.notify(null)},n.appendButton("Upgrade",n.handleUpgrade),n.appendButton("Die",n.handleDeath),n.appendButton("Speed +500",n.handleMoveSpeedUp),n}return r(e,t),e}(n(19).DebugMenu);e.DebugLevelPlayerMenu=s},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(15),a=n(1),l=n(78),c=function(t){function e(e,n,i){void 0===i&&(i={});var r=t.call(this,"Level Powerup",i)||this;return r.spawnRequest=new o.Subject,r.handleGridShow=function(){r.showGrid()},r.handleGridUpdate=function(){r.updateDebugGrid()},r.handleGridHide=function(){r.debugGrid.removeSelf()},r.handleSpawn=function(){r.spawnRequest.notify(null)},r.handleSpawnBaseDefence=function(){r.spawnRequest.notify(s.PowerupType.BaseDefence)},r.handleSpawnFreeze=function(){r.spawnRequest.notify(s.PowerupType.Freeze)},r.levelWorld=e,r.powerupGrid=n,r.debugGrid=new l.DebugGrid(a.FIELD_SIZE,a.FIELD_SIZE,a.TILE_SIZE_MEDIUM),r.appendButton("Show grid",r.handleGridShow),r.appendButton("Hide grid",r.handleGridHide),r.appendButton("Update grid",r.handleGridUpdate),r.appendButton("Spawn",r.handleSpawn),r.appendButton("Spawn: base defence",r.handleSpawnBaseDefence),r.appendButton("Spawn: freeze",r.handleSpawnFreeze),r}return r(e,t),e.prototype.showGrid=function(){this.levelWorld.field.add(this.debugGrid),this.updateDebugGrid()},e.prototype.updateDebugGrid=function(){var t=this;this.debugGrid.removeAllCellHighlights(),this.powerupGrid.getBlockedCellIndexes().forEach((function(e){t.debugGrid.highlightCell(e)}))},e}(n(19).DebugMenu);e.DebugLevelPowerupMenu=c},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=n(2),o=n(77),s=[o.PowerupType.BaseDefence,o.PowerupType.Freeze,o.PowerupType.Life,o.PowerupType.Shield,o.PowerupType.Upgrade,o.PowerupType.Wipeout],a=function(){function t(){}return t.create=function(t){return new r.Powerup(t)},t.createRandom=function(){var t=i.RandomUtils.arrayElement(s);return new r.Powerup(t)},t}();e.PowerupFactory=a},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(147)),i(n(67)),i(n(188)),i(n(189)),i(n(190)),i(n(68)),i(n(69))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(1),l=n(36),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.setup=function(){var t=this;a.BORDER_RECTS.forEach((function(e){var n=new l.BorderWall(e.width,e.height);n.tags=[s.Tag.EditorBlockMove],n.position.set(e.x,e.y),t.add(n)}))},e}(o.GameObject);e.EditorBorder=c},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),r=function(){function t(t,e){var n=this;this.globalMuted=!1,this.audioLoader=t,this.audioLoader.loaded.addListener((function(t){t.setGlobalMuted(n.globalMuted)})),this.storage=e}return t.prototype.setGlobalMuted=function(t){this.globalMuted=t,this.getLoadedSounds().forEach((function(e){e.setGlobalMuted(t)}))},t.prototype.isGlobalMuted=function(){return this.globalMuted},t.prototype.play=function(t){this.audioLoader.load(t).play()},t.prototype.playLoop=function(t){this.audioLoader.load(t).playLoop()},t.prototype.stop=function(t){this.audioLoader.load(t).stop()},t.prototype.pauseAll=function(){this.getLoadedSounds().forEach((function(t){t.pause()}))},t.prototype.resumeAll=function(){this.getLoadedSounds().forEach((function(t){t.canResume()&&t.resume()}))},t.prototype.stopAll=function(){this.getLoadedSounds().forEach((function(t){t.stop()}))},t.prototype.muteAllExcept=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this.getLoadedSounds();n.forEach((function(e){t.includes(e)||e.setMuted(!0)}))},t.prototype.unmuteAll=function(){this.getLoadedSounds().forEach((function(t){t.setMuted(!1)}))},t.prototype.loadSettings=function(){this.globalMuted=this.storage.getBoolean(i.STORAGE_KEY_SETTINGS_AUDIO_MUTED,!1)},t.prototype.saveSettings=function(){this.storage.setBoolean(i.STORAGE_KEY_SETTINGS_AUDIO_MUTED,this.globalMuted),this.storage.save()},t.prototype.getLoadedSounds=function(){return this.audioLoader.getAllLoaded()},t}();e.AudioManager=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Playing=0]="Playing",t[t.Paused=1]="Paused",t[t.Over=2]="Over"}(e.GameState||(e.GameState={}))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.setBoolean=function(t,e){this.set(t,e.toString())},e.prototype.getBoolean=function(t,e){void 0===e&&(e=null);var n=this.get(t),i=e;try{i=JSON.parse(n)}catch(t){}return"boolean"!=typeof i?e:i},e.prototype.setNumber=function(t,e){this.set(t,e.toString())},e.prototype.getNumber=function(t,e){void 0===e&&(e=null);var n=this.get(t),i=e;try{i=JSON.parse(n)}catch(t){}return"number"!=typeof i?e:i},e}(n(0).LocalStorage);e.GameStorage=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Up=0]="Up",t[t.Right=90]="Right",t[t.Down=180]="Down",t[t.Left=270]="Left"}(e.Rotation||(e.Rotation={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.map=new Map}return t.prototype.set=function(t,e){return this.map.set(this.round(t),e),this},t.prototype.get=function(t){return this.map.get(this.round(t))},t.prototype.forEach=function(t){return this.map.forEach(t),this},t.prototype.round=function(t){return Math.round(t)%360},t}();e.RotationMap=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=n(154);!function(t){t[t.Idle=0]="Idle",t[t.Playing=1]="Playing",t[t.GameOver=2]="GameOver"}(i||(i={}));var o=function(){function t(){this.primaryPlayer=new r.SessionPlayer,this.secondaryPlayer=new r.SessionPlayer,this.reset()}return t.prototype.start=function(t,e){this.state===i.Idle&&(this.startLevelNumber=t,this.endLevelNumber=e,this.currentLevelNumber=t,this.state=i.Playing)},t.prototype.reset=function(){this.seenIntro=!1,this.startLevelNumber=1,this.currentLevelNumber=1,this.endLevelNumber=1,this.state=i.Idle,this.playtest=!1,this.primaryPlayer.reset()},t.prototype.resetExceptIntro=function(){this.startLevelNumber=1,this.currentLevelNumber=1,this.endLevelNumber=1,this.state=i.Idle,this.playtest=!1,this.primaryPlayer.reset(),this.secondaryPlayer.reset()},t.prototype.activateNextLevel=function(){this.currentLevelNumber+=1,this.primaryPlayer.completeLevel(),this.secondaryPlayer.completeLevel()},t.prototype.getMaxPoints=function(){var t=[this.primaryPlayer.getTotalPoints(),this.secondaryPlayer.getTotalPoints()];return Math.max.apply(Math,t)},t.prototype.getLevelNumber=function(){return this.currentLevelNumber},t.prototype.isLastLevel=function(){return this.currentLevelNumber===this.endLevelNumber},t.prototype.setGameOver=function(){this.state=i.GameOver},t.prototype.isGameOver=function(){return this.state===i.GameOver},t.prototype.setSeenIntro=function(t){this.seenIntro=t},t.prototype.haveSeenIntro=function(){return this.seenIntro},t.prototype.setPlaytest=function(){this.playtest=!0},t.prototype.resetPlaytest=function(){this.playtest=!1},t.prototype.isPlaytest=function(){return this.playtest},t}();e.Session=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=n(33),o=n(6),s=n(1),a=function(){function t(){this.lifeup=new i.Subject,this.reset()}return t.prototype.reset=function(){this.levelPointsRecord=new r.PointsRecord,this.totalPoints=0,this.lastPoints=0,this.lives=s.PLAYER_INITIAL_LIVES,this.nextLifePointThreshold=s.PLAYER_EXTRA_LIVE_POINTS,this.tankTier=o.TankTier.A,this.levelFirstSpawned=!0},t.prototype.addKillPoints=function(t){this.levelPointsRecord.addKill(t),this.checkLifeup()},t.prototype.addPowerupPoints=function(t){this.levelPointsRecord.addPowerup(t),this.checkLifeup()},t.prototype.completeLevel=function(){this.totalPoints+=this.levelPointsRecord.getTotalPoints(),this.levelPointsRecord.reset(),this.resetLevelFirstSpawn()},t.prototype.getTotalPoints=function(){return this.totalPoints+this.levelPointsRecord.getTotalPoints()},t.prototype.setLastPoints=function(t){this.lastPoints=t},t.prototype.getLastPoints=function(){return this.lastPoints},t.prototype.getLevelPointsRecord=function(){return this.levelPointsRecord},t.prototype.getLivesCount=function(){return this.lives},t.prototype.isAlive=function(){return this.lives>0},t.prototype.getTankTier=function(){return this.tankTier},t.prototype.setTankTier=function(t){this.tankTier=t},t.prototype.resetTankTier=function(){this.tankTier=o.TankTier.A},t.prototype.isLevelFirstSpawn=function(){return this.levelFirstSpawned},t.prototype.setLevelSpawned=function(){this.levelFirstSpawned=!1},t.prototype.resetLevelFirstSpawn=function(){this.levelFirstSpawned=!0},t.prototype.addLife=function(){this.lives+=1,this.lifeup.notify(null)},t.prototype.removeLife=function(){this.lives-=1},t.prototype.checkLifeup=function(){this.getTotalPoints()>=this.nextLifePointThreshold&&(this.nextLifePointThreshold+=s.PLAYER_EXTRA_LIVE_POINTS,this.addLife())},t}();e.SessionPlayer=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),r=function(){function t(t){this.storage=t}return t.prototype.getPrimaryPoints=function(){return this.storage.getNumber(i.STORAGE_KEY_POINTS_HIGHSCORE_PRIMARY,0)},t.prototype.savePrimaryPoints=function(t){this.storage.setNumber(i.STORAGE_KEY_POINTS_HIGHSCORE_PRIMARY,t),this.storage.save()},t.prototype.getSecondaryPoints=function(){return this.storage.getNumber(i.STORAGE_KEY_POINTS_HIGHSCORE_SECONDARY,0)},t.prototype.saveSecondaryPoints=function(t){this.storage.setNumber(i.STORAGE_KEY_POINTS_HIGHSCORE_SECONDARY,t),this.storage.save()},t.prototype.getOverallMaxPoints=function(){var t=[this.getPrimaryPoints(),this.getSecondaryPoints(),i.DEFAULT_HIGHSCORE];return Math.max.apply(Math,t)},t}();e.PointsHighscoreManager=r},function(t,e,n){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0});var r=n(6),o=((i={})[r.TankTier.A]=100,i[r.TankTier.B]=200,i[r.TankTier.C]=300,i[r.TankTier.D]=400,i),s=function(){function t(){this.kills=[],this.powerups=[]}return t.prototype.addKill=function(t){return this.kills.push(t),this},t.prototype.addPowerup=function(t){return this.powerups.push(t),this},t.prototype.getTierKillCost=function(t){return o[t]},t.prototype.getPowerupCost=function(){return 500},t.prototype.getKillTotalCount=function(){return this.kills.length},t.prototype.getTierKillCount=function(t){return this.kills.filter((function(e){return e===t})).length},t.prototype.getTierPoints=function(t){var e=this,n=0;return this.kills.forEach((function(i){i===t&&(n+=e.getTierKillCost(i))})),n},t.prototype.getKillTotalPoints=function(){var t=this,e=0;return this.kills.forEach((function(n){e+=t.getTierKillCost(n)})),e},t.prototype.getPowerupTotalPoints=function(){return this.powerups.length*this.getPowerupCost()},t.prototype.getTotalPoints=function(){return this.getKillTotalPoints()+this.getPowerupTotalPoints()},t.prototype.reset=function(){this.kills=[],this.powerups=[]},t}();e.PointsRecord=s},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,r++)i[r]=o[s];return i};Object.defineProperty(e,"__esModule",{value:!0});var s=n(0),a=n(34),l=n(35),c=n(20),u=function(t){function e(e,n,i,r){var o=t.call(this,[],{delay:.12,loop:!0})||this;if(o.regularFrames=[],o.dropFrames=[],o.type=n,o.regularFrames=[new a.TankAnimationFrame(e,n,i,r,1)],n.party===c.TankParty.Enemy){var s=[l.TankColor.Danger];o.dropFrames=[new a.TankAnimationFrame(e,n,s,r,1)]}return o.updateFrames(),o}return r(e,t),e.prototype.updateFrames=function(){var t=o(this.regularFrames);this.type.hasDrop&&t.push.apply(t,this.dropFrames),this.resetWithFrames(t)},e}(s.Animation);e.TankIdleAnimation=u},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,r++)i[r]=o[s];return i};Object.defineProperty(e,"__esModule",{value:!0});var s=n(0),a=n(34),l=n(35),c=n(20),u=function(t){function e(e,n,i,r){var o=t.call(this,[],{delay:.02,loop:!0})||this;if(o.regularFrames=[],o.dropFrames=[],o.type=n,o.regularFrames=[new a.TankAnimationFrame(e,n,i,r,1),new a.TankAnimationFrame(e,n,i,r,2),new a.TankAnimationFrame(e,n,i,r,1),new a.TankAnimationFrame(e,n,i,r,2)],n.party===c.TankParty.Enemy){var s=[l.TankColor.Danger];o.dropFrames=[new a.TankAnimationFrame(e,n,s,r,1),new a.TankAnimationFrame(e,n,s,r,2),new a.TankAnimationFrame(e,n,s,r,1),new a.TankAnimationFrame(e,n,s,r,2)]}return o.updateFrames(),o}return r(e,t),e.prototype.updateFrames=function(){var t=o(this.regularFrames);this.type.hasDrop&&t.push.apply(t,this.dropFrames),this.resetWithFrames(t)},e}(s.Animation);e.TankMoveAnimation=u},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=n(0),a=n(3),l=n(1),c=n(17);!function(t){t[t.Moving=0]="Moving",t[t.Thinking=1]="Thinking",t[t.UnstuckThinking=2]="UnstuckThinking",t[t.Firing=3]="Firing"}(o||(o={}));var u=[a.Rotation.Up,a.Rotation.Down,a.Rotation.Left,a.Rotation.Right],p=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.state=o.Moving,n.lastPosition=new s.Vector(-1,-1),n.thinkTimer=new s.Timer,n.fireTimer=new s.Timer,n.log=new s.Logger(e.name,s.Logger.Level.Info),n}return r(e,t),e.prototype.update=function(t,e){this.fireTimer.isDone()?(t.fire()?(this.log.debug("Fire!"),this.state===o.Firing&&(this.state=o.Moving)):this.log.debug("Could not fire :("),this.attemptFire()):this.fireTimer.update(e.deltaTime);if(this.state!==o.Firing){if(this.state!==o.Thinking&&this.state!==o.UnstuckThinking){t.move(e.deltaTime);var n=t.position.clone().round();return this.lastPosition.equals(n)&&this.state===o.Moving?(this.log.debug("I am stuck. Thinking..."),this.state=o.Thinking,void this.thinkTimer.reset(.3)):this.shouldThinkWhenUnstuck(t)?(this.log.debug("I changed my mind all of a sudden. Thinking..."),this.state=o.UnstuckThinking,void this.thinkTimer.reset(.3)):void(this.lastPosition=n)}if(this.thinkTimer.isDone()){if(this.state===o.Thinking&&this.shouldFireWhenStuck())return this.log.debug("I am done thinking. I want to fire!"),void(this.state=o.Firing);this.state=o.Moving;var i=this.getNextRotation(t);return this.log.debug("I am done thinking. Rotating %s",i),void t.rotate(i)}this.thinkTimer.update(e.deltaTime)}},e.prototype.attemptFire=function(){var t=s.RandomUtils.number(0,1500)/1e3;this.log.debug("I will try to fire in %f seconds",t),this.fireTimer.reset(t)},e.prototype.shouldThinkWhenUnstuck=function(t){var e=s.RandomUtils.number(1,100)<=5,n=t.rotation,i=t.position,r=n===a.Rotation.Up||n===a.Rotation.Down,o=n===a.Rotation.Left||n===a.Rotation.Right,c=l.TILE_SIZE_MEDIUM,u=o&&i.x%c==0,p=r&&i.y%c==0;return e&&(u||p)},e.prototype.shouldFireWhenStuck=function(){return s.RandomUtils.probability(30)},e.prototype.getNextRotation=function(t){return s.RandomUtils.probability(30)?(this.log.debug("I want to go towards base"),this.getRotationTowardsBase(t)):this.getRandomRotation()},e.prototype.getRandomRotation=function(){return s.RandomUtils.arrayElement(u)},e.prototype.getRandomRotationExcept=function(t){var e=u.slice(),n=e.indexOf(t);return e.splice(n,1),s.RandomUtils.arrayElement(e)},e.prototype.getRotationTowardsBase=function(t){var e=new s.Vector(l.BASE_DEFAULT_POSITION.x,l.BASE_DEFAULT_POSITION.y),n=t.position,i=e.clone().sub(n).normalize(),r=Math.max(i.x,i.y);if(Math.abs(i.x)===Math.abs(r)){if(i.x>0)return a.Rotation.Right;if(i.x<0)return a.Rotation.Left}return a.Rotation.Down},e}(c.TankBehavior);e.AiTankBehavior=p},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.update=function(e,n){t.prototype.update.call(this,e,n),e.fire()},e}(n(61).PatrolTankBehavior);e.PatrolFireTankBehavior=o},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,r++)i[r]=o[s];return i};Object.defineProperty(e,"__esModule",{value:!0});var s=n(3),a=n(2),l=n(7),c=n(17),u=o(l.LevelPlayInputContext.MoveUp,l.LevelPlayInputContext.MoveDown,l.LevelPlayInputContext.MoveLeft,l.LevelPlayInputContext.MoveRight),p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.update=function(t,e){var n=e.deltaTime,i=e.input;i.isDownAny(l.LevelPlayInputContext.Fire)&&t.fire(),i.isHoldAny(l.LevelPlayInputContext.RapidFire)&&t.fire(),t.isSliding()||(i.isHoldLastAny(l.LevelPlayInputContext.MoveUp)&&t.rotate(s.Rotation.Up),i.isHoldLastAny(l.LevelPlayInputContext.MoveDown)&&t.rotate(s.Rotation.Down),i.isHoldLastAny(l.LevelPlayInputContext.MoveLeft)&&t.rotate(s.Rotation.Left),i.isHoldLastAny(l.LevelPlayInputContext.MoveRight)&&t.rotate(s.Rotation.Right),i.isHoldAny(u)&&t.move(n)),i.isNotHoldAll(u)&&t.state!==a.TankState.Idle&&t.idle()},e}(c.TankBehavior);e.PlayerTankBehavior=p},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(11),a=function(t){function e(){var e=t.call(this)||this;return e.setDefault(s.InputControl.Up,o.GamepadButtonCode.Up),e.setDefault(s.InputControl.Down,o.GamepadButtonCode.Down),e.setDefault(s.InputControl.Left,o.GamepadButtonCode.Left),e.setDefault(s.InputControl.Right,o.GamepadButtonCode.Right),e.setDefault(s.InputControl.Select,o.GamepadButtonCode.Start),e.setDefault(s.InputControl.PrimaryAction,o.GamepadButtonCode.X),e.setDefault(s.InputControl.SecondaryAction,o.GamepadButtonCode.Y),e.setDefault(s.InputControl.Rewind,o.GamepadButtonCode.A),e.setDefault(s.InputControl.FastForward,o.GamepadButtonCode.B),e}return r(e,t),e}(o.InputBinding);e.GamepadInputBinding=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(11),a=function(t){function e(){var e=t.call(this)||this;return e.setDefault(s.InputControl.Up,o.KeyboardButtonCode.Up),e.setDefault(s.InputControl.Down,o.KeyboardButtonCode.Down),e.setDefault(s.InputControl.Left,o.KeyboardButtonCode.Left),e.setDefault(s.InputControl.Right,o.KeyboardButtonCode.Right),e.setDefault(s.InputControl.Select,o.KeyboardButtonCode.Enter),e.setDefault(s.InputControl.PrimaryAction,o.KeyboardButtonCode.Z),e.setDefault(s.InputControl.SecondaryAction,o.KeyboardButtonCode.X),e.setDefault(s.InputControl.Rewind,o.KeyboardButtonCode.A),e.setDefault(s.InputControl.FastForward,o.KeyboardButtonCode.S),e}return r(e,t),e}(o.InputBinding);e.KeyboardInputBinding=a},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(165)),i(n(166)),i(n(167)),i(n(168)),i(n(169)),i(n(170)),i(n(171))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(11);e.EditorHintInputContext={Skip:[i.InputControl.Select,i.InputControl.PrimaryAction]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(11);e.EditorMapInputContext={MoveUp:[i.InputControl.Up],MoveDown:[i.InputControl.Down],MoveLeft:[i.InputControl.Left],MoveRight:[i.InputControl.Right],Draw:[i.InputControl.PrimaryAction],Erase:[i.InputControl.SecondaryAction],NextBrush:[i.InputControl.FastForward],PrevBrush:[i.InputControl.Rewind],Menu:[i.InputControl.Select]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(11);e.LevelHintInputContext={Skip:[i.InputControl.Select,i.InputControl.PrimaryAction]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(11);e.LevelPlayInputContext={MoveUp:[i.InputControl.Up],MoveDown:[i.InputControl.Down],MoveLeft:[i.InputControl.Left],MoveRight:[i.InputControl.Right],Fire:[i.InputControl.PrimaryAction],RapidFire:[i.InputControl.SecondaryAction],Pause:[i.InputControl.Select]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(11);e.LevelSelectionInputContext={Next:[i.InputControl.Right],Prev:[i.InputControl.Left],FastNext:[i.InputControl.Up],FastPrev:[i.InputControl.Down],Select:[i.InputControl.Select,i.InputControl.PrimaryAction]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(11);e.LevelScoreInputContext={Skip:[i.InputControl.Select,i.InputControl.PrimaryAction]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(11);e.MenuInputContext={VerticalPrev:[i.InputControl.Up],VerticalNext:[i.InputControl.Down],HorizontalNext:[i.InputControl.Right],HorizontalPrev:[i.InputControl.Left],Skip:[i.InputControl.PrimaryAction,i.InputControl.Select],Select:[i.InputControl.PrimaryAction,i.InputControl.Select]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.asString=function(t){switch(t){case 0:return"A";case 1:return"B";case 2:return"X";case 3:return"Y";case 4:return"LB";case 5:return"RB";case 6:return"LT";case 7:return"RT";case 8:return"SELECT/BACK";case 9:return"START";case 10:return"LEFT AXIS";case 11:return"RIGHT AXIS";case 12:return"D-UP";case 13:return"D-DOWN";case 14:return"D-LEFT";case 15:return"D-RIGHT"}return"GP["+t+"]"},t}();e.GamepadButtonCodePresenter=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.asString=function(t){if(t>=48&&t<=57)return String.fromCharCode(t);if(t>=65&&t<=90)return String.fromCharCode(t).toUpperCase();if(t>=96&&t<=105)return"NUM "+(t-96);switch(t){case 9:return"TAB";case 13:return"ENTER";case 16:return"SHIFT";case 17:return"CTRL";case 18:return"ALT";case 20:return"CAPS";case 32:return"SPACE";case 32:return"HOME";case 33:return"PAGE UP";case 34:return"PAGE DOWN";case 35:return"END";case 37:return"ARROW LEFT";case 38:return"ARROW UP";case 39:return"ARROW RIGHT";case 40:return"ARROW DOWN"}return"KB["+t+"]"},t}();e.KeyboardButtonCodePresenter=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(11),r=function(){function t(){}return t.asString=function(t,e){switch(void 0===e&&(e="???"),t){case i.InputControl.Up:return"MOVE UP";case i.InputControl.Down:return"MOVE DOWN";case i.InputControl.Left:return"MOVE LEFT";case i.InputControl.Right:return"MOVE RIGHT";case i.InputControl.PrimaryAction:return"FIRE";case i.InputControl.SecondaryAction:return"RAPID FIRE";case i.InputControl.Select:return"SELECT/PAUSE";default:return e}},t}();e.InputControlPresenter=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),r=function(){function t(t){this.storage=t}return t.prototype.shouldShowLevelHint=function(){var t=this.getShowLevelHint();return null!==t?t:t=!this.getSeenLevelHint()},t.prototype.shouldShowEditorHint=function(){var t=this.getShowEditorHint();return null!==t?t:t=!this.getSeenEditorHint()},t.prototype.setShowLevelHint=function(t){this.storage.setBoolean(i.STORAGE_KEY_SETTINGS_SHOW_LEVEL_HINT,t),this.storage.save()},t.prototype.getShowLevelHint=function(){return this.storage.getBoolean(i.STORAGE_KEY_SETTINGS_SHOW_LEVEL_HINT,null)},t.prototype.setShowEditorHint=function(t){this.storage.setBoolean(i.STORAGE_KEY_SETTINGS_SHOW_EDITOR_HINT,t),this.storage.save()},t.prototype.getShowEditorHint=function(){return this.storage.getBoolean(i.STORAGE_KEY_SETTINGS_SHOW_EDITOR_HINT,null)},t.prototype.setSeenLevelHint=function(){this.storage.setBoolean(i.STORAGE_KEY_SETTINGS_SEEN_LEVEL_HINT,!0),this.storage.save()},t.prototype.getSeenLevelHint=function(){return this.storage.getBoolean(i.STORAGE_KEY_SETTINGS_SEEN_LEVEL_HINT,!1)},t.prototype.setSeenEditorHint=function(){this.storage.setBoolean(i.STORAGE_KEY_SETTINGS_SEEN_EDITOR_HINT,!0),this.storage.save()},t.prototype.getSeenEditorHint=function(){return this.storage.getBoolean(i.STORAGE_KEY_SETTINGS_SEEN_EDITOR_HINT,!1)},t}();e.InputHintSettings=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r={activationDelay:0,delay:0},o=function(){function t(t,e,n){this.controls=t,this.callback=e,this.options=Object.assign({},r,n),this.timer=new i.Timer(n.activationDelay)}return t.prototype.update=function(t,e){(t.isDownAny(this.controls)||t.isUpAny(this.controls))&&this.timer.reset(this.options.activationDelay),t.isHoldAny(this.controls)&&(this.timer.isDone()?(this.callback(),this.timer.reset(this.options.delay)):this.timer.update(e))},t}();e.InputHoldThrottle=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=n(1),o=n(62),s=n(63),a=n(64),l=function(){function t(t){this.variants=new Map,this.currentVariant=null,this.storage=t,this.input=new i.Input,this.variants.set(a.InputDeviceType.Keyboard,{binding:new o.KeyboardInputBinding,device:new i.KeyboardInputDevice,presenter:new s.KeyboardButtonCodePresenter}),this.variants.set(a.InputDeviceType.Gamepad,{binding:new o.GamepadInputBinding,device:new i.GamepadInputDevice,presenter:new s.GamepadButtonCodePresenter}),this.variants.size>0&&this.activateVariant(this.variants.values().next().value)}return t.prototype.getBinding=function(t){return this.variants.has(t)?this.variants.get(t).binding:null},t.prototype.getDevice=function(t){return this.variants.has(t)?this.variants.get(t).device:null},t.prototype.getPresenter=function(t){return this.variants.has(t)?this.variants.get(t).presenter:null},t.prototype.getCurrentBinding=function(){return this.currentVariant.binding},t.prototype.getCurrentPresenter=function(){return this.currentVariant.presenter},t.prototype.getInput=function(){return this.input},t.prototype.listen=function(){this.variants.forEach((function(t){t.device.listen()}))},t.prototype.unlisten=function(){this.variants.forEach((function(t){t.device.unlisten()}))},t.prototype.update=function(){var t=this;this.variants.forEach((function(e){var n=e.device;n.update();var i=n.getDownCodes().length>0,r=e===t.currentVariant;!i||r||t.activateVariant(e)}))},t.prototype.loadAllBindings=function(){var t=this;this.variants.forEach((function(e,n){var i=e.binding,r=t.getBindingStorageKey(n),o=t.storage.get(r);i.fromJSON(o)}))},t.prototype.saveBinding=function(t){var e=this.getBinding(t),n=this.getBindingStorageKey(t),i=e.toJSON();this.storage.set(n,i),this.storage.save()},t.prototype.getPresentedControlCode=function(t){var e=this.getCurrentBinding(),n=this.getCurrentPresenter(),i=e.get(t);return n.asString(i)},t.prototype.activateVariant=function(t){this.currentVariant=t,this.input.setDevice(t.device),this.input.setBinding(t.binding)},t.prototype.getBindingStorageKey=function(t){return r.STORAGE_KEY_SETTINGS_INPUT_BINDINGS_PRIMARY+"_"+t.toString()},t}();e.InputManager=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.update=function(t){t.fire()},e}(n(17).TankBehavior);e.StandFireTankBehavior=o},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.update=function(){},e}(n(17).TankBehavior);e.StandStillTankBehavior=o},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=n(0),a=n(17);!function(t){t[t.Moving=0]="Moving",t[t.Prefire=1]="Prefire",t[t.Firing=2]="Firing",t[t.Done=3]="Done"}(o||(o={}));var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.stopped=new s.Subject,e.fired=new s.Subject,e.moveTimer=new s.Timer(3),e.prefireTimer=new s.Timer(1),e.fireCounter=0,e.state=o.Moving,e}return r(e,t),e.prototype.update=function(t,e){if(this.state!==o.Done){if(this.state===o.Moving)return this.moveTimer.isDone()?(this.state=o.Prefire,this.stopped.notify(null),void t.idle()):(t.move(e.deltaTime),void this.moveTimer.update(e.deltaTime));if(this.state===o.Prefire)return this.prefireTimer.isDone()?void(this.state=o.Firing):void this.prefireTimer.update(e.deltaTime);if(!this.moveTimer.isActive())t.fire()&&(this.fired.notify(null),this.fireCounter+=1,this.fireCounter<1||(this.state=o.Done))}},e}(a.TankBehavior);e.VictoryTankBehavior=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r,o,s=n(65),a=n(20),l=n(21);!function(t){t[t.Slow=.16]="Slow",t[t.Fast=.04]="Fast"}(i||(i={})),function(t){t[t.Slow=600]="Slow",t[t.Fast=900]="Fast"}(r||(r={})),function(t){t[t.Slow=120]="Slow",t[t.Medium=180]="Medium",t[t.Fast=240]="Fast"}(o||(o={}));var c={list:[{selector:{party:a.TankParty.Player,tier:l.TankTier.A},attributes:{bulletMaxCount:1,bulletRapidFireDelay:i.Slow,bulletSpeed:r.Slow,bulletTankDamage:1,bulletWallDamage:s.TankBulletWallDamage.Low,health:1,moveSpeed:o.Medium}},{selector:{party:a.TankParty.Player,tier:l.TankTier.B},attributes:{bulletMaxCount:1,bulletRapidFireDelay:i.Slow,bulletSpeed:r.Fast,bulletTankDamage:1,bulletWallDamage:s.TankBulletWallDamage.Low,health:1,moveSpeed:o.Medium}},{selector:{party:a.TankParty.Player,tier:l.TankTier.C},attributes:{bulletMaxCount:2,bulletRapidFireDelay:i.Fast,bulletSpeed:r.Fast,bulletTankDamage:1,bulletWallDamage:s.TankBulletWallDamage.Low,health:1,moveSpeed:o.Medium}},{selector:{party:a.TankParty.Player,tier:l.TankTier.D},attributes:{bulletMaxCount:2,bulletRapidFireDelay:i.Fast,bulletSpeed:r.Fast,bulletTankDamage:1,bulletWallDamage:s.TankBulletWallDamage.High,health:1,moveSpeed:o.Medium}},{selector:{party:a.TankParty.Enemy,tier:l.TankTier.A},attributes:{bulletMaxCount:1,bulletRapidFireDelay:i.Slow,bulletSpeed:r.Slow,bulletTankDamage:1,bulletWallDamage:s.TankBulletWallDamage.Low,health:1,moveSpeed:o.Slow}},{selector:{party:a.TankParty.Enemy,tier:l.TankTier.B},attributes:{bulletMaxCount:1,bulletRapidFireDelay:i.Slow,bulletSpeed:r.Slow,bulletTankDamage:1,bulletWallDamage:s.TankBulletWallDamage.Low,health:1,moveSpeed:o.Fast}},{selector:{party:a.TankParty.Enemy,tier:l.TankTier.C},attributes:{bulletMaxCount:1,bulletRapidFireDelay:i.Slow,bulletSpeed:r.Fast,bulletTankDamage:1,bulletWallDamage:s.TankBulletWallDamage.Low,health:1,moveSpeed:o.Slow}},{selector:{party:a.TankParty.Enemy,tier:l.TankTier.D},attributes:{bulletMaxCount:1,bulletRapidFireDelay:i.Slow,bulletSpeed:r.Slow,bulletTankDamage:1,bulletWallDamage:s.TankBulletWallDamage.Low,health:4,moveSpeed:o.Slow}}]},u=function(){function t(){}return t.create=function(t){var e=c.list.find((function(e){var n=e.selector;return n.party===t.party&&n.tier===t.tier}));if(void 0===e)throw new Error('Tank attributes not found for type = "'+t.serialize()+'"');return Object.assign({},e.attributes)},t}();e.TankAttributesFactory=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.Bullet="bullet",t.WipeoutPowerup="wipeout"}(e.TankDeathReason||(e.TankDeathReason={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(60),o=n(66),s=function(){function t(){}return t.createPlayer=function(t,e){return void 0===t&&(t=o.TankType.PlayerA()),void 0===e&&(e=new r.PlayerTankBehavior),new i.PlayerTank(t,e)},t.createPlayerType=function(){return o.TankType.PlayerA()},t.createEnemy=function(t,e){return void 0===t&&(t=o.TankType.EnemyA()),void 0===e&&(e=new r.AiTankBehavior),new i.EnemyTank(t,e)},t}();e.TankFactory=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=n(2),o=n(58),s=function(){function t(t,e,n){this.rotation=i.Rotation.Up,this.tankState=r.TankState.Uninitialized,this.moveAnimationMap=new i.RotationMap,this.idleAnimationMap=new i.RotationMap,this.idleAnimationMap.set(i.Rotation.Up,new o.TankIdleAnimation(t,e,n,i.Rotation.Up)),this.idleAnimationMap.set(i.Rotation.Down,new o.TankIdleAnimation(t,e,n,i.Rotation.Down)),this.idleAnimationMap.set(i.Rotation.Left,new o.TankIdleAnimation(t,e,n,i.Rotation.Left)),this.idleAnimationMap.set(i.Rotation.Right,new o.TankIdleAnimation(t,e,n,i.Rotation.Right)),this.moveAnimationMap.set(i.Rotation.Up,new o.TankMoveAnimation(t,e,n,i.Rotation.Up)),this.moveAnimationMap.set(i.Rotation.Down,new o.TankMoveAnimation(t,e,n,i.Rotation.Down)),this.moveAnimationMap.set(i.Rotation.Left,new o.TankMoveAnimation(t,e,n,i.Rotation.Left)),this.moveAnimationMap.set(i.Rotation.Right,new o.TankMoveAnimation(t,e,n,i.Rotation.Right)),this.currentAnimationMap=this.idleAnimationMap}return t.prototype.update=function(t,e){(this.rotation=t.rotation,t.state!==this.tankState)?(this.tankState=t.state,this.currentAnimationMap=t.state===r.TankState.Idle?this.idleAnimationMap:this.moveAnimationMap,this.currentAnimationMap.get(t.rotation).reset()):this.currentAnimationMap.get(this.rotation).update(e)},t.prototype.updateFrames=function(){this.idleAnimationMap.forEach((function(t){t.updateFrames()})),this.moveAnimationMap.forEach((function(t){t.updateFrames()}))},t.prototype.getCurrentFrame=function(){return this.currentAnimationMap.get(this.rotation).getCurrentFrame()},t}();e.TankSkinAnimation=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.V100=100]="V100",t[t.V200=200]="V200",t[t.V300=300]="V300",t[t.V400=400]="V400",t[t.V500=500]="V500"}(e.PointsValue||(e.PointsValue={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.BlockMove="BlockMove",t.EditorBlockMove="EditorBlockMove",t.Tank="Tank",t.Enemy="Enemy",t.Player="Player",t.Bullet="Bullet",t.Powerup="Powerup",t.Wall="Wall",t.Border="Border",t.Brick="Brick",t.Steel="Steel",t.Ice="Ice"}(e.Tag||(e.Tag={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=n(2),o=n(1),s=n(37),a=function(){function t(){}return t.createMapFromRegionConfigs=function(t){var e=this,n=this.mapRegionConfigsByType(t),i=[];return n.forEach((function(t,n){var r=e.createMapFromRegions(n,t);i.push.apply(i,r)})),i},t.createMapFromRegions=function(t,e){var n=this;if(t===s.TerrainType.Brick)return this.createMapFromBrickRegions(e);var i=[];return e.forEach((function(e){var r=n.createFromRegion(t,e);i.push.apply(i,r)})),i},t.createFromRegionConfigs=function(t){var e=this,n=this.mapRegionConfigsByType(t),i=[];return n.forEach((function(t,n){var r=e.createFromRegions(n,t);i.push.apply(i,r)})),i},t.createFromRegions=function(t,e){var n=this,i=[];return e.forEach((function(e){var r=n.createFromRegion(t,e);i.push.apply(i,r)})),i},t.validateRegion=function(t,e){var n=e.x,i=e.y,r=e.width,o=e.height,s=this.getTileSize(t);return n%s.width!=0?this.createTileSizeError(t,e,"x",s.width):i%s.height!=0?this.createTileSizeError(t,e,"y",s.height):r%s.width!=0?this.createTileSizeError(t,e,"width",s.width):o%s.height!=0?this.createTileSizeError(t,e,"height",s.height):void 0},t.validateRegionConfigs=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e],o=new i.Rect(r.x,r.y,r.width,r.height),s=this.validateRegion(r.type,o);if(void 0!==s)return s}},t.createFromRegion=function(t,e){for(var n=e.x,i=e.y,r=e.width,o=e.height,s=this.getTileSize(t),a=[],l=n;l<n+r;l+=s.width)for(var c=i;c<i+o;c+=s.height){var u=this.createTile(t);u.position.set(l,c),a.push(u)}return a},t.createMapFromBrickRegions=function(t){for(var e=o.BRICK_SUPER_TILE_SIZE,n=o.FIELD_SIZE/e,a=[],l=0;l<n;l+=1){a[l]=[];for(var c=0;c<n;c+=1)a[l][c]=[]}for(var u=o.BRICK_TILE_SIZE,p=o.FIELD_SIZE/u,h=e/u,d=0,f=t;d<f.length;d++){var y=f[d],m=new i.Vector(Math.max(0,Math.floor(y.x/u)),Math.max(0,Math.floor(y.y/u))),g=new i.Vector(Math.min(p,Math.ceil((y.x+y.width)/u)),Math.min(p,Math.ceil((y.y+y.height)/u)));for(l=m.y;l<g.y;l+=1)for(c=m.x;c<g.x;c+=1){var v=Math.floor(l/h),_=Math.floor(c/h),b=c%h*u,w=l%h*u,S=this.createTile(s.TerrainType.Brick);S.position.set(b,w),a[v][_].push(S)}}var T=[];for(l=0;l<n;l+=1)for(c=0;c<n;c+=1){var O=a[l][c];if(0!==O.length){b=c*e,w=l*e;var x=new r.BrickSuperTerrainTile(O);x.position.set(b,w),T.push(x)}}return T},t.mapRegionConfigsByType=function(t){for(var e=new Map,n=0,r=t;n<r.length;n++){var o=r[n],s=o.type,a=new i.Rect(o.x,o.y,o.width,o.height),l=e.get(s)||[];l.push(a),e.set(s,l)}return e},t.createTile=function(t){switch(t){case s.TerrainType.Brick:return new r.BrickTerrainTile;case s.TerrainType.Steel:return new r.SteelTerrainTile;case s.TerrainType.Jungle:return new r.JungleTerrainTile;case s.TerrainType.Water:return new r.WaterTerrainTile;case s.TerrainType.Ice:return new r.IceTerrainTile;case s.TerrainType.MenuBrick:return new r.MenuBrickTerrainTile;case s.TerrainType.InverseBrick:return new r.InverseBrickTerrainTile;case s.TerrainType.BlueBrick:return new r.BlueBrickTerrainTile;default:throw new Error('Tile object for "'+t+'" not defined')}},t.getTileSize=function(t){switch(t){case s.TerrainType.Brick:return new i.Size(o.BRICK_TILE_SIZE,o.BRICK_TILE_SIZE);case s.TerrainType.BrickSuper:return new i.Size(o.BRICK_SUPER_TILE_SIZE,o.BRICK_SUPER_TILE_SIZE);case s.TerrainType.Steel:return new i.Size(o.STEEL_TILE_SIZE,o.STEEL_TILE_SIZE);case s.TerrainType.Jungle:return new i.Size(o.JUNGLE_TILE_SIZE,o.JUNGLE_TILE_SIZE);case s.TerrainType.Water:return new i.Size(o.WATER_TILE_SIZE,o.WATER_TILE_SIZE);case s.TerrainType.Ice:return new i.Size(o.ICE_TILE_SIZE,o.ICE_TILE_SIZE);case s.TerrainType.MenuBrick:case s.TerrainType.InverseBrick:case s.TerrainType.BlueBrick:return new i.Size(o.BRICK_TILE_SIZE,o.BRICK_TILE_SIZE);default:throw new Error('Tile size for "'+t+'" not defined')}},t.createTileSizeError=function(t,e,n,i){var r='Map tile "'+t+'" with properties '+e.toString()+' has invalid property "'+n+'": it must be divisible by tile size "'+i+'"';return new Error(r)},t}();e.TerrainFactory=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(6),l=n(1),c=function(t){function e(e){void 0===e&&(e=[]);var n=t.call(this,96,96)||this;return n.painter=new o.RectPainter(null,l.COLOR_WHITE),n.animations=[],n.selectedIndex=-1,n.types=e,n}return r(e,t),e.prototype.show=function(t){var e=this.types.findIndex((function(e){return e.equals(t)}));this.selectedIndex=e,-1===this.selectedIndex?this.setVisible(!1):this.setVisible(!0),this.setNeedsPaint()},e.prototype.setup=function(t){var e=t.spriteLoader;this.container=new o.GameObject(64,64),this.container.updateMatrix(),this.container.setCenter(this.getSelfCenter()),this.container.painter=new o.SpritePainter,this.add(this.container),this.animations=this.types.map((function(t){return new a.TankIdleAnimation(e,t,[a.TankColor.Default],s.Rotation.Up)}))},e.prototype.update=function(t){var e=t.deltaTime,n=this.animations[this.selectedIndex];if(void 0!==n){n.update(e);var i=n.getCurrentFrame().getSprite(0);this.container.painter.sprite=i,this.setNeedsPaint()}},e}(o.GameObject);e.EditorEnemyPreview=c},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(2),l=n(6),c=n(1),u=n(68),p=function(t){function e(){return t.call(this,c.FIELD_SIZE,c.FIELD_SIZE)||this}return r(e,t),e.prototype.setup=function(t){var e=this,n=t.collisionSystem;this.base=new a.Base,this.base.collider=new o.BoxCollider(this.base,!1),this.base.tags=[s.Tag.EditorBlockMove],this.base.position.set(c.BASE_DEFAULT_POSITION.x,c.BASE_DEFAULT_POSITION.y),n.register(this.base.collider),this.add(this.base),c.PLAYER_DEFAULT_SPAWN_POSITIONS.forEach((function(t){var n=new u.EditorTankDummy(l.TankType.PlayerA(),l.TankColor.Primary);n.position.set(t.x,t.y),e.add(n)})),c.ENEMY_DEFAULT_SPAWN_POSITIONS.forEach((function(t){var n=new u.EditorTankDummy(l.TankType.EnemyA(),l.TankColor.Default,s.Rotation.Down);n.position.set(t.x,t.y),e.add(n)}))},e.prototype.update=function(){this.base.collider.update()},e}(o.GameObject);e.EditorField=p},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(5),a=n(1),l=n(67),c=n(69),u=function(t){function e(e){var n=t.call(this,a.FIELD_SIZE,a.FIELD_SIZE)||this;return n.handleDraw=function(){var t;n.clearRect(n.tool.getBoundingBox().toRect());var e={type:n.tool.getSelectedBrush().type,x:n.tool.position.x,y:n.tool.position.y,width:n.tool.size.width,height:n.tool.size.height};n.mapConfig.addTerrainRegion(e);var i=s.TerrainFactory.createFromRegionConfigs([e]);(t=n.container).add.apply(t,i)},n.handleErase=function(){n.clearRect(n.tool.getBoundingBox().toRect())},n.mapConfig=e,n}return r(e,t),e.prototype.setup=function(){var t=this;this.container=new o.GameObject,this.container.size.copyFrom(this.size),this.add(this.container),this.mapConfig.getTerrainRegions().forEach((function(e){var n,i=s.TerrainFactory.createFromRegionConfigs([e]);(n=t.container).add.apply(n,i)}));var e=a.TILE_SIZE_SMALL,n=a.TILE_SIZE_MEDIUM,i=a.TILE_SIZE_LARGE;this.brushes=[new l.EditorBrush(e,e,s.TerrainType.Brick),new l.EditorBrush(n,n,s.TerrainType.Brick),new l.EditorBrush(i,i,s.TerrainType.Brick),new l.EditorBrush(n,n,s.TerrainType.Steel),new l.EditorBrush(i,i,s.TerrainType.Steel),new l.EditorBrush(n,n,s.TerrainType.Jungle),new l.EditorBrush(i,i,s.TerrainType.Jungle),new l.EditorBrush(n,n,s.TerrainType.Water),new l.EditorBrush(i,i,s.TerrainType.Water),new l.EditorBrush(n,n,s.TerrainType.Ice),new l.EditorBrush(i,i,s.TerrainType.Ice)],this.tool=new c.EditorTool,this.tool.position.set(64,64),this.tool.setBrushes(this.brushes),this.tool.draw.addListener(this.handleDraw),this.tool.erase.addListener(this.handleErase),this.add(this.tool)},e.prototype.clearRect=function(t){for(var e=this.container.children,n=e.length-1;n>=0;n-=1){var i=e[n];i.getBoundingBox().toRect().intersectsRect(t)&&i.removeSelf()}this.mapConfig.clearTerrainRect(t)},e}(o.GameObject);e.EditorMap=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(192))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(1),a=n(193),l=n(195),c=n(203),u=function(t){function e(){var e=t.call(this,64,768)||this;return e.zIndex=s.LEVEL_INFO_Z_INDEX,e.enemyCounter=new a.LevelEnemyCounter,e.livesCounter=new l.LevelLivesCounter,e.levelNumberCounter=new c.LevelNumberCounter,e}return r(e,t),e.prototype.setup=function(){this.add(this.enemyCounter),this.livesCounter.position.setY(444),this.add(this.livesCounter),this.levelNumberCounter.position.setY(636),this.add(this.levelNumberCounter)},e.prototype.setLevelNumber=function(t){this.levelNumberCounter.setLevelNumber(t)},e.prototype.setLivesCount=function(t){this.livesCounter.setCount(t)},e.prototype.setEnemyCount=function(t){this.enemyCounter.setCount(t)},e}(o.GameObject);e.LevelInfo=u},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(194),a=function(t){function e(e){void 0===e&&(e=0);var n=t.call(this,64,320)||this;return n.count=0,n.count=e,n}return r(e,t),e.prototype.setCount=function(t){this.count=t,this.removeAllChildren(),this.addItems(t),this.dirtyPaintBox()},e.prototype.setup=function(){this.addItems(this.count)},e.prototype.addItems=function(t){for(var e=0;e<t;e+=1){var n=new s.LevelEnemyCounterItem,i=n.size.width*(e%2),r=n.size.height*Math.floor(e/2);n.position.set(i,r),this.add(n)}},e}(o.GameObject);e.LevelEnemyCounter=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=function(t){function e(){var e=t.call(this,32,32)||this;return e.painter=new o.SpritePainter,e}return r(e,t),e.prototype.setup=function(t){var e=t.spriteLoader;this.painter.sprite=e.load("ui.enemy")},e}(o.GameObject);e.LevelEnemyCounterItem=s},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(13),a=function(t){function e(){var e=t.call(this,64,64)||this;return e.title=new s.SpriteText("ⅠP"),e.livesText=new s.SpriteText("0"),e.icon=new o.GameObject(28,32),e}return r(e,t),e.prototype.setup=function(t){var e=t.spriteLoader;this.icon.painter=new o.SpritePainter(e.load("ui.player")),this.icon.position.set(0,32),this.add(this.icon),this.livesText.position.set(32,32),this.add(this.livesText),this.add(this.title)},e.prototype.setCount=function(t){var e=Math.max(0,t-1);this.livesText.setText(e.toString())},e}(o.GameObject);e.LevelLivesCounter=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(5),s=function(t){function e(){return t.call(this,"GAME\nOVER",o.TerrainType.Brick,{lineSpacing:6})||this}return r(e,t),e}(n(22).TerrainText);e.GameOverHeading=s},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(5),a=n(22),l=function(t){function e(e){var n=t.call(this)||this;return n.texts=[],n.visibleIndex=0,n.points=e,n.timer=new o.Timer,n.timer.reset(.012),n}return r(e,t),e.prototype.setup=function(){var t=this;this.texts=[this.createText(s.TerrainType.Brick),this.createText(s.TerrainType.InverseBrick),this.createText(s.TerrainType.BlueBrick)],this.texts.forEach((function(e){e.setVisible(!1),t.add(e)})),this.updateVisibility()},e.prototype.update=function(t){var e=t.deltaTime;this.timer.isDone()?(this.nextText(),this.updateVisibility(),this.timer.reset(.012),this.setNeedsPaint()):this.timer.update(e)},e.prototype.nextText=function(){this.visibleIndex+=1,this.visibleIndex>this.texts.length-1&&(this.visibleIndex=0)},e.prototype.updateVisibility=function(){var t=this;this.texts.forEach((function(e,n){n===t.visibleIndex?e.setVisible(!0):e.setVisible(!1)}))},e.prototype.createText=function(t){var e="HISCORE\n"+this.points,n=new a.TerrainText(e,t,{alignment:o.TextAlignment.Right,lineSpacing:6});return n.origin.set(.5,.5),n},e}(o.GameObject);e.HighscoreHeading=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(1),a=n(28),l=function(t){function e(e){var n=t.call(this,e,{color:s.COLOR_BLACK,opacity:.1})||this;return n.zIndex=s.LEVEL_TITLE_Z_INDEX,n.blinkTimer=new o.Timer,n.origin.set(.5,.5),n.updateMatrix(),n.setCenterX(s.CANVAS_WIDTH/2),n.position.setY(840),n}return r(e,t),e.prototype.update=function(t){var e=t.deltaTime;this.blinkTimer.update(e),this.blinkTimer.isDone()&&(this.dirtyPaintBox(),this.setVisible(!this.getVisible()),this.blinkTimer.reset(.4))},e}(a.SpriteText);e.InputHint=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),s=function(t){function e(n,i,r){void 0===n&&(n=0),void 0===i&&(i=!1),void 0===r&&(r={});var s=this,a=i?"PLAYTEST":e.getLevelText(n);return(s=t.call(this,a,r)||this).zIndex=o.LEVEL_TITLE_Z_INDEX,s}return r(e,t),e.prototype.setLevelNumber=function(t){var n=e.getLevelText(t);this.setText(n)},e.getLevelText=function(t){return"STAGE "+t.toString().padStart(2," ")},e}(n(28).SpriteText);e.LevelTitle=s},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(5),a=function(t){function e(){return t.call(this,"BATTLE\nCITY",s.TerrainType.MenuBrick,{alignment:o.TextAlignment.Center,lineSpacing:3})||this}return r(e,t),e}(n(22).TerrainText);e.MainHeading=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),s=function(t){function e(e){var n=t.call(this,e,{color:o.COLOR_YELLOW})||this;return n.position.set(o.MENU_TITLE_DEFAULT_POSITION.x,o.MENU_TITLE_DEFAULT_POSITION.y),n}return r(e,t),e}(n(28).SpriteText);e.SceneMenuTitle=s},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(5),a=n(22),l=function(t){function e(){var e=t.call(this)||this;return e.texts=[],e.visibleIndex=0,e.timer=new o.Timer,e.timer.reset(.012),e}return r(e,t),e.prototype.setup=function(){var t=this;this.texts=[this.createText(s.TerrainType.Brick),this.createText(s.TerrainType.InverseBrick),this.createText(s.TerrainType.BlueBrick)],this.texts.forEach((function(e){e.setVisible(!1),t.add(e)})),this.updateVisibility()},e.prototype.update=function(t){var e=t.deltaTime;this.timer.isDone()?(this.nextText(),this.updateVisibility(),this.timer.reset(.012),this.setNeedsPaint()):this.timer.update(e)},e.prototype.nextText=function(){this.visibleIndex+=1,this.visibleIndex>this.texts.length-1&&(this.visibleIndex=0)},e.prototype.updateVisibility=function(){var t=this;this.texts.forEach((function(e,n){n===t.visibleIndex?e.setVisible(!0):e.setVisible(!1)}))},e.prototype.createText=function(t){var e=new a.TerrainText("VICTORY",t);return e.origin.set(.5,.5),e},e}(o.GameObject);e.VictoryHeading=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(13),a=function(t){function e(){var e=t.call(this,64,96)||this;return e.icon=new o.GameObject(64,64),e.levelNumberText=new s.SpriteText,e}return r(e,t),e.prototype.setLevelNumber=function(t){var e=t.toString().padStart(2," ");this.levelNumberText.setText(e)},e.prototype.setup=function(t){var e=t.spriteLoader;this.icon.painter=new o.SpritePainter(e.load("flag")),this.add(this.icon),this.levelNumberText.position.setY(72),this.add(this.levelNumberText)},e}(o.GameObject);e.LevelNumberCounter=a},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(205)),i(n(71)),i(n(72)),i(n(208)),i(n(38)),i(n(209))},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(206)),i(n(207)),i(n(70))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),s=n(70),a={color:o.COLOR_GRAY},l=function(t){function e(e){void 0===e&&(e={});var n=this,i=Object.assign({},a,e);return(n=t.call(this,"-",i)||this).focusable=!1,n}return r(e,t),e}(s.TextMenuItem);e.DividerMenuItem=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(7),a=n(1),l=n(13),c=n(38),u={containerWidth:256,itemOriginX:.5},p=function(t){function e(e,n){void 0===e&&(e=[]),void 0===n&&(n={});var i=t.call(this)||this;return i.changed=new o.Subject,i.choices=[],i.leftArrow=new l.SpriteText("←",{color:a.COLOR_WHITE}),i.rightArrow=new l.SpriteText("→",{color:a.COLOR_WHITE}),i.selectedIndex=0,i.items=[],i.choices=e,i.options=Object.assign({},u,n),i}return r(e,t),e.prototype.setValue=function(t){var e=this.choices.findIndex((function(e){return e.value===t}));-1!==e&&this.selectChoice(e)},e.prototype.getValue=function(){var t=this.choices[this.selectedIndex];return void 0===t?null:t.value},e.prototype.updateFocused=function(t){var e=t.input;e.isDownAny(s.MenuInputContext.HorizontalNext)&&(this.selectNext(),this.emitChange()),e.isDownAny(s.MenuInputContext.HorizontalPrev)&&(this.selectPrev(),this.emitChange())},e.prototype.setup=function(){var t=this;this.container=new o.GameObject(this.options.containerWidth,28),this.container.painter=new o.RectPainter(a.COLOR_BLACK),this.container.position.setX(44),this.add(this.container),this.choices.forEach((function(e){var n=new l.SpriteText(e.text,{color:a.COLOR_WHITE});n.origin.setX(t.options.itemOriginX),n.position.setX(t.options.containerWidth*t.options.itemOriginX),t.container.add(n)})),this.add(this.leftArrow),this.rightArrow.position.setX(44+this.options.containerWidth+16),this.add(this.rightArrow),this.selectChoice()},e.prototype.emitChange=function(){var t=this.choices[this.selectedIndex];this.changed.notify(t)},e.prototype.selectPrev=function(){var t=this.selectedIndex-1;t<0&&(t=this.choices.length-1),this.selectChoice(t)},e.prototype.selectNext=function(){var t=this.selectedIndex+1;t>this.choices.length-1&&(t=0),this.selectChoice(t)},e.prototype.selectChoice=function(t){var e=this;void 0===t&&(t=this.selectedIndex),void 0===this.choices[t]?this.selectedIndex=-1:this.selectedIndex=t,this.hasBeenSetup()&&(this.container.dirtyPaintBox(),this.container.children.forEach((function(t,n){e.selectedIndex===n?t.setVisible(!0):t.setVisible(!1)})))},e}(c.MenuItem);e.SelectorMenuItem=p},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(1),a=n(13),l=function(t){function e(e){void 0===e&&(e="");var n=t.call(this,992,110)||this;return n.painter=new o.RectPainter(s.COLOR_GRAY,s.COLOR_YELLOW),n.message=e,n}return r(e,t),e.prototype.setup=function(){this.text=new a.SpriteText(this.message,{color:s.COLOR_BLACK}),this.text.position.set(16,16),this.add(this.text)},e}(o.GameObject);e.MenuDescription=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),s=function(t){function e(){var e=t.call(this)||this;return e.position.set(o.MENU_DEFAULT_POSITION.x,o.MENU_DEFAULT_POSITION.y),e}return r(e,t),e}(n(71).Menu);e.SceneMenu=s},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(211)),i(n(212)),i(n(213))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(2),a=n(1),l={containerWidth:512,containerHeight:200,message:"",acceptText:"OK"},c=function(t){function e(e){void 0===e&&(e={});var n=t.call(this)||this;return n.painter=new o.RectPainter(a.COLOR_BACKDROP),n.accepted=new o.Subject,n.zIndex=a.MODAL_Z_INDEX,n.text=null,n.handleAcceptSelected=function(){n.accepted.notify(null)},n.options=Object.assign({},l,e),n}return r(e,t),e.prototype.setup=function(){this.container=new o.GameObject(this.options.containerWidth,this.options.containerHeight),this.container.painter=new o.RectPainter(a.COLOR_GRAY,a.COLOR_WHITE),this.container.updateMatrix(),this.container.setCenter(this.getSelfCenter()),this.add(this.container),this.text=new s.SpriteText(this.options.message,{color:a.COLOR_WHITE}),this.text.setCenterX(this.container.getSelfCenter().x),this.text.origin.setX(.5),this.text.position.setY(16),this.container.add(this.text),this.acceptItem=new s.TextMenuItem(this.options.acceptText),this.acceptItem.selected.addListener(this.handleAcceptSelected);var t=[this.acceptItem];this.menu=new s.Menu,this.menu.setZIndex(this.zIndex+1),this.menu.position.set(16,128),this.menu.setItems(t),this.container.add(this.menu)},e.prototype.setText=function(t){null!==this.text?this.text.setText(t):this.options.message=t},e}(o.GameObject);e.AlertModal=c},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(2),a=n(1),l={containerWidth:512,containerHeight:256,message:"ARE YOU SURE?",acceptText:"YES",declineText:"NO"},c=function(t){function e(e){void 0===e&&(e={});var n=t.call(this)||this;return n.painter=new o.RectPainter(a.COLOR_BACKDROP),n.accepted=new o.Subject,n.declined=new o.Subject,n.zIndex=a.MODAL_Z_INDEX,n.handleAcceptSelected=function(){n.accepted.notify(null)},n.handleDeclineSelected=function(){n.declined.notify(null)},n.options=Object.assign({},l,e),n}return r(e,t),e.prototype.resetSelection=function(){this.menu.reset()},e.prototype.setup=function(){this.container=new o.GameObject(this.options.containerWidth,this.options.containerHeight),this.container.painter=new o.RectPainter(a.COLOR_GRAY,a.COLOR_WHITE),this.container.updateMatrix(),this.container.setCenter(this.getSelfCenter()),this.add(this.container),this.text=new s.SpriteText(this.options.message,{color:a.COLOR_WHITE}),this.text.setCenterX(this.container.getSelfCenter().x),this.text.origin.setX(.5),this.text.position.setY(16),this.container.add(this.text),this.acceptItem=new s.TextMenuItem(this.options.acceptText),this.acceptItem.selected.addListener(this.handleAcceptSelected),this.declineItem=new s.TextMenuItem(this.options.declineText),this.declineItem.selected.addListener(this.handleDeclineSelected);var t=[this.acceptItem,this.declineItem];this.menu=new s.Menu,this.menu.setZIndex(this.zIndex+1),this.menu.position.set(16,128),this.menu.setItems(t),this.container.add(this.menu)},e}(o.GameObject);e.ConfirmModal=c},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(2),a=n(1),l=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.painter=new o.RectPainter(a.COLOR_BACKDROP),i.zIndex=a.MODAL_Z_INDEX,i.container=new o.GameObject(512,256),i.text=new s.SpriteText("PRESS ANY KEY",{color:a.COLOR_WHITE}),i}return r(e,t),e.prototype.setup=function(){this.container.painter=new o.RectPainter(a.COLOR_GRAY,a.COLOR_WHITE),this.container.updateMatrix(),this.container.setCenter(this.getSelfCenter()),this.add(this.container),this.text.setCenter(this.getSelfCenter()),this.text.origin.set(.5,.5),this.add(this.text)},e}(o.GameObject);e.InputButtonCaptureModal=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(215))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=n(0),a=n(21),l=n(1),c=n(13),u=n(216),p=n(217),h=n(218);!function(t){t[t.Idle=0]="Idle",t[t.Transitioning=1]="Transitioning",t[t.Counting=2]="Counting",t[t.Done=3]="Done"}(o||(o={}));var d=[a.TankTier.A,a.TankTier.B,a.TankTier.C,a.TankTier.D],f=function(t){function e(e){var n=t.call(this,832,544)||this;return n.done=new s.Subject,n.playerLabel=new c.SpriteText("Ⅰ-PLAYER",{color:l.COLOR_RED}),n.underline=new h.ScoreTableUnderline,n.totalPoints=new c.SpriteText("",{color:l.COLOR_YELLOW}),n.totalLabel=new c.SpriteText("TOTAL",{color:l.COLOR_WHITE}),n.totalKills=new c.SpriteText("",{color:l.COLOR_WHITE}),n.counters=[],n.currentCounterIndex=0,n.state=o.Idle,n.transitionTimer=new s.Timer,n.record=e,n}return r(e,t),e.prototype.setup=function(t){var e=this,n=t.session;this.playerLabel.position.set(256,0),this.playerLabel.origin.setX(1),this.add(this.playerLabel),this.totalPoints.setText(n.primaryPlayer.getTotalPoints().toString()),this.totalPoints.position.set(256,64),this.totalPoints.origin.set(1,0),this.add(this.totalPoints),d.forEach((function(t,n){var i=new p.ScoreTableTierIcon(t);i.updateMatrix(),i.setCenter(e.getSelfCenter()),i.position.setY(136+100*n),e.add(i);var r=e.record.getTierKillCost(t),o=e.record.getTierKillCount(t),s=new u.ScoreTableCounter(o,r);s.position.set(4,152+100*n),e.counters.push(s),e.add(s)})),this.underline.updateMatrix(),this.underline.setCenter(this.getSelfCenter()),this.underline.position.setY(504),this.add(this.underline),this.totalLabel.position.set(256,516),this.totalLabel.origin.set(1,0),this.add(this.totalLabel),this.totalKills.position.set(348,516),this.totalKills.origin.set(1,0),this.add(this.totalKills)},e.prototype.update=function(t){if(this.state!==o.Idle&&this.state!==o.Done)if(this.state!==o.Transitioning){if(this.state===o.Counting)if(this.getCurrentCounter().isDone())return this.hasNextCounter()&&(this.currentCounterIndex+=1),this.state=o.Transitioning,void this.transitionTimer.reset(.4)}else{if(this.transitionTimer.isDone()){if(this.allCountersDone())return void this.finish();this.getCurrentCounter().start(),this.state=o.Counting}this.transitionTimer.update(t.deltaTime)}},e.prototype.start=function(){this.state===o.Idle&&(this.state=o.Transitioning,this.transitionTimer.reset(.4))},e.prototype.skip=function(){if(this.state!==o.Done){for(var t=0,e=this.counters;t<e.length;t++){e[t].skip()}this.finish()}},e.prototype.finish=function(){this.totalKills.setText(this.record.getKillTotalCount().toString()),this.state=o.Done,this.done.notify(null)},e.prototype.getCurrentCounter=function(){return this.counters[this.currentCounterIndex]},e.prototype.hasNextCounter=function(){return this.currentCounterIndex<this.counters.length-1},e.prototype.allCountersDone=function(){return this.counters[this.counters.length-1].isDone()},e}(s.GameObject);e.ScoreTable=f},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=n(0),a=n(1),l=n(13);!function(t){t[t.Idle=0]="Idle",t[t.Progress=1]="Progress",t[t.Done=2]="Done"}(o||(o={}));var c=function(t){function e(e,n){var i=t.call(this,344,28)||this;return i.pointsLabel=new l.SpriteText("PTS",{color:a.COLOR_WHITE}),i.pointsText=new l.SpriteText("",{color:a.COLOR_WHITE}),i.killsText=new l.SpriteText("",{color:a.COLOR_WHITE}),i.timer=new s.Timer,i.state=o.Idle,i.currentKills=0,i.targetKills=0,i.killCost=0,i.targetKills=e,i.killCost=n,i}return r(e,t),e.prototype.setup=function(t){var e=t.audioLoader;this.incrementSound=e.load("score"),this.pointsLabel.position.setX(160),this.add(this.pointsLabel),this.pointsText.position.setX(124),this.pointsText.origin.setX(1),this.add(this.pointsText),this.killsText.position.setX(this.size.width),this.killsText.origin.setX(1),this.add(this.killsText)},e.prototype.update=function(t){if(this.state===o.Progress){if(this.timer.isDone()){if(this.updateText(),this.incrementSound.play(),this.currentKills+=1,this.setNeedsPaint(),this.currentKills>this.targetKills)return void(this.state=o.Done);this.timer.reset(.135)}this.timer.update(t.deltaTime)}},e.prototype.start=function(){if(this.state===o.Idle){if(this.currentKills===this.targetKills)return this.updateText(),void(this.state=o.Done);this.state=o.Progress,this.timer.reset(.135)}},e.prototype.skip=function(){this.state!==o.Done&&(this.currentKills=this.targetKills,this.updateText(),this.state=o.Done)},e.prototype.updateText=function(){var t=this.currentKills*this.killCost;this.pointsText.setText(t.toString()),this.killsText.setText(this.currentKills.toString())},e.prototype.isIdle=function(){return this.state===o.Idle},e.prototype.isProgress=function(){return this.state===o.Progress},e.prototype.isDone=function(){return this.state===o.Done},e}(s.GameObject);e.ScoreTableCounter=c},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(6),l=n(1),c=n(13),u=function(t){function e(e){var n=t.call(this,128,64)||this;return n.leftIcon=new c.SpriteText("←",{color:l.COLOR_WHITE}),n.tank=new o.GameObject(64,64),n.tier=e,n}return r(e,t),e.prototype.setup=function(t){var e=t.spriteLoader,n=new a.TankType(a.TankParty.Enemy,this.tier),i=a.TankSpriteId.create(n,a.TankColor.Default,s.Rotation.Up),r=e.load(i),l=new o.SpritePainter;l.sprite=r,this.tank.painter=l,this.tank.updateMatrix(),this.tank.setCenter(this.getSelfCenter()),this.add(this.tank),this.leftIcon.position.setY(16),this.add(this.leftIcon)},e}(o.GameObject);e.ScoreTableTierIcon=u},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=function(t){function e(){var e=t.call(this,256,8)||this;return e.painter=new o.RectPainter("#fff"),e}return r(e,t),e}(o.GameObject);e.ScoreTableUnderline=s},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(220)),i(n(221)),i(n(39)),i(n(222)),i(n(223)),i(n(224)),i(n(225)),i(n(226)),i(n(227))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.getSpriteIds=function(){return["terrain.blue-brick.1","terrain.blue-brick.2"]},e}(n(39).BrickTerrainTile);e.BlueBrickTerrainTile=o},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(5),l=n(1),c=function(t){function e(e){var n=t.call(this,l.BRICK_SUPER_TILE_SIZE,l.BRICK_SUPER_TILE_SIZE)||this;return n.type=a.TerrainType.BrickSuper,n.collider=new o.BoxCollider(n),n.tags=[s.Tag.BlockMove],n.subTiles=e,n}return r(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),this.collider.unregister();for(var e=0,n=this.subTiles;e<n.length;e++){n[e].destroy()}},e.prototype.setup=function(t){var e=this;t.collisionSystem.register(this.collider);for(var n=function(t){t.destroyed.addListenerOnce((function(){var n=e.subTiles.indexOf(t);-1!==n&&(e.subTiles.splice(n,1),0===e.subTiles.length&&e.destroy())}))},i=0,r=this.subTiles;i<r.length;i++){n(r[i])}this.add.apply(this,this.subTiles)},e.prototype.update=function(){this.collider.update()},e}(n(16).TerrainTile);e.BrickSuperTerrainTile=c},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(5),l=n(1),c=function(t){function e(){var e=t.call(this,l.ICE_TILE_SIZE,l.ICE_TILE_SIZE)||this;return e.collider=new o.BoxCollider(e),e.type=a.TerrainType.Ice,e.painter=new o.SpritePainter,e.tags=[s.Tag.Ice],e.zIndex=l.ICE_TILE_Z_INDEX,e}return r(e,t),e.prototype.setup=function(t){var e=t.collisionSystem,n=t.spriteLoader;e.register(this.collider),this.painter.sprite=n.load("terrain.ice")},e.prototype.update=function(){this.collider.update()},e}(n(16).TerrainTile);e.IceTerrainTile=c},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.getSpriteIds=function(){return["terrain.inverse-brick.1","terrain.inverse-brick.2"]},e}(n(39).BrickTerrainTile);e.InverseBrickTerrainTile=o},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(5),a=n(1),l=function(t){function e(){var e=t.call(this,a.JUNGLE_TILE_SIZE,a.JUNGLE_TILE_SIZE)||this;return e.type=s.TerrainType.Jungle,e.painter=new o.SpritePainter,e.zIndex=a.JUNGLE_TILE_Z_INDEX,e}return r(e,t),e.prototype.setup=function(t){var e=t.spriteLoader;this.painter.sprite=e.load("terrain.jungle")},e}(n(16).TerrainTile);e.JungleTerrainTile=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(5),a=n(1),l=function(t){function e(){var e=t.call(this,a.BRICK_TILE_SIZE,a.BRICK_TILE_SIZE)||this;return e.type=s.TerrainType.MenuBrick,e.painter=new o.SpritePainter,e}return r(e,t),e.prototype.setup=function(t){var e=t.spriteLoader;this.sprites=e.loadList(["terrain.menu-brick.1","terrain.menu-brick.2"]),this.painter.sprite=this.getSpriteByPosition()},e.prototype.getSpriteIds=function(){return["terrain.brick.1","terrain.brick.2"]},e.prototype.getSpriteByPosition=function(){var t=(Math.floor(this.position.x/a.BRICK_TILE_SIZE)%2+Math.floor(this.position.y/a.BRICK_TILE_SIZE)%2)%2;return this.sprites[t]},e}(n(16).TerrainTile);e.MenuBrickTerrainTile=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(5),l=n(1),c=function(t){function e(){var e=t.call(this,l.STEEL_TILE_SIZE,l.STEEL_TILE_SIZE)||this;return e.type=a.TerrainType.Steel,e.collider=new o.BoxCollider(e),e.zIndex=l.STEEL_TILE_Z_INDEX,e.tags=[s.Tag.Wall,s.Tag.Steel,s.Tag.BlockMove],e.painter=new o.SpritePainter,e}return r(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),this.collider.unregister()},e.prototype.setup=function(t){var e=t.collisionSystem,n=t.spriteLoader;e.register(this.collider),this.painter.sprite=n.load("terrain.steel")},e.prototype.update=function(){this.collider.update()},e}(n(16).TerrainTile);e.SteelTerrainTile=c},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(5),l=n(1),c=function(t){function e(){var e=t.call(this,l.WATER_TILE_SIZE,l.WATER_TILE_SIZE)||this;return e.type=a.TerrainType.Water,e.collider=new o.BoxCollider(e),e.zIndex=l.WATER_TILE_Z_INDEX,e.tags=[s.Tag.BlockMove],e.painter=new o.SpritePainter,e}return r(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),this.collider.unregister()},e.prototype.setup=function(t){var e=t.collisionSystem,n=t.spriteLoader;e.register(this.collider),this.animation=new o.Animation(n.loadList(["terrain.water.1","terrain.water.2"]),{delay:.5,loop:!0})},e.prototype.update=function(t){this.collider.update(),this.animation.update(t.deltaTime),this.painter.sprite=this.animation.getCurrentFrame()},e}(n(16).TerrainTile);e.WaterTerrainTile=c},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(5),a=n(1),l=n(229),c=[new o.Rect(0,0,128,32),new o.Rect(0,32,32,64),new o.Rect(96,32,32,64)],u=function(t){function e(){var e=t.call(this,a.BASE_DEFAULT_SIZE.width,a.BASE_DEFAULT_SIZE.height)||this;return e.died=new o.Subject,e.heart=new l.BaseHeart,e.defenceTimer=new o.Timer,e.isFading=!1,e.lastFadeWallType=s.TerrainType.Steel,e.handleDefenceTimer=function(){e.isFading=!0,e.lastFadeWallType=s.TerrainType.Steel},e}return r(e,t),e.prototype.activateDefence=function(t){this.resetFading(),this.setTiles(s.TerrainType.Steel),this.defenceTimer.reset(t)},e.prototype.setup=function(){this.container=new o.GameObject,this.container.size.copyFrom(this.size),this.add(this.container),this.heart.position.set(32,32),this.heart.died.addListener(this.died.notify),this.add(this.heart),this.setTiles(s.TerrainType.Brick),this.fadeAnimation=new o.Animation([s.TerrainType.Brick,s.TerrainType.Steel],{delay:.25,loop:7}),this.defenceTimer.done.addListener(this.handleDefenceTimer)},e.prototype.update=function(t){if(this.defenceTimer.update(t.deltaTime),this.isFading){if(this.fadeAnimation.isComplete())return this.resetFading(),void this.setTiles(s.TerrainType.Brick);this.fadeAnimation.update(t.deltaTime);var e=this.fadeAnimation.getCurrentFrame();this.lastFadeWallType!==e&&(this.lastFadeWallType=e,this.setTiles(e))}},e.prototype.resetFading=function(){this.isFading=!1,this.fadeAnimation.reset(),this.lastFadeWallType=s.TerrainType.Steel},e.prototype.setTiles=function(t){for(var e=this,n=this.container.children.length-1;n>=0;n-=1){this.container.children[n].destroy()}s.TerrainFactory.createMapFromRegions(t,c).forEach((function(t){e.container.add(t)}))},e}(o.GameObject);e.Base=u},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(2),l=n(1),c=function(t){function e(){var e=t.call(this,64,64)||this;return e.collider=new o.BoxCollider(e,!0),e.tags=[s.Tag.BlockMove],e.painter=new o.SpritePainter,e.zIndex=l.BASE_HEART_Z_INDEX,e.died=new o.Subject,e.isDead=!1,e}return r(e,t),e.prototype.explode=function(){if(!this.isDead){this.isDead=!0;var t=new a.Explosion;t.updateMatrix(),t.setCenter(this.getSelfCenter()),this.add(t),this.painter.sprite=this.deadSprite,this.died.notify(null)}},e.prototype.setup=function(t){var e=t.collisionSystem,n=t.spriteLoader;e.register(this.collider),this.aliveSprite=n.load("base.heart.alive"),this.deadSprite=n.load("base.heart.dead"),this.painter.sprite=this.aliveSprite},e.prototype.update=function(){this.collider.update()},e.prototype.collide=function(t){if(!this.isDead){var e=t.contacts.filter((function(t){return t.collider.object.tags.includes(s.Tag.Bullet)}));if(e.length>0)e[0].collider.object.explode(),this.explode()}},e}(o.GameObject);e.BaseHeart=c},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(1),a=n(36),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.setup=function(){var t=this;s.BORDER_RECTS.forEach((function(e){var n=new a.BorderWall(e.width,e.height);n.position.set(e.x,e.y),t.add(n)}))},e}(o.GameObject);e.Border=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=n(0),a=n(1);!function(t){t[t.Closed=0]="Closed",t[t.Closing=1]="Closing",t[t.Open=2]="Open",t[t.Opening=3]="Opening"}(o||(o={}));var l=function(t){function e(e,n,i){void 0===i&&(i=!0);var r=t.call(this,e,n)||this;return r.zIndex=a.CURTAIN_Z_INDEX,r.state=i?o.Open:o.Closed,r}return r(e,t),e.prototype.setup=function(){this.targetHeight=this.size.height/2;var t=this.state===o.Open?0:this.targetHeight;this.topPart=new s.GameObject(this.size.width,t),this.topPart.painter=new s.RectPainter(a.COLOR_GRAY),this.bottomPart=new s.GameObject(this.size.width,t),this.bottomPart.painter=new s.RectPainter(a.COLOR_GRAY),this.bottomPart.origin.set(0,1),this.bottomPart.position.setY(this.size.height),this.add(this.topPart),this.add(this.bottomPart)},e.prototype.update=function(t){var e=t.deltaTime;if(this.state!==o.Open&&this.state!==o.Closed){var n=this.topPart.size.height;this.state===o.Closing?(n+=1500*e)>=this.targetHeight&&(n=this.targetHeight,this.state=o.Closed):this.state===o.Opening&&(n-=1500*e)<=0&&(n=0,this.state=o.Open),this.topPart.size.setHeight(n),this.topPart.updateMatrix(),this.bottomPart.size.setHeight(n),this.bottomPart.updateMatrix(),this.dirtyPaintBox()}},e.prototype.close=function(){this.state===o.Open&&(this.state=o.Closing)},e.prototype.open=function(){this.state===o.Closed&&(this.state=o.Opening)},e}(s.GameObject);e.Curtain=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(1),a=function(t){function e(){var e=t.call(this,124,60)||this;return e.zIndex=s.GAME_OVER_NOTICE_Z_INDEX,e.painter=new o.SpritePainter,e}return r(e,t),e.prototype.setup=function(t){var e=t.spriteLoader;this.painter.sprite=e.load("ui.gameOver")},e}(o.GameObject);e.GameOverNotice=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=n(6),a=n(1),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tags=[o.Tag.Tank,o.Tag.Enemy],e.zIndex=a.ENEMY_TANK_Z_INDEX,e.healthSkinAnimations=new Map,e}return r(e,t),e.prototype.setup=function(e){var n=e.audioLoader,i=e.spriteLoader;this.hitSound=n.load("hit.enemy"),this.type.hasDrop&&(this.ignorePause=!0),this.type.tier===s.TankTier.D&&(this.healthSkinAnimations.set(4,new s.TankSkinAnimation(i,this.type,[s.TankColor.Default,s.TankColor.Secondary])),this.healthSkinAnimations.set(3,new s.TankSkinAnimation(i,this.type,[s.TankColor.Default,s.TankColor.Primary])),this.healthSkinAnimations.set(2,new s.TankSkinAnimation(i,this.type,[s.TankColor.Secondary,s.TankColor.Primary]))),this.healthSkinAnimations.set(1,new s.TankSkinAnimation(i,this.type,[s.TankColor.Default])),this.skinAnimation=this.healthSkinAnimations.get(this.attributes.health),t.prototype.setup.call(this,e)},e.prototype.update=function(e){var n=e.gameState;if((this.freezeState.hasChangedTo(!0)||n.hasChangedTo(o.GameState.Paused))&&this.idle(),this.freezeState.is(!0)||n.is(o.GameState.Paused))return this.collider.update(),this.updateAnimation(e.deltaTime),void this.setNeedsPaint();t.prototype.update.call(this,e)},e.prototype.receiveHit=function(e){t.prototype.receiveHit.call(this,e),this.isAlive()&&(this.hitSound.play(),this.discardDrop(),this.skinAnimation=this.healthSkinAnimations.get(this.attributes.health))},e.prototype.discardDrop=function(){return this.type.hasDrop=!1,this.ignorePause=!1,this.healthSkinAnimations.forEach((function(t){t.updateFrames()})),this},e}(n(41).Tank);e.EnemyTank=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(1),a=function(t){function e(){return t.call(this,s.FIELD_SIZE,s.FIELD_SIZE)||this}return r(e,t),e}(o.GameObject);e.Field=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(7),a=n(1),l=n(13),c=function(t){function e(e,n){void 0===e&&(e=1),void 0===n&&(n=!1);var i=t.call(this)||this;return i.selected=new o.Subject,i.zIndex=a.LEVEL_TITLE_Z_INDEX,i.currentLevel=1,i.minLevel=1,i.holdThrottles=[],i.selectNext=function(){var t=i.currentLevel+1;t>i.maxLevel||(i.currentLevel=t,i.updateText())},i.selectPrev=function(){var t=i.currentLevel-1;t<i.minLevel||(i.currentLevel=t,i.updateText())},i.maxLevel=e,i.isPlaytest=n,i.holdThrottles=[new s.InputHoldThrottle(s.LevelSelectionInputContext.Next,i.selectNext,{delay:.12}),new s.InputHoldThrottle(s.LevelSelectionInputContext.Prev,i.selectPrev,{delay:.12}),new s.InputHoldThrottle(s.LevelSelectionInputContext.FastNext,i.selectNext,{delay:.016}),new s.InputHoldThrottle(s.LevelSelectionInputContext.FastPrev,i.selectPrev,{delay:.016})],i}return r(e,t),e.prototype.setup=function(){this.title=new l.LevelTitle(0,this.isPlaytest),this.title.origin.set(.5,.5),this.title.updateMatrix(),this.add(this.title),this.updateText(),this.arrowLeft=new l.SpriteText("←",{color:a.COLOR_BLACK,opacity:.1}),this.arrowLeft.origin.setY(.5),this.arrowLeft.position.setX(-200),this.add(this.arrowLeft),this.arrowRight=new l.SpriteText("→",{color:a.COLOR_BLACK,opacity:.1}),this.arrowRight.origin.setY(.5),this.arrowRight.position.setX(180),this.add(this.arrowRight)},e.prototype.update=function(t){var e=t.deltaTime,n=t.input;if(n.isDownAny(s.LevelSelectionInputContext.Select))this.selected.notify(this.currentLevel);else for(var i=0,r=this.holdThrottles;i<r.length;i++){r[i].update(n,e)}},e.prototype.updateText=function(){this.title.setLevelNumber(this.currentLevel)},e}(o.GameObject);e.LevelSelector=c},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(1),a=function(t){function e(){var e=t.call(this,156,28)||this;return e.zIndex=s.PAUSE_NOTICE_Z_INDEX,e.ignorePause=!0,e.painter=new o.SpritePainter,e}return r(e,t),e.prototype.restart=function(){this.animation.reset()},e.prototype.setup=function(t){var e=t.spriteLoader;this.animation=new o.Animation([e.load("ui.pause"),null],{delay:.27,loop:!0})},e.prototype.update=function(t){this.animation.update(t.deltaTime),this.painter.sprite=this.animation.getCurrentFrame(),this.setNeedsPaint()},e}(o.GameObject);e.PauseNotice=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(6),l=n(1),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.upgraded=new o.Subject,e.tags=[s.Tag.Tank,s.Tag.Player],e.zIndex=l.PLAYER_TANK_Z_INDEX,e.tierSkinAnimations=new Map,e.colors=[a.TankColor.Primary],e}return r(e,t),e.prototype.setup=function(e){var n=e.spriteLoader;this.tierSkinAnimations.set(a.TankTier.A,new a.TankSkinAnimation(n,a.TankType.PlayerA(),this.colors)),this.tierSkinAnimations.set(a.TankTier.B,new a.TankSkinAnimation(n,a.TankType.PlayerB(),this.colors)),this.tierSkinAnimations.set(a.TankTier.C,new a.TankSkinAnimation(n,a.TankType.PlayerC(),this.colors)),this.tierSkinAnimations.set(a.TankTier.D,new a.TankSkinAnimation(n,a.TankType.PlayerD(),this.colors)),this.skinAnimation=this.tierSkinAnimations.get(this.type.tier),t.prototype.setup.call(this,e)},e.prototype.upgrade=function(t,e){void 0===t&&(t=null),void 0===e&&(e=!0),this.type.isMaxTier()||(this.type.increaseTier(t),this.attributes=a.TankAttributesFactory.create(this.type),this.skinAnimation=this.tierSkinAnimations.get(this.type.tier),!0===e&&this.upgraded.notify({tier:this.type.tier}))},e}(n(41).Tank);e.PlayerTank=c},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(1),a=function(t){function e(e,n){var i=t.call(this,56,28)||this;return i.zIndex=s.POINTS_Z_INDEX,i.painter=new o.SpritePainter,i.timer=new o.Timer,i.handleTimer=function(){i.dirtyPaintBox(),i.removeSelf()},i.value=e,i.timer.reset(n),i.timer.done.addListener(i.handleTimer),i}return r(e,t),e.prototype.setup=function(t){var e=t.spriteLoader,n=this.getSpriteId(this.value);this.painter.sprite=e.load(n)},e.prototype.update=function(t){this.timer.update(t.deltaTime)},e.prototype.getSpriteId=function(t){return["points",t.toString()].join(".")},e}(o.GameObject);e.Points=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(15),l=n(1),c=function(t){function e(e){var n=t.call(this,64,64)||this;return n.zIndex=l.POWERUP_Z_INDEX,n.collider=new o.BoxCollider(n,!0),n.painter=new o.SpritePainter,n.ignorePause=!0,n.picked=new o.Subject,n.type=e,n}return r(e,t),e.prototype.destroy=function(){this.dirtyPaintBox(),this.removeSelf(),this.collider.unregister()},e.prototype.setup=function(t){var e=t.collisionSystem,n=t.spriteLoader;e.register(this.collider);var i=this.getSpriteId(),r=[n.load(i),null];this.animation=new o.Animation(r,{delay:.12,loop:!0})},e.prototype.update=function(t){this.collider.update(),this.animation.update(t.deltaTime),this.painter.sprite=this.animation.getCurrentFrame(),this.setNeedsPaint()},e.prototype.collide=function(t){var e=t.contacts.filter((function(t){return t.collider.object.tags.includes(s.Tag.Tank)&&t.collider.object.tags.includes(s.Tag.Player)}));if(e.length>0){var n=e[0].collider.getBox(),i=this.collider.getBox().clone().intersectWith(n).toRect();i.width>16&&i.height>16&&(this.destroy(),this.picked.notify(null))}},e.prototype.getSpriteId=function(){switch(this.type){case a.PowerupType.BaseDefence:return"powerup.shovel";case a.PowerupType.Freeze:return"powerup.clock";case a.PowerupType.Life:return"powerup.tank";case a.PowerupType.Shield:return"powerup.helmet";case a.PowerupType.Upgrade:return"powerup.star";case a.PowerupType.Wipeout:return"powerup.grenade"}return"unknown"},e}(o.GameObject);e.Powerup=c},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(1),a=function(t){function e(){var e=t.call(this,64,64)||this;return e.zIndex=s.SPAWN_Z_INDEX,e.painter=new o.SpritePainter,e.completed=new o.Subject,e.painter.alignment=o.SpriteAlignment.MiddleCenter,e}return r(e,t),e.prototype.setup=function(t){var e=t.spriteLoader;this.animation=new o.Animation(e.loadList(["spawn.1","spawn.2","spawn.3","spawn.4"]),{delay:.05,loop:3})},e.prototype.update=function(t){var e=t.deltaTime;this.animation.isComplete()?this.completed.notify(null):(this.animation.update(e),this.painter.sprite=this.animation.getCurrentFrame(),this.setNeedsPaint())},e}(o.GameObject);e.Spawn=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(5),a=n(1),l=n(40),c=n(76),u=function(t){function e(){var e=t.call(this,a.CANVAS_WIDTH,312)||this;return e.tileDestroyed=new o.Subject,e.destroyed=new o.Subject,e.tiles=[],e.destroyCount=1,e.shouldDestroy=!1,e.handleTileDestroyed=function(t){var n;e.shouldDestroy=!0,(n=0===o.RandomUtils.number(0,2)?new c.Explosion:new l.SmallExplosion).updateMatrix(),n.setCenter(t.centerPosition),e.add(n),e.tileDestroyed.notify(null)},e}return r(e,t),e.prototype.destroy=function(){if(0===this.tiles.length)return this.destroyed.notify(null),void(this.shouldDestroy=!1);for(var t=0;t<this.destroyCount;t+=1){var e=o.RandomUtils.arrayElement(this.tiles);if(void 0===e)return;var n=this.tiles.indexOf(e);e.destroy(),this.tiles.splice(n,1)}this.destroyCount+=1},e.prototype.setup=function(){var t=this;this.tiles=s.TerrainFactory.createFromRegions(s.TerrainType.Brick,[new o.Rect(0,0,this.size.width,this.size.height)]),this.tiles.forEach((function(e){e.destroyed.addListener(t.handleTileDestroyed)})),this.add.apply(this,this.tiles)},e.prototype.update=function(){!1!==this.shouldDestroy&&this.destroy()},e}(o.GameObject);e.VictoryMap=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=n(1),o=function(){function t(){this.grid=[],this.backupGrid=null,this.tileSize=r.TILE_SIZE_MEDIUM,this.rowCount=r.FIELD_SIZE/this.tileSize,this.colCount=r.FIELD_SIZE/this.tileSize;for(var t=0;t<this.colCount;t+=1){this.grid[t]=[];for(var e=0;e<this.rowCount;e+=1)this.grid[t][e]=!0}}return t.prototype.blockCell=function(t,e){this.toggleCell(t,e,!1)},t.prototype.freeCell=function(t,e){this.toggleCell(t,e,!0)},t.prototype.blockRect=function(t){this.toggleRect(t,!1)},t.prototype.freeRect=function(t){this.toggleRect(t,!0)},t.prototype.toggleCell=function(t,e,n){this.grid[t][e]=n},t.prototype.toggleRect=function(t,e){for(var n=new i.Vector(Math.max(0,Math.floor(t.x/this.tileSize)),Math.max(0,Math.floor(t.y/this.tileSize))),r=new i.Vector(Math.min(this.rowCount,Math.ceil((t.x+t.width)/this.tileSize)),Math.min(this.colCount,Math.ceil((t.y+t.height)/this.tileSize))),o=n.y;o<r.y;o+=1)for(var s=n.x;s<r.x;s+=1)this.toggleCell(o,s,e)},t.prototype.getBlockedCellIndexes=function(){for(var t=[],e=0;e<this.rowCount;e+=1)for(var n=0;n<this.colCount;n+=1){this.grid[e][n]||t.push(new i.Vector(n,e))}return t},t.prototype.getFreeLargeCellIndexes=function(){for(var t=[],e=0;e<this.rowCount-1;e+=1)for(var n=0;n<this.colCount-1;n+=1){var r=this.grid[e][n],o=this.grid[e][n+1],s=this.grid[e+1][n],a=this.grid[e+1][n+1];!(r||o||s||a)||t.push(new i.Vector(n,e))}return t},t.prototype.getRandomPosition=function(){var t=this.getFreeLargeCellIndexes();return 0===t.length?null:i.RandomUtils.arrayElement(t).multScalar(this.tileSize)},t.prototype.backup=function(){this.backupGrid=[];for(var t=0;t<this.rowCount;t+=1)this.backupGrid[t]=this.grid[t].slice()},t.prototype.restore=function(){if(null!==this.backupGrid){for(var t=0;t<this.rowCount;t+=1)this.grid[t]=this.backupGrid[t].slice();this.backupGrid=null}},t}();e.PowerupGrid=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=function(){function t(t){var e=this;this.click=new i.Subject,this.handleClick=function(t){var n=new i.Vector(window.pageXOffset,window.pageYOffset),r=new i.Vector(t.pageX,t.pageY).clone().sub(n),o=e.canvas.getBoundingClientRect(),s=i.NumberUtils.clamp(r.x-o.left,0,o.width),a=i.NumberUtils.clamp(r.y-o.top,0,o.height),l=new i.Vector(s,a);e.click.notify(l)},this.canvas=t}return t.prototype.listen=function(){this.canvas.addEventListener("click",this.handleClick)},t}();e.DebugInspector=r},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(245)),i(n(248)),i(n(249))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}l((i=i.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0});var a=n(79),l=function(t){function e(e){var n=t.call(this)||this,i=Array.from(e);return i.sort((function(t,e){return t.name.localeCompare(e.name)})),n.files=i,n}return r(e,t),e.prototype.readAsync=function(t){return o(this,void 0,void 0,(function(){var e,n,i,r=this;return s(this,(function(o){return e=t-1,void 0===(n=this.files[e])?(this.error.notify(new Error('Level "'+t+" not found")),[2]):((i=new a.MapFileReader).loaded.addListenerOnce((function(t){r.loaded.notify(t)})),i.error.addListenerOnce((function(t){r.error.notify(t)})),i.read(n),[2])}))}))},e.prototype.getCount=function(){return this.files.length},e}(n(44).MapListReader);e.FileMapListReader=l},function(t,e,n){"use strict";var i,r;Object.defineProperty(e,"__esModule",{value:!0});var o=n(247),s=n(21),a=n(37);e.MapDtoSchema=o.object({version:o.number().default(1),spawn:o.object({enemy:o.object({locations:o.array().items(o.object({x:o.number().required(),y:o.number().required()})).default([]),list:o.array().items(o.object({tier:(i=o.string()).valid.apply(i,Object.values(s.TankTier)).required(),drop:o.boolean()})).default([])}).default(),player:o.object({locations:o.array().items(o.object({x:o.number().required(),y:o.number().required()})).default([])}).default()}).default(),terrain:o.object({regions:o.array().items(o.object({type:(r=o.string()).valid.apply(r,Object.values(a.TerrainType)).required(),x:o.number().required(),y:o.number().required(),width:o.number().required(),height:o.number().required()})).default([])}).default()})},function(t,e,n){window,t.exports=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=11)}([function(t,e,n){"use strict";const i=n(12);t.exports=function(t,...e){if(!t){if(1===e.length&&e[0]instanceof Error)throw e[0];throw new i(e)}}},function(t,e,n){"use strict";const i=n(0),r=n(12),o=n(29);let s,a;const l={isoDate:/^(?:[-+]\d{2})?(?:\d{4}(?!\d{2}\b))(?:(-?)(?:(?:0[1-9]|1[0-2])(?:\1(?:[12]\d|0[1-9]|3[01]))?|W(?:[0-4]\d|5[0-2])(?:-?[1-7])?|(?:00[1-9]|0[1-9]\d|[12]\d{2}|3(?:[0-5]\d|6[1-6])))(?![T]$|[T][\d]+Z$)(?:[T\s](?:(?:(?:[01]\d|2[0-3])(?:(:?)[0-5]\d)?|24\:?00)(?:[.,]\d+(?!:))?)(?:\2[0-5]\d(?:[.,]\d+)?)?(?:[Z]|(?:[+-])(?:[01]\d|2[0-3])(?::?[0-5]\d)?)?)?)?$/};e.version=o.version,e.defaults={abortEarly:!0,allowUnknown:!1,cache:!0,context:null,convert:!0,dateFormat:"iso",errors:{escapeHtml:!1,label:"path",language:null,render:!0,stack:!1,wrap:{label:'"',array:"[]"}},externals:!0,messages:{},nonEnumerables:!1,noDefaults:!1,presence:"optional",skipFunctions:!1,stripUnknown:!1,warnings:!1},e.symbols={any:Symbol.for("@hapi/joi/schema"),arraySingle:Symbol("arraySingle"),deepDefault:Symbol("deepDefault"),literal:Symbol("literal"),override:Symbol("override"),prefs:Symbol("prefs"),ref:Symbol("ref"),values:Symbol("values"),template:Symbol("template")},e.assertOptions=function(t,e,n="Options"){i(t&&"object"==typeof t&&!Array.isArray(t),"Options must be of type object");const r=Object.keys(t).filter(t=>!e.includes(t));i(0===r.length,"".concat(n," contain unknown keys: ").concat(r))},e.checkPreferences=function(t){a=a||n(16);const e=a.preferences.validate(t);if(e.error)throw new r([e.error.details[0].message])},e.compare=function(t,e,n){switch(n){case"=":return t===e;case">":return t>e;case"<":return t<e;case">=":return t>=e;case"<=":return t<=e}},e.default=function(t,e){return void 0===t?e:t},e.isIsoDate=function(t){return l.isoDate.test(t)},e.isNumber=function(t){return"number"==typeof t&&!isNaN(t)},e.isResolvable=function(t){return!!t&&(t[e.symbols.ref]||t[e.symbols.template])},e.isSchema=function(t,n={}){const r=t&&t[e.symbols.any];return!!r&&(i(n.legacy||r.version===e.version,"Cannot mix different versions of joi schemas"),!0)},e.isValues=function(t){return t[e.symbols.values]},e.limit=function(t){return Number.isSafeInteger(t)&&t>=0},e.preferences=function(t,i){s=s||n(9),t=t||{},i=i||{};const r=Object.assign({},t,i);return i.errors&&t.errors&&(r.errors=Object.assign({},t.errors,i.errors),r.errors.wrap=Object.assign({},t.errors.wrap,i.errors.wrap)),i.messages&&(r.messages=s.compile(i.messages,t.messages)),delete r[e.symbols.prefs],r},e.tryWithPath=function(t,e,n={}){try{return t()}catch(t){throw void 0!==t.path?t.path=e+"."+t.path:t.path=e,n.append&&(t.message="".concat(t.message," (").concat(t.path,")")),t}},e.validateArg=function(t,n,{assert:i,message:r}){if(e.isSchema(i)){const e=i.validate(t);if(!e.error)return;return e.error.message}if(!i(t))return n?"".concat(n," ").concat(r):r},e.verifyFlat=function(t,e){for(const n of t)i(!Array.isArray(n),"Method no longer accepts array arguments:",e)}},function(t,e,n){"use strict";const i=n(6),r=n(13),o=n(14),s={needsProtoHack:new Set([r.set,r.map,r.weakSet,r.weakMap])};t.exports=s.clone=function(t,e={},n=null){if("object"!=typeof t||null===t)return t;let i=s.clone,a=n;if(e.shallow){if(!0!==e.shallow)return s.cloneWithShallow(t,e);i=t=>t}else if(a){const e=a.get(t);if(e)return e}else a=new Map;const l=r.getInternalProto(t);if(l===r.buffer)return!1;if(l===r.date)return new Date(t.getTime());if(l===r.regex)return new RegExp(t);const c=s.base(t,l,e);if(c===t)return t;if(a&&a.set(t,c),l===r.set)for(const n of t)c.add(i(n,e,a));else if(l===r.map)for(const[n,r]of t)c.set(n,i(r,e,a));const u=o.keys(t,e);for(const n of u){if(l===r.array&&"length"===n){c.length=t.length;continue}const o=Object.getOwnPropertyDescriptor(t,n);o?o.get||o.set?Object.defineProperty(c,n,o):o.enumerable?c[n]=i(t[n],e,a):Object.defineProperty(c,n,{enumerable:!1,writable:!0,configurable:!0,value:i(t[n],e,a)}):Object.defineProperty(c,n,{enumerable:!0,writable:!0,configurable:!0,value:i(t[n],e,a)})}return c},s.cloneWithShallow=function(t,e){const n=e.shallow;(e=Object.assign({},e)).shallow=!1;const r=new Map;for(const e of n){const n=i(t,e);"object"!=typeof n&&"function"!=typeof n||r.set(n,n)}return s.clone(t,e,r)},s.base=function(t,e,n){if(!1===n.prototype)return s.needsProtoHack.has(e)?new e.constructor:e===r.array?[]:{};const i=Object.getPrototypeOf(t);if(i&&i.isImmutable)return t;if(e===r.array){const t=[];return i!==e&&Object.setPrototypeOf(t,i),t}if(s.needsProtoHack.has(e)){const t=new i.constructor;return i!==e&&Object.setPrototypeOf(t,i),t}return Object.create(i)}},function(t,e,n){"use strict";const i=n(0),r=n(34),o=n(1),s=n(9);t.exports=r.extend({type:"any",flags:{only:{default:!1}},terms:{alterations:{init:null},examples:{init:null},externals:{init:null},metas:{init:[]},notes:{init:[]},shared:{init:null},tags:{init:[]},whens:{init:null}},rules:{custom:{method(t,e){return i("function"==typeof t,"Method must be a function"),i(void 0===e||e&&"string"==typeof e,"Description must be a non-empty string"),this.$_addRule({name:"custom",args:{method:t,description:e}})},validate(t,e,{method:n}){try{return n(t,e)}catch(t){return e.error("any.custom",{error:t})}},args:["method","description"],multi:!0},messages:{method(t){return this.prefs({messages:t})}},shared:{method(t){i(o.isSchema(t)&&t._flags.id,"Schema must be a schema with an id");const e=this.clone();return e.$_terms.shared=e.$_terms.shared||[],e.$_terms.shared.push(t),e.$_mutateRegister(t),e}},warning:{method(t,e){return i(t&&"string"==typeof t,"Invalid warning code"),this.$_addRule({name:"warning",args:{code:t,local:e},warn:!0})},validate:(t,e,{code:n,local:i})=>e.error(n,i),args:["code","local"],multi:!0}},modifiers:{keep(t,e=!0){t.keep=e},message(t,e){t.message=s.compile(e)},warn(t,e=!0){t.warn=e}},manifest:{build(t,e){for(const n in e){const i=e[n];if(["examples","externals","metas","notes","tags"].includes(n))for(const e of i)t=t[n.slice(0,-1)](e);else if("alterations"!==n)if("whens"!==n){if("shared"===n)for(const e of i)t=t.shared(e)}else for(const e of i){const{ref:n,is:i,not:r,then:o,otherwise:s,concat:a}=e;t=a?t.concat(a):n?t.when(n,{is:i,not:r,then:o,otherwise:s,switch:e.switch,break:e.break}):t.when(i,{then:o,otherwise:s,break:e.break})}else{const e={};for(const{target:t,adjuster:n}of i)e[t]=n;t=t.alter(e)}}return t}},messages:{"any.custom":"{{#label}} failed custom validation because {{#error.message}}","any.default":"{{#label}} threw an error when running default method","any.failover":"{{#label}} threw an error when running failover method","any.invalid":"{{#label}} contains an invalid value","any.only":'{{#label}} must be {if(#valids.length == 1, "", "one of ")}{{#valids}}',"any.ref":'{{#label}} {{#arg}} references "{{#ref}}" which {{#reason}}',"any.required":"{{#label}} is required","any.unknown":"{{#label}} is not allowed"}})},function(t,e,n){"use strict";const i=n(32),r=n(1),o=n(7);e.Report=class{constructor(t,n,i,r,o,s,a){if(this.code=t,this.flags=r,this.messages=o,this.path=s.path,this.prefs=a,this.state=s,this.value=n,this.message=null,this.template=null,this.local=i||{},this.local.label=e.label(this.flags,this.state,this.prefs,this.messages),void 0===this.value||this.local.hasOwnProperty("value")||(this.local.value=this.value),this.path.length){const t=this.path[this.path.length-1];"object"!=typeof t&&(this.local.key=t)}}_setTemplate(t){if(this.template=t,!this.flags.label&&0===this.path.length){const t=this._template(this.template,"root");t&&(this.local.label=t)}}toString(){if(this.message)return this.message;const t=this.code;if(!this.prefs.errors.render)return this.code;const e=this._template(this.template)||this._template(this.prefs.messages)||this._template(this.messages);return void 0===e?'Error code "'.concat(t,'" is not defined, your custom type is missing the correct messages definition'):(this.message=e.render(this.value,this.state,this.prefs,this.local,{errors:this.prefs.errors,messages:[this.prefs.messages,this.messages]}),this.prefs.errors.label||(this.message=this.message.replace(/^"" /,"").trim()),this.message)}_template(t,n){return e.template(this.value,t,n||this.code,this.state,this.prefs)}},e.path=function(t){let e="";for(const n of t)"object"!=typeof n&&("string"==typeof n?(e&&(e+="."),e+=n):e+="[".concat(n,"]"));return e},e.template=function(t,e,n,i,s){if(!e)return;if(o.isTemplate(e))return"root"!==n?e:null;let a=s.errors.language;return r.isResolvable(a)&&(a=a.resolve(t,i,s)),a&&e[a]&&void 0!==e[a][n]?e[a][n]:e[n]},e.label=function(t,n,i,r){if(t.label)return t.label;if(!i.errors.label)return"";let o=n.path;return"key"===i.errors.label&&n.path.length>1&&(o=n.path.slice(-1)),e.path(o)||e.template(null,i.messages,"root",n,i)||r&&e.template(null,r,"root",n,i)||"value"},e.process=function(t,n,i){if(!t)return null;const{override:r,message:o,details:s}=e.details(t);if(r)return r;if(i.errors.stack)return new e.ValidationError(o,s,n);const a=Error.stackTraceLimit;Error.stackTraceLimit=0;const l=new e.ValidationError(o,s,n);return Error.stackTraceLimit=a,l},e.details=function(t,e={}){let n=[];const i=[];for(const r of t){if(r instanceof Error){if(!1!==e.override)return{override:r};const t=r.toString();n.push(t),i.push({message:t,type:"override",context:{error:r}});continue}const t=r.toString();n.push(t),i.push({message:t,path:r.path.filter(t=>"object"!=typeof t),type:r.code,context:r.local})}return n.length>1&&(n=[...new Set(n)]),{message:n.join(". "),details:i}},e.ValidationError=class extends Error{constructor(t,e,n){super(t),this._original=n,this.details=e}static isError(t){return t instanceof e.ValidationError}},e.ValidationError.prototype.isJoi=!0,e.ValidationError.prototype.name="ValidationError",e.ValidationError.prototype.annotate=i.error},function(t,e,n){"use strict";const i=n(0),r=n(2),o=n(6),s=n(1);let a;const l={symbol:Symbol("ref"),defaults:{adjust:null,in:!1,iterables:null,map:null,separator:".",type:"value"}};e.create=function(t,e={}){i("string"==typeof t,"Invalid reference key:",t),s.assertOptions(e,["adjust","ancestor","in","iterables","map","prefix","separator"]),i(!e.prefix||"object"==typeof e.prefix,"options.prefix must be of type object");const n=Object.assign({},l.defaults,e);delete n.prefix;const r=n.separator,o=l.context(t,r,e.prefix);if(n.type=o.type,t=o.key,"value"===n.type)if(o.root&&(i(!r||t[0]!==r,"Cannot specify relative path with root prefix"),n.ancestor="root",t||(t=null)),r&&r===t)t=null,n.ancestor=0;else if(void 0!==n.ancestor)i(!r||!t||t[0]!==r,"Cannot combine prefix with ancestor option");else{const[e,i]=l.ancestor(t,r);i&&""===(t=t.slice(i))&&(t=null),n.ancestor=e}return n.path=r?null===t?[]:t.split(r):[t],new l.Ref(n)},e.in=function(t,n={}){return e.create(t,Object.assign({},n,{in:!0}))},e.isRef=function(t){return!!t&&!!t[s.symbols.ref]},l.Ref=class{constructor(t){i("object"==typeof t,"Invalid reference construction"),s.assertOptions(t,["adjust","ancestor","in","iterables","map","path","separator","type","depth","key","root","display"]),i([!1,void 0].includes(t.separator)||"string"==typeof t.separator&&1===t.separator.length,"Invalid separator"),i(!t.adjust||"function"==typeof t.adjust,"options.adjust must be a function"),i(!t.map||Array.isArray(t.map),"options.map must be an array"),i(!t.map||!t.adjust,"Cannot set both map and adjust options"),Object.assign(this,l.defaults,t),i("value"===this.type||void 0===this.ancestor,"Non-value references cannot reference ancestors"),Array.isArray(this.map)&&(this.map=new Map(this.map)),this.depth=this.path.length,this.key=this.path.length?this.path.join(this.separator):null,this.root=this.path[0],this.updateDisplay()}resolve(t,e,n,r,o={}){return i(!this.in||o.in,"Invalid in() reference usage"),"global"===this.type?this._resolve(n.context,e,o):"local"===this.type?this._resolve(r,e,o):this.ancestor?"root"===this.ancestor?this._resolve(e.ancestors[e.ancestors.length-1],e,o):(i(this.ancestor<=e.ancestors.length,"Invalid reference exceeds the schema root:",this.display),this._resolve(e.ancestors[this.ancestor-1],e,o)):this._resolve(t,e,o)}_resolve(t,e,n){let i;if("value"===this.type&&e.mainstay.shadow&&!1!==n.shadow&&(i=e.mainstay.shadow.get(this.absolute(e))),void 0===i&&(i=o(t,this.path,{iterables:this.iterables,functions:!0})),this.adjust&&(i=this.adjust(i)),this.map){const t=this.map.get(i);void 0!==t&&(i=t)}return e.mainstay&&e.mainstay.tracer.resolve(e,this,i),i}toString(){return this.display}absolute(t){return[...t.path.slice(0,-this.ancestor),...this.path]}clone(){return new l.Ref(this)}describe(){const t={path:this.path};"value"!==this.type&&(t.type=this.type),"."!==this.separator&&(t.separator=this.separator),"value"===this.type&&1!==this.ancestor&&(t.ancestor=this.ancestor),this.map&&(t.map=[...this.map]);for(const e of["adjust","iterables"])null!==this[e]&&(t[e]=this[e]);return!1!==this.in&&(t.in=!0),{ref:t}}updateDisplay(){const t=null!==this.key?this.key:"";if("value"!==this.type)return void(this.display="ref:".concat(this.type,":").concat(t));if(!this.separator)return void(this.display="ref:".concat(t));if(!this.ancestor)return void(this.display="ref:".concat(this.separator).concat(t));if("root"===this.ancestor)return void(this.display="ref:root:".concat(t));if(1===this.ancestor)return void(this.display="ref:".concat(t||".."));const e=new Array(this.ancestor+1).fill(this.separator).join("");this.display="ref:".concat(e).concat(t||"")}},l.Ref.prototype[s.symbols.ref]=!0,e.build=function(t){return"value"===(t=Object.assign({},l.defaults,t)).type&&void 0===t.ancestor&&(t.ancestor=1),new l.Ref(t)},l.context=function(t,e,n={}){if(t=t.trim(),n){const i=void 0===n.global?"$":n.global;if(i!==e&&t.startsWith(i))return{key:t.slice(i.length),type:"global"};const r=void 0===n.local?"#":n.local;if(r!==e&&t.startsWith(r))return{key:t.slice(r.length),type:"local"};const o=void 0===n.root?"/":n.root;if(o!==e&&t.startsWith(o))return{key:t.slice(o.length),type:"value",root:!0}}return{key:t,type:"value"}},l.ancestor=function(t,e){if(!e)return[1,0];if(t[0]!==e)return[1,0];if(t[1]!==e)return[0,1];let n=2;for(;t[n]===e;)++n;return[n-1,n]},e.toSibling=0,e.toParent=1,e.Manager=class{constructor(){this.refs=[]}register(t,i){if(t)if(i=void 0===i?e.toParent:i,Array.isArray(t))for(const e of t)this.register(e,i);else if(s.isSchema(t))for(const e of t._refs.refs)e.ancestor-i>=0&&this.refs.push({ancestor:e.ancestor-i,root:e.root});else e.isRef(t)&&"value"===t.type&&t.ancestor-i>=0&&this.refs.push({ancestor:t.ancestor-i,root:t.root}),a=a||n(7),a.isTemplate(t)&&this.register(t.refs(),i)}get length(){return this.refs.length}clone(){const t=new e.Manager;return t.refs=r(this.refs),t}reset(){this.refs=[]}roots(){return this.refs.filter(t=>!t.ancestor).map(t=>t.root)}}},function(t,e,n){"use strict";const i=n(0),r={};t.exports=function(t,e,n){if(!1===e||null==e)return t;"string"==typeof(n=n||{})&&(n={separator:n});const o=Array.isArray(e);i(!o||!n.separator,"Separator option no valid for array-based chain");const s=o?e:e.split(n.separator||".");let a=t;for(let t=0;t<s.length;++t){let o=s[t];const l=n.iterables&&r.iterables(a);if(Array.isArray(a)||"set"===l){const t=Number(o);Number.isInteger(t)&&(o=t<0?a.length+t:t)}if(!a||"function"==typeof a&&!1===n.functions||!l&&void 0===a[o]){i(!n.strict||t+1===s.length,"Missing segment",o,"in reach path ",e),i("object"==typeof a||!0===n.functions||"function"!=typeof a,"Invalid segment",o,"in reach path ",e),a=n.default;break}a=l?"set"===l?[...a][o]:a.get(o):a[o]}return a},r.iterables=function(t){return t instanceof Set?"set":t instanceof Map?"map":void 0}},function(t,e,n){"use strict";const i=n(0),r=n(2),o=n(30),s=n(31),a=n(1),l=n(4),c=n(5),u={symbol:Symbol("template"),opens:new Array(1e3).join("\0"),closes:new Array(1e3).join(""),dateFormat:{date:Date.prototype.toDateString,iso:Date.prototype.toISOString,string:Date.prototype.toString,time:Date.prototype.toTimeString,utc:Date.prototype.toUTCString}};t.exports=u.Template=class{constructor(t,e){i("string"==typeof t,"Template source must be a string"),i(!t.includes("\0")&&!t.includes(""),"Template source cannot contain reserved control characters"),this.source=t,this.rendered=t,this._template=null,this._settings=r(e),this._parse()}_parse(){if(!this.source.includes("{"))return;const t=u.encode(this.source),e=u.split(t);let n=!1;const i=[],r=e.shift();r&&i.push(r);for(const t of e){const e="{"!==t[0],r=e?"}":"}}",o=t.indexOf(r);if(-1===o||"{"===t[1]){i.push("{".concat(u.decode(t)));continue}const s=t.slice(e?0:1,o),a=this._ref(u.decode(s),e);i.push(a),"string"!=typeof a&&(n=!0);const l=t.slice(o+r.length);l&&i.push(u.decode(l))}n?this._template=i:this.rendered=i.join("")}static date(t,e){return u.dateFormat[e.dateFormat].call(t)}describe(t={}){if(!this._settings&&t.compact)return this.source;const e={template:this.source};return this._settings&&(e.options=this._settings),e}static build(t){return new u.Template(t.template,t.options)}isDynamic(){return!!this._template}static isTemplate(t){return!!t&&!!t[a.symbols.template]}refs(){if(!this._template)return;const t=[];for(const e of this._template)"string"!=typeof e&&t.push(...e.refs);return t}resolve(t,e,n,i){return this._template&&1===this._template.length?this._part(this._template[0],t,e,n,i,{}):this.render(t,e,n,i)}_part(t,...e){return t.ref?t.ref.resolve(...e):t.formula.evaluate(e)}render(t,e,n,i,r={}){if(!this.isDynamic())return this.rendered;const s=[];for(const a of this._template)if("string"==typeof a)s.push(a);else{const l=this._part(a,t,e,n,i,r),c=u.stringify(l,n,r.errors);if(void 0!==c){const t=a.raw||!1===(r.errors&&r.errors.escapeHtml)?c:o(c),e=a.ref&&"local"===a.ref.type&&"label"===a.ref.key&&n.errors.wrap.label;s.push(u.wrap(t,e))}}return s.join("")}_ref(t,e){const n=[],i=t=>{const e=c.create(t,this._settings);return n.push(e),t=>e.resolve(...t)};try{var r=new s.Parser(t,{reference:i,functions:u.functions,constants:u.constants})}catch(e){throw e.message='Invalid template variable "'.concat(t,'" fails due to: ').concat(e.message),e}return r.single?"reference"===r.single.type?{ref:n[0],raw:e,refs:n}:u.stringify(r.single.value):{formula:r,raw:e,refs:n}}toString(){return this.source}},u.Template.prototype[a.symbols.template]=!0,u.Template.prototype.isImmutable=!0,u.encode=function(t){return t.replace(/\\(\{+)/g,(t,e)=>u.opens.slice(0,e.length)).replace(/\\(\}+)/g,(t,e)=>u.closes.slice(0,e.length))},u.decode=function(t){return t.replace(/\u0000/g,"{").replace(/\u0001/g,"}")},u.split=function(t){const e=[];let n="";for(let i=0;i<t.length;++i){const r=t[i];if("{"===r){let r="";for(;i+1<t.length&&"{"===t[i+1];)r+="{",++i;e.push(n),n=r}else n+=r}return e.push(n),e},u.wrap=function(t,e){return e?1===e.length?"".concat(e).concat(t).concat(e):"".concat(e[0]).concat(t).concat(e[1]):t},u.stringify=function(t,e,n){const i=typeof t;if(null===t)return"null";if("string"===i)return t;if("number"===i||"function"===i||"symbol"===i)return t.toString();if("object"!==i)return JSON.stringify(t);if(t instanceof Date)return u.Template.date(t,e);if(t instanceof Map){const e=[];for(const[n,i]of t.entries())e.push("".concat(n.toString()," -> ").concat(i.toString()));t=e}if(!Array.isArray(t))return t.toString();let r="";for(const i of t)r=r+(r.length?", ":"")+u.stringify(i,e,n);return u.wrap(r,e.errors.wrap.array)},u.constants={true:!0,false:!1,null:null,second:1e3,minute:6e4,hour:36e5,day:864e5},u.functions={if:(t,e,n)=>t?e:n,msg(t){const[e,n,i,r,o]=this,s=o.messages;if(!s)return"";const a=l.template(e,s[0],t,n,i)||l.template(e,s[1],t,n,i);return a?a.render(e,n,i,r,o):""},number:t=>"number"==typeof t?t:"string"==typeof t?parseFloat(t):"boolean"==typeof t?t?1:0:t instanceof Date?t.getTime():null}},function(t,e,n){"use strict";const i=n(0),r=n(1),o=n(5),s={};e.schema=function(t,e,n={}){r.assertOptions(n,["appendPath","override"]);try{return s.schema(t,e,n)}catch(t){throw n.appendPath&&void 0!==t.path&&(t.message="".concat(t.message," (").concat(t.path,")")),t}},s.schema=function(t,e,n){i(void 0!==e,"Invalid undefined schema"),Array.isArray(e)&&(i(e.length,"Invalid empty array schema"),1===e.length&&(e=e[0]));const o=(e,...i)=>!1!==n.override?e.valid(t.override,...i):e.valid(...i);if(s.simple(e))return o(t,e);if("function"==typeof e)return t.custom(e);if(i("object"==typeof e,"Invalid schema content:",typeof e),r.isResolvable(e))return o(t,e);if(r.isSchema(e))return e;if(Array.isArray(e)){for(const n of e)if(!s.simple(n))return t.alternatives().try(...e);return o(t,...e)}return e instanceof RegExp?t.string().regex(e):e instanceof Date?o(t.date(),e):(i(Object.getPrototypeOf(e)===Object.getPrototypeOf({}),"Schema can only contain plain objects"),t.object().keys(e))},e.ref=function(t,e){return o.isRef(t)?t:o.create(t,e)},e.compile=function(t,n,o={}){r.assertOptions(o,["legacy"]);const a=n&&n[r.symbols.any];if(a)return i(o.legacy||a.version===r.version,"Cannot mix different versions of joi schemas:",a.version,r.version),n;if("object"!=typeof n||!o.legacy)return e.schema(t,n,{appendPath:!0});const l=s.walk(n);return l?l.compile(l.root,n):e.schema(t,n,{appendPath:!0})},s.walk=function(t){if("object"!=typeof t)return null;if(Array.isArray(t)){for(const e of t){const t=s.walk(e);if(t)return t}return null}const e=t[r.symbols.any];if(e)return{root:t[e.root],compile:e.compile};i(Object.getPrototypeOf(t)===Object.getPrototypeOf({}),"Schema can only contain plain objects");for(const e in t){const n=s.walk(t[e]);if(n)return n}return null},s.simple=function(t){return null===t||["boolean","string","number"].includes(typeof t)},e.when=function(t,n,a){if(void 0===a&&(i(n&&"object"==typeof n,"Missing options"),a=n,n=o.create(".")),Array.isArray(a)&&(a={switch:a}),r.assertOptions(a,["is","not","then","otherwise","switch","break"]),r.isSchema(n))return i(void 0===a.is,'"is" can not be used with a schema condition'),i(void 0===a.not,'"not" can not be used with a schema condition'),i(void 0===a.switch,'"switch" can not be used with a schema condition'),s.condition(t,{is:n,then:a.then,otherwise:a.otherwise,break:a.break});if(i(o.isRef(n)||"string"==typeof n,"Invalid condition:",n),i(void 0===a.not||void 0===a.is,'Cannot combine "is" with "not"'),void 0===a.switch){let l=a;void 0!==a.not&&(l={is:a.not,then:a.otherwise,otherwise:a.then,break:a.break});let c=void 0!==l.is?t.$_compile(l.is):t.$_root.invalid(null,!1,0,"").required();return i(void 0!==l.then||void 0!==l.otherwise,'options must have at least one of "then", "otherwise", or "switch"'),i(void 0===l.break||void 0===l.then||void 0===l.otherwise,"Cannot specify then, otherwise, and break all together"),void 0===a.is||o.isRef(a.is)||r.isSchema(a.is)||(c=c.required()),s.condition(t,{ref:e.ref(n),is:c,then:l.then,otherwise:l.otherwise,break:l.break})}i(Array.isArray(a.switch),'"switch" must be an array'),i(void 0===a.is,'Cannot combine "switch" with "is"'),i(void 0===a.not,'Cannot combine "switch" with "not"'),i(void 0===a.then,'Cannot combine "switch" with "then"');const l={ref:e.ref(n),switch:[],break:a.break};for(let e=0;e<a.switch.length;++e){const n=a.switch[e],s=e===a.switch.length-1;r.assertOptions(n,s?["is","then","otherwise"]:["is","then"]),i(void 0!==n.is,'Switch statement missing "is"'),i(void 0!==n.then,'Switch statement missing "then"');const c={is:t.$_compile(n.is),then:t.$_compile(n.then)};if(o.isRef(n.is)||r.isSchema(n.is)||(c.is=c.is.required()),s){i(void 0===a.otherwise||void 0===n.otherwise,'Cannot specify "otherwise" inside and outside a "switch"');const e=void 0!==a.otherwise?a.otherwise:n.otherwise;void 0!==e&&(i(void 0===l.break,"Cannot specify both otherwise and break"),c.otherwise=t.$_compile(e))}l.switch.push(c)}return l},s.condition=function(t,e){for(const n of["then","otherwise"])void 0===e[n]?delete e[n]:e[n]=t.$_compile(e[n]);return e}},function(t,e,n){"use strict";const i=n(0),r=n(2),o=n(7);e.compile=function(t,e){if("string"==typeof t)return i(!e,"Cannot set single message string"),new o(t);if(o.isTemplate(t))return i(!e,"Cannot set single message template"),t;i("object"==typeof t&&!Array.isArray(t),"Invalid message options"),e=e?r(e):{};for(let n in t){const r=t[n];if("root"===n||o.isTemplate(r)){e[n]=r;continue}if("string"==typeof r){e[n]=new o(r);continue}i("object"==typeof r&&!Array.isArray(r),"Invalid message for",n);const s=n;for(n in e[s]=e[s]||{},r){const t=r[n];"root"===n||o.isTemplate(t)?e[s][n]=t:(i("string"==typeof t,"Invalid message for",n,"in",s),e[s][n]=new o(t))}}return e},e.decompile=function(t){const e={};for(let n in t){const i=t[n];if("root"===n){e[n]=i;continue}if(o.isTemplate(i)){e[n]=i.describe({compact:!0});continue}const r=n;for(n in e[r]={},i){const t=i[n];e[r][n]="root"!==n?t.describe({compact:!0}):t}}return e},e.merge=function(t,n){if(!t)return e.compile(n);if(!n)return t;if("string"==typeof n)return new o(n);if(o.isTemplate(n))return n;const s=r(t);for(let t in n){const e=n[t];if("root"===t||o.isTemplate(e)){s[t]=e;continue}if("string"==typeof e){s[t]=new o(e);continue}i("object"==typeof e&&!Array.isArray(e),"Invalid message for",t);const r=t;for(t in s[r]=s[r]||{},e){const n=e[t];"root"===t||o.isTemplate(n)?s[r][t]=n:(i("string"==typeof n,"Invalid message for",t,"in",r),s[r][t]=new o(n))}}return s}},function(t,e,n){"use strict";const i=n(13),r={mismatched:null};t.exports=function(t,e,n){return n=Object.assign({prototype:!0},n),!!r.isDeepEqual(t,e,n,[])},r.isDeepEqual=function(t,e,n,o){if(t===e)return 0!==t||1/t==1/e;const s=typeof t;if(s!==typeof e)return!1;if(null===t||null===e)return!1;if("function"===s){if(!n.deepFunction||t.toString()!==e.toString())return!1}else if("object"!==s)return t!=t&&e!=e;const a=r.getSharedType(t,e,!!n.prototype);switch(a){case i.buffer:return!1;case i.promise:return t===e;case i.regex:return t.toString()===e.toString();case r.mismatched:return!1}for(let n=o.length-1;n>=0;--n)if(o[n].isSame(t,e))return!0;o.push(new r.SeenEntry(t,e));try{return!!r.isDeepEqualObj(a,t,e,n,o)}finally{o.pop()}},r.getSharedType=function(t,e,n){if(n)return Object.getPrototypeOf(t)!==Object.getPrototypeOf(e)?r.mismatched:i.getInternalProto(t);const o=i.getInternalProto(t);return o!==i.getInternalProto(e)?r.mismatched:o},r.valueOf=function(t){const e=t.valueOf;if(void 0===e)return t;try{return e.call(t)}catch(t){return t}},r.hasOwnEnumerableProperty=function(t,e){return Object.prototype.propertyIsEnumerable.call(t,e)},r.isSetSimpleEqual=function(t,e){for(const n of t)if(!e.has(n))return!1;return!0},r.isDeepEqualObj=function(t,e,n,o,s){const{isDeepEqual:a,valueOf:l,hasOwnEnumerableProperty:c}=r,{keys:u,getOwnPropertySymbols:p}=Object;if(t===i.array){if(!o.part){if(e.length!==n.length)return!1;for(let t=0;t<e.length;++t)if(!a(e[t],n[t],o,s))return!1;return!0}for(const t of e)for(const e of n)if(a(t,e,o,s))return!0}else if(t===i.set){if(e.size!==n.size)return!1;if(!r.isSetSimpleEqual(e,n)){const t=new Set(n);for(const n of e){if(t.delete(n))continue;let e=!1;for(const i of t)if(a(n,i,o,s)){t.delete(i),e=!0;break}if(!e)return!1}}}else if(t===i.map){if(e.size!==n.size)return!1;for(const[t,i]of e){if(void 0===i&&!n.has(t))return!1;if(!a(i,n.get(t),o,s))return!1}}else if(t===i.error&&(e.name!==n.name||e.message!==n.message))return!1;const h=l(e),d=l(n);if((e!==h||n!==d)&&!a(h,d,o,s))return!1;const f=u(e);if(!o.part&&f.length!==u(n).length&&!o.skip)return!1;let y=0;for(const t of f)if(o.skip&&o.skip.includes(t))void 0===n[t]&&++y;else{if(!c(n,t))return!1;if(!a(e[t],n[t],o,s))return!1}if(!o.part&&f.length-y!==u(n).length)return!1;if(!1!==o.symbols){const t=p(e),i=new Set(p(n));for(const r of t){if(!o.skip||!o.skip.includes(r))if(c(e,r)){if(!c(n,r))return!1;if(!a(e[r],n[r],o,s))return!1}else if(c(n,r))return!1;i.delete(r)}for(const t of i)if(c(n,t))return!1}return!0},r.SeenEntry=class{constructor(t,e){this.obj=t,this.ref=e}isSame(t,e){return this.obj===t&&this.ref===e}}},function(t,e,n){"use strict";const i=n(0),r=n(2),o=n(15),s=n(1),a=n(8),l=n(4),c=n(17),u=n(18),p=n(5),h=n(7),d=n(19);let f;const y={types:{alternatives:n(33),any:n(3),array:n(39),boolean:n(40),date:n(41),function:n(42),link:n(45),number:n(46),object:n(47),string:n(48),symbol:n(52)},aliases:{alt:"alternatives",bool:"boolean",func:"function"},root:function(){const t={_types:new Set(Object.keys(y.types))};for(const e of t._types)t[e]=function(...t){return i(!t.length||["alternatives","link","object"].includes(e),"The",e,"type does not allow arguments"),y.generate(this,y.types[e],t)};for(const e of["allow","custom","disallow","equal","exist","forbidden","invalid","not","only","optional","options","prefs","preferences","required","strip","valid","when"])t[e]=function(...t){return this.any()[e](...t)};Object.assign(t,y.methods);for(const e in y.aliases){const n=y.aliases[e];t[e]=t[n]}return t.x=t.expression,d.setup&&d.setup(t),t}};y.methods={ValidationError:l.ValidationError,version:s.version,cache:o.provider,assert(t,e,...n){y.assert(t,e,!0,n)},attempt:(t,e,...n)=>y.assert(t,e,!1,n),build(t){return i("function"==typeof u.build,"Manifest functionality disabled"),u.build(this,t)},checkPreferences(t){s.checkPreferences(t)},compile(t,e){return a.compile(this,t,e)},defaults(t){i("function"==typeof t,"modifier must be a function");const e=Object.assign({},this);for(const n of e._types){const r=t(e[n]());i(s.isSchema(r),"modifier must return a valid schema object"),e[n]=function(...t){return y.generate(this,r,t)}}return e},expression:(...t)=>new h(...t),extend(...t){s.verifyFlat(t,"extend"),f=f||n(16),i(t.length,"You need to provide at least one extension"),this.assert(t,f.extensions);const e=Object.assign({},this);e._types=new Set(e._types);for(let n of t){"function"==typeof n&&(n=n(e)),this.assert(n,f.extension);const t=y.expandExtension(n,e);for(const n of t){i(void 0===e[n.type]||e._types.has(n.type),"Cannot override name",n.type);const t=n.base||this.any(),r=c.type(t,n);e._types.add(n.type),e[n.type]=function(...t){return y.generate(this,r,t)}}}return e},isError:l.ValidationError.isError,isExpression:h.isTemplate,isRef:p.isRef,isSchema:s.isSchema,in:(...t)=>p.in(...t),override:s.symbols.override,ref:(...t)=>p.create(...t),types(){const t={};for(const e of this._types)t[e]=this[e]();for(const e in y.aliases)t[e]=this[e]();return t}},y.assert=function(t,e,n,i){const o=i[0]instanceof Error||"string"==typeof i[0]?i[0]:null,a=o?i[1]:i[0],c=e.validate(t,s.preferences({errors:{stack:!0}},a||{}));let u=c.error;if(!u)return c.value;if(o instanceof Error)throw o;const p=n&&"function"==typeof u.annotate?u.annotate():u.message;throw u instanceof l.ValidationError==0&&(u=r(u)),u.message=o?"".concat(o," ").concat(p):p,u},y.generate=function(t,e,n){return i(t,"Must be invoked on a Joi instance."),e.$_root=t,e._definition.args&&n.length?e._definition.args(e,...n):e},y.expandExtension=function(t,e){if("string"==typeof t.type)return[t];const n=[];for(const i of e._types)if(t.type.test(i)){const r=Object.assign({},t);r.type=i,r.base=e[i](),n.push(r)}return n},t.exports=y.root()},function(t,e,n){"use strict";const i=n(28);t.exports=class extends Error{constructor(t){super(t.filter(t=>""!==t).map(t=>"string"==typeof t?t:t instanceof Error?t.message:i(t)).join(" ")||"Unknown error"),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e.assert)}}},function(t,e,n){"use strict";const i={};e=t.exports={array:Array.prototype,buffer:!1,date:Date.prototype,error:Error.prototype,generic:Object.prototype,map:Map.prototype,promise:Promise.prototype,regex:RegExp.prototype,set:Set.prototype,weakMap:WeakMap.prototype,weakSet:WeakSet.prototype},i.typeMap=new Map([["[object Error]",e.error],["[object Map]",e.map],["[object Promise]",e.promise],["[object Set]",e.set],["[object WeakMap]",e.weakMap],["[object WeakSet]",e.weakSet]]),e.getInternalProto=function(t){if(Array.isArray(t))return e.array;if(t instanceof Date)return e.date;if(t instanceof RegExp)return e.regex;if(t instanceof Error)return e.error;const n=Object.prototype.toString.call(t);return i.typeMap.get(n)||e.generic}},function(t,e,n){"use strict";e.keys=function(t,e={}){return!1!==e.symbols?Reflect.ownKeys(t):Object.getOwnPropertyNames(t)}},function(t,e,n){"use strict";const i=n(0),r=n(2),o=n(1),s={max:1e3,supported:new Set(["undefined","boolean","number","string"])};e.provider={provision:t=>new s.Cache(t)},s.Cache=class{constructor(t={}){o.assertOptions(t,["max"]),i(void 0===t.max||t.max&&t.max>0&&isFinite(t.max),"Invalid max cache size"),this._max=t.max||s.max,this._map=new Map,this._list=new s.List}get length(){return this._map.size}set(t,e){if(null!==t&&!s.supported.has(typeof t))return;let n=this._map.get(t);if(n)return n.value=e,void this._list.first(n);n=this._list.unshift({key:t,value:e}),this._map.set(t,n),this._compact()}get(t){const e=this._map.get(t);if(e)return this._list.first(e),r(e.value)}_compact(){if(this._map.size>this._max){const t=this._list.pop();this._map.delete(t.key)}}},s.List=class{constructor(){this.tail=null,this.head=null}unshift(t){return t.next=null,t.prev=this.head,this.head&&(this.head.next=t),this.head=t,this.tail||(this.tail=t),t}first(t){t!==this.head&&(this._remove(t),this.unshift(t))}pop(){return this._remove(this.tail)}_remove(t){const{next:e,prev:n}=t;return e.prev=n,n&&(n.next=e),t===this.tail&&(this.tail=e),t.prev=null,t.next=null,t}}},function(t,e,n){"use strict";const i=n(11),r={};r.wrap=i.string().min(1).max(2).allow(!1),e.preferences=i.object({allowUnknown:i.boolean(),abortEarly:i.boolean(),cache:i.boolean(),context:i.object(),convert:i.boolean(),dateFormat:i.valid("date","iso","string","time","utc"),debug:i.boolean(),errors:{escapeHtml:i.boolean(),label:i.valid("path","key",!1),language:[i.string(),i.object().ref()],render:i.boolean(),stack:i.boolean(),wrap:{label:r.wrap,array:r.wrap}},externals:i.boolean(),messages:i.object(),noDefaults:i.boolean(),nonEnumerables:i.boolean(),presence:i.valid("required","optional","forbidden"),skipFunctions:i.boolean(),stripUnknown:i.object({arrays:i.boolean(),objects:i.boolean()}).or("arrays","objects").allow(!0,!1),warnings:i.boolean()}).strict(),r.nameRx=/^[a-zA-Z0-9]\w*$/,r.rule=i.object({alias:i.array().items(i.string().pattern(r.nameRx)).single(),args:i.array().items(i.string(),i.object({name:i.string().pattern(r.nameRx).required(),ref:i.boolean(),assert:i.alternatives([i.function(),i.object().schema()]).conditional("ref",{is:!0,then:i.required()}),normalize:i.function(),message:i.string().when("assert",{is:i.function(),then:i.required()})})),convert:i.boolean(),manifest:i.boolean(),method:i.function().allow(!1),multi:i.boolean(),validate:i.function()}),e.extension=i.object({type:i.alternatives([i.string(),i.object().regex()]).required(),args:i.function(),base:i.object().schema().when("type",{is:i.object().regex(),then:i.forbidden()}),coerce:[i.function().maxArity(3),i.object({method:i.function().maxArity(3).required(),from:i.array().items(i.string()).single()})],flags:i.object().pattern(r.nameRx,i.object({setter:i.string(),default:i.any()})),manifest:{build:i.function().arity(2)},messages:[i.object(),i.string()],modifiers:i.object().pattern(r.nameRx,i.function().minArity(1).maxArity(2)),overrides:i.object().pattern(r.nameRx,i.function()),prepare:i.function().maxArity(3),rebuild:i.function().arity(1),rules:i.object().pattern(r.nameRx,r.rule),terms:i.object().pattern(r.nameRx,i.object({init:i.array().allow(null).required(),manifest:i.object().pattern(/.+/,[i.valid("schema","single"),i.object({mapped:i.object({from:i.string().required(),to:i.string().required()}).required()})])})),validate:i.function().maxArity(3)}).strict(),e.extensions=i.array().items(i.object(),i.function().arity(1)).strict(),r.desc={buffer:i.object({buffer:i.string()}),func:i.object({function:i.function().required(),options:{literal:!0}}),override:i.object({override:!0}),ref:i.object({ref:i.object({type:i.valid("value","global","local"),path:i.array().required(),separator:i.string().length(1).allow(!1),ancestor:i.number().min(0).integer().allow("root"),map:i.array().items(i.array().length(2)).min(1),adjust:i.function(),iterables:i.boolean(),in:i.boolean()}).required()}),regex:i.object({regex:i.string().min(3)}),special:i.object({special:i.valid("deep").required()}),template:i.object({template:i.string().required(),options:i.object()}),value:i.object({value:i.alternatives([i.object(),i.array()]).required()})},r.desc.entity=i.alternatives([i.array().items(i.link("...")),i.boolean(),i.function(),i.number(),i.string(),r.desc.buffer,r.desc.func,r.desc.ref,r.desc.regex,r.desc.special,r.desc.template,r.desc.value,i.link("/")]),r.desc.values=i.array().items(null,i.boolean(),i.function(),i.number().allow(1/0,-1/0),i.string().allow(""),i.symbol(),r.desc.buffer,r.desc.func,r.desc.override,r.desc.ref,r.desc.regex,r.desc.template,r.desc.value),r.desc.messages=i.object().pattern(/.+/,[i.string(),r.desc.template,i.object().pattern(/.+/,[i.string(),r.desc.template])]),e.description=i.object({type:i.string().required(),flags:i.object({cast:i.string(),default:i.any(),description:i.string(),empty:i.link("/"),failover:r.desc.entity,id:i.string(),label:i.string(),only:!0,presence:["optional","required","forbidden"],result:["raw","strip"],strip:i.boolean(),unit:i.string()}).unknown(),preferences:{allowUnknown:i.boolean(),abortEarly:i.boolean(),cache:i.boolean(),convert:i.boolean(),dateFormat:["date","iso","string","time","utc"],errors:{escapeHtml:i.boolean(),label:["path","key"],language:[i.string(),r.desc.ref],wrap:{label:r.wrap,array:r.wrap}},externals:i.boolean(),messages:r.desc.messages,noDefaults:i.boolean(),nonEnumerables:i.boolean(),presence:["required","optional","forbidden"],skipFunctions:i.boolean(),stripUnknown:i.object({arrays:i.boolean(),objects:i.boolean()}).or("arrays","objects").allow(!0,!1),warnings:i.boolean()},allow:r.desc.values,invalid:r.desc.values,rules:i.array().min(1).items({name:i.string().required(),args:i.object().min(1),keep:i.boolean(),message:[i.string(),r.desc.messages],warn:i.boolean()}),keys:i.object().pattern(/.*/,i.link("/")),link:r.desc.ref}).pattern(/^[a-z]\w*$/,i.any())},function(t,e,n){"use strict";const i=n(0),r=n(2),o=n(1),s=n(9),a={};e.type=function(t,e){const n=Object.getPrototypeOf(t),l=r(n),c=t._assign(Object.create(l)),u=Object.assign({},e);delete u.base,l._definition=u;const p=n._definition||{};u.messages=s.merge(p.messages,u.messages),u.properties=Object.assign({},p.properties,u.properties),c.type=u.type,u.flags=Object.assign({},p.flags,u.flags);const h=Object.assign({},p.terms);if(u.terms)for(const t in u.terms){const e=u.terms[t];i(void 0===c.$_terms[t],"Invalid term override for",u.type,t),c.$_terms[t]=e.init,h[t]=e}u.terms=h,u.args||(u.args=p.args),u.prepare=a.prepare(u.prepare,p.prepare),u.coerce&&("function"==typeof u.coerce&&(u.coerce={method:u.coerce}),u.coerce.from&&!Array.isArray(u.coerce.from)&&(u.coerce={method:u.coerce.method,from:[].concat(u.coerce.from)})),u.coerce=a.coerce(u.coerce,p.coerce),u.validate=a.validate(u.validate,p.validate);const d=Object.assign({},p.rules);if(u.rules)for(const t in u.rules){const e=u.rules[t];i("object"==typeof e,"Invalid rule definition for",u.type,t);let n=e.method;if(void 0===n&&(n=function(){return this.$_addRule(t)}),n&&(i(!l[t],"Rule conflict in",u.type,t),l[t]=n),i(!d[t],"Rule conflict in",u.type,t),d[t]=e,e.alias){const t=[].concat(e.alias);for(const n of t)l[n]=e.method}e.args&&(e.argsByName=new Map,e.args=e.args.map(t=>("string"==typeof t&&(t={name:t}),i(!e.argsByName.has(t.name),"Duplicated argument name",t.name),o.isSchema(t.assert)&&(t.assert=t.assert.strict().label(t.name)),e.argsByName.set(t.name,t),t)))}u.rules=d;const f=Object.assign({},p.modifiers);if(u.modifiers)for(const t in u.modifiers){i(!l[t],"Rule conflict in",u.type,t);const e=u.modifiers[t];i("function"==typeof e,"Invalid modifier definition for",u.type,t);const n=function(e){return this.rule({[t]:e})};l[t]=n,f[t]=e}if(u.modifiers=f,u.overrides){l._super=n,c.$_super={};for(const t in u.overrides)i(n[t],"Cannot override missing",t),c.$_super[t]=n[t].bind(c);Object.assign(l,u.overrides)}u.cast=Object.assign({},p.cast,u.cast);const y=Object.assign({},p.manifest,u.manifest);return y.build=a.build(u.manifest&&u.manifest.build,p.manifest&&p.manifest.build),u.manifest=y,u.rebuild=a.rebuild(u.rebuild,p.rebuild),c},a.build=function(t,e){return t&&e?function(n,i){return e(t(n,i),i)}:t||e},a.coerce=function(t,e){return t&&e?{from:t.from&&e.from?[...new Set([...t.from,...e.from])]:null,method(n,i){let r;if((!e.from||e.from.includes(typeof n))&&(r=e.method(n,i),r)){if(r.errors||void 0===r.value)return r;n=r.value}if(!t.from||t.from.includes(typeof n)){const e=t.method(n,i);if(e)return e}return r}}:t||e},a.prepare=function(t,e){return t&&e?function(n,i){const r=t(n,i);if(r){if(r.errors||void 0===r.value)return r;n=r.value}return e(n,i)||r}:t||e},a.rebuild=function(t,e){return t&&e?function(n){e(n),t(n)}:t||e},a.validate=function(t,e){return t&&e?function(n,i){const r=e(n,i);if(r){if(r.errors&&(!Array.isArray(r.errors)||r.errors.length))return r;n=r.value}return t(n,i)||r}:t||e}},function(t,e){},function(t,e){},function(t,e,n){"use strict";const i=n(0),r=n(2),o=n(14),s={};t.exports=s.merge=function(t,e,n){if(i(t&&"object"==typeof t,"Invalid target value: must be an object"),i(null==e||"object"==typeof e,"Invalid source value: must be null, undefined, or an object"),!e)return t;if(n=Object.assign({nullOverride:!0,mergeArrays:!0},n),Array.isArray(e)){i(Array.isArray(t),"Cannot merge array onto an object"),n.mergeArrays||(t.length=0);for(let i=0;i<e.length;++i)t.push(r(e[i],{symbols:n.symbols}));return t}const a=o.keys(e,n);for(let i=0;i<a.length;++i){const o=a[i];if("__proto__"===o||!Object.prototype.propertyIsEnumerable.call(e,o))continue;const l=e[o];if(l&&"object"==typeof l){if(t[o]===l)continue;!t[o]||"object"!=typeof t[o]||Array.isArray(t[o])!==Array.isArray(l)||l instanceof Date||l instanceof RegExp?t[o]=r(l,{symbols:n.symbols}):s.merge(t[o],l,n)}else(null!=l||n.nullOverride)&&(t[o]=l)}return t}},function(t,e,n){"use strict";const i=n(0),r=n(10),o=n(1),s={};t.exports=s.Values=class{constructor(t,e){this._values=new Set(t),this._refs=new Set(e),this._lowercase=s.lowercases(t),this._override=!1}get length(){return this._values.size+this._refs.size}add(t,e){o.isResolvable(t)?this._refs.has(t)||(this._refs.add(t),e&&e.register(t)):this.has(t,null,null,!1)||(this._values.add(t),"string"==typeof t&&this._lowercase.set(t.toLowerCase(),t))}static merge(t,e,n){if(t=t||new s.Values,e){if(e._override)return e.clone();for(const n of[...e._values,...e._refs])t.add(n)}if(n)for(const e of[...n._values,...n._refs])t.remove(e);return t.length?t:null}remove(t){o.isResolvable(t)?this._refs.delete(t):(this._values.delete(t),"string"==typeof t&&this._lowercase.delete(t.toLowerCase()))}has(t,e,n,i){return!!this.get(t,e,n,i)}get(t,e,n,i){if(!this.length)return!1;if(this._values.has(t))return{value:t};if("string"==typeof t&&t&&i){const e=this._lowercase.get(t.toLowerCase());if(e)return{value:e}}if(!this._refs.size&&"object"!=typeof t)return!1;if("object"==typeof t)for(const e of this._values)if(r(e,t))return{value:e};if(e)for(const o of this._refs){const s=o.resolve(t,e,n,null,{in:!0});if(void 0===s)continue;const a=o.in&&"object"==typeof s?Array.isArray(s)?s:Object.keys(s):[s];for(const e of a)if(typeof e==typeof t)if(i&&t&&"string"==typeof t){if(e.toLowerCase()===t.toLowerCase())return{value:e,ref:o}}else if(r(e,t))return{value:e,ref:o}}return!1}override(){this._override=!0}values(t){if(t&&t.display){const t=[];for(const e of[...this._values,...this._refs])void 0!==e&&t.push(e);return t}return Array.from([...this._values,...this._refs])}clone(){const t=new s.Values(this._values,this._refs);return t._override=this._override,t}concat(t){i(!t._override,"Cannot concat override set of values");const e=new s.Values([...this._values,...t._values],[...this._refs,...t._refs]);return e._override=this._override,e}describe(){const t=[];this._override&&t.push({override:!0});for(const e of this._values.values())t.push(e&&"object"==typeof e?{value:e}:e);for(const e of this._refs.values())t.push(e.describe());return t}},s.Values.prototype[o.symbols.values]=!0,s.Values.prototype.slice=s.Values.prototype.clone,s.lowercases=function(t){const e=new Map;if(t)for(const n of t)"string"==typeof n&&e.set(n.toLowerCase(),n);return e}},function(t,e,n){"use strict";const i=n(43),r=n(0),o=n(2),s=n(44),a=n(3),l=n(1),c=n(8),u=n(4),p=n(5),h=n(7),d={renameDefaults:{alias:!1,multiple:!1,override:!1}};t.exports=a.extend({type:"_keys",properties:{typeof:"object"},flags:{unknown:{default:!1}},terms:{dependencies:{init:null},keys:{init:null,manifest:{mapped:{from:"schema",to:"key"}}},patterns:{init:null},renames:{init:null}},args:(t,e)=>t.keys(e),validate(t,{schema:e,error:n,state:i,prefs:r}){if(!t||typeof t!==e.$_property("typeof")||Array.isArray(t))return{value:t,errors:n("object.base",{type:e.$_property("typeof")})};if(!(e.$_terms.renames||e.$_terms.dependencies||e.$_terms.keys||e.$_terms.patterns||e.$_terms.externals))return;t=d.clone(t,r);const o=[];if(e.$_terms.renames&&!d.rename(e,t,i,r,o))return{value:t,errors:o};if(!e.$_terms.keys&&!e.$_terms.patterns&&!e.$_terms.dependencies)return{value:t,errors:o};const s=new Set(Object.keys(t));if(e.$_terms.keys){const n=[t,...i.ancestors];for(const a of e.$_terms.keys){const e=a.key,l=t[e];s.delete(e);const c=i.localize([...i.path,e],n,a),u=a.schema.$_validate(l,c,r);if(u.errors){if(r.abortEarly)return{value:t,errors:u.errors};o.push(...u.errors)}else"strip"===a.schema._flags.result||void 0===u.value&&void 0!==l?delete t[e]:void 0!==u.value&&(t[e]=u.value)}}if(s.size||e._flags._hasPatternMatch){const n=d.unknown(e,t,s,o,i,r);if(n)return n}if(e.$_terms.dependencies)for(const n of e.$_terms.dependencies){if(n.key&&void 0===n.key.resolve(t,i,r,null,{shadow:!1}))continue;const s=d.dependencies[n.rel](e,n,t,i,r);if(s){const n=e.$_createError(s.code,t,s.context,i,r);if(r.abortEarly)return{value:t,errors:n};o.push(n)}}return{value:t,errors:o}},rules:{and:{method(...t){return l.verifyFlat(t,"and"),d.dependency(this,"and",null,t)}},append:{method(t){return null==t||0===Object.keys(t).length?this:this.keys(t)}},assert:{method(t,e,n){h.isTemplate(t)||(t=c.ref(t)),r(void 0===n||"string"==typeof n,"Message must be a string"),e=this.$_compile(e,{appendPath:!0});const i=this.$_addRule({name:"assert",args:{subject:t,schema:e,message:n}});return i.$_mutateRegister(t),i.$_mutateRegister(e),i},validate(t,{error:e,prefs:n,state:i},{subject:r,schema:o,message:s}){const a=r.resolve(t,i,n),l=p.isRef(r)?r.absolute(i):[];return o.$_match(a,i.localize(l,[t,...i.ancestors],o),n)?t:e("object.assert",{subject:r,message:s})},args:["subject","schema","message"],multi:!0},instance:{method(t,e){return r("function"==typeof t,"constructor must be a function"),e=e||t.name,this.$_addRule({name:"instance",args:{constructor:t,name:e}})},validate:(t,e,{constructor:n,name:i})=>t instanceof n?t:e.error("object.instance",{type:i,value:t}),args:["constructor","name"]},keys:{method(t){r(void 0===t||"object"==typeof t,"Object schema must be a valid object"),r(!l.isSchema(t),"Object schema cannot be a joi schema");const e=this.clone();if(t)if(Object.keys(t).length){e.$_terms.keys=e.$_terms.keys?e.$_terms.keys.filter(e=>!t.hasOwnProperty(e.key)):new d.Keys;for(const n in t)l.tryWithPath(()=>e.$_terms.keys.push({key:n,schema:this.$_compile(t[n])}),n)}else e.$_terms.keys=new d.Keys;else e.$_terms.keys=null;return e.$_mutateRebuild()}},length:{method(t){return this.$_addRule({name:"length",args:{limit:t},operator:"="})},validate:(t,e,{limit:n},{name:i,operator:r,args:o})=>l.compare(Object.keys(t).length,n,r)?t:e.error("object."+i,{limit:o.limit,value:t}),args:[{name:"limit",ref:!0,assert:l.limit,message:"must be a positive integer"}]},max:{method(t){return this.$_addRule({name:"max",method:"length",args:{limit:t},operator:"<="})}},min:{method(t){return this.$_addRule({name:"min",method:"length",args:{limit:t},operator:">="})}},nand:{method(...t){return l.verifyFlat(t,"nand"),d.dependency(this,"nand",null,t)}},or:{method(...t){return l.verifyFlat(t,"or"),d.dependency(this,"or",null,t)}},oxor:{method(...t){return d.dependency(this,"oxor",null,t)}},pattern:{method(t,e,n={}){const i=t instanceof RegExp;i||(t=this.$_compile(t,{appendPath:!0})),r(void 0!==e,"Invalid rule"),l.assertOptions(n,["fallthrough","matches"]),i&&r(!t.flags.includes("g")&&!t.flags.includes("y"),"pattern should not use global or sticky mode"),e=this.$_compile(e,{appendPath:!0});const o=this.clone();o.$_terms.patterns=o.$_terms.patterns||[];const s={[i?"regex":"schema"]:t,rule:e};return n.matches&&(s.matches=this.$_compile(n.matches),"array"!==s.matches.type&&(s.matches=s.matches.$_root.array().items(s.matches)),o.$_mutateRegister(s.matches),o.$_setFlag("_hasPatternMatch",!0,{clone:!1})),n.fallthrough&&(s.fallthrough=!0),o.$_terms.patterns.push(s),o.$_mutateRegister(e),o}},ref:{method(){return this.$_addRule("ref")},validate:(t,e)=>p.isRef(t)?t:e.error("object.refType",{value:t})},regex:{method(){return this.$_addRule("regex")},validate:(t,e)=>t instanceof RegExp?t:e.error("object.regex",{value:t})},rename:{method(t,e,n={}){r("string"==typeof t||t instanceof RegExp,"Rename missing the from argument"),r("string"==typeof e||e instanceof h,"Invalid rename to argument"),r(e!==t,"Cannot rename key to same name:",t),l.assertOptions(n,["alias","ignoreUndefined","override","multiple"]);const o=this.clone();o.$_terms.renames=o.$_terms.renames||[];for(const e of o.$_terms.renames)r(e.from!==t,"Cannot rename the same key multiple times");return e instanceof h&&o.$_mutateRegister(e),o.$_terms.renames.push({from:t,to:e,options:i(d.renameDefaults,n)}),o}},schema:{method(t="any"){return this.$_addRule({name:"schema",args:{type:t}})},validate:(t,e,{type:n})=>!l.isSchema(t)||"any"!==n&&t.type!==n?e.error("object.schema",{type:n}):t},unknown:{method(t){return this.$_setFlag("unknown",!1!==t)}},with:{method(t,e,n={}){return d.dependency(this,"with",t,e,n)}},without:{method(t,e,n={}){return d.dependency(this,"without",t,e,n)}},xor:{method(...t){return l.verifyFlat(t,"xor"),d.dependency(this,"xor",null,t)}}},overrides:{default(t,e){return void 0===t&&(t=l.symbols.deepDefault),this.$_super.default(t,e)}},rebuild(t){if(t.$_terms.keys){const e=new s.Sorter;for(const n of t.$_terms.keys)l.tryWithPath(()=>e.add(n,{after:n.schema.$_rootReferences(),group:n.key}),n.key);t.$_terms.keys=new d.Keys(...e.nodes)}},manifest:{build(t,e){if(e.keys&&(t=t.keys(e.keys)),e.dependencies)for(const{rel:n,key:i=null,peers:r,options:o}of e.dependencies)t=d.dependency(t,n,i,r,o);if(e.patterns)for(const{regex:n,schema:i,rule:r,fallthrough:o,matches:s}of e.patterns)t=t.pattern(n||i,r,{fallthrough:o,matches:s});if(e.renames)for(const{from:n,to:i,options:r}of e.renames)t=t.rename(n,i,r);return t}},messages:{"object.and":"{{#label}} contains {{#presentWithLabels}} without its required peers {{#missingWithLabels}}","object.assert":'{{#label}} is invalid because {if(#subject.key, `"` + #subject.key + `" failed to ` + (#message || "pass the assertion test"), #message || "the assertion failed")}',"object.base":"{{#label}} must be of type {{#type}}","object.instance":'{{#label}} must be an instance of "{{#type}}"',"object.length":'{{#label}} must have {{#limit}} key{if(#limit == 1, "", "s")}',"object.max":'{{#label}} must have less than or equal to {{#limit}} key{if(#limit == 1, "", "s")}',"object.min":'{{#label}} must have at least {{#limit}} key{if(#limit == 1, "", "s")}',"object.missing":"{{#label}} must contain at least one of {{#peersWithLabels}}","object.nand":'"{{#mainWithLabel}}" must not exist simultaneously with {{#peersWithLabels}}',"object.oxor":"{{#label}} contains a conflict between optional exclusive peers {{#peersWithLabels}}","object.pattern.match":"{{#label}} keys failed to match pattern requirements","object.refType":"{{#label}} must be a Joi reference","object.regex":"{{#label}} must be a RegExp object","object.rename.multiple":'{{#label}} cannot rename "{{#from}}" because multiple renames are disabled and another key was already renamed to "{{#to}}"',"object.rename.override":'{{#label}} cannot rename "{{#from}}" because override is disabled and target "{{#to}}" exists',"object.schema":"{{#label}} must be a Joi schema of {{#type}} type","object.unknown":"{{#label}} is not allowed","object.with":'"{{#mainWithLabel}}" missing required peer "{{#peerWithLabel}}"',"object.without":'"{{#mainWithLabel}}" conflict with forbidden peer "{{#peerWithLabel}}"',"object.xor":"{{#label}} contains a conflict between exclusive peers {{#peersWithLabels}}"}}),d.clone=function(t,e){if("object"==typeof t){if(e.nonEnumerables)return o(t,{shallow:!0});const n=Object.create(Object.getPrototypeOf(t));return Object.assign(n,t),n}const n=function(...e){return t.apply(this,e)};return n.prototype=o(t.prototype),Object.defineProperty(n,"name",{value:t.name,writable:!1}),Object.defineProperty(n,"length",{value:t.length,writable:!1}),Object.assign(n,t),n},d.dependency=function(t,e,n,i,o){r(null===n||"string"==typeof n,e,"key must be a strings"),o||(o=i.length>1&&"object"==typeof i[i.length-1]?i.pop():{}),l.assertOptions(o,["separator"]),i=[].concat(i);const s=l.default(o.separator,"."),a=[];for(const t of i)r("string"==typeof t,e,"peers must be a string or a reference"),a.push(c.ref(t,{separator:s,ancestor:0,prefix:!1}));null!==n&&(n=c.ref(n,{separator:s,ancestor:0,prefix:!1}));const u=t.clone();return u.$_terms.dependencies=u.$_terms.dependencies||[],u.$_terms.dependencies.push(new d.Dependency(e,n,a,i)),u},d.dependencies={and(t,e,n,i,r){const o=[],s=[],a=e.peers.length;for(const t of e.peers)void 0===t.resolve(n,i,r,null,{shadow:!1})?o.push(t.key):s.push(t.key);if(o.length!==a&&s.length!==a)return{code:"object.and",context:{present:s,presentWithLabels:d.keysToLabels(t,s),missing:o,missingWithLabels:d.keysToLabels(t,o)}}},nand(t,e,n,i,r){const o=[];for(const t of e.peers)void 0!==t.resolve(n,i,r,null,{shadow:!1})&&o.push(t.key);if(o.length!==e.peers.length)return;const s=e.paths[0],a=e.paths.slice(1);return{code:"object.nand",context:{main:s,mainWithLabel:d.keysToLabels(t,s),peers:a,peersWithLabels:d.keysToLabels(t,a)}}},or(t,e,n,i,r){for(const t of e.peers)if(void 0!==t.resolve(n,i,r,null,{shadow:!1}))return;return{code:"object.missing",context:{peers:e.paths,peersWithLabels:d.keysToLabels(t,e.paths)}}},oxor(t,e,n,i,r){const o=[];for(const t of e.peers)void 0!==t.resolve(n,i,r,null,{shadow:!1})&&o.push(t.key);if(!o.length||1===o.length)return;const s={peers:e.paths,peersWithLabels:d.keysToLabels(t,e.paths)};return s.present=o,s.presentWithLabels=d.keysToLabels(t,o),{code:"object.oxor",context:s}},with(t,e,n,i,r){for(const o of e.peers)if(void 0===o.resolve(n,i,r,null,{shadow:!1}))return{code:"object.with",context:{main:e.key.key,mainWithLabel:d.keysToLabels(t,e.key.key),peer:o.key,peerWithLabel:d.keysToLabels(t,o.key)}}},without(t,e,n,i,r){for(const o of e.peers)if(void 0!==o.resolve(n,i,r,null,{shadow:!1}))return{code:"object.without",context:{main:e.key.key,mainWithLabel:d.keysToLabels(t,e.key.key),peer:o.key,peerWithLabel:d.keysToLabels(t,o.key)}}},xor(t,e,n,i,r){const o=[];for(const t of e.peers)void 0!==t.resolve(n,i,r,null,{shadow:!1})&&o.push(t.key);if(1===o.length)return;const s={peers:e.paths,peersWithLabels:d.keysToLabels(t,e.paths)};return 0===o.length?{code:"object.missing",context:s}:(s.present=o,s.presentWithLabels=d.keysToLabels(t,o),{code:"object.xor",context:s})}},d.keysToLabels=function(t,e){return Array.isArray(e)?e.map(e=>t.$_mapLabels(e)):t.$_mapLabels(e)},d.rename=function(t,e,n,i,r){const o={};for(const s of t.$_terms.renames){const a=[],l="string"!=typeof s.from;if(l)for(const t in e){if(void 0===e[t]&&s.options.ignoreUndefined)continue;if(t===s.to)continue;const n=s.from.exec(t);n&&a.push({from:t,to:s.to,match:n})}else!Object.prototype.hasOwnProperty.call(e,s.from)||void 0===e[s.from]&&s.options.ignoreUndefined||a.push(s);for(const c of a){const a=c.from;let u=c.to;if(u instanceof h&&(u=u.render(e,n,i,c.match)),a!==u){if(!s.options.multiple&&o[u]&&(r.push(t.$_createError("object.rename.multiple",e,{from:a,to:u,pattern:l},n,i)),i.abortEarly))return!1;if(Object.prototype.hasOwnProperty.call(e,u)&&!s.options.override&&!o[u]&&(r.push(t.$_createError("object.rename.override",e,{from:a,to:u,pattern:l},n,i)),i.abortEarly))return!1;void 0===e[a]?delete e[u]:e[u]=e[a],o[u]=!0,s.options.alias||delete e[a]}}}return!0},d.unknown=function(t,e,n,i,r,o){if(t.$_terms.patterns){let s=!1;const a=t.$_terms.patterns.map(t=>{if(t.matches)return s=!0,[]}),l=[e,...r.ancestors];for(const s of n){const c=e[s],u=[...r.path,s];for(let p=0;p<t.$_terms.patterns.length;++p){const h=t.$_terms.patterns[p];if(h.regex){const t=h.regex.test(s);if(r.mainstay.tracer.debug(r,"rule","pattern.".concat(p),t?"pass":"error"),!t)continue}else if(!h.schema.$_match(s,r.nest(h.schema,"pattern.".concat(p)),o))continue;n.delete(s);const d=r.localize(u,l,{schema:h.rule,key:s}),f=h.rule.$_validate(c,d,o);if(f.errors){if(o.abortEarly)return{value:e,errors:f.errors};i.push(...f.errors)}if(h.matches&&a[p].push(s),e[s]=f.value,!h.fallthrough)break}}if(s)for(let n=0;n<a.length;++n){const s=a[n];if(!s)continue;const c=t.$_terms.patterns[n].matches,p=r.localize(r.path,l,c),h=c.$_validate(s,p,o);if(h.errors){const n=u.details(h.errors,{override:!1});n.matches=s;const a=t.$_createError("object.pattern.match",e,n,r,o);if(o.abortEarly)return{value:e,errors:a};i.push(a)}}}if(n.size&&(t.$_terms.keys||t.$_terms.patterns)){if(o.stripUnknown&&!t._flags.unknown||o.skipFunctions){const t=!(!o.stripUnknown||!0!==o.stripUnknown&&!o.stripUnknown.objects);for(const i of n)t?(delete e[i],n.delete(i)):"function"==typeof e[i]&&n.delete(i)}if(!l.default(t._flags.unknown,o.allowUnknown))for(const s of n){const n=r.localize([...r.path,s],[]),a=t.$_createError("object.unknown",e[s],{child:s},n,o,{flags:!1});if(o.abortEarly)return{value:e,errors:a};i.push(a)}}},d.Dependency=class{constructor(t,e,n,i){this.rel=t,this.key=e,this.peers=n,this.paths=i}describe(){const t={rel:this.rel,peers:this.paths};return null!==this.key&&(t.key=this.key.key),"."!==this.peers[0].separator&&(t.options={separator:this.peers[0].separator}),t}},d.Keys=class extends Array{concat(t){const e=this.slice(),n=new Map;for(let t=0;t<e.length;++t)n.set(e[t].key,t);for(const i of t){const t=i.key,r=n.get(t);void 0!==r?e[r]={key:t,schema:e[r].schema.concat(i.schema)}:e.push(i)}return e}}},function(t,e,n){"use strict";const i=n(24),r=n(25),o={minDomainSegments:2,nonAsciiRx:/[^\x00-\x7f]/,domainControlRx:/[\x00-\x20@\:\/]/,tldSegmentRx:/^[a-zA-Z](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,domainSegmentRx:/^[a-zA-Z0-9](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,URL:i.URL||URL};e.analyze=function(t,e={}){if("string"!=typeof t)throw new Error("Invalid input: domain must be a string");if(!t)return r.code("DOMAIN_NON_EMPTY_STRING");if(t.length>256)return r.code("DOMAIN_TOO_LONG");if(o.nonAsciiRx.test(t)){if(!1===e.allowUnicode)return r.code("DOMAIN_INVALID_UNICODE_CHARS");t=t.normalize("NFC")}if(o.domainControlRx.test(t))return r.code("DOMAIN_INVALID_CHARS");t=o.punycode(t);const n=e.minDomainSegments||o.minDomainSegments,i=t.split(".");if(i.length<n)return r.code("DOMAIN_SEGMENTS_COUNT");const s=e.tlds;if(s){const t=i[i.length-1].toLowerCase();if(s.deny&&s.deny.has(t)||s.allow&&!s.allow.has(t))return r.code("DOMAIN_FORBIDDEN_TLDS")}for(let t=0;t<i.length;++t){const e=i[t];if(!e.length)return r.code("DOMAIN_EMPTY_SEGMENT");if(e.length>63)return r.code("DOMAIN_LONG_SEGMENT");if(t<i.length-1){if(!o.domainSegmentRx.test(e))return r.code("DOMAIN_INVALID_CHARS")}else if(!o.tldSegmentRx.test(e))return r.code("DOMAIN_INVALID_TLDS_CHARS")}return null},e.isValid=function(t,n){return!e.analyze(t,n)},o.punycode=function(t){try{return new o.URL("http://".concat(t)).host}catch(e){return t}}},function(t,e){},function(t,e,n){"use strict";e.codes={EMPTY_STRING:"Address must be a non-empty string",FORBIDDEN_UNICODE:"Address contains forbidden Unicode characters",MULTIPLE_AT_CHAR:"Address cannot contain more than one @ character",MISSING_AT_CHAR:"Address must contain one @ character",EMPTY_LOCAL:"Address local part cannot be empty",ADDRESS_TOO_LONG:"Address too long",LOCAL_TOO_LONG:"Address local part too long",EMPTY_LOCAL_SEGMENT:"Address local part contains empty dot-separated segment",INVALID_LOCAL_CHARS:"Address local part contains invalid character",DOMAIN_NON_EMPTY_STRING:"Domain must be a non-empty string",DOMAIN_TOO_LONG:"Domain too long",DOMAIN_INVALID_UNICODE_CHARS:"Domain contains forbidden Unicode characters",DOMAIN_INVALID_CHARS:"Domain contains invalid character",DOMAIN_INVALID_TLDS_CHARS:"Domain contains invalid tld character",DOMAIN_SEGMENTS_COUNT:"Domain lacks the minimum required number of segments",DOMAIN_FORBIDDEN_TLDS:"Domain uses forbidden TLD",DOMAIN_EMPTY_SEGMENT:"Domain contains empty dot-separated segment",DOMAIN_LONG_SEGMENT:"Domain contains dot-separated segment that is too long"},e.code=function(t){return{code:t,error:e.codes[t]}}},function(t,e,n){"use strict";const i=n(0),r=n(27),o={generate:function(){const t={},e="!\\$&'\\(\\)\\*\\+,;=",n="\\w-\\.~%\\dA-Fa-f"+e+":@",i="["+n+"]",r="(?:0{0,2}\\d|0?[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";t.ipv4address="(?:"+r+"\\.){3}"+r;const o="[\\dA-Fa-f]{1,4}",s="(?:"+o+":"+o+"|"+t.ipv4address+")",a="(?:"+o+":){6}"+s,l="::(?:"+o+":){5}"+s,c="(?:"+o+")?::(?:"+o+":){4}"+s,u="(?:(?:"+o+":){0,1}"+o+")?::(?:"+o+":){3}"+s,p="(?:(?:"+o+":){0,2}"+o+")?::(?:"+o+":){2}"+s,h="(?:(?:"+o+":){0,3}"+o+")?::"+o+":"+s,d="(?:(?:"+o+":){0,4}"+o+")?::"+s;t.ipv4Cidr="(?:\\d|[1-2]\\d|3[0-2])",t.ipv6Cidr="(?:0{0,2}\\d|0?[1-9]\\d|1[01]\\d|12[0-8])",t.ipv6address="(?:"+a+"|"+l+"|"+c+"|"+u+"|"+p+"|"+h+"|"+d+"|(?:(?:[\\dA-Fa-f]{1,4}:){0,5}[\\dA-Fa-f]{1,4})?::[\\dA-Fa-f]{1,4}|(?:(?:[\\dA-Fa-f]{1,4}:){0,6}[\\dA-Fa-f]{1,4})?::)",t.ipvFuture="v[\\dA-Fa-f]+\\.[\\w-\\.~"+e+":]+",t.scheme="[a-zA-Z][a-zA-Z\\d+-\\.]*",t.schemeRegex=new RegExp(t.scheme);const f="[\\w-\\.~%\\dA-Fa-f"+e+":]*",y="(?:\\[(?:"+t.ipv6address+"|"+t.ipvFuture+")\\]|"+t.ipv4address+"|[\\w-\\.~%\\dA-Fa-f!\\$&'\\(\\)\\*\\+,;=]{1,255})",m="(?:"+f+"@)?"+y+"(?::\\d*)?",g="(?:"+f+"@)?("+y+")(?::\\d*)?",v=i+"+",_="(?:\\/[\\w-\\.~%\\dA-Fa-f!\\$&'\\(\\)\\*\\+,;=:@]*)*",b="\\/(?:"+v+_+")?",w=v+_;return t.hierPart="(?:(?:\\/\\/"+m+_+")|"+b+"|"+w+"|(?:\\/\\/\\/[\\w-\\.~%\\dA-Fa-f!\\$&'\\(\\)\\*\\+,;=:@]*(?:\\/[\\w-\\.~%\\dA-Fa-f!\\$&'\\(\\)\\*\\+,;=:@]*)*))",t.hierPartCapture="(?:(?:\\/\\/"+g+_+")|"+b+"|"+w+")",t.relativeRef="(?:(?:\\/\\/"+m+_+")|"+b+"|[\\w-\\.~%\\dA-Fa-f!\\$&'\\(\\)\\*\\+,;=@]+(?:\\/[\\w-\\.~%\\dA-Fa-f!\\$&'\\(\\)\\*\\+,;=:@]*)*|)",t.query="["+n+"\\/\\?]*(?=#|$)",t.queryWithSquareBrackets="["+n+"\\[\\]\\/\\?]*(?=#|$)",t.fragment="["+n+"\\/\\?]*",t}};o.rfc3986=o.generate(),e.ip={v4Cidr:o.rfc3986.ipv4Cidr,v6Cidr:o.rfc3986.ipv6Cidr,ipv4:o.rfc3986.ipv4address,ipv6:o.rfc3986.ipv6address,ipvfuture:o.rfc3986.ipvFuture},o.createRegex=function(t){const e=o.rfc3986,n="(?:\\?"+(t.allowQuerySquareBrackets?e.queryWithSquareBrackets:e.query)+")?(?:#"+e.fragment+")?";if(t.relativeOnly)return o.wrap(e.relativeRef+n);let s="";if(t.scheme){i(t.scheme instanceof RegExp||"string"==typeof t.scheme||Array.isArray(t.scheme),"scheme must be a RegExp, String, or Array");const n=[].concat(t.scheme);i(n.length>=1,"scheme must have at least 1 scheme specified");const o=[];for(let t=0;t<n.length;++t){const s=n[t];i(s instanceof RegExp||"string"==typeof s,"scheme at position "+t+" must be a RegExp or String"),s instanceof RegExp?o.push(s.source.toString()):(i(e.schemeRegex.test(s),"scheme at position "+t+" must be a valid scheme"),o.push(r(s)))}s=o.join("|")}const a="(?:"+(s?"(?:"+s+")":e.scheme)+":"+(t.domain?e.hierPartCapture:e.hierPart)+")",l=t.allowRelative?"(?:"+a+"|"+e.relativeRef+")":a;return o.wrap(l+n,s)},o.wrap=function(t,e){return{raw:t="(?=.)(?!https?:/$)".concat(t),regex:new RegExp("^".concat(t,"$")),scheme:e}},o.uriRegex=o.createRegex({}),e.regex=function(t={}){return t.scheme||t.allowRelative||t.relativeOnly||t.allowQuerySquareBrackets||t.domain?o.createRegex(t):o.uriRegex}},function(t,e,n){"use strict";t.exports=function(t){return t.replace(/[\^\$\.\*\+\-\?\=\!\:\|\\\/\(\)\[\]\{\}\,]/g,"\\$&")}},function(t,e,n){"use strict";t.exports=function(...t){try{return JSON.stringify.apply(null,t)}catch(t){return"[Cannot display object: "+t.message+"]"}}},function(t){t.exports=JSON.parse('{"version":"17.1.0"}')},function(t,e,n){"use strict";const i={};t.exports=function(t){if(!t)return"";let e="";for(let n=0;n<t.length;++n){const r=t.charCodeAt(n);i.isSafe(r)?e+=t[n]:e+=i.escapeHtmlChar(r)}return e},i.escapeHtmlChar=function(t){const e=i.namedHtml[t];if(void 0!==e)return e;if(t>=256)return"&#"+t+";";const n=t.toString(16).padStart(2,"0");return"&#x".concat(n,";")},i.isSafe=function(t){return void 0!==i.safeCharCodes[t]},i.namedHtml={38:"&amp;",60:"&lt;",62:"&gt;",34:"&quot;",160:"&nbsp;",162:"&cent;",163:"&pound;",164:"&curren;",169:"&copy;",174:"&reg;"},i.safeCharCodes=function(){const t={};for(let e=32;e<123;++e)(e>=97||e>=65&&e<=90||e>=48&&e<=57||32===e||46===e||44===e||45===e||58===e||95===e)&&(t[e]=null);return t}()},function(t,e,n){"use strict";const i={operators:["!","^","*","/","%","+","-","<","<=",">",">=","==","!=","&&","||","??"],operatorCharacters:["!","^","*","/","%","+","-","<","=",">","&","|","?"],operatorsOrder:[["^"],["*","/","%"],["+","-"],["<","<=",">",">="],["==","!="],["&&"],["||","??"]],operatorsPrefix:["!","n"],literals:{'"':'"',"`":"`","'":"'","[":"]"},numberRx:/^(?:[0-9]*\.?[0-9]*){1}$/,tokenRx:/^[\w\$\#\.\@\:\{\}]+$/,symbol:Symbol("formula"),settings:Symbol("settings")};e.Parser=class{constructor(t,e={}){if(!e[i.settings]&&e.constants)for(const t in e.constants){const n=e.constants[t];if(null!==n&&!["boolean","number","string"].includes(typeof n))throw new Error("Formula constant ".concat(t," contains invalid ").concat(typeof n," value type"))}this.settings=e[i.settings]?e:Object.assign({[i.settings]:!0,constants:{},functions:{}},e),this.single=null,this._parts=null,this._parse(t)}_parse(t){let n=[],r="",o=0,s=!1;const a=t=>{if(o)throw new Error("Formula missing closing parenthesis");const a=n.length?n[n.length-1]:null;if(s||r||t){if(a&&"reference"===a.type&&")"===t)return a.type="function",a.value=this._subFormula(r,a.value),void(r="");if(")"===t){const t=new e.Parser(r,this.settings);n.push({type:"segment",value:t})}else if(s){if("]"===s)return n.push({type:"reference",value:r}),void(r="");n.push({type:"literal",value:r})}else if(i.operatorCharacters.includes(r))a&&"operator"===a.type&&i.operators.includes(a.value+r)?a.value+=r:n.push({type:"operator",value:r});else if(r.match(i.numberRx))n.push({type:"constant",value:parseFloat(r)});else if(void 0!==this.settings.constants[r])n.push({type:"constant",value:this.settings.constants[r]});else{if(!r.match(i.tokenRx))throw new Error("Formula contains invalid token: ".concat(r));n.push({type:"reference",value:r})}r=""}};for(const e of t)s?e===s?(a(),s=!1):r+=e:o?"("===e?(r+=e,++o):")"===e?(--o,o?r+=e:a(e)):r+=e:e in i.literals?s=i.literals[e]:"("===e?(a(),++o):i.operatorCharacters.includes(e)?(a(),r=e,a()):" "!==e?r+=e:a();a(),n=n.map((t,e)=>"operator"!==t.type||"-"!==t.value||e&&"operator"!==n[e-1].type?t:{type:"operator",value:"n"});let l=!1;for(const t of n){if("operator"===t.type){if(i.operatorsPrefix.includes(t.value))continue;if(!l)throw new Error("Formula contains an operator in invalid position");if(!i.operators.includes(t.value))throw new Error("Formula contains an unknown operator ".concat(t.value))}else if(l)throw new Error("Formula missing expected operator");l=!l}if(!l)throw new Error("Formula contains invalid trailing operator");1===n.length&&["reference","literal","constant"].includes(n[0].type)&&(this.single={type:"reference"===n[0].type?"reference":"value",value:n[0].value}),this._parts=n.map(t=>{if("operator"===t.type)return i.operatorsPrefix.includes(t.value)?t:t.value;if("reference"!==t.type)return t.value;if(this.settings.tokenRx&&!this.settings.tokenRx.test(t.value))throw new Error("Formula contains invalid reference ".concat(t.value));return this.settings.reference?this.settings.reference(t.value):i.reference(t.value)})}_subFormula(t,n){const r=this.settings.functions[n];if("function"!=typeof r)throw new Error("Formula contains unknown function ".concat(n));let o=[];if(t){let e="",r=0,s=!1;const a=()=>{if(!e)throw new Error("Formula contains function ".concat(n," with invalid arguments ").concat(t));o.push(e),e=""};for(let n=0;n<t.length;++n){const o=t[n];s?(e+=o,o===s&&(s=!1)):o in i.literals&&!r?(e+=o,s=i.literals[o]):","!==o||r?(e+=o,"("===o?++r:")"===o&&--r):a()}a()}return o=o.map(t=>new e.Parser(t,this.settings)),function(t){const e=[];for(const n of o)e.push(n.evaluate(t));return r.call(t,...e)}}evaluate(t){const e=this._parts.slice();for(let n=e.length-2;n>=0;--n){const r=e[n];if(r&&"operator"===r.type){const o=e[n+1];e.splice(n+1,1);const s=i.evaluate(o,t);e[n]=i.single(r.value,s)}}return i.operatorsOrder.forEach(n=>{for(let r=1;r<e.length-1;)if(n.includes(e[r])){const n=e[r],o=i.evaluate(e[r-1],t),s=i.evaluate(e[r+1],t);e.splice(r,2);const a=i.calculate(n,o,s);e[r-1]=0===a?0:a}else r+=2}),i.evaluate(e[0],t)}},e.Parser.prototype[i.symbol]=!0,i.reference=function(t){return function(e){return e&&void 0!==e[t]?e[t]:null}},i.evaluate=function(t,e){return null===t?null:"function"==typeof t?t(e):t[i.symbol]?t.evaluate(e):t},i.single=function(t,e){if("!"===t)return!e;const n=-e;return 0===n?0:n},i.calculate=function(t,e,n){if("??"===t)return i.exists(e)?e:n;if("string"==typeof e||"string"==typeof n){if("+"===t)return(e=i.exists(e)?e:"")+(i.exists(n)?n:"")}else switch(t){case"^":return Math.pow(e,n);case"*":return e*n;case"/":return e/n;case"%":return e%n;case"+":return e+n;case"-":return e-n}switch(t){case"<":return e<n;case"<=":return e<=n;case">":return e>n;case">=":return e>=n;case"==":return e===n;case"!=":return e!==n;case"&&":return e&&n;case"||":return e||n}return null},i.exists=function(t){return null!=t}},function(t,e){},function(t,e,n){"use strict";const i=n(0),r=n(3),o=n(1),s=n(8),a=n(4),l=n(5),c={};t.exports=r.extend({type:"alternatives",flags:{match:{default:"any"}},terms:{matches:{init:[],register:l.toSibling}},args:(t,...e)=>1===e.length&&Array.isArray(e[0])?t.try(...e[0]):t.try(...e),validate(t,e){const{schema:n,error:i,state:r,prefs:o}=e;if(n._flags.match){let e,s=0;for(let i=0;i<n.$_terms.matches.length;++i){const a=n.$_terms.matches[i],l=r.nest(a.schema,"match.".concat(i));l.snapshot();const c=a.schema.$_validate(t,l,o);c.errors?l.restore():(++s,e=c.value)}return s?"one"===n._flags.match?1===s?{value:e}:{errors:i("alternatives.one")}:s===n.$_terms.matches.length?{value:t}:{errors:i("alternatives.all")}:{errors:i("alternatives.any")}}const s=[];for(let e=0;e<n.$_terms.matches.length;++e){const i=n.$_terms.matches[e];if(i.schema){const n=r.nest(i.schema,"match.".concat(e));n.snapshot();const a=i.schema.$_validate(t,n,o);if(!a.errors)return a;n.restore(),s.push({schema:i.schema,reports:a.errors});continue}const a=i.ref?i.ref.resolve(t,r,o):t,l=i.is?[i]:i.switch;for(let n=0;n<l.length;++n){const s=l[n],{is:c,then:u,otherwise:p}=s,h="match.".concat(e).concat(i.switch?"."+n:"");if(c.$_match(a,r.nest(c,"".concat(h,".is")),o)){if(u)return u.$_validate(t,r.nest(u,"".concat(h,".then")),o)}else if(p)return p.$_validate(t,r.nest(p,"".concat(h,".otherwise")),o)}}return c.errors(s,e)},rules:{conditional:{method(t,e){i(!this._flags._endedSwitch,"Unreachable condition"),i(!this._flags.match,"Cannot combine match mode",this._flags.match,"with conditional rule"),i(void 0===e.break,"Cannot use break option with alternatives conditional");const n=this.clone(),r=s.when(n,t,e),o=r.is?[r]:r.switch;for(const t of o)if(t.then&&t.otherwise){n.$_setFlag("_endedSwitch",!0,{clone:!1});break}return n.$_terms.matches.push(r),n.$_mutateRebuild()}},match:{method(t){if(i(["any","one","all"].includes(t),"Invalid alternatives match mode",t),"any"!==t)for(const e of this.$_terms.matches)i(e.schema,"Cannot combine match mode",t,"with conditional rules");return this.$_setFlag("match",t)}},try:{method(...t){i(t.length,"Missing alternative schemas"),o.verifyFlat(t,"try"),i(!this._flags._endedSwitch,"Unreachable condition");const e=this.clone();for(const n of t)e.$_terms.matches.push({schema:e.$_compile(n)});return e.$_mutateRebuild()}}},overrides:{label(t){return this.$_super.label(t).$_modify({each:(e,n)=>"is"!==n.path[0]?e.label(t):void 0,ref:!1})}},rebuild(t){t.$_modify({each:e=>{o.isSchema(e)&&"array"===e.type&&t.$_setFlag("_arrayItems",!0,{clone:!1})}})},manifest:{build(t,e){if(e.matches)for(const n of e.matches){const{schema:e,ref:i,is:r,not:o,then:s,otherwise:a}=n;t=e?t.try(e):i?t.conditional(i,{is:r,then:s,not:o,otherwise:a,switch:n.switch}):t.conditional(r,{then:s,otherwise:a})}return t}},messages:{"alternatives.all":"{{#label}} does not match all of the required types","alternatives.any":"{{#label}} does not match any of the allowed types","alternatives.match":"{{#label}} does not match any of the allowed types","alternatives.one":"{{#label}} matches more than one allowed type","alternatives.types":"{{#label}} must be one of {{#types}}"}}),c.errors=function(t,{error:e,state:n}){if(!t.length)return{errors:e("alternatives.any")};if(1===t.length)return{errors:t[0].reports};const i=new Set,r=[];for(const{reports:o,schema:s}of t){if(o.length>1)return c.unmatched(t,e);const l=o[0];if(l instanceof a.Report==0)return c.unmatched(t,e);if(l.state.path.length!==n.path.length){r.push({type:s.type,report:l});continue}if("any.only"===l.code){for(const t of l.local.valids)i.add(t);continue}const[u,p]=l.code.split(".");"base"===p?i.add(u):r.push({type:s.type,report:l})}return r.length?1===r.length?{errors:r[0].report}:c.unmatched(t,e):{errors:e("alternatives.types",{types:[...i]})}},c.unmatched=function(t,e){const n=[];for(const e of t)n.push(...e.reports);return{errors:e("alternatives.match",a.details(n,{override:!1}))}}},function(t,e,n){"use strict";const i=n(0),r=n(2),o=n(10),s=n(20),a=n(15),l=n(1),c=n(8),u=n(4),p=n(17),h=n(18),d=n(9),f=n(35),y=n(5),m=n(19),g=n(36),v=n(21),_={Base:class{constructor(t){this.type=t,this.$_root=null,this._definition={},this._ids=new f.Ids,this._preferences=null,this._refs=new y.Manager,this._cache=null,this._valids=null,this._invalids=null,this._flags={},this._rules=[],this._singleRules=new Map,this.$_terms={},this.$_temp={ruleset:null,whens:{}}}describe(){return i("function"==typeof h.describe,"Manifest functionality disabled"),h.describe(this)}allow(...t){return l.verifyFlat(t,"allow"),this._values(t,"_valids")}alter(t){i(t&&"object"==typeof t&&!Array.isArray(t),"Invalid targets argument"),i(!this._inRuleset(),"Cannot set alterations inside a ruleset");const e=this.clone();e.$_terms.alterations=e.$_terms.alterations||[];for(const n in t){const r=t[n];i("function"==typeof r,"Alteration adjuster for",n,"must be a function"),e.$_terms.alterations.push({target:n,adjuster:r})}return e.$_temp.ruleset=!1,e}cast(t){return i(!1===t||"string"==typeof t,"Invalid to value"),i(!1===t||this._definition.cast[t],"Type",this.type,"does not support casting to",t),this.$_setFlag("cast",!1===t?void 0:t)}default(t,e){return this._default("default",t,e)}description(t){return i(t&&"string"==typeof t,"Description must be a non-empty string"),this.$_setFlag("description",t)}empty(t){const e=this.clone();return void 0!==t&&(t=e.$_compile(t,{override:!1})),e.$_setFlag("empty",t,{clone:!1})}error(t){return i(t,"Missing error"),i(t instanceof Error||"function"==typeof t,"Must provide a valid Error object or a function"),this.$_setFlag("error",t)}example(t,e={}){return i(void 0!==t,"Missing example"),l.assertOptions(e,["override"]),this._inner("examples",t,{single:!0,override:e.override})}external(t,e){return"object"==typeof t&&(i(!e,"Cannot combine options with description"),e=t.description,t=t.method),i("function"==typeof t,"Method must be a function"),i(void 0===e||e&&"string"==typeof e,"Description must be a non-empty string"),this._inner("externals",{method:t,description:e},{single:!0})}failover(t,e){return this._default("failover",t,e)}forbidden(){return this.presence("forbidden")}id(t){return t?(i("string"==typeof t,"id must be a non-empty string"),i(/^[^\.]+$/.test(t),"id cannot contain period character"),this.$_setFlag("id",t)):this.$_setFlag("id",void 0)}invalid(...t){return this._values(t,"_invalids")}label(t){return i(t&&"string"==typeof t,"Label name must be a non-empty string"),this.$_setFlag("label",t)}meta(t){return i(void 0!==t,"Meta cannot be undefined"),this._inner("metas",t,{single:!0})}note(...t){i(t.length,"Missing notes");for(const e of t)i(e&&"string"==typeof e,"Notes must be non-empty strings");return this._inner("notes",t)}only(t=!0){return i("boolean"==typeof t,"Invalid mode:",t),this.$_setFlag("only",t)}optional(){return this.presence("optional")}prefs(t){i(t,"Missing preferences"),i(void 0===t.context,"Cannot override context"),i(void 0===t.externals,"Cannot override externals"),i(void 0===t.warnings,"Cannot override warnings"),i(void 0===t.debug,"Cannot override debug"),l.checkPreferences(t);const e=this.clone();return e._preferences=l.preferences(e._preferences,t),e}presence(t){return i(["optional","required","forbidden"].includes(t),"Unknown presence mode",t),this.$_setFlag("presence",t)}raw(t=!0){return this.$_setFlag("result",t?"raw":void 0)}result(t){return i(["raw","strip"].includes(t),"Unknown result mode",t),this.$_setFlag("result",t)}required(){return this.presence("required")}strict(t){const e=this.clone(),n=void 0!==t&&!t;return e._preferences=l.preferences(e._preferences,{convert:n}),e}strip(t=!0){return this.$_setFlag("result",t?"strip":void 0)}tag(...t){i(t.length,"Missing tags");for(const e of t)i(e&&"string"==typeof e,"Tags must be non-empty strings");return this._inner("tags",t)}unit(t){return i(t&&"string"==typeof t,"Unit name must be a non-empty string"),this.$_setFlag("unit",t)}valid(...t){l.verifyFlat(t,"valid");const e=this.allow(...t);return e.$_setFlag("only",!!e._valids,{clone:!1}),e}when(t,e){const n=this.clone();n.$_terms.whens||(n.$_terms.whens=[]);const r=c.when(n,t,e);if(!["any","link"].includes(n.type)){const t=r.is?[r]:r.switch;for(const e of t)i(!e.then||"any"===e.then.type||e.then.type===n.type,"Cannot combine",n.type,"with",e.then&&e.then.type),i(!e.otherwise||"any"===e.otherwise.type||e.otherwise.type===n.type,"Cannot combine",n.type,"with",e.otherwise&&e.otherwise.type)}return n.$_terms.whens.push(r),n.$_mutateRebuild()}cache(t){i(!this._inRuleset(),"Cannot set caching inside a ruleset"),i(!this._cache,"Cannot override schema cache");const e=this.clone();return e._cache=t||a.provider.provision(),e.$_temp.ruleset=!1,e}clone(){const t=Object.create(Object.getPrototypeOf(this));return this._assign(t)}concat(t){i(l.isSchema(t),"Invalid schema object"),i("any"===this.type||"any"===t.type||t.type===this.type,"Cannot merge type",this.type,"with another type:",t.type),i(!this._inRuleset(),"Cannot concatenate onto a schema with open ruleset"),i(!t._inRuleset(),"Cannot concatenate a schema with open ruleset");let e=this.clone();if("any"===this.type&&"any"!==t.type){const n=t.clone();for(const t of Object.keys(e))"type"!==t&&(n[t]=e[t]);e=n}e._ids.concat(t._ids),e._refs.register(t,y.toSibling),e._preferences=e._preferences?l.preferences(e._preferences,t._preferences):t._preferences,e._valids=v.merge(e._valids,t._valids,t._invalids),e._invalids=v.merge(e._invalids,t._invalids,t._valids);for(const n of t._singleRules.keys())e._singleRules.has(n)&&(e._rules=e._rules.filter(t=>t.keep||t.name!==n),e._singleRules.delete(n));for(const n of t._rules)t._definition.rules[n.method].multi||e._singleRules.set(n.name,n),e._rules.push(n);if(e._flags.empty&&t._flags.empty){e._flags.empty=e._flags.empty.concat(t._flags.empty);const n=Object.assign({},t._flags);delete n.empty,s(e._flags,n)}else if(t._flags.empty){e._flags.empty=t._flags.empty;const n=Object.assign({},t._flags);delete n.empty,s(e._flags,n)}else s(e._flags,t._flags);for(const n in t.$_terms){const i=t.$_terms[n];i?e.$_terms[n]?e.$_terms[n]=e.$_terms[n].concat(i):e.$_terms[n]=i.slice():e.$_terms[n]||(e.$_terms[n]=i)}return this.$_root._tracer&&this.$_root._tracer._combine(e,[this,t]),e.$_mutateRebuild()}extend(t){return i(!t.base,"Cannot extend type with another base"),p.type(this,t)}extract(t){return t=Array.isArray(t)?t:t.split("."),this._ids.reach(t)}fork(t,e){i(!this._inRuleset(),"Cannot fork inside a ruleset");let n=this;for(let i of[].concat(t))i=Array.isArray(i)?i:i.split("."),n=n._ids.fork(i,e,n);return n.$_temp.ruleset=!1,n}rule(t){const e=this._definition;l.assertOptions(t,Object.keys(e.modifiers)),i(!1!==this.$_temp.ruleset,"Cannot apply rules to empty ruleset or the last rule added does not support rule properties");const n=null===this.$_temp.ruleset?this._rules.length-1:this.$_temp.ruleset;i(n>=0&&n<this._rules.length,"Cannot apply rules to empty ruleset");const o=this.clone();for(let s=n;s<o._rules.length;++s){const n=o._rules[s],a=r(n);for(const r in t)e.modifiers[r](a,t[r]),i(a.name===n.name,"Cannot change rule name");o._rules[s]=a,o._singleRules.get(a.name)===n&&o._singleRules.set(a.name,a)}return o.$_temp.ruleset=!1,o.$_mutateRebuild()}get ruleset(){i(!this._inRuleset(),"Cannot start a new ruleset without closing the previous one");const t=this.clone();return t.$_temp.ruleset=t._rules.length,t}get $(){return this.ruleset}tailor(t){t=[].concat(t),i(!this._inRuleset(),"Cannot tailor inside a ruleset");let e=this;if(this.$_terms.alterations)for(const{target:n,adjuster:r}of this.$_terms.alterations)t.includes(n)&&(e=r(e),i(l.isSchema(e),"Alteration adjuster for",n,"failed to return a schema object"));return e=e.$_modify({each:e=>e.tailor(t),ref:!1}),e.$_temp.ruleset=!1,e.$_mutateRebuild()}tracer(){return m.location?m.location(this):this}validate(t,e){return g.entry(t,this,e)}validateAsync(t,e){return g.entryAsync(t,this,e)}$_addRule(t){"string"==typeof t&&(t={name:t}),i(t&&"object"==typeof t,"Invalid options"),i(t.name&&"string"==typeof t.name,"Invalid rule name");for(const e in t)i("_"!==e[0],"Cannot set private rule properties");const e=Object.assign({},t);e._resolve=[],e.method=e.method||e.name;const n=this._definition.rules[e.method],r=e.args;i(n,"Unknown rule",e.method);const o=this.clone();if(r){i(1===Object.keys(r).length||Object.keys(r).length===this._definition.rules[e.name].args.length,"Invalid rule definition for",this.type,e.name);for(const t in r){let s=r[t];if(void 0!==s){if(n.argsByName){const a=n.argsByName.get(t);if(a.ref&&l.isResolvable(s))e._resolve.push(t),o.$_mutateRegister(s);else if(a.normalize&&(s=a.normalize(s),r[t]=s),a.assert){const e=l.validateArg(s,t,a);i(!e,e,"or reference")}}r[t]=s}else delete r[t]}}return n.multi||(o._ruleRemove(e.name,{clone:!1}),o._singleRules.set(e.name,e)),!1===o.$_temp.ruleset&&(o.$_temp.ruleset=null),n.priority?o._rules.unshift(e):o._rules.push(e),o}$_compile(t,e){return c.schema(this.$_root,t,e)}$_createError(t,e,n,i,r,o={}){const s=!1!==o.flags?this._flags:{},a=o.messages?d.merge(this._definition.messages,o.messages):this._definition.messages;return new u.Report(t,e,n,s,a,i,r)}$_getFlag(t){return this._flags[t]}$_getRule(t){return this._singleRules.get(t)}$_mapLabels(t){return t=Array.isArray(t)?t:t.split("."),this._ids.labels(t)}$_match(t,e,n,i){(n=Object.assign({},n)).abortEarly=!0,n._externals=!1,e.snapshot();const r=!g.validate(t,this,e,n,i).errors;return e.restore(),r}$_modify(t){return l.assertOptions(t,["each","once","ref","schema"]),f.schema(this,t)||this}$_mutateRebuild(){return i(!this._inRuleset(),"Cannot add this rule inside a ruleset"),this._refs.reset(),this._ids.reset(),this.$_modify({each:(t,{source:e,name:n,path:i,key:r})=>{const o=this._definition[e][n]&&this._definition[e][n].register;!1!==o&&this.$_mutateRegister(t,{family:o,key:r})}}),this._definition.rebuild&&this._definition.rebuild(this),this.$_temp.ruleset=!1,this}$_mutateRegister(t,{family:e,key:n}={}){this._refs.register(t,e),this._ids.register(t,{key:n})}$_property(t){return this._definition.properties[t]}$_reach(t){return this._ids.reach(t)}$_rootReferences(){return this._refs.roots()}$_setFlag(t,e,n={}){i("_"===t[0]||!this._inRuleset(),"Cannot set flag inside a ruleset");const r=this._definition.flags[t]||{};if(o(e,r.default)&&(e=void 0),o(e,this._flags[t]))return this;const s=!1!==n.clone?this.clone():this;return void 0!==e?(s._flags[t]=e,s.$_mutateRegister(e)):delete s._flags[t],"_"!==t[0]&&(s.$_temp.ruleset=!1),s}$_validate(t,e,n){return g.validate(t,this,e,n)}_assign(t){t.type=this.type,t.$_root=this.$_root,t.$_temp=Object.assign({},this.$_temp),t.$_temp.whens={},t._ids=this._ids.clone(),t._preferences=this._preferences,t._valids=this._valids&&this._valids.clone(),t._invalids=this._invalids&&this._invalids.clone(),t._rules=this._rules.slice(),t._singleRules=r(this._singleRules,{shallow:!0}),t._refs=this._refs.clone(),t._flags=Object.assign({},this._flags),t._cache=null,t.$_terms={};for(const e in this.$_terms)t.$_terms[e]=this.$_terms[e]?this.$_terms[e].slice():null;t.$_super={};for(const e in this.$_super)t.$_super[e]=this._super[e].bind(t);return t}_default(t,e,n={}){return l.assertOptions(n,"literal"),i(void 0!==e,"Missing",t,"value"),i("function"==typeof e||!n.literal,"Only function value supports literal option"),"function"==typeof e&&n.literal&&(e={[l.symbols.literal]:!0,literal:e}),this.$_setFlag(t,e)}_generate(t,e,n){if(!this.$_terms.whens)return{schema:this};const i=[],r=[];for(let o=0;o<this.$_terms.whens.length;++o){const s=this.$_terms.whens[o];if(s.concat){i.push(s.concat),r.push("".concat(o,".concat"));continue}const a=s.ref?s.ref.resolve(t,e,n):t,l=s.is?[s]:s.switch,c=r.length;for(let c=0;c<l.length;++c){const{is:u,then:p,otherwise:h}=l[c],d="".concat(o).concat(s.switch?"."+c:"");if(u.$_match(a,e.nest(u,"".concat(d,".is")),n)){if(p){const o=e.localize([...e.path,"".concat(d,".then")],e.ancestors,e.schemas),{schema:s,id:a}=p._generate(t,o,n);i.push(s),r.push("".concat(d,".then").concat(a?"(".concat(a,")"):""));break}}else if(h){const o=e.localize([...e.path,"".concat(d,".otherwise")],e.ancestors,e.schemas),{schema:s,id:a}=h._generate(t,o,n);i.push(s),r.push("".concat(d,".otherwise").concat(a?"(".concat(a,")"):""));break}}if(s.break&&r.length>c)break}const o=r.join(", ");if(e.mainstay.tracer.debug(e,"rule","when",o),!o)return{schema:this};if(!e.mainstay.tracer.active&&this.$_temp.whens[o])return{schema:this.$_temp.whens[o],id:o};let s=this;this._definition.generate&&(s=this._definition.generate(this,t,e,n));for(const t of i)s=s.concat(t);return this.$_root._tracer&&this.$_root._tracer._combine(s,[this,...i]),this.$_temp.whens[o]=s,{schema:s,id:o}}_inner(t,e,n={}){i(!this._inRuleset(),"Cannot set ".concat(t," inside a ruleset"));const r=this.clone();return r.$_terms[t]&&!n.override||(r.$_terms[t]=[]),n.single?r.$_terms[t].push(e):r.$_terms[t].push(...e),r.$_temp.ruleset=!1,r}_inRuleset(){return null!==this.$_temp.ruleset&&!1!==this.$_temp.ruleset}_ruleRemove(t,e={}){if(!this._singleRules.has(t))return this;const n=!1!==e.clone?this.clone():this;n._singleRules.delete(t);const i=[];for(let e=0;e<n._rules.length;++e){const r=n._rules[e];r.name!==t||r.keep?i.push(r):n._inRuleset()&&e<n.$_temp.ruleset&&--n.$_temp.ruleset}return n._rules=i,n}_values(t,e){l.verifyFlat(t,e.slice(1,-1));const n=this.clone(),r=t[0]===l.symbols.override;if(r&&(t=t.slice(1)),!n[e]&&t.length?n[e]=new v:r&&(n[e]=t.length?new v:null,n.$_mutateRebuild()),!n[e])return n;r&&n[e].override();for(const r of t){i(void 0!==r,"Cannot call allow/valid/invalid with undefined"),i(r!==l.symbols.override,"Override must be the first value");const t="_invalids"===e?"_valids":"_invalids";n[t]&&(n[t].remove(r),n[t].length||(i("_valids"===e||!n._flags.only,"Setting invalid value",r,"leaves schema rejecting all values due to previous valid rule"),n[t]=null)),n[e].add(r,n._refs)}return n}}};_.Base.prototype[l.symbols.any]={version:l.version,compile:c.compile,root:"$_root"},_.Base.prototype.isImmutable=!0,_.Base.prototype.deny=_.Base.prototype.invalid,_.Base.prototype.disallow=_.Base.prototype.invalid,_.Base.prototype.equal=_.Base.prototype.valid,_.Base.prototype.exist=_.Base.prototype.required,_.Base.prototype.not=_.Base.prototype.invalid,_.Base.prototype.options=_.Base.prototype.prefs,_.Base.prototype.preferences=_.Base.prototype.prefs,t.exports=new _.Base},function(t,e,n){"use strict";function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const o=n(0),s=n(1),a=n(5),l={};e.Ids=l.Ids=class{constructor(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}clone(){const t=new l.Ids;return t._byId=new Map(this._byId),t._byKey=new Map(this._byKey),t._schemaChain=this._schemaChain,t}concat(t){t._schemaChain&&(this._schemaChain=!0);for(const[e,n]of t._byId.entries())o(!this._byKey.has(e),"Schema id conflicts with existing key:",e),this._byId.set(e,n);for(const[e,n]of t._byKey.entries())o(!this._byId.has(e),"Schema key conflicts with existing id:",e),this._byKey.set(e,n)}fork(t,e,n){const i=this._collect(t);i.push({schema:n});const r=i.shift();let a={id:r.id,schema:e(r.schema)};o(s.isSchema(a.schema),"adjuster function failed to return a joi schema type");for(const t of i)a={id:t.id,schema:l.fork(t.schema,a.id,a.schema)};return a.schema}labels(t,e=[]){const n=t[0],i=this._get(n);if(!i)return[...e,...t].join(".");const r=t.slice(1);return e=[...e,i.schema._flags.label||n],r.length?i.schema._ids.labels(r,e):e.join(".")}reach(t,e=[]){const n=t[0],i=this._get(n);o(i,"Schema does not contain path",[...e,...t].join("."));const r=t.slice(1);return r.length?i.schema._ids.reach(r,[...e,n]):i.schema}register(t,{key:e}={}){if(!t||!s.isSchema(t))return;(t.$_property("schemaChain")||t._ids._schemaChain)&&(this._schemaChain=!0);const n=t._flags.id;if(n){const e=this._byId.get(n);o(!e||e.schema===t,"Cannot add different schemas with the same id:",n),o(!this._byKey.has(n),"Schema id conflicts with existing key:",n),this._byId.set(n,{schema:t,id:n})}e&&(o(!this._byKey.has(e),"Schema already contains key:",e),o(!this._byId.has(e),"Schema key conflicts with existing id:",e),this._byKey.set(e,{schema:t,id:e}))}reset(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}_collect(t,e=[],n=[]){const i=t[0],r=this._get(i);o(r,"Schema does not contain path",[...e,...t].join(".")),n=[r,...n];const s=t.slice(1);return s.length?r.schema._ids._collect(s,[...e,i],n):n}_get(t){return this._byId.get(t)||this._byKey.get(t)}},l.fork=function(t,n,i){return e.schema(t,{each:(t,{key:e})=>{if(n===(t._flags.id||e))return i},ref:!1}).$_mutateRebuild()},e.schema=function(t,e){let n;for(const i in t._flags){if("_"===i[0])continue;const r=l.scan(t._flags[i],{source:"flags",name:i},e);void 0!==r&&(n=n||t.clone(),n._flags[i]=r)}for(let i=0;i<t._rules.length;++i){const r=t._rules[i],o=l.scan(r.args,{source:"rules",name:r.name},e);if(void 0!==o){n=n||t.clone();const e=Object.assign({},r);e.args=o,n._rules[i]=e,n._singleRules.get(r.name)===r&&n._singleRules.set(r.name,e)}}for(const i in t.$_terms){if("_"===i[0])continue;const r=l.scan(t.$_terms[i],{source:"terms",name:i},e);void 0!==r&&(n=n||t.clone(),n.$_terms[i]=r)}return n},l.scan=function(t,e,n,o,c){const u=o||[];if(null===t||"object"!=typeof t)return;let p;if(Array.isArray(t)){for(let i=0;i<t.length;++i){const r="terms"===e.source&&"keys"===e.name&&t[i].key,o=l.scan(t[i],e,n,[i,...u],r);void 0!==o&&(p=p||t.slice(),p[i]=o)}return p}if(!1!==n.schema&&s.isSchema(t)||!1!==n.ref&&a.isRef(t)){const o=n.each(t,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},e,{path:u,key:c}));if(o===t)return;return o}for(const i in t){if("_"===i[0])continue;const r=l.scan(t[i],e,n,[i,...u],c);void 0!==r&&(p=p||Object.assign({},t),p[i]=r)}return p}},function(t,e,n){"use strict";const i=n(0),r=n(2),o=n(37),s=n(6),a=n(1),l=n(4),c=n(38),u={result:Symbol("result")};e.entry=function(t,e,n){let r=a.defaults;n&&(i(void 0===n.warnings,"Cannot override warnings preference in synchronous validation"),r=a.preferences(a.defaults,n));const o=u.entry(t,e,r);i(!o.mainstay.externals.length,"Schema with external rules must use validateAsync()");const s={value:o.value};return o.error&&(s.error=o.error),o.mainstay.warnings.length&&(s.warning=l.details(o.mainstay.warnings)),o.mainstay.debug&&(s.debug=o.mainstay.debug),s},e.entryAsync=async function(t,e,n){let i=a.defaults;n&&(i=a.preferences(a.defaults,n));const r=u.entry(t,e,i),o=r.mainstay;if(r.error)throw o.debug&&(r.error.debug=o.debug),r.error;if(o.externals.length){let e=r.value;for(const{method:n,path:i,label:r}of o.externals){let o,a,l=e;i.length&&(o=i[i.length-1],a=s(e,i.slice(0,-1)),l=a[o]);try{const t=await n(l);if(void 0===t||t===l)continue;a?a[o]=t:e=t}catch(t){throw t.message+=" (".concat(r,")"),t}}r.value=e}if(!i.warnings&&!i.debug)return r.value;const c={value:r.value};return o.warnings.length&&(c.warning=l.details(o.warnings)),o.debug&&(c.debug=o.debug),c},u.entry=function(t,n,i){const{tracer:r,cleanup:o}=u.tracer(n,i),s={externals:[],warnings:[],tracer:r,debug:i.debug?[]:null,links:n._ids._schemaChain?new Map:null},a=n._ids._schemaChain?[{schema:n}]:null,p=new c([],[],{mainstay:s,schemas:a}),h=e.validate(t,n,p,i);o&&n.$_root.untrace();const d=l.process(h.errors,t,i);return{value:h.value,error:d,mainstay:s}},u.tracer=function(t,e){return t.$_root._tracer?{tracer:t.$_root._tracer._register(t)}:e.debug?(i(t.$_root.trace,"Debug mode not supported"),{tracer:t.$_root.trace()._register(t),cleanup:!0}):{tracer:u.ignore}},e.validate=function(t,e,n,i,r={}){if(e.$_terms.whens&&(e=e._generate(t,n,i).schema),e._preferences&&(i=u.prefs(e,i)),e._cache&&i.cache){const i=e._cache.get(t);if(n.mainstay.tracer.debug(n,"validate","cached",!!i),i)return i}const o=(r,o,s)=>e.$_createError(r,t,o,s||n,i),s={original:t,prefs:i,schema:e,state:n,error:o,warn:(t,e,i)=>n.mainstay.warnings.push(o(t,e,i)),message:(r,o)=>e.$_createError("custom",t,o,n,i,{messages:r})};n.mainstay.tracer.entry(e,n);const l=e._definition;if(l.prepare&&void 0!==t&&i.convert){const e=l.prepare(t,s);if(e){if(n.mainstay.tracer.value(n,"prepare",t,e.value),e.errors)return u.finalize(e.value,[].concat(e.errors),s);t=e.value}}if(l.coerce&&void 0!==t&&i.convert&&(!l.coerce.from||l.coerce.from.includes(typeof t))){const e=l.coerce.method(t,s);if(e){if(n.mainstay.tracer.value(n,"coerced",t,e.value),e.errors)return u.finalize(e.value,[].concat(e.errors),s);t=e.value}}const c=e._flags.empty;c&&c.$_match(u.trim(t,e),n.nest(c),a.defaults)&&(n.mainstay.tracer.value(n,"empty",t,void 0),t=void 0);const p=r.presence||e._flags.presence||(e._flags._endedSwitch?"ignore":i.presence);if(void 0===t){if("forbidden"===p)return u.finalize(t,null,s);if("required"===p)return u.finalize(t,[e.$_createError("any.required",t,null,n,i)],s);if("optional"===p){if(e._flags.default!==a.symbols.deepDefault)return u.finalize(t,null,s);n.mainstay.tracer.value(n,"default",t,{}),t={}}}else if("forbidden"===p)return u.finalize(t,[e.$_createError("any.unknown",t,null,n,i)],s);const h=[];if(e._valids){const r=e._valids.get(t,n,i,e._flags.insensitive);if(r)return i.convert&&(n.mainstay.tracer.value(n,"valids",t,r.value),t=r.value),n.mainstay.tracer.filter(e,n,"valid",r),u.finalize(t,null,s);if(e._flags.only){const r=e.$_createError("any.only",t,{valids:e._valids.values({display:!0})},n,i);if(i.abortEarly)return u.finalize(t,[r],s);h.push(r)}}if(e._invalids){const r=e._invalids.get(t,n,i,e._flags.insensitive);if(r){n.mainstay.tracer.filter(e,n,"invalid",r);const o=e.$_createError("any.invalid",t,{invalids:e._invalids.values({display:!0})},n,i);if(i.abortEarly)return u.finalize(t,[o],s);h.push(o)}}if(l.validate){const e=l.validate(t,s);if(e&&(n.mainstay.tracer.value(n,"base",t,e.value),t=e.value,e.errors)){if(!Array.isArray(e.errors))return h.push(e.errors),u.finalize(t,h,s);if(e.errors.length)return h.push(...e.errors),u.finalize(t,h,s)}}return e._rules.length?u.rules(t,h,s):u.finalize(t,h,s)},u.rules=function(t,e,n){const{schema:i,state:r,prefs:o}=n;for(const s of i._rules){const l=i._definition.rules[s.method];if(l.convert&&o.convert){r.mainstay.tracer.log(i,r,"rule",s.name,"full");continue}let c,p=s.args;if(s._resolve.length){p=Object.assign({},p);for(const e of s._resolve){const n=l.argsByName.get(e),s=p[e].resolve(t,r,o),u=n.normalize?n.normalize(s):s,h=a.validateArg(u,null,n);if(h){c=i.$_createError("any.ref",s,{arg:e,ref:p[e],reason:h},r,o);break}p[e]=u}}c=c||l.validate(t,n,p,s);const h=u.rule(c,s);if(h.errors){if(r.mainstay.tracer.log(i,r,"rule",s.name,"error"),s.warn){r.mainstay.warnings.push(...h.errors);continue}if(o.abortEarly)return u.finalize(t,h.errors,n);e.push(...h.errors)}else r.mainstay.tracer.log(i,r,"rule",s.name,"pass"),r.mainstay.tracer.value(r,"rule",t,h.value,s.name),t=h.value}return u.finalize(t,e,n)},u.rule=function(t,e){return t instanceof l.Report?(u.error(t,e),{errors:[t],value:null}):Array.isArray(t)&&(t[0]instanceof l.Report||t[0]instanceof Error)?(t.forEach(t=>u.error(t,e)),{errors:t,value:null}):{errors:null,value:t}},u.error=function(t,e){return e.message&&t._setTemplate(e.message),t},u.finalize=function(t,e,n){e=e||[];const{schema:r,state:o,prefs:s}=n;if(e.length){const i=u.default("failover",void 0,e,n);void 0!==i&&(o.mainstay.tracer.value(o,"failover",t,i),t=i,e=[])}if(e.length&&r._flags.error)if("function"==typeof r._flags.error){e=r._flags.error(e),Array.isArray(e)||(e=[e]);for(const t of e)i(t instanceof Error||t instanceof l.Report,"error() must return an Error object")}else e=[r._flags.error];if(void 0===t){const i=u.default("default",t,e,n);o.mainstay.tracer.value(o,"default",t,i),t=i}if(r._flags.cast&&void 0!==t){const e=r._definition.cast[r._flags.cast];if(e.from(t)){const i=e.to(t,n);o.mainstay.tracer.value(o,"cast",t,i,r._flags.cast),t=i}}if(r.$_terms.externals&&s.externals&&!1!==s._externals)for(const{method:t}of r.$_terms.externals)o.mainstay.externals.push({method:t,path:o.path,label:l.label(r._flags,o,s)});const a={value:t,errors:e.length?e:null};return r._flags.result&&(a.value="strip"===r._flags.result?void 0:n.original,o.mainstay.tracer.value(o,r._flags.result,t,a.value),o.shadow(t,r._flags.result)),r._cache&&!1!==s.cache&&!r._refs.length&&r._cache.set(n.original,a),a},u.prefs=function(t,e){const n=e===a.defaults;return n&&t._preferences[a.symbols.prefs]?t._preferences[a.symbols.prefs]:(e=a.preferences(e,t._preferences),n&&(t._preferences[a.symbols.prefs]=e),e)},u.default=function(t,e,n,i){const{schema:o,state:s,prefs:l}=i,c=o._flags[t];if(l.noDefaults||void 0===c)return e;if(s.mainstay.tracer.log(o,s,"rule",t,"full"),!c)return c;if("function"==typeof c){const a=c.length?[r(s.ancestors[0]),i]:[];try{return c(...a)}catch(e){return void n.push(o.$_createError("any.".concat(t),null,{error:e},s,l))}}return"object"!=typeof c?c:c[a.symbols.literal]?c.literal:a.isResolvable(c)?c.resolve(e,s,l):r(c)},u.trim=function(t,e){if("string"!=typeof t)return t;const n=e.$_getRule("trim");return n&&n.args.enabled?t.trim():t},u.ignore={active:!1,debug:o,entry:o,filter:o,log:o,resolve:o,value:o}},function(t,e,n){"use strict";t.exports=function(){}},function(t,e,n){"use strict";const i=n(2),r=n(6),o=n(1),s={value:Symbol("value")};t.exports=s.State=class{constructor(t,e,n){this.path=t,this.ancestors=e,this.mainstay=n.mainstay,this.schemas=n.schemas,this.debug=null}localize(t,e=null,n=null){const i=new s.State(t,e,this);return n&&i.schemas&&(i.schemas=[s.schemas(n),...i.schemas]),i}nest(t,e){const n=new s.State(this.path,this.ancestors,this);return n.schemas=n.schemas&&[s.schemas(t),...n.schemas],n.debug=e,n}shadow(t,e){this.mainstay.shadow=this.mainstay.shadow||new s.Shadow,this.mainstay.shadow.set(this.path,t,e)}snapshot(){this.mainstay.shadow&&(this._snapshot=i(this.mainstay.shadow.node(this.path)))}restore(){this.mainstay.shadow&&(this.mainstay.shadow.override(this.path,this._snapshot),this._snapshot=void 0)}},s.schemas=function(t){return o.isSchema(t)?{schema:t}:t},s.Shadow=class{constructor(){this._values=null}set(t,e,n){if(!t.length)return;if("strip"===n&&"number"==typeof t[t.length-1])return;this._values=this._values||new Map;let i=this._values;for(let e=0;e<t.length;++e){const n=t[e];let r=i.get(n);r||(r=new Map,i.set(n,r)),i=r}i[s.value]=e}get(t){const e=this.node(t);if(e)return e[s.value]}node(t){if(this._values)return r(this._values,t,{iterables:!0})}override(t,e){if(!this._values)return;const n=t.slice(0,-1),i=t[t.length-1],o=r(this._values,n,{iterables:!0});e?o.set(i,e):o&&o.delete(i)}}},function(t,e,n){"use strict";const i=n(0),r=n(10),o=n(6),s=n(3),a=n(1),l=n(8),c={};t.exports=s.extend({type:"array",flags:{single:{default:!1},sparse:{default:!1}},terms:{items:{init:[],manifest:"schema"},ordered:{init:[],manifest:"schema"},_exclusions:{init:[]},_inclusions:{init:[]},_requireds:{init:[]}},coerce:{from:"object",method(t,{schema:e,state:n,prefs:i}){if(!Array.isArray(t))return;const r=e.$_getRule("sort");return r?c.sort(e,t,r.args.options,n,i):void 0}},validate(t,{schema:e,error:n}){if(!Array.isArray(t)){if(e._flags.single){const e=[t];return e[a.symbols.arraySingle]=!0,{value:e}}return{errors:n("array.base")}}if(e.$_getRule("items")||e.$_terms.externals)return{value:t.slice()}},rules:{has:{method(t){t=this.$_compile(t,{appendPath:!0});const e=this.$_addRule({name:"has",args:{schema:t}});return e.$_mutateRegister(t),e},validate(t,{state:e,prefs:n,error:i},{schema:r}){const o=[t,...e.ancestors];for(let i=0;i<t.length;++i){const s=e.localize([...e.path,i],o,r);if(r.$_match(t[i],s,n))return t}const s=r._flags.label;return s?i("array.hasKnown",{patternLabel:s}):i("array.hasUnknown",null)},multi:!0},items:{method(...t){a.verifyFlat(t,"items");const e=this.$_addRule("items");for(let n=0;n<t.length;++n){const i=a.tryWithPath(()=>this.$_compile(t[n]),n,{append:!0});e.$_terms.items.push(i)}return e.$_mutateRebuild()},validate(t,{schema:e,error:n,state:i,prefs:r}){const o=e.$_terms._requireds.slice(),s=e.$_terms.ordered.slice(),l=[...e.$_terms._inclusions,...o],u=!t[a.symbols.arraySingle];delete t[a.symbols.arraySingle];const p=[];let h=t.length;for(let a=0;a<h;++a){const d=t[a];let f=!1,y=!1;const m=u?a:new Number(a),g=[...i.path,m];if(!e._flags.sparse&&void 0===d){if(p.push(n("array.sparse",{key:m,path:g,pos:a,value:void 0},i.localize(g))),r.abortEarly)return p;s.shift();continue}const v=[t,...i.ancestors];for(const t of e.$_terms._exclusions)if(t.$_match(d,i.localize(g,v,t),r,{presence:"ignore"})){if(p.push(n("array.excludes",{pos:a,value:d},i.localize(g))),r.abortEarly)return p;f=!0,s.shift();break}if(f)continue;if(e.$_terms.ordered.length){if(s.length){const o=s.shift(),l=o.$_validate(d,i.localize(g,v,o),r);if(l.errors){if(p.push(...l.errors),r.abortEarly)return p}else if("strip"===o._flags.result)c.fastSplice(t,a),--a,--h;else{if(!e._flags.sparse&&void 0===l.value){if(p.push(n("array.sparse",{key:m,path:g,pos:a,value:void 0},i.localize(g))),r.abortEarly)return p;continue}t[a]=l.value}continue}if(!e.$_terms.items.length){if(p.push(n("array.orderedLength",{pos:a,limit:e.$_terms.ordered.length})),r.abortEarly)return p;break}}const _=[];let b=o.length;for(let s=0;s<b;++s){const l=i.localize(g,v,o[s]);l.snapshot();const u=o[s].$_validate(d,l,r);if(_[s]=u,!u.errors){if(t[a]=u.value,y=!0,c.fastSplice(o,s),--s,--b,!e._flags.sparse&&void 0===u.value&&(p.push(n("array.sparse",{key:m,path:g,pos:a,value:void 0},i.localize(g))),r.abortEarly))return p;break}l.restore()}if(y)continue;const w=r.stripUnknown&&!!r.stripUnknown.arrays||!1;b=l.length;for(const s of l){let l;const u=o.indexOf(s);if(-1!==u)l=_[u];else{const o=i.localize(g,v,s);if(o.snapshot(),l=s.$_validate(d,o,r),!l.errors){"strip"===s._flags.result?(c.fastSplice(t,a),--a,--h):e._flags.sparse||void 0!==l.value?t[a]=l.value:(p.push(n("array.sparse",{key:m,path:g,pos:a,value:void 0},i.localize(g))),f=!0),y=!0;break}o.restore()}if(1===b){if(w){c.fastSplice(t,a),--a,--h,y=!0;break}if(p.push(...l.errors),r.abortEarly)return p;f=!0;break}}if(!f&&e.$_terms._inclusions.length&&!y){if(w){c.fastSplice(t,a),--a,--h;continue}if(p.push(n("array.includes",{pos:a,value:d},i.localize(g))),r.abortEarly)return p}}return o.length&&c.fillMissedErrors(e,p,o,t,i,r),s.length&&c.fillOrderedErrors(e,p,s,t,i,r),p.length?p:t},priority:!0,manifest:!1},length:{method(t){return this.$_addRule({name:"length",args:{limit:t},operator:"="})},validate:(t,e,{limit:n},{name:i,operator:r,args:o})=>a.compare(t.length,n,r)?t:e.error("array."+i,{limit:o.limit,value:t}),args:[{name:"limit",ref:!0,assert:a.limit,message:"must be a positive integer"}]},max:{method(t){return this.$_addRule({name:"max",method:"length",args:{limit:t},operator:"<="})}},min:{method(t){return this.$_addRule({name:"min",method:"length",args:{limit:t},operator:">="})}},ordered:{method(...t){a.verifyFlat(t,"ordered");const e=this.$_addRule("items");for(let n=0;n<t.length;++n){const i=a.tryWithPath(()=>this.$_compile(t[n]),n,{append:!0});c.validateSingle(i,e),e.$_mutateRegister(i),e.$_terms.ordered.push(i)}return e.$_mutateRebuild()}},single:{method(t){const e=void 0===t||!!t;return i(!e||!this._flags._arrayItems,"Cannot specify single rule when array has array items"),this.$_setFlag("single",e)}},sort:{method(t={}){a.assertOptions(t,["by","order"]);const e={order:t.order||"ascending"};return t.by&&(e.by=l.ref(t.by,{ancestor:0}),i(!e.by.ancestor,"Cannot sort by ancestor")),this.$_addRule({name:"sort",args:{options:e}})},validate(t,{error:e,state:n,prefs:i,schema:r},{options:o}){const{value:s,errors:a}=c.sort(r,t,o,n,i);if(a)return a;for(let n=0;n<t.length;++n)if(t[n]!==s[n])return e("array.sort",{order:o.order,by:o.by?o.by.key:"value"});return t},convert:!0},sparse:{method(t){const e=void 0===t||!!t;return this._flags.sparse===e?this:(e?this.clone():this.$_addRule("items")).$_setFlag("sparse",e,{clone:!1})}},unique:{method(t,e={}){i(!t||"function"==typeof t||"string"==typeof t,"comparator must be a function or a string"),a.assertOptions(e,["ignoreUndefined","separator"]);const n={name:"unique",args:{options:e,comparator:t}};if(t)if("string"==typeof t){const i=a.default(e.separator,".");n.path=i?t.split(i):[t]}else n.comparator=t;return this.$_addRule(n)},validate(t,{state:e,error:n,schema:s},{comparator:a,options:l},{comparator:c,path:u}){const p={string:Object.create(null),number:Object.create(null),undefined:Object.create(null),boolean:Object.create(null),object:new Map,function:new Map,custom:new Map},h=c||r,d=l.ignoreUndefined;for(let r=0;r<t.length;++r){const s=u?o(t[r],u):t[r],l=c?p.custom:p[typeof s];if(i(l,"Failed to find unique map container for type",typeof s),l instanceof Map){const i=l.entries();let o;for(;!(o=i.next()).done;)if(h(o.value[0],s)){const i=e.localize([...e.path,r],[t,...e.ancestors]),s={pos:r,value:t[r],dupePos:o.value[1],dupeValue:t[o.value[1]]};return u&&(s.path=a),n("array.unique",s,i)}l.set(s,r)}else{if((!d||void 0!==s)&&void 0!==l[s]){const i={pos:r,value:t[r],dupePos:l[s],dupeValue:t[l[s]]};return u&&(i.path=a),n("array.unique",i,e.localize([...e.path,r],[t,...e.ancestors]))}l[s]=r}}return t},args:["comparator","options"],multi:!0}},cast:{set:{from:Array.isArray,to:(t,e)=>new Set(t)}},rebuild(t){t.$_terms._inclusions=[],t.$_terms._exclusions=[],t.$_terms._requireds=[];for(const e of t.$_terms.items)c.validateSingle(e,t),"required"===e._flags.presence?t.$_terms._requireds.push(e):"forbidden"===e._flags.presence?t.$_terms._exclusions.push(e):t.$_terms._inclusions.push(e);for(const e of t.$_terms.ordered)c.validateSingle(e,t)},manifest:{build:(t,e)=>(e.items&&(t=t.items(...e.items)),e.ordered&&(t=t.ordered(...e.ordered)),t)},messages:{"array.base":"{{#label}} must be an array","array.excludes":"{{#label}} contains an excluded value","array.hasKnown":'{{#label}} does not contain at least one required match for type "{#patternLabel}"',"array.hasUnknown":"{{#label}} does not contain at least one required match","array.includes":"{{#label}} does not match any of the allowed types","array.includesRequiredBoth":"{{#label}} does not contain {{#knownMisses}} and {{#unknownMisses}} other required value(s)","array.includesRequiredKnowns":"{{#label}} does not contain {{#knownMisses}}","array.includesRequiredUnknowns":"{{#label}} does not contain {{#unknownMisses}} required value(s)","array.length":"{{#label}} must contain {{#limit}} items","array.max":"{{#label}} must contain less than or equal to {{#limit}} items","array.min":"{{#label}} must contain at least {{#limit}} items","array.orderedLength":"{{#label}} must contain at most {{#limit}} items","array.sort":"{{#label}} must be sorted in {#order} order by {{#by}}","array.sort.mismatching":"{{#label}} cannot be sorted due to mismatching types","array.sort.unsupported":"{{#label}} cannot be sorted due to unsupported type {#type}","array.sparse":"{{#label}} must not be a sparse array item","array.unique":"{{#label}} contains a duplicate value"}}),c.fillMissedErrors=function(t,e,n,i,r,o){const s=[];let a=0;for(const t of n){const e=t._flags.label;e?s.push(e):++a}s.length?a?e.push(t.$_createError("array.includesRequiredBoth",i,{knownMisses:s,unknownMisses:a},r,o)):e.push(t.$_createError("array.includesRequiredKnowns",i,{knownMisses:s},r,o)):e.push(t.$_createError("array.includesRequiredUnknowns",i,{unknownMisses:a},r,o))},c.fillOrderedErrors=function(t,e,n,i,r,o){const s=[];for(const t of n)"required"===t._flags.presence&&s.push(t);s.length&&c.fillMissedErrors(t,e,s,i,r,o)},c.fastSplice=function(t,e){let n=e;for(;n<t.length;)t[n++]=t[n];--t.length},c.validateSingle=function(t,e){("array"===t.type||t._flags._arrayItems)&&(i(!e._flags.single,"Cannot specify array item with single rule enabled"),e.$_setFlag("_arrayItems",!0,{clone:!1}))},c.sort=function(t,e,n,i,r){const o="ascending"===n.order?1:-1,s=-1*o,a=o,l=(l,u)=>{let p=c.compare(l,u,s,a);if(null!==p)return p;if(n.by&&(l=n.by.resolve(l,i,r),u=n.by.resolve(u,i,r)),p=c.compare(l,u,s,a),null!==p)return p;const h=typeof l;if(h!==typeof u)throw t.$_createError("array.sort.mismatching",e,null,i,r);if("number"!==h&&"string"!==h)throw t.$_createError("array.sort.unsupported",e,{type:h},i,r);return"number"===h?(l-u)*o:l<u?s:a};try{return{value:e.slice().sort(l)}}catch(t){return{errors:t}}},c.compare=function(t,e,n,i){return t===e?0:void 0===t?1:void 0===e?-1:null===t?i:null===e?n:null}},function(t,e,n){"use strict";const i=n(0),r=n(3),o=n(1),s=n(21),a={isBool:function(t){return"boolean"==typeof t}};t.exports=r.extend({type:"boolean",flags:{sensitive:{default:!1}},terms:{falsy:{init:null,manifest:"values"},truthy:{init:null,manifest:"values"}},coerce(t,{schema:e}){if("boolean"!=typeof t){if("string"==typeof t){const n=e._flags.sensitive?t:t.toLowerCase();t="true"===n||"false"!==n&&t}return"boolean"!=typeof t&&(t=e.$_terms.truthy&&e.$_terms.truthy.has(t,null,null,!e._flags.sensitive)||(!e.$_terms.falsy||!e.$_terms.falsy.has(t,null,null,!e._flags.sensitive))&&t),{value:t}}},validate(t,{error:e}){if("boolean"!=typeof t)return{value:t,errors:e("boolean.base")}},rules:{truthy:{method(...t){o.verifyFlat(t,"truthy");const e=this.clone();e.$_terms.truthy=e.$_terms.truthy||new s;for(let n=0;n<t.length;++n){const r=t[n];i(void 0!==r,"Cannot call truthy with undefined"),e.$_terms.truthy.add(r)}return e}},falsy:{method(...t){o.verifyFlat(t,"falsy");const e=this.clone();e.$_terms.falsy=e.$_terms.falsy||new s;for(let n=0;n<t.length;++n){const r=t[n];i(void 0!==r,"Cannot call falsy with undefined"),e.$_terms.falsy.add(r)}return e}},sensitive:{method(t=!0){return this.$_setFlag("sensitive",t)}}},cast:{number:{from:a.isBool,to:(t,e)=>t?1:0},string:{from:a.isBool,to:(t,e)=>t?"true":"false"}},manifest:{build:(t,e)=>(e.truthy&&(t=t.truthy(...e.truthy)),e.falsy&&(t=t.falsy(...e.falsy)),t)},messages:{"boolean.base":"{{#label}} must be a boolean"}})},function(t,e,n){"use strict";const i=n(0),r=n(3),o=n(1),s=n(7),a={isDate:function(t){return t instanceof Date}};t.exports=r.extend({type:"date",coerce:{from:["number","string"],method:(t,{schema:e})=>({value:a.parse(t,e._flags.format)||t})},validate(t,{schema:e,error:n,prefs:i}){if(t instanceof Date&&!isNaN(t.getTime()))return;const r=e._flags.format;return i.convert&&r&&"string"==typeof t?{value:t,errors:n("date.format",{format:r})}:{value:t,errors:n("date.base")}},rules:{compare:{method:!1,validate(t,e,{date:n},{name:i,operator:r,args:s}){const a="now"===n?Date.now():n.getTime();return o.compare(t.getTime(),a,r)?t:e.error("date."+i,{limit:s.date,value:t})},args:[{name:"date",ref:!0,normalize:t=>"now"===t?t:a.parse(t),assert:t=>null!==t,message:"must have a valid date format"}]},format:{method(t){return i(["iso","javascript","unix"].includes(t),"Unknown date format",t),this.$_setFlag("format",t)}},greater:{method(t){return this.$_addRule({name:"greater",method:"compare",args:{date:t},operator:">"})}},iso:{method(){return this.format("iso")}},less:{method(t){return this.$_addRule({name:"less",method:"compare",args:{date:t},operator:"<"})}},max:{method(t){return this.$_addRule({name:"max",method:"compare",args:{date:t},operator:"<="})}},min:{method(t){return this.$_addRule({name:"min",method:"compare",args:{date:t},operator:">="})}},timestamp:{method(t="javascript"){return i(["javascript","unix"].includes(t),'"type" must be one of "javascript, unix"'),this.format(t)}}},cast:{number:{from:a.isDate,to:(t,e)=>t.getTime()},string:{from:a.isDate,to:(t,{prefs:e})=>s.date(t,e)}},messages:{"date.base":"{{#label}} must be a valid date","date.format":'{{#label}} must be in {msg("date.format." + #format) || #format} format',"date.greater":'{{#label}} must be greater than "{{#limit}}"',"date.less":'{{#label}} must be less than "{{#limit}}"',"date.max":'{{#label}} must be less than or equal to "{{#limit}}"',"date.min":'{{#label}} must be larger than or equal to "{{#limit}}"',"date.format.iso":"ISO 8601 date","date.format.javascript":"timestamp or number of milliseconds","date.format.unix":"timestamp or number of seconds"}}),a.parse=function(t,e){if(t instanceof Date)return t;if("string"!=typeof t&&(isNaN(t)||!isFinite(t)))return null;if(/^\s*$/.test(t))return null;if("iso"===e)return o.isIsoDate(t)?a.date(t.toString()):null;const n=t;if("string"==typeof t&&/^[+-]?\d+(\.\d+)?$/.test(t)&&(t=parseFloat(t)),e){if("javascript"===e)return a.date(1*t);if("unix"===e)return a.date(1e3*t);if("string"==typeof n)return null}return a.date(t)},a.date=function(t){const e=new Date(t);return isNaN(e.getTime())?null:e}},function(t,e,n){"use strict";const i=n(0),r=n(22);t.exports=r.extend({type:"function",properties:{typeof:"function"},rules:{arity:{method(t){return i(Number.isSafeInteger(t)&&t>=0,"n must be a positive integer"),this.$_addRule({name:"arity",args:{n:t}})},validate:(t,e,{n:n})=>t.length===n?t:e.error("function.arity",{n:n})},class:{method(){return this.$_addRule("class")},validate:(t,e)=>/^\s*class\s/.test(t.toString())?t:e.error("function.class",{value:t})},minArity:{method(t){return i(Number.isSafeInteger(t)&&t>0,"n must be a strict positive integer"),this.$_addRule({name:"minArity",args:{n:t}})},validate:(t,e,{n:n})=>t.length>=n?t:e.error("function.minArity",{n:n})},maxArity:{method(t){return i(Number.isSafeInteger(t)&&t>=0,"n must be a positive integer"),this.$_addRule({name:"maxArity",args:{n:t}})},validate:(t,e,{n:n})=>t.length<=n?t:e.error("function.maxArity",{n:n})}},messages:{"function.arity":"{{#label}} must have an arity of {{#n}}","function.class":"{{#label}} must be a class","function.maxArity":"{{#label}} must have an arity lesser or equal to {{#n}}","function.minArity":"{{#label}} must have an arity greater or equal to {{#n}}"}})},function(t,e,n){"use strict";const i=n(0),r=n(2),o=n(20),s=n(6),a={};t.exports=function(t,e,n={}){if(i(t&&"object"==typeof t,"Invalid defaults value: must be an object"),i(!e||!0===e||"object"==typeof e,"Invalid source value: must be true, falsy or an object"),i("object"==typeof n,"Invalid options: must be an object"),!e)return null;if(n.shallow)return a.applyToDefaultsWithShallow(t,e,n);const s=r(t);if(!0===e)return s;const l=void 0!==n.nullOverride&&n.nullOverride;return o(s,e,{nullOverride:l,mergeArrays:!1})},a.applyToDefaultsWithShallow=function(t,e,n){const l=n.shallow;i(Array.isArray(l),"Invalid keys");const c=new Map,u=!0===e?null:new Set;for(let n of l){n=Array.isArray(n)?n:n.split(".");const i=s(t,n);i&&"object"==typeof i?c.set(i,u&&s(e,n)||i):u&&u.add(n)}const p=r(t,{},c);if(!u)return p;for(const t of u)a.reachCopy(p,e,t);return o(p,e,{mergeArrays:!1,nullOverride:!1})},a.reachCopy=function(t,e,n){for(const t of n){if(!(t in e))return;e=e[t]}const i=e;let r=t;for(let t=0;t<n.length-1;++t){const e=n[t];"object"!=typeof r[e]&&(r[e]={}),r=r[e]}r[n[n.length-1]]=i}},function(t,e,n){"use strict";const i=n(0),r={};e.Sorter=class{constructor(){this._items=[],this.nodes=[]}add(t,e){const n=[].concat((e=e||{}).before||[]),r=[].concat(e.after||[]),o=e.group||"?",s=e.sort||0;i(!n.includes(o),"Item cannot come before itself: ".concat(o)),i(!n.includes("?"),"Item cannot come before unassociated items"),i(!r.includes(o),"Item cannot come after itself: ".concat(o)),i(!r.includes("?"),"Item cannot come after unassociated items"),Array.isArray(t)||(t=[t]);for(const e of t){const t={seq:this._items.length,sort:s,before:n,after:r,group:o,node:e};this._items.push(t)}const a=this._sort();return i(a,"item","?"!==o?"added into group ".concat(o):"","created a dependencies error"),this.nodes}merge(t){Array.isArray(t)||(t=[t]);for(const e of t)if(e)for(const t of e._items)this._items.push(Object.assign({},t));this._items.sort(r.mergeSort);for(let t=0;t<this._items.length;++t)this._items[t].seq=t;const e=this._sort();return i(e,"merge created a dependencies error"),this.nodes}_sort(){const t={},e=Object.create(null),n=Object.create(null);for(const i of this._items){const r=i.seq,o=i.group;n[o]=n[o]||[],n[o].push(r),t[r]=i.before;for(const t of i.after)e[t]=e[t]||[],e[t].push(r)}for(const e in t){const i=[];for(const r in t[e]){const o=t[e][r];n[o]=n[o]||[],i.push(...n[o])}t[e]=i}for(const i in e)if(n[i])for(const r of n[i])t[r].push(...e[i]);const i={};for(const e in t){const n=t[e];for(const t of n)i[t]=i[t]||[],i[t].push(e)}const r={},o=[];for(let t=0;t<this._items.length;++t){let e=t;if(i[t]){e=null;for(let t=0;t<this._items.length;++t){if(!0===r[t])continue;i[t]||(i[t]=[]);const n=i[t].length;let o=0;for(let e=0;e<n;++e)r[i[t][e]]&&++o;if(o===n){e=t;break}}}null!==e&&(r[e]=!0,o.push(e))}if(o.length!==this._items.length)return!1;const s={};for(const t of this._items)s[t.seq]=t;this._items=[],this.nodes=[];for(const t of o){const e=s[t];this.nodes.push(e.node),this._items.push(e)}return!0}},r.mergeSort=(t,e)=>t.sort===e.sort?0:t.sort<e.sort?-1:1},function(t,e,n){"use strict";const i=n(0),r=n(3),o=n(1),s=n(8),a=n(4),l={};t.exports=r.extend({type:"link",properties:{schemaChain:!0},terms:{link:{init:null,manifest:"single",register:!1}},args:(t,e)=>t.ref(e),validate(t,{schema:e,state:n,prefs:r}){i(e.$_terms.link,"Uninitialized link schema");const o=l.generate(e,t,n,r),s=e.$_terms.link[0].ref;return o.$_validate(t,n.nest(o,"link:".concat(s.display,":").concat(o.type)),r)},generate:(t,e,n,i)=>l.generate(t,e,n,i),rules:{ref:{method(t){i(!this.$_terms.link,"Cannot reinitialize schema"),t=s.ref(t),i("value"===t.type||"local"===t.type,"Invalid reference type:",t.type),i("local"===t.type||"root"===t.ancestor||t.ancestor>0,"Link cannot reference itself");const e=this.clone();return e.$_terms.link=[{ref:t}],e}},relative:{method(t=!0){return this.$_setFlag("relative",t)}}},overrides:{concat(t){i(this.$_terms.link,"Uninitialized link schema"),i(o.isSchema(t),"Invalid schema object"),i("link"!==t.type,"Cannot merge type link with another link");const e=this.clone();return e.$_terms.whens||(e.$_terms.whens=[]),e.$_terms.whens.push({concat:t}),e.$_mutateRebuild()}},manifest:{build:(t,e)=>(i(e.link,"Invalid link description missing link"),t.ref(e.link))}}),l.generate=function(t,e,n,i){let r=n.mainstay.links.get(t);if(r)return r._generate(e,n,i).schema;const o=t.$_terms.link[0].ref,{perspective:s,path:a}=l.perspective(o,n);l.assert(s,"which is outside of schema boundaries",o,t,n,i);try{r=a.length?s.$_reach(a):s}catch(e){l.assert(!1,"to non-existing schema",o,t,n,i)}return l.assert("link"!==r.type,"which is another link",o,t,n,i),t._flags.relative||n.mainstay.links.set(t,r),r._generate(e,n,i).schema},l.perspective=function(t,e){if("local"===t.type){for(const{schema:n,key:i}of e.schemas){if((n._flags.id||i)===t.path[0])return{perspective:n,path:t.path.slice(1)};if(n.$_terms.shared)for(const e of n.$_terms.shared)if(e._flags.id===t.path[0])return{perspective:e,path:t.path.slice(1)}}return{perspective:null,path:null}}return"root"===t.ancestor?{perspective:e.schemas[e.schemas.length-1].schema,path:t.path}:{perspective:e.schemas[t.ancestor]&&e.schemas[t.ancestor].schema,path:t.path}},l.assert=function(t,e,n,r,o,s){t||i(!1,'"'.concat(a.label(r._flags,o,s),'" contains link reference "').concat(n.display,'" ').concat(e))}},function(t,e,n){"use strict";const i=n(0),r=n(3),o=n(1),s={numberRx:/^\s*[+-]?(?:(?:\d+(?:\.\d*)?)|(?:\.\d+))(?:e([+-]?\d+))?\s*$/i,precisionRx:/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/};t.exports=r.extend({type:"number",flags:{unsafe:{default:!1}},coerce:{from:"string",method(t,{schema:e,error:n}){const i=t.match(s.numberRx);if(!i)return;t=t.trim();const r={value:parseFloat(t)};if(0===r.value&&(r.value=0),!e._flags.unsafe)if(t.match(/e/i)){if(s.normalizeExponent("".concat(r.value/Math.pow(10,i[1]),"e").concat(i[1]))!==s.normalizeExponent(t))return r.errors=n("number.unsafe"),r}else{const e=r.value.toString();if(e.match(/e/i))return r;if(e!==s.normalizeDecimal(t))return r.errors=n("number.unsafe"),r}return r}},validate(t,{schema:e,error:n,prefs:i}){if(t===1/0||t===-1/0)return{value:t,errors:n("number.infinity")};if(!o.isNumber(t))return{value:t,errors:n("number.base")};const r={value:t};if(i.convert){const t=e.$_getRule("precision");if(t){const e=Math.pow(10,t.args.limit);r.value=Math.round(r.value*e)/e}}return 0===r.value&&(r.value=0),!e._flags.unsafe&&(t>Number.MAX_SAFE_INTEGER||t<Number.MIN_SAFE_INTEGER)&&(r.errors=n("number.unsafe")),r},rules:{compare:{method:!1,validate:(t,e,{limit:n},{name:i,operator:r,args:s})=>o.compare(t,n,r)?t:e.error("number."+i,{limit:s.limit,value:t}),args:[{name:"limit",ref:!0,assert:o.isNumber,message:"must be a number"}]},greater:{method(t){return this.$_addRule({name:"greater",method:"compare",args:{limit:t},operator:">"})}},integer:{method(){return this.$_addRule("integer")},validate:(t,e)=>Math.trunc(t)-t==0?t:e.error("number.integer")},less:{method(t){return this.$_addRule({name:"less",method:"compare",args:{limit:t},operator:"<"})}},max:{method(t){return this.$_addRule({name:"max",method:"compare",args:{limit:t},operator:"<="})}},min:{method(t){return this.$_addRule({name:"min",method:"compare",args:{limit:t},operator:">="})}},multiple:{method(t){return this.$_addRule({name:"multiple",args:{base:t}})},validate:(t,e,{base:n},i)=>t%n==0?t:e.error("number.multiple",{multiple:i.args.base,value:t}),args:[{name:"base",ref:!0,assert:t=>"number"==typeof t&&isFinite(t)&&t>0,message:"must be a positive number"}],multi:!0},negative:{method(){return this.sign("negative")}},port:{method(){return this.$_addRule("port")},validate:(t,e)=>Number.isSafeInteger(t)&&t>=0&&t<=65535?t:e.error("number.port")},positive:{method(){return this.sign("positive")}},precision:{method(t){return i(Number.isSafeInteger(t),"limit must be an integer"),this.$_addRule({name:"precision",args:{limit:t}})},validate(t,e,{limit:n}){const i=t.toString().match(s.precisionRx);return Math.max((i[1]?i[1].length:0)-(i[2]?parseInt(i[2],10):0),0)<=n?t:e.error("number.precision",{limit:n,value:t})},convert:!0},sign:{method(t){return i(["negative","positive"].includes(t),"Invalid sign",t),this.$_addRule({name:"sign",args:{sign:t}})},validate:(t,e,{sign:n})=>"negative"===n&&t<0||"positive"===n&&t>0?t:e.error("number.".concat(n))},unsafe:{method(t=!0){return i("boolean"==typeof t,"enabled must be a boolean"),this.$_setFlag("unsafe",t)}}},cast:{string:{from:t=>"number"==typeof t,to:(t,e)=>t.toString()}},messages:{"number.base":"{{#label}} must be a number","number.greater":"{{#label}} must be greater than {{#limit}}","number.infinity":"{{#label}} cannot be infinity","number.integer":"{{#label}} must be an integer","number.less":"{{#label}} must be less than {{#limit}}","number.max":"{{#label}} must be less than or equal to {{#limit}}","number.min":"{{#label}} must be larger than or equal to {{#limit}}","number.multiple":"{{#label}} must be a multiple of {{#multiple}}","number.negative":"{{#label}} must be a negative number","number.port":"{{#label}} must be a valid port","number.positive":"{{#label}} must be a positive number","number.precision":"{{#label}} must have no more than {{#limit}} decimal places","number.unsafe":"{{#label}} must be a safe number"}}),s.normalizeExponent=function(t){return t.replace(/E/,"e").replace(/\.(\d*[1-9])?0+e/,".$1e").replace(/\.e/,"e").replace(/e\+/,"e").replace(/^\+/,"").replace(/^(-?)0+([1-9])/,"$1$2")},s.normalizeDecimal=function(t){return(t=t.replace(/^\+/,"").replace(/\.0+$/,"").replace(/^(-?)\.([^\.]*)$/,"$10.$2").replace(/^(-?)0+([1-9])/,"$1$2")).includes(".")&&t.endsWith("0")&&(t=t.replace(/0+$/,"")),"-0"===t?"0":t}},function(t,e,n){"use strict";const i=n(22);t.exports=i.extend({type:"object",cast:{map:{from:t=>t&&"object"==typeof t,to:(t,e)=>new Map(Object.entries(t))}}})},function(t,e,n){"use strict";function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function r(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){o(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const s=n(0),a=n(23),l=n(49),c=n(50),u=n(27),p=n(51),h=n(26),d=n(3),f=n(1),y={tlds:p instanceof Set&&{tlds:{allow:p,deny:null}},base64Regex:{true:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}==|[\w\-]{3}=)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/},false:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}(==)?|[\w\-]{3}=?)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}(==)?|[A-Za-z0-9+\/]{3}=?)?$/}},dataUriRegex:/^data:[\w+.-]+\/[\w+.-]+;((charset=[\w-]+|base64),)?(.*)$/,hexRegex:/^[a-f0-9]+$/i,ipRegex:c.regex().regex,isoDurationRegex:/^P(?!$)(\d+Y)?(\d+M)?(\d+W)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?$/,guidBrackets:{"{":"}","[":"]","(":")","":""},guidVersions:{uuidv1:"1",uuidv2:"2",uuidv3:"3",uuidv4:"4",uuidv5:"5"},cidrPresences:["required","optional","forbidden"],normalizationForms:["NFC","NFD","NFKC","NFKD"]};t.exports=d.extend({type:"string",flags:{insensitive:{default:!1},truncate:{default:!1}},terms:{replacements:{init:null}},coerce:{from:"string",method(t,{schema:e,state:n,prefs:i}){const r=e.$_getRule("normalize");r&&(t=t.normalize(r.args.form));const o=e.$_getRule("case");o&&(t="upper"===o.args.direction?t.toLocaleUpperCase():t.toLocaleLowerCase());const s=e.$_getRule("trim");if(s&&s.args.enabled&&(t=t.trim()),e.$_terms.replacements)for(const n of e.$_terms.replacements)t=t.replace(n.pattern,n.replacement);const a=e.$_getRule("hex");if(a&&a.args.options.byteAligned&&t.length%2!=0&&(t="0".concat(t)),e.$_getRule("isoDate")){const e=y.isoDate(t);e&&(t=e)}if(e._flags.truncate){const r=e.$_getRule("max");if(r){let o=r.args.limit;if(f.isResolvable(o)&&(o=o.resolve(t,n,i),!f.limit(o)))return{value:t,errors:e.$_createError("any.ref",o,{ref:r.args.limit,arg:"limit",reason:"must be a positive integer"},n,i)};t=t.slice(0,o)}}return{value:t}}},validate:(t,{error:e})=>"string"!=typeof t?{value:t,errors:e("string.base")}:""===t?{value:t,errors:e("string.empty")}:void 0,rules:{alphanum:{method(){return this.$_addRule("alphanum")},validate:(t,e)=>/^[a-zA-Z0-9]+$/.test(t)?t:e.error("string.alphanum")},base64:{method(t={}){return f.assertOptions(t,["paddingRequired","urlSafe"]),t=r({urlSafe:!1,paddingRequired:!0},t),s("boolean"==typeof t.paddingRequired,"paddingRequired must be boolean"),s("boolean"==typeof t.urlSafe,"urlSafe must be boolean"),this.$_addRule({name:"base64",args:{options:t}})},validate:(t,e,{options:n})=>y.base64Regex[n.paddingRequired][n.urlSafe].test(t)?t:e.error("string.base64")},case:{method(t){return s(["lower","upper"].includes(t),"Invalid case:",t),this.$_addRule({name:"case",args:{direction:t}})},validate:(t,e,{direction:n})=>"lower"===n&&t===t.toLocaleLowerCase()||"upper"===n&&t===t.toLocaleUpperCase()?t:e.error("string.".concat(n,"case")),convert:!0},creditCard:{method(){return this.$_addRule("creditCard")},validate(t,e){let n=t.length,i=0,r=1;for(;n--;){const e=t.charAt(n)*r;i+=e-9*(e>9),r^=3}return i>0&&i%10==0?t:e.error("string.creditCard")}},dataUri:{method(t={}){return f.assertOptions(t,["paddingRequired"]),t=r({paddingRequired:!0},t),s("boolean"==typeof t.paddingRequired,"paddingRequired must be boolean"),this.$_addRule({name:"dataUri",args:{options:t}})},validate(t,e,{options:n}){const i=t.match(y.dataUriRegex);if(i){if(!i[2])return t;if("base64"!==i[2])return t;if(y.base64Regex[n.paddingRequired].false.test(i[3]))return t}return e.error("string.dataUri")}},domain:{method(t){t&&f.assertOptions(t,["allowUnicode","minDomainSegments","tlds"]);const e=y.addressOptions(t);return this.$_addRule({name:"domain",args:{options:t},address:e})},validate:(t,e,n,{address:i})=>a.isValid(t,i)?t:e.error("string.domain")},email:{method(t={}){f.assertOptions(t,["allowUnicode","ignoreLength","minDomainSegments","multiple","separator","tlds"]),s(void 0===t.multiple||"boolean"==typeof t.multiple,"multiple option must be an boolean");const e=y.addressOptions(t),n=new RegExp("\\s*[".concat(t.separator?u(t.separator):",","]\\s*"));return this.$_addRule({name:"email",args:{options:t},regex:n,address:e})},validate(t,e,{options:n},{regex:i,address:r}){const o=n.multiple?t.split(i):[t],s=[];for(const t of o)l.isValid(t,r)||s.push(t);return s.length?e.error("string.email",{value:t,invalids:s}):t}},guid:{alias:"uuid",method(t={}){f.assertOptions(t,["version"]);let e="";if(t.version){const n=[].concat(t.version);s(n.length>=1,"version must have at least 1 valid version specified");const i=new Set;for(let t=0;t<n.length;++t){const r=n[t];s("string"==typeof r,"version at position "+t+" must be a string");const o=y.guidVersions[r.toLowerCase()];s(o,"version at position "+t+" must be one of "+Object.keys(y.guidVersions).join(", ")),s(!i.has(o),"version at position "+t+" must not be a duplicate"),e+=o,i.add(o)}}const n=new RegExp("^([\\[{\\(]?)[0-9A-F]{8}([:-]?)[0-9A-F]{4}\\2?[".concat(e||"0-9A-F","][0-9A-F]{3}\\2?[").concat(e?"89AB":"0-9A-F","][0-9A-F]{3}\\2?[0-9A-F]{12}([\\]}\\)]?)$"),"i");return this.$_addRule({name:"guid",args:{options:t},regex:n})},validate(t,e,n,{regex:i}){const r=i.exec(t);return r?y.guidBrackets[r[1]]!==r[r.length-1]?e.error("string.guid"):t:e.error("string.guid")}},hex:{method(t={}){return f.assertOptions(t,["byteAligned"]),t=r({byteAligned:!1},t),s("boolean"==typeof t.byteAligned,"byteAligned must be boolean"),this.$_addRule({name:"hex",args:{options:t}})},validate:(t,e,{options:n})=>y.hexRegex.test(t)?n.byteAligned&&t.length%2!=0?e.error("string.hexAlign"):t:e.error("string.hex")},hostname:{method(){return this.$_addRule("hostname")},validate:(t,e)=>a.isValid(t,{minDomainSegments:1})||y.ipRegex.test(t)?t:e.error("string.hostname")},insensitive:{method(){return this.$_setFlag("insensitive",!0)}},ip:{method(t={}){f.assertOptions(t,["cidr","version"]);const{cidr:e,versions:n,regex:i}=c.regex(t),r=t.version?n:void 0;return this.$_addRule({name:"ip",args:{options:{cidr:e,version:r}},regex:i})},validate:(t,e,{options:n},{regex:i})=>i.test(t)?t:n.version?e.error("string.ipVersion",{value:t,cidr:n.cidr,version:n.version}):e.error("string.ip",{value:t,cidr:n.cidr})},isoDate:{method(){return this.$_addRule("isoDate")},validate:(t,{error:e})=>y.isoDate(t)?t:e("string.isoDate")},isoDuration:{method(){return this.$_addRule("isoDuration")},validate:(t,e)=>y.isoDurationRegex.test(t)?t:e.error("string.isoDuration")},length:{method(t,e){return y.length(this,"length",t,"=",e)},validate(t,e,{limit:n,encoding:i},{name:r,operator:o,args:s}){const a=!i&&t.length;return f.compare(a,n,o)?t:e.error("string."+r,{limit:s.limit,value:t,encoding:i})},args:[{name:"limit",ref:!0,assert:f.limit,message:"must be a positive integer"},"encoding"]},lowercase:{method(){return this.case("lower")}},max:{method(t,e){return y.length(this,"max",t,"<=",e)},args:["limit","encoding"]},min:{method(t,e){return y.length(this,"min",t,">=",e)},args:["limit","encoding"]},normalize:{method(t="NFC"){return s(y.normalizationForms.includes(t),"normalization form must be one of "+y.normalizationForms.join(", ")),this.$_addRule({name:"normalize",args:{form:t}})},validate:(t,{error:e},{form:n})=>t===t.normalize(n)?t:e("string.normalize",{value:t,form:n}),convert:!0},pattern:{alias:"regex",method(t,e={}){s(t instanceof RegExp,"regex must be a RegExp"),s(!t.flags.includes("g")&&!t.flags.includes("y"),"regex should not use global or sticky mode"),"string"==typeof e&&(e={name:e}),f.assertOptions(e,["invert","name"]);const n=["string.pattern",e.invert?".invert":"",e.name?".name":".base"].join("");return this.$_addRule({name:"pattern",args:{regex:t,options:e},errorCode:n})},validate:(t,e,{regex:n,options:i},{errorCode:r})=>n.test(t)^i.invert?t:e.error(r,{name:i.name,regex:n,value:t}),args:["regex","options"],multi:!0},replace:{method(t,e){"string"==typeof t&&(t=new RegExp(u(t),"g")),s(t instanceof RegExp,"pattern must be a RegExp"),s("string"==typeof e,"replacement must be a String");const n=this.clone();return n.$_terms.replacements||(n.$_terms.replacements=[]),n.$_terms.replacements.push({pattern:t,replacement:e}),n}},token:{method(){return this.$_addRule("token")},validate:(t,e)=>/^\w+$/.test(t)?t:e.error("string.token")},trim:{method(t=!0){return s("boolean"==typeof t,"enabled must be a boolean"),this.$_addRule({name:"trim",args:{enabled:t}})},validate:(t,e,{enabled:n})=>n&&t!==t.trim()?e.error("string.trim"):t,convert:!0},truncate:{method(t=!0){return s("boolean"==typeof t,"enabled must be a boolean"),this.$_setFlag("truncate",t)}},uppercase:{method(){return this.case("upper")}},uri:{method(t={}){f.assertOptions(t,["allowRelative","allowQuerySquareBrackets","domain","relativeOnly","scheme"]),t.domain&&f.assertOptions(t.domain,["allowUnicode","minDomainSegments","tlds"]);const{regex:e,scheme:n}=h.regex(t),i=t.domain?y.addressOptions(t.domain):null;return this.$_addRule({name:"uri",args:{options:t},regex:e,domain:i,scheme:n})},validate(t,e,{options:n},{regex:i,domain:r,scheme:o}){if(["http:/","https:/"].includes(t))return e.error("string.uri");const s=i.exec(t);return s?r&&!a.isValid(s[1],r)?e.error("string.domain",{value:s[1]}):t:n.relativeOnly?e.error("string.uriRelativeOnly"):n.scheme?e.error("string.uriCustomScheme",{scheme:o,value:t}):e.error("string.uri")}}},manifest:{build(t,e){if(e.replacements)for(const{pattern:n,replacement:i}of e.replacements)t=t.replace(n,i);return t}},messages:{"string.alphanum":"{{#label}} must only contain alpha-numeric characters","string.base":"{{#label}} must be a string","string.base64":"{{#label}} must be a valid base64 string","string.creditCard":"{{#label}} must be a credit card","string.dataUri":"{{#label}} must be a valid dataUri string","string.domain":"{{#label}} must contain a valid domain name","string.email":"{{#label}} must be a valid email","string.empty":"{{#label}} is not allowed to be empty","string.guid":"{{#label}} must be a valid GUID","string.hex":"{{#label}} must only contain hexadecimal characters","string.hexAlign":"{{#label}} hex decoded representation must be byte aligned","string.hostname":"{{#label}} must be a valid hostname","string.ip":"{{#label}} must be a valid ip address with a {{#cidr}} CIDR","string.ipVersion":"{{#label}} must be a valid ip address of one of the following versions {{#version}} with a {{#cidr}} CIDR","string.isoDate":"{{#label}} must be in iso format","string.isoDuration":"{{#label}} must be a valid ISO 8601 duration","string.length":"{{#label}} length must be {{#limit}} characters long","string.lowercase":"{{#label}} must only contain lowercase characters","string.max":"{{#label}} length must be less than or equal to {{#limit}} characters long","string.min":"{{#label}} length must be at least {{#limit}} characters long","string.normalize":"{{#label}} must be unicode normalized in the {{#form}} form","string.token":"{{#label}} must only contain alpha-numeric and underscore characters","string.pattern.base":'{{#label}} with value "{[.]}" fails to match the required pattern: {{#regex}}',"string.pattern.name":'{{#label}} with value "{[.]}" fails to match the {{#name}} pattern',"string.pattern.invert.base":'{{#label}} with value "{[.]}" matches the inverted pattern: {{#regex}}',"string.pattern.invert.name":'{{#label}} with value "{[.]}" matches the inverted {{#name}} pattern',"string.trim":"{{#label}} must not have leading or trailing whitespace","string.uri":"{{#label}} must be a valid uri","string.uriCustomScheme":"{{#label}} must be a valid uri with a scheme matching the {{#scheme}} pattern","string.uriRelativeOnly":"{{#label}} must be a valid relative uri","string.uppercase":"{{#label}} must only contain uppercase characters"}}),y.addressOptions=function(t){if(!t)return t;if(s(void 0===t.minDomainSegments||Number.isSafeInteger(t.minDomainSegments)&&t.minDomainSegments>0,"minDomainSegments must be a positive integer"),!1===t.tlds)return t;if(!0===t.tlds||void 0===t.tlds)return s(y.tlds,"Built-in TLD list disabled"),Object.assign({},t,y.tlds);s("object"==typeof t.tlds,"tlds must be true, false, or an object");const e=t.tlds.deny;if(e)return Array.isArray(e)&&(t=Object.assign({},t,{tlds:{deny:new Set(e)}})),s(t.tlds.deny instanceof Set,"tlds.deny must be an array, Set, or boolean"),s(!t.tlds.allow,"Cannot specify both tlds.allow and tlds.deny lists"),t;const n=t.tlds.allow;return n?!0===n?(s(y.tlds,"Built-in TLD list disabled"),Object.assign({},t,y.tlds)):(Array.isArray(n)&&(t=Object.assign({},t,{tlds:{allow:new Set(n)}})),s(t.tlds.allow instanceof Set,"tlds.allow must be an array, Set, or boolean"),t):t},y.isoDate=function(t){if(!f.isIsoDate(t))return null;const e=new Date(t);return isNaN(e.getTime())?null:e.toISOString()},y.length=function(t,e,n,i,r){return s(!r||!1,"Invalid encoding:",r),t.$_addRule({name:e,method:"length",args:{limit:n,encoding:r},operator:i})}},function(t,e,n){"use strict";const i=n(24),r=n(23),o=n(25),s={nonAsciiRx:/[^\x00-\x7f]/,encoder:new(i.TextEncoder||TextEncoder)};e.analyze=function(t,e){return s.email(t,e)},e.isValid=function(t,e){return!s.email(t,e)},s.email=function(t,e={}){if("string"!=typeof t)throw new Error("Invalid input: email must be a string");if(!t)return o.code("EMPTY_STRING");const n=!s.nonAsciiRx.test(t);if(!n){if(!1===e.allowUnicode)return o.code("FORBIDDEN_UNICODE");t=t.normalize("NFC")}const i=t.split("@");if(2!==i.length)return i.length>2?o.code("MULTIPLE_AT_CHAR"):o.code("MISSING_AT_CHAR");const[a,l]=i;if(!a)return o.code("EMPTY_LOCAL");if(!e.ignoreLength){if(t.length>254)return o.code("ADDRESS_TOO_LONG");if(s.encoder.encode(a).length>64)return o.code("LOCAL_TOO_LONG")}return s.local(a,n)||r.analyze(l,e)},s.local=function(t,e){const n=t.split(".");for(const t of n){if(!t.length)return o.code("EMPTY_LOCAL_SEGMENT");if(e){if(!s.atextRx.test(t))return o.code("INVALID_LOCAL_CHARS")}else for(const e of t){if(s.atextRx.test(e))continue;const t=s.binary(e);if(!s.atomRx.test(t))return o.code("INVALID_LOCAL_CHARS")}}},s.binary=function(t){return Array.from(s.encoder.encode(t)).map(t=>String.fromCharCode(t)).join("")},s.atextRx=/^[\w!#\$%&'\*\+\-/=\?\^`\{\|\}~]+$/,s.atomRx=new RegExp(["(?:[\\xc2-\\xdf][\\x80-\\xbf])","(?:\\xe0[\\xa0-\\xbf][\\x80-\\xbf])|(?:[\\xe1-\\xec][\\x80-\\xbf]{2})|(?:\\xed[\\x80-\\x9f][\\x80-\\xbf])|(?:[\\xee-\\xef][\\x80-\\xbf]{2})","(?:\\xf0[\\x90-\\xbf][\\x80-\\xbf]{2})|(?:[\\xf1-\\xf3][\\x80-\\xbf]{3})|(?:\\xf4[\\x80-\\x8f][\\x80-\\xbf]{2})"].join("|"))},function(t,e,n){"use strict";const i=n(0),r=n(26);e.regex=function(t={}){i(void 0===t.cidr||"string"==typeof t.cidr,"options.cidr must be a string");const e=t.cidr?t.cidr.toLowerCase():"optional";i(["required","optional","forbidden"].includes(e),"options.cidr must be one of required, optional, forbidden"),i(void 0===t.version||"string"==typeof t.version||Array.isArray(t.version),"options.version must be a string or an array of string");let n=t.version||["ipv4","ipv6","ipvfuture"];Array.isArray(n)||(n=[n]),i(n.length>=1,"options.version must have at least 1 version specified");for(let t=0;t<n.length;++t)i("string"==typeof n[t],"options.version must only contain strings"),n[t]=n[t].toLowerCase(),i(["ipv4","ipv6","ipvfuture"].includes(n[t]),"options.version contains unknown version "+n[t]+" - must be one of ipv4, ipv6, ipvfuture");n=Array.from(new Set(n));const o=n.map(t=>{if("forbidden"===e)return r.ip[t];const n="\\/".concat("ipv4"===t?r.ip.v4Cidr:r.ip.v6Cidr);return"required"===e?"".concat(r.ip[t]).concat(n):"".concat(r.ip[t],"(?:").concat(n,")?")}),s="(?:".concat(o.join("|"),")"),a=new RegExp("^".concat(s,"$"));return{cidr:e,versions:n,regex:a,raw:s}}},function(t,e){},function(t,e,n){"use strict";const i=n(0),r=n(3),o={};o.Map=class extends Map{slice(){return new o.Map(this)}},t.exports=r.extend({type:"symbol",terms:{map:{init:new o.Map}},coerce:{method(t,{schema:e,error:n}){const i=e.$_terms.map.get(t);return i&&(t=i),e._flags.only&&"symbol"!=typeof t?{value:t,errors:n("symbol.map",{map:e.$_terms.map})}:{value:t}}},validate(t,{error:e}){if("symbol"!=typeof t)return{value:t,errors:e("symbol.base")}},rules:{map:{method(t){t&&!t[Symbol.iterator]&&"object"==typeof t&&(t=Object.entries(t)),i(t&&t[Symbol.iterator],"Iterable must be an iterable or object");const e=this.clone(),n=[];for(const r of t){i(r&&r[Symbol.iterator],"Entry must be an iterable");const[t,o]=r;i("object"!=typeof t&&"function"!=typeof t&&"symbol"!=typeof t,"Key must not be of type object, function, or Symbol"),i("symbol"==typeof o,"Value must be a Symbol"),e.$_terms.map.set(t,o),n.push(o)}return e.valid(...n)}}},manifest:{build:(t,e)=>(e.map&&(t=t.map(e.map)),t)},messages:{"symbol.base":"{{#label}} must be a symbol","symbol.map":"{{#label}} must be one of {{#map}}"}})}])},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}l((i=i.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0});var a=n(43),l=function(t){function e(e){var n=t.call(this)||this;return n.manifest=e,n}return r(e,t),e.prototype.readAsync=function(t){return o(this,void 0,void 0,(function(){var e,n,i,r,o;return s(this,(function(s){switch(s.label){case 0:if(e=t-1,void 0===(n=this.manifest.list[e]))return this.error.notify(new Error('Level "'+t+" not found")),[2];s.label=1;case 1:return s.trys.push([1,4,,5]),[4,fetch(n.file)];case 2:return[4,s.sent().json()];case 3:return i=s.sent(),(r=new a.MapConfig).fromDto(i),this.loaded.notify(r),[3,5];case 4:return o=s.sent(),this.error.notify(o),[3,5];case 5:return[2]}}))}))},e.prototype.getCount=function(){return this.manifest.list.length},e}(n(44).MapListReader);e.ManifestMapListReader=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e){var n=t.call(this)||this;return n.mapConfigs=e,n}return r(e,t),e.prototype.readAsync=function(t){var e=t-1,n=this.mapConfigs[e];void 0!==n?this.loaded.notify(n):this.error.notify(new Error('Level "'+t+" not found"))},e.prototype.getCount=function(){return this.mapConfigs.length},e}(n(44).MapListReader);e.MemoryMapListReader=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=function(){function t(t){var e=this;this.loaded=new i.Subject,this.error=new i.Subject,this.activeReader=null,this.handleReaderLoaded=function(t){e.loaded.notify(t)},this.handleReaderError=function(t){e.error.notify(t)},this.defaultReader=t,this.setListReader(t)}return t.prototype.setListReader=function(t){null!==this.activeReader&&(this.activeReader.loaded.removeListener(this.handleReaderLoaded),this.activeReader.error.removeListener(this.handleReaderError)),this.activeReader=t,this.activeReader.loaded.addListener(this.handleReaderLoaded),this.activeReader.error.addListener(this.handleReaderError)},t.prototype.restoreDefaultReader=function(){this.setListReader(this.defaultReader)},t.prototype.loadAsync=function(t){this.activeReader.readAsync(t)},t.prototype.getItemsCount=function(){return this.activeReader.getCount()},t}();e.MapLoader=r},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(4)),i(n(252)),i(n(8))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(253),a=n(260),l=n(282),c=n(288),u=n(291),p=n(296),h=n(8),d=function(t){function e(){var e=t.call(this)||this;return e.register(h.GameSceneType.EditorEnemy,s.EditorEnemyScene),e.register(h.GameSceneType.EditorHint,s.EditorHintScene),e.register(h.GameSceneType.EditorMap,s.EditorMapScene),e.register(h.GameSceneType.EditorMenu,s.EditorMenuScene),e.register(h.GameSceneType.MainAbout,l.MainAboutScene),e.register(h.GameSceneType.MainGameOver,l.MainGameOverScene),e.register(h.GameSceneType.MainHighscore,l.MainHighscoreScene),e.register(h.GameSceneType.MainMenu,l.MainMenuScene),e.register(h.GameSceneType.MainVictory,l.MainVictoryScene),e.register(h.GameSceneType.ModesMenu,c.ModesMenuScene),e.register(h.GameSceneType.ModesCustom,c.ModesCustomScene),e.register(h.GameSceneType.LevelHint,a.LevelHintScene),e.register(h.GameSceneType.LevelLoad,a.LevelLoadScene),e.register(h.GameSceneType.LevelSelection,a.LevelSelectionScene),e.register(h.GameSceneType.LevelScore,a.LevelScoreScene),e.register(h.GameSceneType.LevelPlay,a.LevelPlayScene),e.register(h.GameSceneType.SettingsAudio,u.SettingsAudioScene),e.register(h.GameSceneType.SettingsInterface,u.SettingsInterfaceScene),e.register(h.GameSceneType.SettingsMenu,u.SettingsMenuScene),e.register(h.GameSceneType.SettingsKeybinding,u.SettingsKeybindingScene),e.register(h.GameSceneType.SandboxTransform,p.SandboxTransformScene),e}return r(e,t),e}(o.SceneRouter);e.GameSceneRouter=d},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(254)),i(n(255)),i(n(256)),i(n(257))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,r++)i[r]=o[s];return i};Object.defineProperty(e,"__esModule",{value:!0});var s=n(2),a=n(6),l=n(1),c=n(4),u=n(8),p=[a.TankType.EnemyA(),a.TankType.EnemyB(),a.TankType.EnemyC(),a.TankType.EnemyD(),a.TankType.EnemyA().setHasDrop(!0),a.TankType.EnemyB().setHasDrop(!0),a.TankType.EnemyC().setHasDrop(!0),a.TankType.EnemyD().setHasDrop(!0)],h=l.ENEMY_MAX_TOTAL_COUNT/5,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.selectorsItems=[],e.pageIndex=0,e.handleSelectorChanged=function(t,n){var i=5*e.pageIndex+n,r=p[t.value];e.preview.show(r),e.mapConfig.setEnemySpawnListItem(i,r)},e.handleSelectorFocused=function(t){e.preview.setVisible(!0);var n=e.selectorsItems[t].getValue(),i=p[n];e.preview.show(i)},e.handleSelectorUnfocused=function(){e.preview.setVisible(!1),e.preview.dirtyPaintBox()},e.handleNextSelected=function(){e.hasNextPage()?(e.pageIndex+=1,e.updateMenu()):e.navigator.back()},e.handlePrevSelected=function(){e.hasPrevPage()?(e.pageIndex-=1,e.updateMenu()):e.navigator.back()},e.handleBackSelected=function(){e.navigator.replace(u.GameSceneType.EditorMenu,e.params)},e}return r(e,t),e.prototype.setup=function(){var t=this;this.mapConfig=this.params.mapConfig,this.mapConfig.isEnemySpawnListEmpty()&&this.mapConfig.fillEnemySpawnList(a.TankType.EnemyA()),this.title=new s.SceneMenuTitle(this.getTitleText()),this.root.add(this.title),this.preview=new s.EditorEnemyPreview(p),this.preview.position.set(600,230),this.root.add(this.preview);for(var e=p.map((function(t,e){var n="TIER "+t.tier.toString().toUpperCase();return t.hasDrop&&(n+=" +"),{value:e,text:n}})),n=function(n){var r=new s.SelectorMenuItem(e,{containerWidth:264,itemOriginX:0});r.changed.addListener((function(e){t.handleSelectorChanged(e,n)})),r.focused.addListener((function(){t.handleSelectorFocused(n)})),r.unfocused.addListener(i.handleSelectorUnfocused),i.selectorsItems[n]=r},i=this,r=0;r<5;r+=1)n(r);this.nextItem=new s.TextMenuItem(this.getNextText()),this.nextItem.selected.addListener(this.handleNextSelected),this.prevItem=new s.TextMenuItem(this.getPrevText()),this.prevItem.selected.addListener(this.handlePrevSelected),this.backItem=new s.TextMenuItem("BACK"),this.backItem.selected.addListener(this.handleBackSelected);var l=o(this.selectorsItems,[new s.DividerMenuItem,this.nextItem,this.prevItem,new s.DividerMenuItem,this.backItem]);this.menu=new s.SceneMenu,this.menu.setItems(l),this.root.add(this.menu),this.updateMenu()},e.prototype.getTypeValue=function(t){return p.findIndex((function(e){return e.equals(t)}))},e.prototype.updateMenu=function(){var t=this;this.title.setText(this.getTitleText()),this.prevItem.setText(this.getPrevText()),this.prevItem.setFocusable(this.hasPrevPage()),this.nextItem.setText(this.getNextText()),this.nextItem.setFocusable(this.hasNextPage());var e=this.getPageRange(this.pageIndex),n=this.mapConfig.getEnemySpawnList().slice(e[0],e[1]+1);this.selectorsItems.forEach((function(e,i){var r=n[i],o=t.getTypeValue(r);e.setValue(o)}))},e.prototype.getTitleText=function(){return"CONSTRUCTION → ENEMY "+this.getPageRangeText(this.pageIndex)},e.prototype.getPrevText=function(){return this.hasPrevPage()?"PREV → ENEMY "+this.getPageRangeText(this.pageIndex-1):"PREV"},e.prototype.getNextText=function(){return this.hasNextPage()?"NEXT → ENEMY "+this.getPageRangeText(this.pageIndex+1):"NEXT"},e.prototype.getPageRangeText=function(t){var e=this.getPageRange(t);return"["+(e[0]+1)+"-"+(e[1]+1)+"]"},e.prototype.getPageRange=function(t){var e=5*t;return[e,e+5-1]},e.prototype.hasPrevPage=function(){return this.pageIndex>0},e.prototype.hasNextPage=function(){return this.pageIndex<h-1},e}(c.GameScene);e.EditorEnemyScene=d},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(2),a=n(7),l=n(5),c=n(1),u=n(4),p=n(8),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.setup=function(t){var e=t.inputHintSettings,n=t.inputManager;e.setSeenEditorHint(),this.background=new o.GameObject,this.background.size.copyFrom(this.root.size),this.background.painter=new o.RectPainter(c.COLOR_GRAY),this.root.add(this.background),this.title=new s.SpriteText("CONTROLS",{color:c.COLOR_YELLOW}),this.title.origin.set(.5,.5),this.title.setCenterX(this.root.getSelfCenter().x),this.title.position.setY(64),this.root.add(this.title),this.brushIcon=new s.EditorBrush(64,64,l.TerrainType.Brick),this.brushIcon.origin.set(.5,.5),this.brushIcon.setCenterX(this.root.getSelfCenter().x),this.brushIcon.position.setY(302),this.root.add(this.brushIcon);var i=n.getPresentedControlCode(a.EditorMapInputContext.MoveUp[0]);this.moveUpHint=new s.SpriteText(i+"\n↑",{alignment:o.TextAlignment.Center}),this.moveUpHint.origin.set(.5,.5),this.moveUpHint.setCenterX(this.root.getSelfCenter().x),this.moveUpHint.position.setY(216),this.root.add(this.moveUpHint);var r=n.getPresentedControlCode(a.EditorMapInputContext.MoveDown[0]);this.moveDownHint=new s.SpriteText("↓\n"+r,{alignment:o.TextAlignment.Center}),this.moveDownHint.origin.set(.5,.5),this.moveDownHint.setCenterX(this.root.getSelfCenter().x),this.moveDownHint.position.setY(400),this.root.add(this.moveDownHint);var u=n.getPresentedControlCode(a.EditorMapInputContext.MoveLeft[0]);this.moveLeftHint=new s.SpriteText(u+" ←",{alignment:o.TextAlignment.Right}),this.moveLeftHint.origin.set(1,.5),this.moveLeftHint.position.set(460,305),this.root.add(this.moveLeftHint);var p=n.getPresentedControlCode(a.EditorMapInputContext.MoveRight[0]);this.moveRightHint=new s.SpriteText("→ "+p,{alignment:o.TextAlignment.Right}),this.moveRightHint.origin.set(0,.5),this.moveRightHint.position.set(560,305),this.root.add(this.moveRightHint);var h=n.getPresentedControlCode(a.EditorMapInputContext.Draw[0]);this.drawHint=new s.SpriteText("DRAW       - "+h),this.drawHint.position.set(290,500),this.root.add(this.drawHint);var d=n.getPresentedControlCode(a.EditorMapInputContext.Erase[0]);this.eraseHint=new s.SpriteText("ERASE      - "+d),this.eraseHint.position.set(290,550),this.root.add(this.eraseHint);var f=n.getPresentedControlCode(a.EditorMapInputContext.NextBrush[0]);this.nextBrushHint=new s.SpriteText("NEXT BRUSH - "+f),this.nextBrushHint.position.set(290,600),this.root.add(this.nextBrushHint);var y=n.getPresentedControlCode(a.EditorMapInputContext.PrevBrush[0]);this.prevBrushHint=new s.SpriteText("PREV BRUSH - "+y),this.prevBrushHint.position.set(290,650),this.root.add(this.prevBrushHint);var m=n.getPresentedControlCode(a.EditorMapInputContext.Menu[0]);this.backHint=new s.SpriteText("MENU       - "+m),this.backHint.position.set(290,700),this.root.add(this.backHint);var g=n.getPresentedControlCode(a.EditorHintInputContext.Skip[0]);this.continueHint=new s.InputHint(g+" TO CONTINUE"),this.root.add(this.continueHint)},e.prototype.update=function(e){e.input.isDownAny(a.EditorHintInputContext.Skip)?this.navigator.replace(p.GameSceneType.EditorMap,this.params):t.prototype.update.call(this,e)},e}(u.GameScene);e.EditorHintScene=h},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(18),s=n(2),a=n(7),l=n(1),c=n(4),u=n(8),p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.setup=function(t){var e=t.collisionSystem;this.debugCollisionMenu=new o.DebugCollisionMenu(e,this.root,{top:400}),l.IS_DEV&&(this.debugCollisionMenu.attach(),this.debugCollisionMenu.show()),this.root.add(new s.EditorBorder),this.mapConfig=this.params.mapConfig,this.map=new s.EditorMap(this.mapConfig),this.map.position.set(l.BORDER_LEFT_WIDTH,l.BORDER_TOP_BOTTOM_HEIGHT),this.root.add(this.map),this.field=new s.EditorField,this.field.position.set(l.BORDER_LEFT_WIDTH,l.BORDER_TOP_BOTTOM_HEIGHT),this.root.add(this.field)},e.prototype.update=function(e){var n=e.collisionSystem;e.input.isDownAny(a.EditorMapInputContext.Menu)?this.navigator.replace(u.GameSceneType.EditorMenu,this.params):(t.prototype.update.call(this,e),this.root.updateWorldMatrix(!1,!0),n.update(),l.IS_DEV&&this.debugCollisionMenu.update(),n.collide())},e}(c.GameScene);e.EditorMapScene=p},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=n(0),a=n(2),l=n(42),c=n(4),u=n(8),p=n(258);!function(t){t[t.Navigation=0]="Navigation",t[t.Alert=1]="Alert",t[t.Confrimation=2]="Confrimation"}(o||(o={}));var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mapConfig=null,e.menuState=o.Navigation,e.loadState=p.EditorLoadState.None,e.handleNewSelected=function(){e.mapConfig=new l.MapConfig,e.loadState=p.EditorLoadState.Draft,e.updateMenu()},e.handleLoadSelected=function(){var t=new s.FileOpener,n=new l.MapFileReader;t.opened.addListener((function(t){var e=t[0];n.read(e)})),n.loaded.addListener(e.handleFileLoaded),n.error.addListener(e.handleFileLoadError),t.openDialog()},e.handleFileLoaded=function(t){e.mapConfig=t,e.loadState=p.EditorLoadState.File,e.updateMenu()},e.handleFileLoadError=function(){e.showAlert()},e.handleSaveSelected=function(){var t=e.mapConfig.toJSON();(new s.FileSaver).saveJSON(t,"map.json")},e.handlePlaytestSelected=function(){e.navigator.push(u.GameSceneType.EditorMenu,e.createLocationParams());var t=new l.MemoryMapListReader([e.mapConfig]);e.mapLoader.setListReader(t),e.session.setPlaytest(),e.navigator.push(u.GameSceneType.LevelLoad)},e.handleMapSelected=function(){e.inputHintSettings.shouldShowEditorHint()?e.navigator.push(u.GameSceneType.EditorHint,e.createLocationParams()):e.navigator.push(u.GameSceneType.EditorMap,e.createLocationParams())},e.handleEnemySelected=function(){e.navigator.push(u.GameSceneType.EditorEnemy,e.createLocationParams())},e.handleExitSelected=function(){e.navigator.clearAndPush(u.GameSceneType.MainMenu)},e.handleRequestedConfirmation=function(){e.isLoaded()?e.showConfirmation():e.handleConfirmAccepted()},e.handleConfirmAccepted=function(){e.newItem.isFocused&&(e.handleNewSelected(),e.hideConfirmation()),e.loadItem.isFocused&&(e.handleLoadSelected(),e.hideConfirmation()),e.exitItem.isFocused&&e.handleExitSelected()},e.handleConfirmDeclined=function(){e.hideConfirmation()},e.handleAlertAccepted=function(){e.hideAlert()},e}return r(e,t),e.prototype.setup=function(t){var e,n=t.inputHintSettings,i=t.mapLoader,r=t.session;if(this.inputHintSettings=n,this.session=r,this.mapLoader=i,void 0!==this.params.mapConfig&&(this.mapConfig=this.params.mapConfig,this.loadState=null!=(e=this.params.loadState)?e:p.EditorLoadState.Draft),this.session.isPlaytest()&&null===this.mapConfig)return this.session.resetExceptIntro(),this.mapLoader.restoreDefaultReader(),void this.navigator.back();this.title=new a.SceneMenuTitle(this.getTitleText()),this.root.add(this.title),this.newItem=new a.TextMenuItem("NEW"),this.newItem.selected.addListener(this.handleRequestedConfirmation),this.loadItem=new a.TextMenuItem("LOAD"),this.loadItem.selected.addListener(this.handleRequestedConfirmation),this.saveItem=new a.TextMenuItem("SAVE"),this.saveItem.selected.addListener(this.handleSaveSelected),this.saveItem.setFocusable(!1),this.playtestItem=new a.TextMenuItem("PLAYTEST"),this.playtestItem.selected.addListener(this.handlePlaytestSelected),this.playtestItem.setFocusable(!1),this.mapItem=new a.TextMenuItem("EDIT → MAP"),this.mapItem.selected.addListener(this.handleMapSelected),this.mapItem.setFocusable(!1),this.enemyItem=new a.TextMenuItem("EDIT → ENEMIES"),this.enemyItem.selected.addListener(this.handleEnemySelected),this.enemyItem.setFocusable(!1),this.exitItem=new a.TextMenuItem("MAIN MENU"),this.exitItem.selected.addListener(this.handleRequestedConfirmation);var o=[this.newItem,this.loadItem,this.saveItem,new a.DividerMenuItem,this.mapItem,this.enemyItem,new a.DividerMenuItem,this.playtestItem,new a.DividerMenuItem,this.exitItem];this.menu=new a.SceneMenu,this.menu.setItems(o),this.root.add(this.menu),this.updateMenu(),this.alertModal=new a.AlertModal({containerWidth:768,message:"INVALID MAP CONFIG"}),this.alertModal.size.copyFrom(this.root.size),this.alertModal.setVisible(!1),this.alertModal.accepted.addListener(this.handleAlertAccepted),this.root.add(this.alertModal),this.confirmModal=new a.ConfirmModal({containerWidth:768,message:"CHANGES WILL BE LOST.\nARE YOU SURE?"}),this.confirmModal.size.copyFrom(this.root.size),this.confirmModal.updateMatrix(),this.confirmModal.setVisible(!1),this.confirmModal.accepted.addListener(this.handleConfirmAccepted),this.confirmModal.declined.addListener(this.handleConfirmDeclined),this.root.add(this.confirmModal)},e.prototype.update=function(t){var e=this;this.menuState!==o.Alert?this.menuState!==o.Confrimation?this.root.traverseDescedants((function(n){n===e.alertModal||n.hasParent(e.alertModal)||n===e.confirmModal||n.hasParent(e.confirmModal)||n.invokeUpdate(t)})):this.confirmModal.traverse((function(e){e.invokeUpdate(t)})):this.alertModal.traverse((function(e){e.invokeUpdate(t)}))},e.prototype.updateMenu=function(){this.title.setText(this.getTitleText()),this.saveItem.setFocusable(this.isLoaded()),this.mapItem.setFocusable(this.isLoaded()),this.enemyItem.setFocusable(this.isLoaded()),this.playtestItem.setFocusable(this.isLoaded())},e.prototype.createLocationParams=function(){return{mapConfig:this.mapConfig,loadState:this.loadState}},e.prototype.getTitleText=function(){return this.loadState===p.EditorLoadState.File?"CONSTRUCTION [FILE]":this.loadState===p.EditorLoadState.Draft?"CONSTRUCTION [DRAFT]":"CONSTRUCTION"},e.prototype.isLoaded=function(){return this.loadState!==p.EditorLoadState.None},e.prototype.showConfirmation=function(){this.confirmModal.setVisible(!0),this.menuState=o.Confrimation},e.prototype.hideConfirmation=function(){this.menuState===o.Confrimation&&(this.confirmModal.resetSelection(),this.confirmModal.setVisible(!1),this.menuState=o.Navigation,this.root.setNeedsPaint())},e.prototype.showAlert=function(){this.alertModal.setVisible(!0),this.menuState=o.Alert},e.prototype.hideAlert=function(){this.alertModal.setVisible(!1),this.menuState=o.Navigation},e}(c.GameScene);e.EditorMenuScene=h},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(259))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.None=0]="None",t[t.Draft=1]="Draft",t[t.File=2]="File"}(e.EditorLoadState||(e.EditorLoadState={}))},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(261)),i(n(262)),i(n(263)),i(n(280)),i(n(281))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(2),l=n(7),c=n(6),u=n(1),p=n(4),h=n(8),d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.setup=function(t){var e=t.inputHintSettings,n=t.inputManager,i=t.spriteLoader;e.setSeenLevelHint(),this.background=new o.GameObject,this.background.size.copyFrom(this.root.size),this.background.painter=new o.RectPainter(u.COLOR_GRAY),this.root.add(this.background),this.title=new a.SpriteText("CONTROLS",{color:u.COLOR_YELLOW}),this.title.origin.set(.5,.5),this.title.setCenterX(this.root.getSelfCenter().x),this.title.position.setY(64),this.root.add(this.title);var r=c.TankSpriteId.create(c.TankType.PlayerA(),c.TankColor.Primary,s.Rotation.Up);this.tankIcon=new o.GameObject(64,64),this.tankIcon.origin.set(.5,.5),this.tankIcon.setCenterX(this.root.getSelfCenter().x),this.tankIcon.position.setY(302),this.tankIcon.painter=new o.SpritePainter(i.load(r)),this.root.add(this.tankIcon);var p=n.getPresentedControlCode(l.LevelPlayInputContext.MoveUp[0]);this.moveUpHint=new a.SpriteText(p+"\n↑",{alignment:o.TextAlignment.Center}),this.moveUpHint.origin.set(.5,.5),this.moveUpHint.setCenterX(this.root.getSelfCenter().x),this.moveUpHint.position.setY(216),this.root.add(this.moveUpHint);var h=n.getPresentedControlCode(l.LevelPlayInputContext.MoveDown[0]);this.moveDownHint=new a.SpriteText("↓\n"+h,{alignment:o.TextAlignment.Center}),this.moveDownHint.origin.set(.5,.5),this.moveDownHint.setCenterX(this.root.getSelfCenter().x),this.moveDownHint.position.setY(400),this.root.add(this.moveDownHint);var d=n.getPresentedControlCode(l.LevelPlayInputContext.MoveLeft[0]);this.moveLeftHint=new a.SpriteText(d+" ←",{alignment:o.TextAlignment.Right}),this.moveLeftHint.origin.set(1,.5),this.moveLeftHint.position.set(460,305),this.root.add(this.moveLeftHint);var f=n.getPresentedControlCode(l.LevelPlayInputContext.MoveRight[0]);this.moveRightHint=new a.SpriteText("→ "+f,{alignment:o.TextAlignment.Right}),this.moveRightHint.origin.set(0,.5),this.moveRightHint.position.set(560,305),this.root.add(this.moveRightHint);var y=n.getPresentedControlCode(l.LevelPlayInputContext.Fire[0]);this.fireHint=new a.SpriteText("FIRE       - "+y),this.fireHint.position.set(250,550),this.root.add(this.fireHint);var m=n.getPresentedControlCode(l.LevelPlayInputContext.RapidFire[0]);this.rapidFireHint=new a.SpriteText("RAPID FIRE - "+m),this.rapidFireHint.position.set(250,600),this.root.add(this.rapidFireHint);var g=n.getPresentedControlCode(l.LevelPlayInputContext.Pause[0]);this.pauseHint=new a.SpriteText("PAUSE      - "+g),this.pauseHint.position.set(250,650),this.root.add(this.pauseHint);var v=n.getPresentedControlCode(l.LevelHintInputContext.Skip[0]);this.continueHint=new a.InputHint(v+" TO CONTINUE"),this.root.add(this.continueHint)},e.prototype.update=function(e){e.input.isDownAny(l.LevelHintInputContext.Skip)?this.navigator.replace(h.GameSceneType.LevelPlay,this.params):t.prototype.update.call(this,e)},e}(p.GameScene);e.LevelHintScene=d},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=n(0),a=n(2),l=n(4),c=n(8);!function(t){t[t.Navigation=0]="Navigation",t[t.Alert=1]="Alert"}(o||(o={}));var u=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.state=o.Navigation,n.log=new s.Logger(e.name,s.Logger.Level.Warn),n.handleMapLoaded=function(t){n.mapLoader.error.removeListener(n.handleMapLoadError),n.inputHintSettings.shouldShowLevelHint()?n.navigator.replace(c.GameSceneType.LevelHint,{mapConfig:t}):n.navigator.replace(c.GameSceneType.LevelPlay,{mapConfig:t})},n.handleMapLoadError=function(t){n.log.error("Failed to load the map",t),n.mapLoader.loaded.removeListener(n.handleMapLoaded),n.session.isLastLevel()&&n.alertModal.setText("FAILED TO LOAD THE MAP\nNO MAPS LEFT"),n.showAlert()},n.handleAlertAccepted=function(){n.session.isPlaytest()?n.navigator.replace(c.GameSceneType.EditorMenu):n.session.isLastLevel()?n.session.getMaxPoints()>0?n.navigator.replace(c.GameSceneType.MainVictory):n.navigator.replace(c.GameSceneType.MainMenu):(n.session.activateNextLevel(),n.navigator.replace(c.GameSceneType.LevelLoad))},n}return r(e,t),e.prototype.setup=function(t){var e=t.inputHintSettings,n=t.mapLoader,i=t.session;this.inputHintSettings=e,this.session=i;var r=this.session.getLevelNumber();this.curtain=new a.Curtain(this.root.size.width,this.root.size.height,!1),this.root.add(this.curtain),this.title=new a.LevelTitle(r,this.session.isPlaytest()),this.title.setCenter(this.root.getSelfCenter()),this.title.origin.set(.5,.5),this.root.add(this.title),this.alertModal=new a.AlertModal({containerWidth:768,message:"FAILED TO LOAD THE MAP\nTRYING NEXT MAP"}),this.alertModal.size.copyFrom(this.root.size),this.alertModal.setVisible(!1),this.alertModal.accepted.addListener(this.handleAlertAccepted),this.root.add(this.alertModal),this.mapLoader=n,this.mapLoader.loaded.addListenerOnce(this.handleMapLoaded),this.mapLoader.error.addListenerOnce(this.handleMapLoadError),this.mapLoader.loadAsync(r)},e.prototype.update=function(t){var e=this;this.state!==o.Alert?this.root.traverseDescedants((function(n){n===e.alertModal||n.hasParent(e.alertModal)||n.invokeUpdate(t)})):this.alertModal.traverse((function(e){e.invokeUpdate(t)}))},e.prototype.showAlert=function(){this.alertModal.setVisible(!0),this.state=o.Alert},e.prototype.hideAlert=function(){this.alertModal.setVisible(!1),this.state=o.Navigation},e}(l.GameScene);e.LevelLoadScene=u},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(18),s=n(3),a=n(2),l=n(15),c=n(5),u=n(1),p=n(264),h=n(80),d=n(4),f=n(8),y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.allScripts=[],e.alwaysUpdateScripts=[],e.playingUpdateScripts=[],e.handlePlayerDied=function(){e.session.primaryPlayer.removeLife(),e.session.primaryPlayer.isAlive()||(e.session.setGameOver(),e.pauseScript.disable(),e.playerScript.disable(),e.gameOverScript.enable(),e.winScript.disable())},e.handleEnemyAllDied=function(){e.pauseScript.disable(),e.winScript.enable()},e.handleEnemyDied=function(t){e.session.primaryPlayer.addKillPoints(t.type.tier)},e.handlePowerupPicked=function(t){e.session.primaryPlayer.addPowerupPoints(t.type),t.type===l.PowerupType.Life&&e.session.primaryPlayer.addLife()},e.handleBaseDied=function(){e.session.setGameOver(),e.pauseScript.disable(),e.playerScript.disable(),e.gameOverScript.enable(),e.winScript.disable()},e.handleLevelGameOverMoveBlocked=function(){e.inputManager.unlisten()},e.handleLevelGameOverCompleted=function(){e.inputManager.listen(),e.session.isPlaytest()?e.navigator.replace(f.GameSceneType.EditorMenu):e.navigator.replace(f.GameSceneType.LevelScore)},e.handleLevelWinCompleted=function(){e.session.isPlaytest()?e.navigator.replace(f.GameSceneType.EditorMenu):e.navigator.replace(f.GameSceneType.LevelScore)},e}return r(e,t),e.prototype.setup=function(t){var e,n=this,i=t.collisionSystem,r=t.inputManager,s=t.session;this.debugCollisionMenu=new o.DebugCollisionMenu(i,this.root,{top:400}),u.IS_DEV&&(this.debugCollisionMenu.attach(),this.debugCollisionMenu.show()),this.world=new p.LevelWorld(this.root),this.root.add(new a.Border),this.world.field.position.set(u.BORDER_LEFT_WIDTH,u.BORDER_TOP_BOTTOM_HEIGHT),this.root.add(this.world.field),this.eventBus=new p.LevelEventBus,this.inputManager=r,this.session=s;for(var l=this.params.mapConfig,d=l.getTerrainRegions(),f=c.TerrainFactory.createMapFromRegionConfigs(d),y=function(t){t.destroyed.addListener((function(){n.eventBus.mapTileDestroyed.notify({type:t.type,position:t.position.clone(),size:t.size.clone()})}))},m=0,g=f;m<g.length;m++){y(g[m])}(e=this.world.field).add.apply(e,f),this.audioScript=new h.LevelAudioScript,this.baseScript=new h.LevelBaseScript,this.enemyScript=new h.LevelEnemyScript,this.explosionScript=new h.LevelExplosionScript,this.gameOverScript=new h.LevelGameOverScript,this.infoScript=new h.LevelInfoScript,this.introScript=new h.LevelIntroScript,this.pauseScript=new h.LevelPauseScript,this.playerScript=new h.LevelPlayerScript,this.pointsScript=new h.LevelPointsScript,this.powerupScript=new h.LevelPowerupScript,this.spawnScript=new h.LevelSpawnScript,this.winScript=new h.LevelWinScript,this.allScripts=[this.audioScript,this.baseScript,this.enemyScript,this.explosionScript,this.gameOverScript,this.infoScript,this.introScript,this.pauseScript,this.playerScript,this.pointsScript,this.powerupScript,this.spawnScript,this.winScript],this.allScripts.forEach((function(t){t.invokeInit(n.world,n.eventBus,s,l)})),this.alwaysUpdateScripts=[this.audioScript,this.introScript],this.introScript.completed.addListener((function(){n.alwaysUpdateScripts.push(n.gameOverScript,n.pauseScript,n.winScript),n.playingUpdateScripts.push(n.baseScript,n.explosionScript,n.infoScript,n.enemyScript,n.spawnScript,n.playerScript,n.pointsScript,n.powerupScript)})),this.eventBus.baseDied.addListener(this.handleBaseDied),this.eventBus.enemyAllDied.addListener(this.handleEnemyAllDied),this.eventBus.enemyDied.addListener(this.handleEnemyDied),this.eventBus.playerDied.addListener(this.handlePlayerDied),this.eventBus.powerupPicked.addListener(this.handlePowerupPicked),this.eventBus.levelGameOverCompleted.addListener(this.handleLevelGameOverCompleted),this.eventBus.levelGameOverMoveBlocked.addListener(this.handleLevelGameOverMoveBlocked),this.eventBus.levelWinCompleted.addListener(this.handleLevelWinCompleted)},e.prototype.update=function(t){var e=this,n=t.collisionSystem,i=t.gameState;this.alwaysUpdateScripts.forEach((function(e){e.invokeUpdate(t)})),i.is(s.GameState.Paused)||this.playingUpdateScripts.forEach((function(n){e.alwaysUpdateScripts.includes(n)||n.invokeUpdate(t)})),this.root.traverseDescedants((function(e){(i.is(s.GameState.Playing)||e.ignorePause)&&e.invokeUpdate(t)})),this.root.updateWorldMatrix(!1,!0),n.update(),u.IS_DEV&&this.debugCollisionMenu.update(),n.collide()},e}(d.GameScene);e.LevelPlayScene=y},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(80)),i(n(278)),i(n(9)),i(n(279))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,r++)i[r]=o[s];return i};Object.defineProperty(e,"__esModule",{value:!0});var s,a=n(3),l=n(7),c=n(15),u=n(9),p=o(l.LevelPlayInputContext.MoveUp,l.LevelPlayInputContext.MoveDown,l.LevelPlayInputContext.MoveLeft,l.LevelPlayInputContext.MoveRight);!function(t){t[t.Idle=0]="Idle",t[t.Moving=1]="Moving"}(s||(s={}));var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tankState=s.Idle,e.handleBaseDied=function(){e.playerExplosionSound.play()},e.handleEnemyDied=function(){e.audioConttoller.play("explosion.enemy")},e.handlePlayerDied=function(){e.playerExplosionSound.play()},e.handlePlayerFired=function(){e.audioConttoller.play("fire")},e.handlePlayerSlided=function(){e.audioConttoller.play("ice")},e.handlePowerupSpawned=function(){e.audioConttoller.play("powerup.spawn")},e.handlePowerupPicked=function(t){t.type!==c.PowerupType.Life&&e.audioConttoller.play("powerup.pickup")},e.handleSessionLifeup=function(){e.audioConttoller.play("life")},e.handleLevelPaused=function(){e.audioConttoller.pauseAll(),e.pauseSound.play()},e.levelUnpaused=function(){e.audioConttoller.resumeAll()},e.handleLevelGameOverMoveBlocked=function(){e.moveSound.stop(),e.idleSound.stop()},e.handleLevelWinCompleted=function(){e.audioConttoller.stopAll()},e}return r(e,t),e.prototype.setup=function(t){var e=this,n=t.audioManager,i=t.audioLoader;this.audioConttoller=n,this.eventBus.baseDied.addListener(this.handleBaseDied),this.eventBus.enemyDied.addListener(this.handleEnemyDied),this.eventBus.playerDied.addListener(this.handlePlayerDied),this.eventBus.playerFired.addListener(this.handlePlayerFired),this.eventBus.playerSlided.addListener(this.handlePlayerSlided),this.eventBus.powerupSpawned.addListener(this.handlePowerupSpawned),this.eventBus.powerupPicked.addListener(this.handlePowerupPicked),this.eventBus.levelPaused.addListener(this.handleLevelPaused),this.eventBus.levelUnpaused.addListener(this.levelUnpaused),this.eventBus.levelGameOverMoveBlocked.addListener(this.handleLevelGameOverMoveBlocked),this.eventBus.levelWinCompleted.addListener(this.handleLevelWinCompleted),this.session.primaryPlayer.lifeup.addListener(this.handleSessionLifeup),this.moveSound=i.load("tank.move"),this.idleSound=i.load("tank.idle"),this.pauseSound=i.load("pause"),this.playerExplosionSound=i.load("explosion.player");var r=i.load("level-intro");r.ended.addListener((function(){e.audioConttoller.unmuteAll()})),r.play(),this.audioConttoller.muteAllExcept(r,this.pauseSound,this.playerExplosionSound),this.idleSound.playLoop()},e.prototype.update=function(t){var e=t.gameState,n=t.input;e.is(a.GameState.Paused)||(n.isHoldAny(p)&&this.tankState!==s.Moving&&(this.tankState=s.Moving,this.idleSound.stop(),this.moveSound.playLoop()),n.isNotHoldAll(p)&&this.tankState!==s.Idle&&(this.tankState=s.Idle,this.moveSound.stop(),this.idleSound.playLoop()))},e}(u.LevelScript);e.LevelAudioScript=h},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),s=n(15),a=n(1),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handlePowerupPicked=function(t){t.type===s.PowerupType.BaseDefence&&e.base.activateDefence(a.BASE_DEFENCE_POWERUP_DURATION)},e}return r(e,t),e.prototype.setup=function(){var t=this;this.eventBus.powerupPicked.addListener(this.handlePowerupPicked),this.base=new o.Base,this.base.position.set(a.BASE_DEFAULT_POSITION.x,a.BASE_DEFAULT_POSITION.y),this.base.died.addListener((function(){t.eventBus.baseDied.notify(null)})),this.world.field.add(this.base)},e}(n(9).LevelScript);e.LevelBaseScript=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(15),l=n(6),c=n(1),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.list=[],e.listIndex=0,e.aliveTanks=[],e.positions=[],e.positionIndex=0,e.spawnTimer=new o.Timer,e.freezeTimer=new o.Timer,e.spawningCount=0,e.handleSpawnTimer=function(){e.aliveTanks.length>=c.ENEMY_MAX_ALIVE_COUNT||e.listIndex>=e.list.length?e.spawnTimer.stop():(e.requestSpawn(),e.spawnTimer.reset(c.ENEMY_SPAWN_DELAY))},e.handleSpawnCompleted=function(t){e.spawningCount-=1;var n=t.type;if(n.party===l.TankParty.Enemy){var i=l.TankFactory.createEnemy(n);i.updateMatrix(),i.rotate(s.Rotation.Down),i.setCenter(t.centerPosition),i.updateMatrix(),e.freezeTimer.isActive()&&i.freezeState.set(!0),i.hit.addListener((function(){e.eventBus.enemyHit.notify({type:i.type})})),i.died.addListener((function(t){e.eventBus.enemyDied.notify({type:i.type,centerPosition:i.getCenter(),reason:t.reason}),i.removeSelf(),e.aliveTanks=e.aliveTanks.filter((function(t){return t!==i})),e.spawnTimer.isActive()||e.spawnTimer.reset(c.ENEMY_SPAWN_DELAY),e.areAllDead()&&e.eventBus.enemyAllDied.notify(null)})),e.aliveTanks.push(i),e.world.field.add(i)}},e.handleFreezeTimer=function(){e.aliveTanks.forEach((function(t){t.freezeState.set(!1)}))},e.handlePowerupPicked=function(t){var n=t.type;n===a.PowerupType.Freeze&&(e.freezeTimer.reset(c.FREEZE_POWERUP_DURATION),e.aliveTanks.forEach((function(t){t.freezeState.set(!0)}))),n===a.PowerupType.Wipeout&&e.aliveTanks.forEach((function(t){t.discardDrop(),t.die(l.TankDeathReason.WipeoutPowerup)}))},e}return r(e,t),e.prototype.setup=function(){this.eventBus.enemySpawnCompleted.addListener(this.handleSpawnCompleted),this.eventBus.powerupPicked.addListener(this.handlePowerupPicked),this.list=this.mapConfig.getEnemySpawnList(),this.positions=this.mapConfig.getEnemySpawnPositions(),this.spawnTimer.reset(c.ENEMY_FIRST_SPAWN_DELAY),this.spawnTimer.done.addListener(this.handleSpawnTimer),this.freezeTimer.done.addListener(this.handleFreezeTimer)},e.prototype.update=function(t){var e=t.deltaTime;this.spawnTimer.update(e),this.freezeTimer.update(e)},e.prototype.requestSpawn=function(){this.spawningCount+=1;var t=this.list[this.listIndex],e=this.positions[this.positionIndex];this.listIndex+=1,this.positionIndex+=1,this.positionIndex>=this.positions.length&&(this.positionIndex=0);var n=this.getUnspawnedCount();this.eventBus.enemySpawnRequested.notify({type:t,position:e,unspawnedCount:n})},e.prototype.getUnspawnedCount=function(){return this.list.length-this.listIndex},e.prototype.areAllDead=function(){var t=this.spawningCount,e=this.getUnspawnedCount(),n=this.aliveTanks.length;return 0===t&&0===e&&0===n},e}(n(9).LevelScript);e.LevelEnemyScript=u},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handleEnemyDied=function(t){var n=new o.Explosion;n.updateMatrix(),n.setCenter(t.centerPosition),n.completed.addListener((function(){e.eventBus.enemyExploded.notify(t)})),e.world.field.add(n)},e.handlePlayerDied=function(t){var n=new o.Explosion;n.updateMatrix(),n.setCenter(t.centerPosition),e.world.field.add(n)},e}return r(e,t),e.prototype.setup=function(){this.eventBus.enemyDied.addListener(this.handleEnemyDied),this.eventBus.playerDied.addListener(this.handlePlayerDied)},e}(n(9).LevelScript);e.LevelExplosionScript=s},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(2),a=n(9),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.enabled=!1,e.moveBlockTimer=new o.Timer,e.totalTimer=new o.Timer,e.handleMoveBlockTimer=function(){e.eventBus.levelGameOverMoveBlocked.notify(null)},e.handleTotalTimer=function(){e.eventBus.levelGameOverCompleted.notify(null)},e}return r(e,t),e.prototype.setup=function(){this.notice=new s.GameOverNotice,this.notice.updateMatrix(),this.notice.setCenterX(this.world.field.getSelfCenter().x),this.notice.position.y=this.world.field.size.height+100,this.world.field.add(this.notice),this.moveBlockTimer.reset(1),this.moveBlockTimer.done.addListener(this.handleMoveBlockTimer),this.totalTimer.reset(5),this.totalTimer.done.addListener(this.handleTotalTimer)},e.prototype.update=function(t){var e=t.deltaTime;this.notice.dirtyPaintBox(),this.notice.position.y-=200*e,this.notice.position.y<=360&&(this.notice.position.y=360),this.notice.updateMatrix(),this.moveBlockTimer.update(e),this.totalTimer.update(e)},e}(a.LevelScript);e.LevelGameOverScript=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),s=n(1),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handlePlayerDied=function(){e.info.setLivesCount(e.session.primaryPlayer.getLivesCount())},e.handleEnemySpawnRequested=function(t){e.info.setEnemyCount(t.unspawnedCount)},e.handleSessionLifeup=function(){e.info.setLivesCount(e.session.primaryPlayer.getLivesCount())},e}return r(e,t),e.prototype.setup=function(){this.eventBus.playerDied.addListener(this.handlePlayerDied),this.eventBus.enemySpawnRequested.addListener(this.handleEnemySpawnRequested),this.session.primaryPlayer.lifeup.addListener(this.handleSessionLifeup),this.info=new o.LevelInfo,this.info.position.set(s.BORDER_LEFT_WIDTH+s.FIELD_SIZE+32,s.BORDER_TOP_BOTTOM_HEIGHT+32),this.world.sceneRoot.add(this.info),this.info.setLivesCount(this.session.primaryPlayer.getLivesCount()),this.info.setLevelNumber(this.session.getLevelNumber())},e}(n(9).LevelScript);e.LevelInfoScript=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(2),a=n(1),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.completed=new o.Subject,e.handleTimer=function(){e.curtain.open(),e.title.setVisible(!1),e.completed.notify(null)},e}return r(e,t),e.prototype.setup=function(){this.timer=new o.Timer(a.LEVEL_START_DELAY),this.timer.done.addListener(this.handleTimer),this.curtain=new s.Curtain(this.world.sceneRoot.size.width,this.world.sceneRoot.size.height,!1),this.world.sceneRoot.add(this.curtain),this.title=new s.LevelTitle(this.session.getLevelNumber(),this.session.isPlaytest()),this.title.setCenter(this.world.sceneRoot.getSelfCenter()),this.title.origin.set(.5,.5),this.world.sceneRoot.add(this.title)},e.prototype.update=function(t){var e=t.deltaTime;this.timer.update(e)},e}(n(9).LevelScript);e.LevelIntroScript=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=n(2),a=n(7),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.setup=function(){this.notice=new s.PauseNotice,this.notice.updateMatrix(),this.notice.setCenter(this.world.field.getSelfCenter()),this.notice.position.y+=18,this.notice.setVisible(!1),this.world.field.add(this.notice)},e.prototype.update=function(t){var e=t.gameState;t.input.isDownAny(a.LevelPlayInputContext.Pause)&&(e.is(o.GameState.Playing)?(e.set(o.GameState.Paused),this.activate()):(e.set(o.GameState.Playing),this.deactivate()))},e.prototype.activate=function(){this.notice.setVisible(!0),this.notice.restart(),this.eventBus.levelPaused.notify(null)},e.prototype.deactivate=function(){this.notice.dirtyPaintBox(),this.notice.setVisible(!1),this.eventBus.levelUnpaused.notify(null)},e}(n(9).LevelScript);e.LevelPauseScript=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(18),a=n(15),l=n(6),c=n(1),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.playerIndex=0,e.tank=null,e.handleTimer=function(){var t=e.position,n=l.TankFactory.createPlayerType();e.eventBus.playerSpawnRequested.notify({type:n,position:t})},e.handleSpawnCompleted=function(t){if(t.type.party===l.TankParty.Player){var n=l.TankFactory.createPlayer();if(n.updateMatrix(),n.setCenter(t.centerPosition),n.updateMatrix(),n.activateShield(c.SHIELD_SPAWN_DURATION),e.session.primaryPlayer.isLevelFirstSpawn()){var i=e.session.primaryPlayer.getTankTier();n.upgrade(i,!1)}n.died.addListener((function(){e.eventBus.playerDied.notify({type:t.type,centerPosition:n.getCenter()}),n.removeSelf(),e.tank=null,e.world.removePlayerTank(),e.timer.reset(c.PLAYER_SPAWN_DELAY),e.session.primaryPlayer.resetTankTier()})),n.fired.addListener((function(){e.eventBus.playerFired.notify(null)})),n.upgraded.addListener((function(t){e.session.primaryPlayer.setTankTier(t.tier)})),n.slided.addListener((function(){e.eventBus.playerSlided.notify(null)})),e.session.primaryPlayer.setLevelSpawned(),e.tank=n,e.world.addPlayerTank(e.tank)}},e.handlePowerupPicked=function(t){var n=t.type;n===a.PowerupType.Shield&&e.tank.activateShield(c.SHIELD_POWERUP_DURATION),n===a.PowerupType.Upgrade&&e.tank.upgrade()},e.handleLevelGameOverMoveBlocked=function(){null!==e.tank&&e.tank.freezeState.set(!0)},e}return r(e,t),e.prototype.setup=function(){var t=this;if(this.eventBus.playerSpawnCompleted.addListener(this.handleSpawnCompleted),this.eventBus.powerupPicked.addListener(this.handlePowerupPicked),this.eventBus.levelGameOverMoveBlocked.addListener(this.handleLevelGameOverMoveBlocked),this.position=this.mapConfig.getPlayerSpawnPosition(this.playerIndex),this.timer=new o.Timer(c.PLAYER_FIRST_SPAWN_DELAY),this.timer.done.addListener(this.handleTimer),c.IS_DEV){var e=new s.DebugLevelPlayerMenu({top:270});e.attach(),e.upgradeRequest.addListener((function(){null!==t.tank&&t.tank.upgrade()})),e.deathRequest.addListener((function(){null!==t.tank&&t.tank.die()})),e.moveSpeedUpRequest.addListener((function(e){null!==t.tank&&(t.tank.attributes.moveSpeed+=e)}))}},e.prototype.update=function(t){var e=t.deltaTime;this.timer.update(e)},e}(n(9).LevelScript);e.LevelPlayerScript=u},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),s=n(33),a=n(6),l=n(1),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handleEnemyExploded=function(t){if(t.reason!==a.TankDeathReason.WipeoutPowerup){var n=e.getEnemyTankPointsValue(t.type),i=new o.Points(n,l.POINTS_ENEMY_TANK_DURATION);i.updateMatrix(),i.setCenter(t.centerPosition),e.world.field.add(i)}},e.handlePowerupPicked=function(t){var n=new o.Points(s.PointsValue.V500,l.POINTS_POWERUP_DURATION);n.updateMatrix(),n.setCenter(t.centerPosition),e.world.field.add(n)},e}return r(e,t),e.prototype.setup=function(){this.eventBus.enemyExploded.addListener(this.handleEnemyExploded),this.eventBus.powerupPicked.addListener(this.handlePowerupPicked)},e.prototype.getEnemyTankPointsValue=function(t){switch(t.tier){case a.TankTier.A:return s.PointsValue.V100;case a.TankTier.B:return s.PointsValue.V200;case a.TankTier.C:return s.PointsValue.V300;case a.TankTier.D:return s.PointsValue.V400;default:return 0}},e}(n(9).LevelScript);e.LevelPointsScript=c},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(18),a=n(15),l=n(5),c=n(1),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.activePowerup=null,e.handleEnemyHit=function(t){t.type.hasDrop&&e.spawn()},e.handleEnemySpawnCompleted=function(t){t.type.hasDrop&&e.revoke()},e.handleTimer=function(){e.revoke()},e.handleMapTileDestroyed=function(t){var n=t.type,i=t.position,r=t.size;if(n===l.TerrainType.Steel){var s=new o.Rect(i.x,i.y,r.width,r.height);e.grid.freeRect(s)}},e}return r(e,t),e.prototype.setup=function(){var t=this;if(this.eventBus.enemyHit.addListener(this.handleEnemyHit),this.eventBus.enemySpawnCompleted.addListener(this.handleEnemySpawnCompleted),this.eventBus.mapTileDestroyed.addListener(this.handleMapTileDestroyed),this.timer=new o.Timer,this.timer.done.addListener(this.handleTimer),this.grid=new a.PowerupGrid,this.blockGridDefaults(),this.blockGridInitialMap(),c.IS_DEV){var e=new s.DebugLevelPowerupMenu(this.world,this.grid,{top:125});e.attach(),e.spawnRequest.addListener((function(e){t.spawn(e)}))}},e.prototype.update=function(t){var e=t.deltaTime;this.timer.update(e)},e.prototype.spawn=function(t){var e=this;void 0===t&&(t=null),this.revoke();var n=null!==t?a.PowerupFactory.create(t):a.PowerupFactory.createRandom(),i=this.createPlayerTankRect();null!==i&&(this.grid.backup(),this.grid.blockRect(i));var r=this.grid.getRandomPosition();if(null!==i&&this.grid.restore(),null!==r)n.position.copyFrom(r),n.picked.addListener((function(){e.eventBus.powerupPicked.notify({type:n.type,centerPosition:n.getCenter()})})),this.timer.reset(c.POWERUP_DURATION),this.activePowerup=n,this.world.field.add(n),this.eventBus.powerupSpawned.notify({type:n.type,position:r});else{var o=null!=i?i:this.createBaseRect();this.eventBus.powerupPicked.notify({type:n.type,centerPosition:o.getCenter()})}},e.prototype.revoke=function(){null!==this.activePowerup&&(this.activePowerup.destroy(),this.activePowerup=null,this.eventBus.powerupRevoked.notify(null))},e.prototype.createBaseRect=function(){return new o.Rect(c.BASE_DEFAULT_POSITION.x,c.BASE_DEFAULT_POSITION.y,c.BASE_DEFAULT_SIZE.width,c.BASE_DEFAULT_SIZE.height)},e.prototype.createPlayerTankRect=function(){var t=this.world.getPlayerTank();if(null===t)return null;var e=c.TILE_SIZE_LARGE;return new o.Rect(t.position.x-e,t.position.y-e,t.size.width+2*e,t.size.height+2*e)},e.prototype.blockGridDefaults=function(){var t=this;this.grid.blockRect(this.createBaseRect());var e=this.mapConfig.getPlayerSpawnPosition(0);this.grid.blockRect(new o.Rect(e.x,e.y,64,64)),this.mapConfig.getEnemySpawnPositions().forEach((function(e){t.grid.blockRect(new o.Rect(e.x,e.y,64,64))}))},e.prototype.blockGridInitialMap=function(){var t=this,e=[l.TerrainType.Steel,l.TerrainType.Water];this.mapConfig.getTerrainRegions().forEach((function(n){e.includes(n.type)&&t.grid.blockRect(new o.Rect(n.x,n.y,n.width,n.height))}))},e}(n(9).LevelScript);e.LevelPowerupScript=u},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handleEnemySpawnRequested=function(t){var n=new o.Spawn;n.position.copyFrom(t.position),n.updateMatrix(),n.completed.addListenerOnce((function(){e.eventBus.enemySpawnCompleted.notify({type:t.type,centerPosition:n.getCenter()}),n.removeSelf()})),e.world.field.add(n)},e.handlePlayerSpawnRequested=function(t){var n=new o.Spawn;n.position.copyFrom(t.position),n.updateMatrix(),n.completed.addListenerOnce((function(){e.eventBus.playerSpawnCompleted.notify({type:t.type,centerPosition:n.getCenter()}),n.removeSelf()})),e.world.field.add(n)},e}return r(e,t),e.prototype.setup=function(){this.eventBus.enemySpawnRequested.addListener(this.handleEnemySpawnRequested),this.eventBus.playerSpawnRequested.addListener(this.handlePlayerSpawnRequested)},e}(n(9).LevelScript);e.LevelSpawnScript=s},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(9),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.enabled=!1,e.timer=new o.Timer,e.handleTimer=function(){e.eventBus.levelWinCompleted.notify(null)},e}return r(e,t),e.prototype.setup=function(){this.timer.reset(3),this.timer.done.addListener(this.handleTimer)},e.prototype.update=function(t){this.timer.update(t.deltaTime)},e}(s.LevelScript);e.LevelWinScript=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=function(){this.baseDied=new i.Subject,this.enemyAllDied=new i.Subject,this.enemyDied=new i.Subject,this.enemyExploded=new i.Subject,this.enemyHit=new i.Subject,this.enemySpawnCompleted=new i.Subject,this.enemySpawnRequested=new i.Subject,this.mapTileDestroyed=new i.Subject,this.levelPaused=new i.Subject,this.levelUnpaused=new i.Subject,this.levelGameOverMoveBlocked=new i.Subject,this.levelGameOverCompleted=new i.Subject,this.levelWinCompleted=new i.Subject,this.playerDied=new i.Subject,this.playerFired=new i.Subject,this.playerSlided=new i.Subject,this.playerSpawnCompleted=new i.Subject,this.playerSpawnRequested=new i.Subject,this.powerupSpawned=new i.Subject,this.powerupPicked=new i.Subject,this.powerupRevoked=new i.Subject};e.LevelEventBus=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=function(){function t(t){this.playerTank=null,this.sceneRoot=t,this.field=new i.Field}return t.prototype.addPlayerTank=function(t){this.playerTank=t,this.field.add(t)},t.prototype.removePlayerTank=function(){null!==this.playerTank&&(this.playerTank.removeSelf(),this.playerTank=null)},t.prototype.getPlayerTank=function(){return this.playerTank},t}();e.LevelWorld=r},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=n(0),a=n(2),l=n(7),c=n(1),u=n(4),p=n(8);!function(t){t[t.Idle=0]="Idle",t[t.Counting=1]="Counting",t[t.Post=2]="Post"}(o||(o={}));var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.postTimer=new s.Timer,e.state=o.Idle,e.handleDone=function(){e.state=o.Post,e.postTimer.reset(3)},e.handlePost=function(){e.finish()},e}return r(e,t),e.prototype.setup=function(t){var e=t.pointsHighscoreManager,n=t.session;this.pointsHighscoreManager=e,this.session=n,this.root.painter=new s.RectPainter(c.COLOR_BLACK),this.highscoreTitle=new a.SpriteText("HI-SCORE",{color:c.COLOR_RED}),this.highscoreTitle.position.set(256,64),this.root.add(this.highscoreTitle),this.highscorePoints=new a.SpriteText(this.getCommonHighscoreText(),{color:c.COLOR_YELLOW}),this.highscorePoints.origin.setX(1),this.highscorePoints.position.set(768,64),this.root.add(this.highscorePoints),this.levelTitle=new a.LevelTitle(this.session.getLevelNumber(),this.session.isPlaytest(),{color:c.COLOR_WHITE}),this.levelTitle.origin.set(.5,0),this.levelTitle.setCenter(this.root.getSelfCenter()),this.levelTitle.position.setY(128),this.root.add(this.levelTitle);var i=this.session.primaryPlayer.getLevelPointsRecord();this.scoreTable=new a.ScoreTable(i),this.scoreTable.updateMatrix(),this.scoreTable.setCenter(this.root.getSelfCenter()),this.scoreTable.done.addListener(this.handleDone),this.root.add(this.scoreTable),this.postTimer.done.addListener(this.handlePost),this.state=o.Counting,this.scoreTable.start()},e.prototype.update=function(e){var n=e.deltaTime;if(e.input.isDownAny(l.LevelScoreInputContext.Skip)){if(this.state===o.Counting)return void this.scoreTable.skip();if(this.state===o.Post)return void this.finish()}this.state!==o.Post?t.prototype.update.call(this,e):this.postTimer.update(n)},e.prototype.getCommonHighscoreText=function(){return this.pointsHighscoreManager.getOverallMaxPoints().toString().padStart(6," ")},e.prototype.finish=function(){this.session.isGameOver()?this.navigator.replace(p.GameSceneType.MainGameOver):this.session.isLastLevel()?this.navigator.replace(p.GameSceneType.MainVictory):(this.session.activateNextLevel(),this.navigator.replace(p.GameSceneType.LevelLoad))},e}(u.GameScene);e.LevelScoreScene=h},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),s=n(7),a=n(4),l=n(8),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handleLevelSelected=function(t){var n=t,i=e.mapLoader.getItemsCount();e.session.start(n,i),e.navigator.replace(l.GameSceneType.LevelLoad)},e}return r(e,t),e.prototype.setup=function(t){var e=t.inputManager,n=t.mapLoader,i=t.session;this.session=i,this.mapLoader=n,this.curtain=new o.Curtain(this.root.size.width,this.root.size.height),this.root.add(this.curtain),this.selector=new o.LevelSelector(this.mapLoader.getItemsCount(),this.session.isPlaytest()),this.selector.setCenter(this.root.getSelfCenter()),this.selector.selected.addListener(this.handleLevelSelected),this.root.add(this.selector);var r=e.getPresentedControlCode(s.LevelSelectionInputContext.Select[0]);this.continueHint=new o.InputHint(r+" TO SELECT"),this.root.add(this.continueHint),this.curtain.close()},e}(a.GameScene);e.LevelSelectionScene=c},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(283)),i(n(284)),i(n(285)),i(n(286)),i(n(287))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),s=n(1),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handleGithubSelected=function(){e.openURL(s.GITHUB_URL)},e.handleBackSelected=function(){e.navigator.back()},e}return r(e,t),e.prototype.setup=function(){this.title=new o.SceneMenuTitle("ABOUT"),this.root.add(this.title),this.description=new o.MenuDescription("SELF-EDUCATIONAL CLONE OF\nBATTLE CITY BY NAMCO (1985)"),this.description.position.set(16,180),this.root.add(this.description),this.githubItem=new o.TextMenuItem("GITHUB"),this.githubItem.selected.addListener(this.handleGithubSelected),this.backItem=new o.TextMenuItem("BACK"),this.backItem.selected.addListener(this.handleBackSelected);var t=[this.githubItem,this.backItem];this.menu=new o.SceneMenu,this.menu.position.addY(164),this.menu.setItems(t),this.root.add(this.menu)},e.prototype.openURL=function(t){var e=document.createElement("a");e.setAttribute("href",t),e.setAttribute("target","_blank"),e.click()},e}(n(4).GameScene);e.MainAboutScene=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(2),a=n(7),l=n(4),c=n(8),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.heading=new s.GameOverHeading,e.timer=new o.Timer(3),e.handleDone=function(){e.finish()},e}return r(e,t),e.prototype.setup=function(t){var e=t.audioManager;this.audioManager=e,this.timer.done.addListener(this.handleDone),this.heading.origin.set(.5,.5),this.heading.setCenter(this.root.getSelfCenter()),this.heading.position.addY(-32),this.root.add(this.heading),this.audioManager.play("game-over")},e.prototype.update=function(e){e.input.isDownAny(a.MenuInputContext.Skip)?this.finish():(t.prototype.update.call(this,e),this.timer.update(e.deltaTime))},e.prototype.finish=function(){this.audioManager.stopAll(),this.navigator.clearAndPush(c.GameSceneType.MainHighscore)},e}(l.GameScene);e.MainGameOverScene=u},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),s=n(4),a=n(8),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handleEnded=function(){e.navigator.clearAndPush(a.GameSceneType.MainMenu)},e}return r(e,t),e.prototype.setup=function(t){var e=t.audioLoader,n=t.pointsHighscoreManager,i=t.session,r=i.primaryPlayer.getTotalPoints(),s=i.secondaryPlayer.getTotalPoints(),l=Math.max(r,s),c=n.getPrimaryPoints(),u=n.getSecondaryPoints(),p=n.getOverallMaxPoints();if(i.reset(),i.primaryPlayer.setLastPoints(r),i.secondaryPlayer.setLastPoints(s),r>c&&n.savePrimaryPoints(r),s>u&&n.saveSecondaryPoints(s),l<=p)this.navigator.clearAndPush(a.GameSceneType.MainMenu);else{this.heading=new o.HighscoreHeading(l),this.heading.origin.set(.5,.5),this.heading.setCenter(this.root.getSelfCenter()),this.heading.position.addY(-96),this.root.add(this.heading);var h=e.load("highscore");h.ended.addListener(this.handleEnded),h.play()}},e}(s.GameScene);e.MainHighscoreScene=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o,s=n(0),a=n(2),l=n(7),c=n(1),u=n(4),p=n(8);!function(t){t[t.Sliding=0]="Sliding",t[t.Ready=1]="Ready"}(o||(o={}));var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.state=o.Ready,e.handleSinglePlayerSelected=function(){e.navigator.replace(p.GameSceneType.LevelSelection)},e.handleModesSelected=function(){e.navigator.push(p.GameSceneType.ModesMenu)},e.handleEditorSelected=function(){e.navigator.push(p.GameSceneType.EditorMenu)},e.handleSettingsSelected=function(){e.navigator.push(p.GameSceneType.SettingsMenu)},e.handleAboutSelected=function(){e.navigator.push(p.GameSceneType.MainAbout)},e}return r(e,t),e.prototype.setup=function(t){var e=t.mapLoader,n=t.pointsHighscoreManager,i=t.session;this.session=i,this.pointsHighscoreManager=n,e.restoreDefaultReader(),this.group=new s.GameObject,this.group.size.copyFrom(this.root.size),this.primaryPoints=new a.SpriteText(this.getPrimaryPointsText(),{color:c.COLOR_WHITE}),this.primaryPoints.position.set(92,64),this.group.add(this.primaryPoints),this.commonHighscore=new a.SpriteText(this.getCommonHighscoreText(),{color:c.COLOR_WHITE}),this.commonHighscore.position.set(380,64),this.group.add(this.commonHighscore),this.heading=new a.MainHeading,this.heading.origin.setX(.5),this.heading.setCenter(this.root.getSelfCenter()),this.heading.position.setY(160),this.group.add(this.heading),this.singlePlayerItem=new a.TextMenuItem("1 PLAYER"),this.singlePlayerItem.selected.addListener(this.handleSinglePlayerSelected),this.modesItem=new a.TextMenuItem("MODES"),this.modesItem.selected.addListener(this.handleModesSelected),this.editorItem=new a.TextMenuItem("CONSTRUCTION"),this.editorItem.selected.addListener(this.handleEditorSelected),this.settingsItem=new a.TextMenuItem("SETTINGS"),this.settingsItem.selected.addListener(this.handleSettingsSelected),this.aboutItem=new a.TextMenuItem("ABOUT"),this.aboutItem.selected.addListener(this.handleAboutSelected);var r=[this.singlePlayerItem,this.modesItem,this.editorItem,this.settingsItem,this.aboutItem];this.menu=new a.Menu,this.menu.setItems(r),this.menu.setCenter(this.root.getSelfCenter()),this.menu.position.setY(512),this.group.add(this.menu),this.session.haveSeenIntro()||(this.state=o.Sliding,this.group.position.setY(this.root.size.height),this.menu.hideCursor()),this.root.add(this.group)},e.prototype.update=function(e){var n=e.deltaTime,i=e.input;if(this.state===o.Sliding){var r=this.group.position.y-240*n;r<=0&&(r=0),i.isDownAny(l.MenuInputContext.Skip)&&(r=0);var s=0===r;return this.group.dirtyPaintBox(),this.group.position.setY(r),this.group.updateMatrix(!0),void(s?(this.state=o.Ready,this.menu.showCursor(),this.session.setSeenIntro(!0)):t.prototype.update.call(this,e))}t.prototype.update.call(this,e)},e.prototype.getPrimaryPointsText=function(){var t=this.session.primaryPlayer.getLastPoints();return"Ⅰ-"+(t>0?t.toString():"00").padStart(6," ")},e.prototype.getCommonHighscoreText=function(){return"HI-"+this.pointsHighscoreManager.getOverallMaxPoints().toString().padStart(6," ")},e}(u.GameScene);e.MainMenuScene=h},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),s=n(7),a=n(6),l=n(4),c=n(8),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.victoryPlays=0,e.handleStopped=function(){e.audioManager.stop("tank.move")},e.handleTankFired=function(){e.audioManager.play("fire")},e.handleTileDestroyed=function(){e.audioManager.play("explosion.enemy")},e.handleMapDestroyed=function(){e.victorySound.play(),e.victoryPlays+=1,e.root.add(e.heading)},e.handleVictorySoundEnded=function(){e.victoryPlays>=3?e.finish():(e.victorySound.play(),e.victoryPlays+=1)},e}return r(e,t),e.prototype.setup=function(t){var e=t.audioManager,n=t.audioLoader;this.audioManager=e,this.victorySound=n.load("victory"),this.victorySound.ended.addListener(this.handleVictorySoundEnded),this.map=new o.VictoryMap,this.map.tileDestroyed.addListener(this.handleTileDestroyed),this.map.destroyed.addListener(this.handleMapDestroyed),this.root.add(this.map),this.heading=new o.VictoryHeading,this.heading.updateMatrix(),this.heading.origin.set(.5,.5),this.heading.setCenterX(this.root.getSelfCenter().x),this.heading.position.setY(256),this.behavior=new a.VictoryTankBehavior,this.behavior.stopped.addListener(this.handleStopped),this.tank=a.TankFactory.createPlayer(a.TankType.PlayerA(),this.behavior),this.tank.updateMatrix(),this.tank.setCenterX(this.root.getSelfCenter().x),this.tank.position.setY(this.root.size.height+300),this.tank.fired.addListener(this.handleTankFired),this.root.add(this.tank),this.audioManager.playLoop("tank.move")},e.prototype.update=function(e){var n=e.collisionSystem;e.input.isDownAny(s.MenuInputContext.Skip)?this.finish():(t.prototype.update.call(this,e),this.root.updateWorldMatrix(!1,!0),n.update(),n.collide(),this.root.setNeedsPaint())},e.prototype.finish=function(){this.audioManager.stopAll(),this.navigator.clearAndPush(c.GameSceneType.MainHighscore)},e}(l.GameScene);e.MainVictoryScene=u},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(289)),i(n(290))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(2),a=n(42),l=n(4),c=n(8),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fileMapListReader=null,e.handleLoadSelected=function(){var t=new o.FileOpener;t.opened.addListener((function(t){e.fileMapListReader=new a.FileMapListReader(t),e.updateMenu()})),t.openDialog()},e.handlePlaySelected=function(){e.mapLoader.setListReader(e.fileMapListReader),e.navigator.replace(c.GameSceneType.LevelSelection)},e.handleBackSelected=function(){e.mapLoader.restoreDefaultReader(),e.navigator.back()},e}return r(e,t),e.prototype.setup=function(t){var e=t.mapLoader;this.mapLoader=e,this.title=new s.SceneMenuTitle("MODES → CUSTOM MAPS"),this.root.add(this.title),this.description=new s.MenuDescription("LOAD YOUR OWN LIST OF MAPS \nFROM CONSTRUCTION JSON FILES"),this.description.position.set(16,180),this.root.add(this.description),this.loadItem=new s.TextMenuItem("LOAD"),this.loadItem.selected.addListener(this.handleLoadSelected),this.playItem=new s.TextMenuItem("PLAY"),this.playItem.selected.addListener(this.handlePlaySelected),this.playItem.setFocusable(!1),this.backItem=new s.TextMenuItem("BACK"),this.backItem.selected.addListener(this.handleBackSelected);var n=new s.DividerMenuItem,i=[this.loadItem,this.playItem,n,this.backItem];this.menu=new s.SceneMenu,this.menu.position.addY(164),this.menu.setItems(i),this.root.add(this.menu)},e.prototype.updateMenu=function(){this.playItem.setFocusable(this.canPlay())},e.prototype.canPlay=function(){return null!==this.fileMapListReader},e}(l.GameScene);e.ModesCustomScene=u},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),s=n(4),a=n(8),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handleCustomSelected=function(){e.navigator.push(a.GameSceneType.ModesCustom)},e.handleBackSelected=function(){e.navigator.back()},e}return r(e,t),e.prototype.setup=function(){this.title=new o.SceneMenuTitle("MODES"),this.root.add(this.title),this.customItem=new o.TextMenuItem("CUSTOM MAPS"),this.customItem.selected.addListener(this.handleCustomSelected),this.backItem=new o.TextMenuItem("BACK"),this.backItem.selected.addListener(this.handleBackSelected);var t=[this.customItem,this.backItem];this.menu=new o.SceneMenu,this.menu.setItems(t),this.root.add(this.menu)},e}(s.GameScene);e.ModesMenuScene=l},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(292)),i(n(293)),i(n(294)),i(n(295))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handleMuteSelected=function(){var t=!e.audioManager.isGlobalMuted();e.audioManager.setGlobalMuted(t),e.audioManager.saveSettings(),e.muteItem.setText(e.getMuteText())},e.handleBackSelected=function(){e.navigator.back()},e}return r(e,t),e.prototype.setup=function(t){var e=t.audioManager;this.audioManager=e,this.title=new o.SceneMenuTitle("SETTINGS → AUDIO"),this.root.add(this.title),this.muteItem=new o.TextMenuItem(this.getMuteText()),this.muteItem.selected.addListener(this.handleMuteSelected),this.backItem=new o.TextMenuItem("BACK"),this.backItem.selected.addListener(this.handleBackSelected);var n=[this.muteItem,this.backItem];this.menu=new o.SceneMenu,this.menu.setItems(n),this.root.add(this.menu)},e.prototype.getMuteText=function(){return"MUTE ["+(this.audioManager.isGlobalMuted()?"+":" ")+"]"},e}(n(4).GameScene);e.SettingsAudioScene=s},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handleLevelControlsHintSelected=function(){var t=!e.inputHintSettings.getShowLevelHint();e.inputHintSettings.setShowLevelHint(t),e.levelControlsHintItem.setText(e.getLevelControlsHintText())},e.handleEditorControlsHintSelected=function(){var t=!e.inputHintSettings.getShowEditorHint();e.inputHintSettings.setShowEditorHint(t),e.editorControlsHintItem.setText(e.getEditorControlsHintText())},e.handleBackSelected=function(){e.navigator.back()},e}return r(e,t),e.prototype.setup=function(t){var e=t.audioManager,n=t.inputHintSettings;this.audioManager=e,this.inputHintSettings=n,this.title=new o.SceneMenuTitle("SETTINGS → INTERFACE"),this.root.add(this.title),this.levelControlsHintItem=new o.TextMenuItem(this.getLevelControlsHintText()),this.levelControlsHintItem.selected.addListener(this.handleLevelControlsHintSelected),this.editorControlsHintItem=new o.TextMenuItem(this.getEditorControlsHintText()),this.editorControlsHintItem.selected.addListener(this.handleEditorControlsHintSelected),this.backItem=new o.TextMenuItem("BACK"),this.backItem.selected.addListener(this.handleBackSelected);var i=[this.levelControlsHintItem,this.editorControlsHintItem,this.backItem];this.menu=new o.SceneMenu,this.menu.setItems(i),this.root.add(this.menu)},e.prototype.getLevelControlsHintText=function(){var t=this.inputHintSettings.getShowLevelHint(),e=" ";return null===t?e="?":t&&(e="+"),"GAMEPLAY CONTROLS HINT ["+e+"]"},e.prototype.getEditorControlsHintText=function(){var t=this.inputHintSettings.getShowEditorHint(),e=" ";return null===t?e="?":t&&(e="+"),"CONSTRUCT. CONTROLS HINT ["+e+"]"},e}(n(4).GameScene);e.SettingsInterfaceScene=s},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,r++)i[r]=o[s];return i};Object.defineProperty(e,"__esModule",{value:!0});var s,a=n(2),l=n(7),c=n(1),u=n(4),p=[{value:l.InputDeviceType.Keyboard,text:"KEYBOARD"},{value:l.InputDeviceType.Gamepad,text:"GAMEPAD"}],h=[l.InputControl.Up,l.InputControl.Down,l.InputControl.Left,l.InputControl.Right,l.InputControl.PrimaryAction,l.InputControl.SecondaryAction,l.InputControl.Select];!function(t){t[t.Navigation=0]="Navigation",t[t.WaitingInput=1]="WaitingInput"}(s||(s={}));var d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.state=s.Navigation,e.selectedControl=null,e.handleDeviceChanged=function(t){e.selectedDeviceType=t.value,e.updateMenu()},e.handleResetSelected=function(){e.getSelectedBinding().resetAllToDefault(),e.inputManager.saveBinding(e.selectedDeviceType),e.updateMenu()},e.handleBackSelected=function(){e.navigator.back()},e}return r(e,t),e.prototype.setup=function(t){var e=this;this.inputManager=t.inputManager,this.title=new a.SceneMenuTitle("SETTINGS → KEY BINDINGS"),this.title.position.set(112,96),this.root.add(this.title),this.deviceSelectorItem=new a.SelectorMenuItem(p),this.deviceSelectorItem.changed.addListener(this.handleDeviceChanged),this.topDividerItem=new a.DividerMenuItem({color:c.COLOR_GRAY}),this.botDividerItem=new a.DividerMenuItem({color:c.COLOR_GRAY}),this.bindingItems=h.map((function(t){var n=new a.TextMenuItem("",{color:c.COLOR_WHITE});return n.selected.addListener((function(){e.openModal(t)})),n})),this.resetItem=new a.TextMenuItem("RESET",{color:c.COLOR_WHITE}),this.resetItem.selected.addListener(this.handleResetSelected),this.backItem=new a.TextMenuItem("BACK",{color:c.COLOR_WHITE}),this.backItem.selected.addListener(this.handleBackSelected);var n=o([this.deviceSelectorItem],this.bindingItems,[this.botDividerItem,this.resetItem,this.backItem]);this.menu=new a.SceneMenu,this.menu.setItems(n),this.root.add(this.menu),this.modal=new a.InputButtonCaptureModal(this.root.size.width,this.root.size.height),this.modal.setVisible(!1),this.root.add(this.modal),p.length>0&&(this.selectedDeviceType=p[0].value,this.updateMenu())},e.prototype.update=function(e){if(this.state!==s.WaitingInput)t.prototype.update.call(this,e);else{var n=this.getSelectedDevice().getDownCodes();if(n.length>0){var i=n[0];this.updateBinding(this.selectedControl,i),this.updateMenu(),this.closeModal()}}},e.prototype.getSelectedBinding=function(){return this.inputManager.getBinding(this.selectedDeviceType)},e.prototype.getSelectedDevice=function(){return this.inputManager.getDevice(this.selectedDeviceType)},e.prototype.getSelectedPresenter=function(){return this.inputManager.getPresenter(this.selectedDeviceType)},e.prototype.openModal=function(t){this.selectedControl=t,this.state=s.WaitingInput,this.modal.setVisible(!0)},e.prototype.closeModal=function(){this.selectedControl=null,this.state=s.Navigation,this.modal.setVisible(!1),this.root.dirtyPaintBox()},e.prototype.updateMenu=function(){var t=this,e=this.getSelectedBinding(),n=this.getSelectedPresenter(),i=0;h.forEach((function(t){var e=l.InputControlPresenter.asString(t);e.length>i&&(i=e.length)})),h.forEach((function(r,o){var s=t.bindingItems[o],a=l.InputControlPresenter.asString(r).padEnd(i," "),c=e.get(r),u=a+" - "+n.asString(c);s.setText(u)}))},e.prototype.updateBinding=function(t,e){var n=this.getSelectedBinding(),i=n.get(t),r=n.getControl(e);null!==r&&n.setCustom(r,i),n.setCustom(t,e),this.inputManager.saveBinding(this.selectedDeviceType)},e}(u.GameScene);e.SettingsKeybindingScene=d},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),s=n(4),a=n(8),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handleKeybindingSelected=function(){e.navigator.push(a.GameSceneType.SettingsKeybinding)},e.handleAudioSelected=function(){e.navigator.push(a.GameSceneType.SettingsAudio)},e.handleInterfaceSelected=function(){e.navigator.push(a.GameSceneType.SettingsInterface)},e.handleBackSelected=function(){e.navigator.back()},e}return r(e,t),e.prototype.setup=function(){this.title=new o.SceneMenuTitle("SETTINGS"),this.root.add(this.title),this.keybindingItem=new o.TextMenuItem("KEY BINDINGS"),this.keybindingItem.selected.addListener(this.handleKeybindingSelected),this.audioItem=new o.TextMenuItem("AUDIO"),this.audioItem.selected.addListener(this.handleAudioSelected),this.interfaceItem=new o.TextMenuItem("INTERFACE"),this.interfaceItem.selected.addListener(this.handleInterfaceSelected),this.backItem=new o.TextMenuItem("BACK"),this.backItem.selected.addListener(this.handleBackSelected);var t=[this.keybindingItem,this.audioItem,this.interfaceItem,this.backItem];this.menu=new o.SceneMenu,this.menu.setItems(t),this.root.add(this.menu)},e}(s.GameScene);e.SettingsMenuScene=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(297))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(7),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.angle=0,e}return r(e,t),e.prototype.setup=function(t){var e=t.spriteLoader.load("tank.player.primary.a.up.1");this.parent=new o.GameObject(64,64),this.parent.painter=new o.SpritePainter(e),this.parent.position.set(200,200),this.root.add(this.parent)},e.prototype.update=function(e){e.input.isDown(s.InputControl.PrimaryAction)&&(this.parent.dirtyPaintBox(),this.parent.position.addX(100),this.parent.updateMatrix()),t.prototype.update.call(this,e)},e}(n(4).GameScene);e.SandboxTransformScene=a},function(t){t.exports=JSON.parse('{"fire":{"file":"data/audio/fire.mp3"},"game-over":{"file":"data/audio/game-over.mp3"},"highscore":{"file":"data/audio/high-score.mp3"},"hit.enemy":{"file":"data/audio/hit-enemy.mp3"},"hit.steel":{"file":"data/audio/hit-steel.mp3"},"hit.brick":{"file":"data/audio/hit-brick.mp3"},"ice":{"file":"data/audio/ice.mp3"},"level-intro":{"file":"data/audio/level-intro.mp3"},"life":{"file":"data/audio/life.mp3"},"tank.idle":{"file":"data/audio/tank-idle.mp3"},"tank.move":{"file":"data/audio/tank-move.mp3"},"pause":{"file":"data/audio/pause.mp3"},"powerup.spawn":{"file":"data/audio/powerup-appear.mp3"},"powerup.pickup":{"file":"data/audio/powerup-pickup.mp3"},"explosion.player":{"file":"data/audio/player-explosion.mp3"},"explosion.enemy":{"file":"data/audio/enemy-explosion.mp3"},"score":{"file":"data/audio/score.mp3"},"victory":{"file":"data/audio/victory.mp3"}}')},function(t){t.exports=JSON.parse('{"bullet.down":{"file":"data/graphics/sprite.png","rect":[1384,408,12,16]},"bullet.left":{"file":"data/graphics/sprite.png","rect":[1348,408,16,12]},"bullet.right":{"file":"data/graphics/sprite.png","rect":[1412,408,16,12]},"bullet.up":{"file":"data/graphics/sprite.png","rect":[1320,408,12,16]},"explosion.small.1":{"file":"data/graphics/sprite.png","rect":[1064,520,44,44]},"explosion.small.2":{"file":"data/graphics/sprite.png","rect":[1120,516,60,60]},"explosion.small.3":{"file":"data/graphics/sprite.png","rect":[1180,512,64,64]},"explosion.large.1":{"file":"data/graphics/sprite.png","rect":[1244,516,124,116]},"explosion.large.2":{"file":"data/graphics/sprite.png","rect":[1364,512,136,128]},"powerup.helmet":{"file":"data/graphics/sprite.png","rect":[1052,448,64,60]},"powerup.clock":{"file":"data/graphics/sprite.png","rect":[1116,448,64,60]},"powerup.shovel":{"file":"data/graphics/sprite.png","rect":[1180,448,64,60]},"powerup.star":{"file":"data/graphics/sprite.png","rect":[1244,448,64,60]},"powerup.grenade":{"file":"data/graphics/sprite.png","rect":[1308,448,64,60]},"powerup.tank":{"file":"data/graphics/sprite.png","rect":[1372,448,64,60]},"powerup.gun":{"file":"data/graphics/sprite.png","rect":[1436,448,64,60]},"points.100":{"file":"data/graphics/sprite.png","rect":[1184,656,56,28]},"points.200":{"file":"data/graphics/sprite.png","rect":[1248,656,56,28]},"points.300":{"file":"data/graphics/sprite.png","rect":[1312,656,56,28]},"points.400":{"file":"data/graphics/sprite.png","rect":[1376,656,56,28]},"points.500":{"file":"data/graphics/sprite.png","rect":[1440,656,56,28]},"ui.enemy":{"file":"data/graphics/sprite.png","rect":[1308,768,32,32]},"ui.player":{"file":"data/graphics/sprite.png","rect":[1536,576,28,32]},"ui.pause":{"file":"data/graphics/sprite.png","rect":[1184,704,156,28]},"ui.gameOver":{"file":"data/graphics/sprite.png","rect":[1184,736,124,60]},"flag":{"file":"data/graphics/sprite.png","rect":[1532,736,64,60]},"shield.1":{"file":"data/graphics/sprite.png","rect":[1052,576,64,64]},"shield.2":{"file":"data/graphics/sprite.png","rect":[1116,576,64,64]},"base.heart.alive":{"file":"data/graphics/sprite.png","rect":[1244,128,64,64]},"base.heart.dead":{"file":"data/graphics/sprite.png","rect":[1308,128,64,64]},"spawn.1":{"file":"data/graphics/sprite.png","rect":[1064,396,36,36]},"spawn.2":{"file":"data/graphics/sprite.png","rect":[1124,392,44,44]},"spawn.3":{"file":"data/graphics/sprite.png","rect":[1184,388,52,52]},"spawn.4":{"file":"data/graphics/sprite.png","rect":[1244,384,60,60]},"terrain.brick.1":{"file":"data/graphics/sprite.png","rect":[1052,0,16,16]},"terrain.brick.2":{"file":"data/graphics/sprite.png","rect":[1068,0,16,16]},"terrain.steel":{"file":"data/graphics/sprite.png","rect":[1052,64,32,32]},"terrain.jungle":{"file":"data/graphics/sprite.png","rect":[1116,128,32,32]},"terrain.water.1":{"file":"data/graphics/sprite.png","rect":[1052,192,32,32]},"terrain.water.2":{"file":"data/graphics/sprite.png","rect":[1116,192,32,32]},"terrain.ice":{"file":"data/graphics/sprite.png","rect":[1180,128,32,32]},"terrain.menu-brick.1":{"file":"data/graphics/menu-brick.png","rect":[0,0,16,16]},"terrain.menu-brick.2":{"file":"data/graphics/menu-brick.png","rect":[16,0,16,16]},"terrain.inverse-brick.1":{"file":"data/graphics/inverse-brick.png","rect":[0,0,16,16]},"terrain.inverse-brick.2":{"file":"data/graphics/inverse-brick.png","rect":[16,0,16,16]},"terrain.blue-brick.1":{"file":"data/graphics/blue-brick.png","rect":[0,0,16,16]},"terrain.blue-brick.2":{"file":"data/graphics/blue-brick.png","rect":[16,0,16,16]},"tank.enemy.default.a.up.1":{"file":"data/graphics/sprite.png","rect":[524,264,52,60]},"tank.enemy.default.a.up.2":{"file":"data/graphics/sprite.png","rect":[588,264,52,60]},"tank.enemy.default.a.down.1":{"file":"data/graphics/sprite.png","rect":[780,264,52,60]},"tank.enemy.default.a.down.2":{"file":"data/graphics/sprite.png","rect":[844,264,52,60]},"tank.enemy.default.a.left.1":{"file":"data/graphics/sprite.png","rect":[648,272,60,52]},"tank.enemy.default.a.left.2":{"file":"data/graphics/sprite.png","rect":[712,272,60,52]},"tank.enemy.default.a.right.1":{"file":"data/graphics/sprite.png","rect":[908,268,60,52]},"tank.enemy.default.a.right.2":{"file":"data/graphics/sprite.png","rect":[972,268,60,52]},"tank.enemy.default.b.up.1":{"file":"data/graphics/sprite.png","rect":[524,328,52,60]},"tank.enemy.default.b.up.2":{"file":"data/graphics/sprite.png","rect":[588,328,52,60]},"tank.enemy.default.b.down.1":{"file":"data/graphics/sprite.png","rect":[780,332,52,60]},"tank.enemy.default.b.down.2":{"file":"data/graphics/sprite.png","rect":[844,332,52,60]},"tank.enemy.default.b.left.1":{"file":"data/graphics/sprite.png","rect":[648,336,60,52]},"tank.enemy.default.b.left.2":{"file":"data/graphics/sprite.png","rect":[712,336,60,52]},"tank.enemy.default.b.right.1":{"file":"data/graphics/sprite.png","rect":[908,332,60,52]},"tank.enemy.default.b.right.2":{"file":"data/graphics/sprite.png","rect":[972,332,60,52]},"tank.enemy.default.c.up.1":{"file":"data/graphics/sprite.png","rect":[524,396,52,60]},"tank.enemy.default.c.up.2":{"file":"data/graphics/sprite.png","rect":[588,396,52,60]},"tank.enemy.default.c.down.1":{"file":"data/graphics/sprite.png","rect":[776,396,52,60]},"tank.enemy.default.c.down.2":{"file":"data/graphics/sprite.png","rect":[840,396,52,60]},"tank.enemy.default.c.left.1":{"file":"data/graphics/sprite.png","rect":[648,404,60,52]},"tank.enemy.default.c.left.2":{"file":"data/graphics/sprite.png","rect":[712,404,60,52]},"tank.enemy.default.c.right.1":{"file":"data/graphics/sprite.png","rect":[908,400,60,52]},"tank.enemy.default.c.right.2":{"file":"data/graphics/sprite.png","rect":[972,400,60,52]},"tank.enemy.default.d.up.1":{"file":"data/graphics/sprite.png","rect":[524,460,52,60]},"tank.enemy.default.d.up.2":{"file":"data/graphics/sprite.png","rect":[588,460,52,60]},"tank.enemy.default.d.down.1":{"file":"data/graphics/sprite.png","rect":[780,460,52,60]},"tank.enemy.default.d.down.2":{"file":"data/graphics/sprite.png","rect":[844,460,52,60]},"tank.enemy.default.d.left.1":{"file":"data/graphics/sprite.png","rect":[648,464,60,52]},"tank.enemy.default.d.left.2":{"file":"data/graphics/sprite.png","rect":[712,464,60,52]},"tank.enemy.default.d.right.1":{"file":"data/graphics/sprite.png","rect":[904,464,60,52]},"tank.enemy.default.d.right.2":{"file":"data/graphics/sprite.png","rect":[968,464,60,52]},"tank.enemy.danger.a.up.1":{"file":"data/graphics/sprite.png","rect":[524,788,52,60]},"tank.enemy.danger.a.up.2":{"file":"data/graphics/sprite.png","rect":[588,788,52,60]},"tank.enemy.danger.a.down.1":{"file":"data/graphics/sprite.png","rect":[780,788,52,60]},"tank.enemy.danger.a.down.2":{"file":"data/graphics/sprite.png","rect":[844,788,52,60]},"tank.enemy.danger.a.left.1":{"file":"data/graphics/sprite.png","rect":[648,796,60,52]},"tank.enemy.danger.a.left.2":{"file":"data/graphics/sprite.png","rect":[712,796,60,52]},"tank.enemy.danger.a.right.1":{"file":"data/graphics/sprite.png","rect":[908,792,60,52]},"tank.enemy.danger.a.right.2":{"file":"data/graphics/sprite.png","rect":[972,792,60,52]},"tank.enemy.danger.b.up.1":{"file":"data/graphics/sprite.png","rect":[524,852,52,60]},"tank.enemy.danger.b.up.2":{"file":"data/graphics/sprite.png","rect":[588,852,52,60]},"tank.enemy.danger.b.down.1":{"file":"data/graphics/sprite.png","rect":[780,856,52,60]},"tank.enemy.danger.b.down.2":{"file":"data/graphics/sprite.png","rect":[844,856,52,60]},"tank.enemy.danger.b.left.1":{"file":"data/graphics/sprite.png","rect":[648,860,60,52]},"tank.enemy.danger.b.left.2":{"file":"data/graphics/sprite.png","rect":[712,860,60,52]},"tank.enemy.danger.b.right.1":{"file":"data/graphics/sprite.png","rect":[908,856,60,52]},"tank.enemy.danger.b.right.2":{"file":"data/graphics/sprite.png","rect":[972,856,60,52]},"tank.enemy.danger.c.up.1":{"file":"data/graphics/sprite.png","rect":[524,920,52,60]},"tank.enemy.danger.c.up.2":{"file":"data/graphics/sprite.png","rect":[588,920,52,60]},"tank.enemy.danger.c.down.1":{"file":"data/graphics/sprite.png","rect":[776,920,52,60]},"tank.enemy.danger.c.down.2":{"file":"data/graphics/sprite.png","rect":[840,920,52,60]},"tank.enemy.danger.c.left.1":{"file":"data/graphics/sprite.png","rect":[648,928,60,52]},"tank.enemy.danger.c.left.2":{"file":"data/graphics/sprite.png","rect":[712,928,60,52]},"tank.enemy.danger.c.right.1":{"file":"data/graphics/sprite.png","rect":[908,924,60,52]},"tank.enemy.danger.c.right.2":{"file":"data/graphics/sprite.png","rect":[972,924,60,52]},"tank.enemy.danger.d.up.1":{"file":"data/graphics/sprite.png","rect":[524,984,52,60]},"tank.enemy.danger.d.up.2":{"file":"data/graphics/sprite.png","rect":[588,984,52,60]},"tank.enemy.danger.d.down.1":{"file":"data/graphics/sprite.png","rect":[780,984,52,60]},"tank.enemy.danger.d.down.2":{"file":"data/graphics/sprite.png","rect":[844,984,52,60]},"tank.enemy.danger.d.left.1":{"file":"data/graphics/sprite.png","rect":[648,988,60,52]},"tank.enemy.danger.d.left.2":{"file":"data/graphics/sprite.png","rect":[712,988,60,52]},"tank.enemy.danger.d.right.1":{"file":"data/graphics/sprite.png","rect":[904,988,60,52]},"tank.enemy.danger.d.right.2":{"file":"data/graphics/sprite.png","rect":[968,988,60,52]},"tank.enemy.primary.d.up.1":{"file":"data/graphics/sprite.png","rect":[4,460,52,60]},"tank.enemy.primary.d.up.2":{"file":"data/graphics/sprite.png","rect":[68,460,52,60]},"tank.enemy.primary.d.down.1":{"file":"data/graphics/sprite.png","rect":[264,460,52,60]},"tank.enemy.primary.d.down.2":{"file":"data/graphics/sprite.png","rect":[328,460,52,60]},"tank.enemy.primary.d.left.1":{"file":"data/graphics/sprite.png","rect":[128,464,60,52]},"tank.enemy.primary.d.left.2":{"file":"data/graphics/sprite.png","rect":[196,464,60,52]},"tank.enemy.primary.d.right.1":{"file":"data/graphics/sprite.png","rect":[388,464,60,52]},"tank.enemy.primary.d.right.2":{"file":"data/graphics/sprite.png","rect":[456,464,60,52]},"tank.enemy.secondary.d.up.1":{"file":"data/graphics/sprite.png","rect":[4,984,52,60]},"tank.enemy.secondary.d.up.2":{"file":"data/graphics/sprite.png","rect":[68,984,52,60]},"tank.enemy.secondary.d.down.1":{"file":"data/graphics/sprite.png","rect":[264,984,52,60]},"tank.enemy.secondary.d.down.2":{"file":"data/graphics/sprite.png","rect":[328,984,52,60]},"tank.enemy.secondary.d.left.1":{"file":"data/graphics/sprite.png","rect":[128,988,60,52]},"tank.enemy.secondary.d.left.2":{"file":"data/graphics/sprite.png","rect":[196,988,60,52]},"tank.enemy.secondary.d.right.1":{"file":"data/graphics/sprite.png","rect":[388,988,60,52]},"tank.enemy.secondary.d.right.2":{"file":"data/graphics/sprite.png","rect":[456,988,60,52]},"tank.player.primary.a.up.1":{"file":"data/graphics/sprite.png","rect":[4,8,52,52]},"tank.player.primary.a.up.2":{"file":"data/graphics/sprite.png","rect":[68,8,52,52]},"tank.player.primary.a.down.1":{"file":"data/graphics/sprite.png","rect":[264,4,52,52]},"tank.player.primary.a.down.2":{"file":"data/graphics/sprite.png","rect":[328,4,52,52]},"tank.player.primary.a.left.1":{"file":"data/graphics/sprite.png","rect":[136,4,52,52]},"tank.player.primary.a.left.2":{"file":"data/graphics/sprite.png","rect":[204,4,52,52]},"tank.player.primary.a.right.1":{"file":"data/graphics/sprite.png","rect":[392,4,52,52]},"tank.player.primary.a.right.2":{"file":"data/graphics/sprite.png","rect":[460,4,52,52]},"tank.player.primary.b.up.1":{"file":"data/graphics/sprite.png","rect":[4,64,52,64]},"tank.player.primary.b.up.2":{"file":"data/graphics/sprite.png","rect":[68,64,52,64]},"tank.player.primary.b.down.1":{"file":"data/graphics/sprite.png","rect":[264,64,52,64]},"tank.player.primary.b.down.2":{"file":"data/graphics/sprite.png","rect":[328,64,52,64]},"tank.player.primary.b.left.1":{"file":"data/graphics/sprite.png","rect":[128,68,64,52]},"tank.player.primary.b.left.2":{"file":"data/graphics/sprite.png","rect":[196,68,64,52]},"tank.player.primary.b.right.1":{"file":"data/graphics/sprite.png","rect":[388,68,64,52]},"tank.player.primary.b.right.2":{"file":"data/graphics/sprite.png","rect":[456,68,64,52]},"tank.player.primary.c.up.1":{"file":"data/graphics/sprite.png","rect":[4,132,52,60]},"tank.player.primary.c.up.2":{"file":"data/graphics/sprite.png","rect":[68,132,52,60]},"tank.player.primary.c.down.1":{"file":"data/graphics/sprite.png","rect":[264,136,52,60]},"tank.player.primary.c.down.2":{"file":"data/graphics/sprite.png","rect":[328,136,52,60]},"tank.player.primary.c.left.1":{"file":"data/graphics/sprite.png","rect":[128,136,60,52]},"tank.player.primary.c.left.2":{"file":"data/graphics/sprite.png","rect":[196,136,60,52]},"tank.player.primary.c.right.1":{"file":"data/graphics/sprite.png","rect":[392,136,60,52]},"tank.player.primary.c.right.2":{"file":"data/graphics/sprite.png","rect":[460,136,60,52]},"tank.player.primary.d.up.1":{"file":"data/graphics/sprite.png","rect":[4,200,56,60]},"tank.player.primary.d.up.2":{"file":"data/graphics/sprite.png","rect":[68,200,56,60]},"tank.player.primary.d.down.1":{"file":"data/graphics/sprite.png","rect":[264,200,56,60]},"tank.player.primary.d.down.2":{"file":"data/graphics/sprite.png","rect":[328,200,56,60]},"tank.player.primary.d.left.1":{"file":"data/graphics/sprite.png","rect":[128,204,60,56]},"tank.player.primary.d.left.2":{"file":"data/graphics/sprite.png","rect":[196,204,60,56]},"tank.player.primary.d.right.1":{"file":"data/graphics/sprite.png","rect":[392,204,60,56]},"tank.player.primary.d.right.2":{"file":"data/graphics/sprite.png","rect":[460,204,60,56]}}')},function(t){t.exports=JSON.parse('{"file":"data/fonts/sprite-font.png","characterSet":"ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890-ⅠⅡ←→[]?()/+.↑↓","characterWidth":28,"characterHeight":28,"rowCount":6,"columnCount":10,"horizontalSpacing":4,"verticalSpacing":4,"offsetX":0,"offsetY":0}')},function(t){t.exports=JSON.parse('{"fillSymbol":"o","emptySymbol":"-","characterWidth":7,"characterHeight":7,"characterSet":"ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890","characters":[["--ooo--","-oo-oo-","oo---oo","oo---oo","ooooooo","oo---oo","oo---oo"],["oooooo-","oo---oo","oo---oo","oooooo-","oo---oo","oo---oo","oooooo-"],["--oooo-","-oo--oo","oo-----","oo-----","oo-----","-oo--oo","--oooo-"],["ooooo--","oo--oo-","oo---oo","oo---oo","oo---oo","oo--oo-","ooooo--"],["-oooooo","-oo----","-oo----","-ooooo-","-oo----","-oo----","-oooooo"],["-oooooo","-oo----","-oo----","-ooooo-","-oo----","-oo----","-oo----"],["--ooooo","-oo----","oo-----","oo--ooo","oo---oo","-oo--oo","--ooooo"],["-oo--oo","-oo--oo","-oo--oo","-oooooo","-oo--oo","-oo--oo","-oo--oo"],["-oooooo","---oo--","---oo--","---oo--","---oo--","---oo--","-oooooo"],["-----oo","-----oo","-----oo","-----oo","-----oo","oo---oo","-ooooo-"],["oo---oo","oo--oo-","oo-oo--","oooo---","ooooo--","oo--oo-","oo---oo"],["-oo----","-oo----","-oo----","-oo----","-oo----","-oo----","-oooooo"],["oo---oo","ooo-ooo","ooooooo","ooooooo","oo-o-oo","oo---oo","oo---oo"],["oo---oo","ooo--oo","oooo-oo","ooooooo","oo-oooo","oo--ooo","oo---oo"],["-ooooo-","oo---oo","oo---oo","oo---oo","oo---oo","oo---oo","-ooooo-"],["oooooo-","oo---oo","oo---oo","oo---oo","oooooo-","oo-----","oo-----"],["-ooooo-","oo---oo","oo---oo","oo---oo","oo-oooo","oo--oo-","-oooo-o"],["oooooo-","oo---oo","oo---oo","oo--ooo","ooooo--","oo-ooo-","oo--ooo"],["-oooo--","oo--oo-","oo-----","-ooooo-","-----oo","oo---oo","-ooooo-"],["-oooooo","---oo--","---oo--","---oo--","---oo--","---oo--","---oo--"],["oo---oo","oo---oo","oo---oo","oo---oo","oo---oo","oo---oo","-ooooo-"],["oo---oo","oo---oo","oo---oo","ooo-ooo","-ooooo-","--ooo--","---o---"],["oo---oo","oo---oo","oo-o-oo","ooooooo","ooooooo","ooo-ooo","oo---oo"],["oo---oo","ooo-ooo","-ooooo-","--ooo--","-ooooo-","ooo-ooo","oo---oo"],["-oo--oo","-oo--oo","-oo--oo","--oooo-","---oo--","---oo--","---oo--"],["ooooooo","----ooo","---ooo-","--ooo--","-ooo---","ooo----","ooooooo"],["---oo--","--ooo--","---oo--","---oo--","---oo--","---oo--","-oooooo"],["-ooooo-","oo---oo","----ooo","--oooo-","-oooo--","ooo----","ooooooo"],["-oooooo","----oo-","---oo--","--oooo-","-----oo","oo---oo","-ooooo-"],["---ooo-","--oooo-","-oo-oo-","oo--oo-","ooooooo","----oo-","----oo-"],["oooooo-","oo-----","oooooo-","-----oo","-----oo","oo---oo","-ooooo-"],["--ooo--","-oo----","oo-----","oooooo-","oo---oo","oo---oo","-ooooo-"],["ooooooo","oo---oo","----oo-","---oo--","--oo---","--oo---","--oo---"],["-oooo--","oo---o-","ooo--o-","-oooo--","o--oooo","o----oo","-ooooo-"],["-ooooo-","oo---oo","oo---oo","-oooooo","-----oo","----oo-","-oooo--"],["--ooo--","-o--oo-","oo---oo","oo---oo","oo---oo","-oo--o-","--ooo--"]]}')},function(t){t.exports=JSON.parse('{"list":[{"file":"data/maps/original/01.json"},{"file":"data/maps/original/02.json"},{"file":"data/maps/original/03.json"},{"file":"data/maps/original/04.json"},{"file":"data/maps/original/05.json"},{"file":"data/maps/original/06.json"},{"file":"data/maps/original/07.json"},{"file":"data/maps/original/08.json"},{"file":"data/maps/original/09.json"},{"file":"data/maps/original/10.json"},{"file":"data/maps/original/11.json"},{"file":"data/maps/original/12.json"},{"file":"data/maps/original/13.json"},{"file":"data/maps/original/14.json"},{"file":"data/maps/original/15.json"},{"file":"data/maps/original/16.json"},{"file":"data/maps/original/17.json"},{"file":"data/maps/original/18.json"},{"file":"data/maps/original/19.json"},{"file":"data/maps/original/20.json"},{"file":"data/maps/original/21.json"},{"file":"data/maps/original/22.json"},{"file":"data/maps/original/23.json"},{"file":"data/maps/original/24.json"},{"file":"data/maps/original/25.json"},{"file":"data/maps/original/26.json"},{"file":"data/maps/original/27.json"},{"file":"data/maps/original/28.json"},{"file":"data/maps/original/29.json"},{"file":"data/maps/original/30.json"},{"file":"data/maps/original/31.json"},{"file":"data/maps/original/32.json"},{"file":"data/maps/original/33.json"},{"file":"data/maps/original/34.json"},{"file":"data/maps/original/35.json"}]}')}]);